var e=Object.defineProperty,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(l,r,t)=>r in l?e(l,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[r]=t,a=(e,a)=>{for(var i in a||(a={}))r.call(a,i)&&o(e,i,a[i]);if(l)for(var i of l(a))t.call(a,i)&&o(e,i,a[i]);return e};import{d as i,z as u,b as n,r as d,o as s,h as m,g as p,f as c,u as f,q as _,x as b,F as g,y,L as v,a as F,w as k,s as h,ah as V,c as x,t as w,i as C,a8 as U,k as D}from"./vendor.107e8656.js";import{d as S,e as q,f as E,g as R}from"./buzz.8d52d7c1.js";import{m as j}from"./message.96b00d49.js";import"./index.d19719a5.js";const A=y("添加"),O=y("删除"),P={slot:"footer",class:"dialog-footer mt-10"},N=y("清 空"),I=y("确 定"),M=i({props:{msg:{require:!0,default:"",type:Array}},emits:["kk","up"],setup(e,{emit:l}){const r="此项必填";const t=e=>{let l=new RegExp(/\n+/),r=new RegExp(/[\S]+/),t=e.split(l),o=!0,a=[];return t.forEach(((e,l)=>{if(e&&r.test(e)){let l=e.trim().split(/\s+/);if(2===l.length){let e={diy_siteid:l[0],weight:l[1]};a.push(e)}else o=!1}else o=!1})),o?a:[]};let o=u({siteData:e.msg,siteRules:{site:[{required:!0,validator:(e,l,o)=>{if(""!==l){o(t(l)?void 0:new Error("格式错误！"))}else o(new Error(r))},trigger:"blur"}]},siteRuleForm:{site:""}});const a=()=>{o.siteData=[...t(o.siteRuleForm.site)]},i=()=>{o.siteData=[]},y=()=>{l("kk",o.siteData)};return n((()=>{})),(e,l)=>{const r=d("el-input"),t=d("el-form-item"),u=d("el-button"),n=d("el-form"),v=d("el-table-column"),F=d("el-table");return s(),m(g,null,[p(n,{enctype:"multipart/form-data",ref:(e,l)=>{l.siteRuleForm=e},rules:f(o).siteRules,model:f(o).siteRuleForm,"label-position":"right"},{default:c((()=>[p(t,{label:"diy_siteid:",prop:"site"},{default:c((()=>[p(r,{class:"w100",type:"textarea",modelValue:f(o).siteRuleForm.site,"onUpdate:modelValue":l[0]||(l[0]=e=>f(o).siteRuleForm.site=e),rows:4,placeholder:""},null,8,["modelValue"])])),_:1}),p(t,null,{default:c((()=>[p(u,{type:"primary",onClick:a},{default:c((()=>[A])),_:1})])),_:1})])),_:1},8,["rules","model"]),p(F,{data:f(o).siteData},{default:c((()=>[p(v,{align:"center",property:"diy_siteid",label:"diy_siteid"}),p(v,{align:"center",property:"weight",label:"权重"}),p(v,{align:"center",label:"操作"},{default:c((e=>[p(u,{type:"danger",onClick:l=>{return e.row,r=e.$index,void o.siteData.splice(r,1);var r}},{default:c((()=>[O])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),_("span",P,[b(' <el-button @click="cancleDevice">取 消</el-button> '),p(u,{type:"primary",onClick:i},{default:c((()=>[N])),_:1}),p(u,{type:"primary",onClick:y},{default:c((()=>[I])),_:1})])],64)}}}),L={class:"content-con flex column"},z={class:"flex flex-start form-one radio-box"},T=["textContent"],$={class:"form-one flex jc-start"},H=y("CPI"),B=y("CPA"),K={class:"flex ai-center"},G=["textContent"],J=y("% "),Q=_("span",null,"-",-1),W=["textContent"],X=y("% （"),Y=_("span",null,"总设备数:",-1),Z=["textContent"],ee=y("） （"),le=_("span",null,"选中设备数:",-1),re=["textContent"],te=y("） "),oe={class:"flex flex-start form-one p10 pt-0 pb-0"},ae={class:"flex jc-start form-one"},ie={class:"flex form-one flex-start radio-box"},ue=y("Slot_ID"),ne=y("Update(Hours)"),de={class:"flex jc-start form-one flex-start radio-box"},se=y("Real"),me=y("Virtual"),pe={class:"w100 flex"},ce=y("Save"),fe=i({setup(e){let{proxy:l}=D();const r=v(),t="此项必填";let o=F(0),i=F([0,100]),y=u({dialogVisible:!1,dialogVisibleSite:!1,search:{id:"",baseDeviceSelect:{},deviceData:{all:[],select:[],count:0}},type:"1",params:"",loading:!0,options:{channel:[],attribute_provider:["AppsFlyer","Branch","Adjust","Singular","AppMetrica"],time:[-1,...[...new Array(24)].map(((e,l)=>l))],platform:[{value:"1",label:"Android"},{value:"2",label:"iOS"}],country:[],site_id:["0.2","0.4","0.6","1","2","4","8","24","72","168"],category:[],devices:[]},ruleForm:{type:"",id:"",operation_type:"",offer_id:"",channel:"",copy_offer:"",attribute_provider:"AppsFlyer",title:"",tracking_link:"",pkg_name:"",conversion_flow:"",event_name:"",payout:"",platform:"",country:"",max_clk_num:"",site_clk_limit:"0",site_install_limitation:"0",start_hour:"-1",end_hour:"-1",device:[],cutoff_start:"",cutoff_end:"",diy_siteid:[],site_id:"",hour:"",clk_id:"",site_clk_id:"",note:""},rules:{channel:[{required:!0,message:t,trigger:["blur","change"]}],attribute_provider:[{required:!0,message:t,trigger:["blur","change"]}],title:[{required:!0,message:t,trigger:["blur","change"]}],tracking_link:[{required:!0,message:t,trigger:["blur","change"]},{validator:(e,l,r)=>{let t=/^http/;new RegExp("\\s+","g").test(l)?r(new Error("链接中有空格")):t.test(l)?"AppsFlyer"===y.ruleForm.attribute_provider?l.includes(y.ruleForm.pkg_name)?r(void 0):r(new Error("Attribute Provider:为Appsflyer时Package Name的值必须包含在Traking Link中")):r(void 0):r(new Error("请以http开头")),r(void 0)}}],pkg_name:[{required:!0,message:t,trigger:["blur","change"]},{validator:(e,l,r)=>{"AppsFlyer"===y.ruleForm.attribute_provider?y.ruleForm.tracking_link.includes(y.ruleForm.pkg_name)?r(void 0):r(new Error("Attribute Provider:为Appsflyer时Package Name的值必须包含在Traking Link中")):r(void 0)}}],conversion_flow:[{required:!0,message:t,trigger:["blur","change"]}],event_name:[{required:!0,message:t,trigger:["blur","change"]},{validator:(e,l,r)=>{"1"===y.ruleForm.conversion_flow?r(void 0):r(l?void 0:new Error(t))}}],payout:[{required:!0,message:t,trigger:["blur","change"]}],platform:[{required:!0,message:t,trigger:["blur","change"]}],country:[{required:!0,message:t,trigger:["blur","change"]}],max_clk_num:[{required:!0,message:t,trigger:["blur","change"]}],device:[{required:!0,validator:(e,l,r)=>{r(void 0)},trigger:["blur","change"]}],site_id:[{required:!0,validator:(e,l,r)=>{l?"1"===l||y.ruleForm.hour?r(void 0):r(new Error("请选择具体数值")):r(new Error(t))},trigger:["blur","change"]}],clk_id:[{required:!0,message:t,trigger:["blur","change"]}],start_hour:[{required:!1,validator:(e,l,r)=>{""!==l&&(""===y.ruleForm.end_hour?r(new Error(t)):r(void 0))},trigger:["blur","change"]}],end_hour:[{required:!1,validator:(e,l,r)=>{""!==l&&(""===y.ruleForm.start_hour?r(new Error(t)):r(void 0))},trigger:["blur","change"]}],cutoff_start:[{required:!0,trigger:["blur","change"]}],cutoff_end:[{required:!0,trigger:["blur","change"]}]},siteData:[]});const A=()=>{y.dialogVisibleSite=!0;const e=y.ruleForm.diy_siteid?y.ruleForm.diy_siteid:[];y.siteData=e},O=()=>{P("ruleForm")},P=e=>{l.$refs[e].validate((e=>{if(!e)return!1;N()}))},N=async()=>{const e=await S(y.ruleForm);j(e)&&l.$router.push({path:"/adnetwork/buzz"})},I=e=>{y.ruleForm.diy_siteid=e,y.dialogVisibleSite=!1};k(i,((e,l)=>{(e=>{y.ruleForm.cutoff_start=(e[0]/100).toString(),y.ruleForm.cutoff_end=(e[1]/100).toString()})(e)}),{immediate:!0});const fe=h((()=>{const e=o.value,l=y.ruleForm.cutoff_start,r=y.ruleForm.cutoff_end;return{judge:((Number(r)-Number(l))*Number(e)).toFixed(0),all:Number(e).toFixed(0)}})),_e=async e=>{const l=await R(e),{data:r}=l;return 0!==r.length?r[0].device_num:0};V((()=>{(async()=>{const e=y.ruleForm.pkg_name,l=y.ruleForm.country,r=y.ruleForm.platform,t={pkg_name:e,country:l,platform:r};if(e&&l&&r){const e=await _e(t);o.value=e}})()}));const be=async()=>{const e={id:r.currentRoute.value.params.id},l=await E(e),{data:t}=l;y.ruleForm=((e,l)=>{let r={};"2"===l.type&&(r.id=e.id,r.offer_id=e.offer_id),r=a(a({},e),l);let t=null===e.diy_siteid||""===e.diy_siteid?[]:e.diy_siteid;return y.siteData=t,r})(t[0],{type:y.ruleForm.type,isCopy:!1}),i.value=[100*Number(y.ruleForm.cutoff_start),100*Number(y.ruleForm.cutoff_end)]};return n((()=>{(async()=>{const e=await q(),{data:l}=e;y.options.channel=Object.values(l.channel),y.options.country=Object.values(l.country)})();const e=r.currentRoute.value.name;"create"===e&&(y.ruleForm.operation_type="1",y.ruleForm.type="1"),"edit"===e&&(y.ruleForm.operation_type="2",y.ruleForm.type="2",be())})),(e,l)=>{const r=d("el-form-item"),t=d("el-option"),o=d("el-select"),a=d("el-input"),u=d("el-radio"),n=d("el-slider"),v=d("el-button"),F=d("el-form"),k=d("el-dialog");return s(),m(g,null,[b(" form "),p(F,{enctype:"multipart/form-data",ref:(e,l)=>{l.ruleForm=e},rules:f(y).rules,model:f(y).ruleForm,"label-width":"240px","label-position":"right"},{default:c((()=>[_("div",L,[b(" offer_id "),"2"===f(y).type?(s(),x(r,{key:0,label:"Offer ID:",prop:"offer_id"},{default:c((()=>[_("div",z,[_("span",{textContent:w(f(y).ruleForm.offer_id)},null,8,T)])])),_:1})):b("v-if",!0),b(" channel "),p(r,{label:"Channel:",prop:"channel"},{default:c((()=>[p(o,{filterable:"",class:"form-one",modelValue:f(y).ruleForm.channel,"onUpdate:modelValue":l[0]||(l[0]=e=>f(y).ruleForm.channel=e),clearable:"",placeholder:""},{default:c((()=>[(s(!0),m(g,null,C(f(y).options.channel,(e=>(s(),x(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(" copy_offer "),b(' <el-form-item label="Copy Offer:" prop="copy_offer">\n        <el-input class=\'form-one copy-btn search-input\' placeholder="" v-model.trim="data.ruleForm.copy_offer">\n          <el-button type="primary" slot="append" icon="el-icon-search" @click=\'copyFun\'></el-button>\n        </el-input>\n      </el-form-item> '),b(" attribute_provider "),p(r,{label:"Attribute Provider:",prop:"attribute_provider"},{default:c((()=>[p(o,{filterable:"",class:"form-one",modelValue:f(y).ruleForm.attribute_provider,"onUpdate:modelValue":l[1]||(l[1]=e=>f(y).ruleForm.attribute_provider=e),clearable:"",placeholder:""},{default:c((()=>[(s(!0),m(g,null,C(f(y).options.attribute_provider,(e=>(s(),x(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(" title "),p(r,{label:"Offer Title:",prop:"title"},{default:c((()=>[p(a,{class:"form-one",type:"text",modelValue:f(y).ruleForm.title,"onUpdate:modelValue":l[2]||(l[2]=e=>f(y).ruleForm.title=e),modelModifiers:{trim:!0},placeholder:""},null,8,["modelValue"])])),_:1}),b(" tracking_link "),b(" 此处需要去除空格和制表符 "),p(r,{class:"mb-30",label:"Traking Link:",prop:"tracking_link"},{default:c((()=>[p(a,{class:"form-one",type:"textarea",modelValue:f(y).ruleForm.tracking_link,"onUpdate:modelValue":l[3]||(l[3]=e=>f(y).ruleForm.tracking_link=e),modelModifiers:{trim:!0},autosize:{minRows:8,maxRows:80},placeholder:""},null,8,["modelValue"])])),_:1}),b(" pkg_name "),p(r,{label:"Package Name:",prop:"pkg_name"},{default:c((()=>[p(a,{class:"form-one",type:"text",modelValue:f(y).ruleForm.pkg_name,"onUpdate:modelValue":l[4]||(l[4]=e=>f(y).ruleForm.pkg_name=e),modelModifiers:{trim:!0},placeholder:""},null,8,["modelValue"])])),_:1}),b(" conversion_flow_type "),p(r,{label:"Conversion Flow:",prop:"conversion_flow"},{default:c((()=>[_("div",$,[p(u,{modelValue:f(y).ruleForm.conversion_flow,"onUpdate:modelValue":l[5]||(l[5]=e=>f(y).ruleForm.conversion_flow=e),label:"1"},{default:c((()=>[H])),_:1},8,["modelValue"]),p(u,{modelValue:f(y).ruleForm.conversion_flow,"onUpdate:modelValue":l[6]||(l[6]=e=>f(y).ruleForm.conversion_flow=e),label:"2"},{default:c((()=>[B])),_:1},8,["modelValue"])])])),_:1}),b(" conversion_flow "),"2"===f(y).ruleForm.conversion_flow?(s(),x(r,{key:1,label:"Event Name:",prop:"event_name"},{default:c((()=>[p(a,{class:"form-one",type:"text",modelValue:f(y).ruleForm.event_name,"onUpdate:modelValue":l[7]||(l[7]=e=>f(y).ruleForm.event_name=e),modelModifiers:{trim:!0},placeholder:""},null,8,["modelValue"])])),_:1})):b("v-if",!0),b(" payout "),p(r,{label:"Payout($):",prop:"payout"},{default:c((()=>[p(a,{class:"form-one",type:"text",modelValue:f(y).ruleForm.payout,"onUpdate:modelValue":l[8]||(l[8]=e=>f(y).ruleForm.payout=e),modelModifiers:{trim:!0},placeholder:""},null,8,["modelValue"])])),_:1}),b(" platform "),p(r,{label:"Select Platform:",prop:"platform"},{default:c((()=>[p(o,{filterable:"",class:"form-one",modelValue:f(y).ruleForm.platform,"onUpdate:modelValue":l[9]||(l[9]=e=>f(y).ruleForm.platform=e),clearable:"",placeholder:""},{default:c((()=>[(s(!0),m(g,null,C(f(y).options.platform,(e=>(s(),x(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(" country "),p(r,{label:"Targeting Countries:",prop:"country"},{default:c((()=>[p(o,{filterable:"",class:"form-one",modelValue:f(y).ruleForm.country,"onUpdate:modelValue":l[10]||(l[10]=e=>f(y).ruleForm.country=e),clearable:"",placeholder:""},{default:c((()=>[(s(!0),m(g,null,C(f(y).options.country,(e=>(s(),x(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(" max_clk_num "),p(r,{label:"Click Limitation(w):",prop:"max_clk_num"},{default:c((()=>[p(a,{class:"form-one",type:"text",modelValue:f(y).ruleForm.max_clk_num,"onUpdate:modelValue":l[11]||(l[11]=e=>f(y).ruleForm.max_clk_num=e),modelModifiers:{trim:!0},placeholder:""},null,8,["modelValue"])])),_:1}),b(" Site Click Limitation "),p(r,{label:"Site Click Limitation:",prop:"site_clk_limit"},{default:c((()=>[p(a,{class:"form-one",type:"text",modelValue:f(y).ruleForm.site_clk_limit,"onUpdate:modelValue":l[12]||(l[12]=e=>f(y).ruleForm.site_clk_limit=e),modelModifiers:{trim:!0},placeholder:""},null,8,["modelValue"])])),_:1}),b(" start_hour "),p(r,{label:"Start Hour:",prop:"start_hour"},{default:c((()=>[p(o,{filterable:"",class:"form-one",modelValue:f(y).ruleForm.start_hour,"onUpdate:modelValue":l[13]||(l[13]=e=>f(y).ruleForm.start_hour=e),placeholder:""},{default:c((()=>[(s(!0),m(g,null,C(f(y).options.time,(e=>(s(),x(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(" end_hour "),p(r,{label:"End Hour:",prop:"end_hour"},{default:c((()=>[p(o,{filterable:"",class:"form-one",modelValue:f(y).ruleForm.end_hour,"onUpdate:modelValue":l[14]||(l[14]=e=>f(y).ruleForm.end_hour=e),placeholder:""},{default:c((()=>[(s(!0),m(g,null,C(f(y).options.time,(e=>(s(),x(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(" site_install_limitation"),b(' <el-form-item label="Site Install Limitation:" prop="site_install_limitation">\n        <el-select filterable class=\'form-one\' v-model="data.ruleForm.site_install_limitation" clearable placeholder="">\n          <el-option\n            v-for="item in 6"\n            :key="item"\n            :label="item - 1"\n            :value="item - 1">\n          </el-option>\n        </el-select>\n      </el-form-item> '),b(" Device Cutoff "),p(r,{label:"Device Cutoff:",prop:"cutoff_start"},{default:c((()=>[_("div",K,[_("span",{textContent:w(100*f(y).ruleForm.cutoff_start)},null,8,G),J,Q,_("span",{textContent:w(100*f(y).ruleForm.cutoff_end)},null,8,W),X,Y,_("span",{textContent:w(f(fe).all)},null,8,Z),ee,le,_("span",{textContent:w(f(fe).judge)},null,8,re),te]),_("div",oe,[p(n,{class:"w100",modelValue:f(i),"onUpdate:modelValue":l[15]||(l[15]=e=>U(i)?i.value=e:i=e),range:"",step:5,"show-stops":!0,"show-input":"",min:0,max:100},null,8,["modelValue"])])])),_:1}),b(" diy_siteid "),p(r,{label:"Diy SiteID:",prop:"site"},{default:c((()=>[_("div",ae,[p(v,{class:"cp icon ml-10",type:"primary",icon:"el-icon-setting",circle:"",onClick:A})])])),_:1}),b(" site_id "),p(r,{label:"Site ID:",prop:"site_id"},{default:c((()=>[_("div",ie,[p(u,{modelValue:f(y).ruleForm.site_id,"onUpdate:modelValue":l[16]||(l[16]=e=>f(y).ruleForm.site_id=e),label:"1"},{default:c((()=>[ue])),_:1},8,["modelValue"]),p(u,{modelValue:f(y).ruleForm.site_id,"onUpdate:modelValue":l[17]||(l[17]=e=>f(y).ruleForm.site_id=e),label:"2"},{default:c((()=>[ne])),_:1},8,["modelValue"]),p(o,{filterable:"",class:"form-one ml-10",modelValue:f(y).ruleForm.hour,"onUpdate:modelValue":l[18]||(l[18]=e=>f(y).ruleForm.hour=e),clearable:"",placeholder:"",disabled:"2"!==f(y).ruleForm.site_id},{default:c((()=>[(s(!0),m(g,null,C(f(y).options.site_id,(e=>(s(),x(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])])),_:1}),b(" clk_id "),p(r,{label:"Click ID:",prop:"clk_id"},{default:c((()=>[_("div",de,[p(u,{modelValue:f(y).ruleForm.clk_id,"onUpdate:modelValue":l[19]||(l[19]=e=>f(y).ruleForm.clk_id=e),label:"1"},{default:c((()=>[se])),_:1},8,["modelValue"]),p(u,{modelValue:f(y).ruleForm.clk_id,"onUpdate:modelValue":l[20]||(l[20]=e=>f(y).ruleForm.clk_id=e),label:"2"},{default:c((()=>[me])),_:1},8,["modelValue"])])])),_:1}),b(" site_clk_id "),b(' <el-form-item label="Site Click ID:" prop="site_clk_id">\n        <div class=\'flex flex-start form-one flex-start radio-box\'>\n          <el-radio v-model="data.ruleForm.site_clk_id" label="1">ON</el-radio>\n          <el-radio v-model="data.ruleForm.site_clk_id" label="2">OFF</el-radio>\n        </div>\n      </el-form-item> '),b(" category "),b(' <el-form-item label="Category:" prop="category_id">\n        <el-select filterable class=\'form-one\' v-model="data.ruleForm.category_id" clearable placeholder="">\n          <el-option\n            v-for="(value, key) in handleOptionsCategory"\n            :key="key"\n            :label="value"\n            :value="key">\n          </el-option>\n        </el-select>\n      </el-form-item> '),b(" note "),p(r,{label:"Note:",prop:"note"},{default:c((()=>[p(a,{class:"form-one",type:"textarea",modelValue:f(y).ruleForm.note,"onUpdate:modelValue":l[21]||(l[21]=e=>f(y).ruleForm.note=e),modelModifiers:{trim:!0},autosize:{minRows:8,maxRows:80},placeholder:""},null,8,["modelValue"])])),_:1})])])),_:1},8,["rules","model"]),b(" form "),b(" footer "),_("div",pe,[p(v,{type:"primary",onClick:O},{default:c((()=>[ce])),_:1})]),b(" footer "),p(k,{title:"diy_siteid",modelValue:f(y).dialogVisibleSite,"onUpdate:modelValue":l[22]||(l[22]=e=>f(y).dialogVisibleSite=e)},{default:c((()=>[p(f(M),{msg:f(y).siteData,onKk:I},null,8,["msg"])])),_:1},8,["modelValue"])],64)}}});export{fe as default};
