var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,t=(l,a,r)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[a]=r,o=(e,o)=>{for(var u in o||(o={}))a.call(o,u)&&t(e,u,o[u]);if(l)for(var u of l(o))r.call(o,u)&&t(e,u,o[u]);return e};import{d as u,z as n,w as i,b as s,r as d,o as c,h as p,q as m,g as f,f as _,F as v,i as b,c as g,u as y,x as h,y as F,N as k,a as V,s as w,ah as x,P,j as U,t as j,k as S}from"./vendor.abf78dba.js";import{_ as C}from"./lodash.6df001c0.js";import{i as q,k as A,l as O,m as T,n as R,o as D,p as N,q as L,r as E}from"./fenix.ca658d1c.js";import{c as K}from"./clipboard.3b8c759c.js";import{m as M}from"./message.9010e90c.js";import"./index.4873aa89.js";const z={class:"flex jc-end"},B=F("Add"),I={class:"flex"},J=F("Copy"),Z=u({props:{list:{require:!0,default:[],type:Array},offer:{require:!0,default:"",type:String}},emits:["kk","up"],setup(e,{emit:l}){const a=e,r=n({pub:[{id:"",pub_name:""}]});let t=n({manage_traffic:[]});const o={pub:"",slotid:"",payout:0,cap_daily:0,pub_status:1,pub_tracking_link:""},u=()=>{t.manage_traffic.push(C.cloneDeep(o))};return i((()=>a.list),((e,l)=>{t.manage_traffic=e}),{immediate:!0,deep:!0}),i((()=>t.manage_traffic),((e,l)=>{}),{immediate:!0,deep:!0}),s((()=>{(async()=>{const{data:e}=await q();r.pub=e})()})),(e,l)=>{const o=d("el-button"),n=d("el-option"),i=d("el-select"),s=d("el-table-column"),F=d("el-input"),k=d("el-switch"),V=d("el-table");return c(),p("div",null,[m("div",z,[f(o,{type:"primary",onClick:u},{default:_((()=>[B])),_:1})]),f(V,{class:"mt-10",data:y(t).manage_traffic,style:{width:"100%"},border:""},{default:_((()=>[f(s,{label:"Pub Name",align:"center"},{default:_((e=>[f(i,{filterable:"",modelValue:e.row.pub,"onUpdate:modelValue":l=>e.row.pub=l,onChange:l=>(e=>{const{row:l}=e,t="http://track.adsforward.com/api/track?offer={offer}&mid={slot}&pub_id={siteid}&gaid={gaid}&idfa={idfa}&click_id={clickid}&ip={ip}&ua={ua}&osv={osv}&lang={lang}";l.pub_tracking_link=t;const o=r.pub.find((e=>e.pub_name===l.pub));l.slotid=o.slot_id,l.pub_status=o.status,l.pub_tracking_link=t.replace("{offer}",a.offer).replace("{slot}",o.slot_id)})(e),clearable:"",placeholder:""},{default:_((()=>[(c(!0),p(v,null,b(y(r).pub,(e=>(c(),g(n,{key:e.id,label:e.pub_name,value:e.pub_name},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),f(s,{label:"Payout",align:"center"},{default:_((e=>[f(F,{modelValue:e.row.payout,"onUpdate:modelValue":l=>e.row.payout=l,type:"number",min:"0",step:"0.001",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),f(s,{label:"Cap Daily",align:"center"},{default:_((e=>[f(F,{modelValue:e.row.cap_daily,"onUpdate:modelValue":l=>e.row.cap_daily=l,type:"number",min:"0",step:"0.001",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),f(s,{label:"Operation",align:"center",width:"180px"},{default:_((e=>[m("div",I,[f(o,{class:"mr-10",type:"danger",icon:"Delete",circle:"",onClick:l=>(e=>{const l=e.$index;t.manage_traffic.splice(l,1)})(e)},null,8,["onClick"]),f(k,{modelValue:e.row.pub_status,"onUpdate:modelValue":l=>e.row.pub_status=l,"active-value":1,"inactive-value":2,class:"mr-10",onChange:e=>{}},null,8,["modelValue","onUpdate:modelValue","onChange"]),e.row.pub_tracking_link?(c(),g(o,{key:0,class:"cp",type:"primary",onClick:l=>(({row:e})=>{const{pub_tracking_link:l}=e;K(l)})(e)},{default:_((()=>[J])),_:2},1032,["onClick"])):h("v-if",!0)])])),_:1})])),_:1},8,["data"])])}}}),$={class:"content-con flex column"},G={class:"flex jc-start ai-center form-one"},H=["textContent"],Q={class:"flex jc-start ai-center form-one"},W=F("BUZZ"),X=F("SDK"),Y={class:"flex jc-start ai-center form-one"},ee={key:0},le={key:1},ae={class:"flex jc-start ai-center form-one"},re={class:"flex jc-start ai-center form-one"},te={class:"flex jc-start ai-center form-one"},oe={class:"flex jc-start ai-center form-one"},ue={class:"flex jc-start ai-center form-one"},ne={class:"form-one"},ie={class:"flex jc-start ai-center form-one"},se={class:"flex jc-start ai-center form-one"},de={class:"flex jc-start ai-center form-one"},ce={class:"flex jc-start ai-center form-one"},pe={class:"flex jc-start ai-center form-one"},me={class:"flex jc-start ai-center form-one"},fe={class:"flex jc-start ai-center form-one"},_e={class:"flex jc-start ai-center form-one"},ve={class:"w100 flex"},be=F("Save"),ge=u({setup(e){let{proxy:l}=S();const a=k(),r="此项必填";let t=V(!1);const u=n({options:{channel:[{id:"",short_name:""}],country:[{id:"",short_name:"",zh_cn:""}],conversion_flow:[{value:1,label:"CPI"},{value:2,label:"CPA"},{value:9,label:"SDK"}],platform:[{value:1,label:"Android"},{value:2,label:"iOS"}],site_type:[{value:"rule_sdkindex",label:"匹配SDK自定义"},{value:"rule_pubredirect",label:"透传渠道ID"},{value:"rule_slotid",label:"渠道slotid"},{value:"rule_value",label:"固定值"}],attribute_provider:[{value:"AppsFlyer",label:"AppsFlyer"},{value:"Branch",label:"Branch"},{value:"Adjust",label:"Adjust"},{value:"Singular",label:"Singular"},{value:"AppMetrica",label:"AppMetrica"}]},rules:{no_required:[{required:!1}],channel:[{required:!0,message:r,trigger:["blur","change"]}],channel_type:[{required:!0,message:r,trigger:["blur","change"]}],status:[{required:!0,message:r,trigger:["blur","change"]}],title:[{required:!0,message:r,trigger:["blur","change"]}],pkg:[{required:!0,message:r,trigger:["blur","change"]}],platform:[{required:!0,message:r,trigger:["blur","change"]}],country:[{required:!0,message:r,trigger:["blur","change"]},{validator:(e,l,a)=>{0!==l.length?l.length>1?a(new Error("只能填选一个国家")):a(void 0):a(new Error(r))},trigger:["blur","change"]}],revenue:[{required:!0,message:r,trigger:["blur","change"]}],traffic:[{required:!1,validator:(e,l,a)=>{0!==l.length?(e=>{let l=!0;return e.map((e=>{for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)){const r=e[a];if((""===r||void 0===r)&&0!==r){l=!1;break}}})),l})(l)?a(void 0):a(new Error("不允许有空值")):a(void 0)},trigger:["blur","change"]}],adv_tracking_link:[{required:!0,message:r,trigger:["blur","change"]}],site_type:[{required:!0,message:r,trigger:["blur","change"]}],site_value:[{required:!0,message:r,trigger:["blur","change"]}],is_s2s:[{required:!0,message:r,trigger:["blur","change"]}],s2s_tracking_link:[{required:!0,message:r,trigger:["blur","change"]}],app_url:[{required:!0,message:r,trigger:["blur","change"]}]},ruleForm:{id:void 0,offer_id:"",adv_offer:"",create_type:1,channel:"",channel_type:1,adv_status:1,conversion_flow:"",status:1,title:"",pkg:"",attribute_provider:"",pid:"",platform:1,country:[],revenue:void 0,traffic:[],adtype:38,update_date:"",adv_tracking_link:"",target_cvr:void 0,cvr_status:2,is_s2s:2,s2s_tracking_link:"",app_url:"",site_type:"rule_value",site_value:"",description:""},search:{adv_offer:""}});let F=V(""),q=V(""),K=V("");const z=async()=>{t.value=!0;const e=C.cloneDeep(u.ruleForm);let l,a=o({},e);if(a.conversion_flow=e.conversion_flow,a.country=e.country[0],a.target_cvr=parseFloat(a.target_cvr),0!==e.traffic.length){const l=(e=>{const l=[];return e.map((e=>{let a=o({},e);return e.payout&&(a.payout=Number(e.payout)),e.cap_daily&&(a.cap_daily=Number(e.cap_daily)),l.push(a),e})),l})(e.traffic);a.traffic=JSON.stringify(l)}else delete a.traffic;"create"===K.value&&(l=await L(a)),"edit"===K.value&&(l=await E(a)),t.value=!1,M(l)},B=()=>{l.$refs.ruleForm.validate((e=>{if(!e)return!1;z()}))},I=async()=>{const e=await O();if(200===e.code){const{offer_id:l}=e;u.ruleForm.offer_id=l.toString()}else I()},J=async()=>{const{data:e}=await T();return u.options.channel=e,e},ge=async()=>{const{data:e}=await R();return u.options.country=e,e};s((async()=>{F.value=a.currentRoute.value.name,q.value=a.currentRoute.value.params.id,"fenix-offer-create"===F.value&&(I(),K.value="create"),"fenix-offer-edit"===F.value&&(q.value=a.currentRoute.value.params.id,K.value="edit",ye()),await(async()=>await Promise.all([J(),ge()]))()}));const ye=async()=>{const{data:e}=await A(q.value);u.ruleForm=o({},e),u.ruleForm.country=[e.country],u.search.adv_offer=e.adv_offer,u.ruleForm.traffic=e.traffic?JSON.parse(e.traffic):[]},he=w((()=>"rule_value"===u.ruleForm.site_type));i((()=>u.ruleForm.traffic),((e,l)=>{}),{immediate:!0,deep:!0}),i((()=>u.ruleForm.adv_offer),((e,l)=>{u.ruleForm.create_type=e?2:1}),{immediate:!0,deep:!0});const Fe=e=>{},ke=async()=>{u.ruleForm.adv_offer=u.search.adv_offer;const e=u.ruleForm.adv_offer;if(!e)return!1;const l={adv_offer:e,platform:u.ruleForm.platform};if(e&&e.includes("_")){u.ruleForm.channel_type=2,u.ruleForm.adtype=39;const e=await D(l),{data:a}=e;200===e.status?(u.ruleForm.adv_status=1,we(a)):u.ruleForm.adv_status=2}else{u.ruleForm.channel_type=1,u.ruleForm.adtype=38;const{data:e}=await N(l);u.ruleForm.adv_status=e.status,Ve(e)}},Ve=e=>{u.ruleForm.channel=e.channel,u.ruleForm.attribute_provider=e.attribute_provider,u.ruleForm.conversion_flow=e.conversion_flow,u.ruleForm.title=e.title,u.ruleForm.pkg=e.pkg_name,u.ruleForm.pid=e.pid,u.ruleForm.platform=e.platform,u.ruleForm.revenue=e.payout,u.ruleForm.adv_tracking_link=e.tracking_link,xe(e.country)},we=e=>{var l;u.ruleForm.pkg=e.app_pkg_name,u.ruleForm.channel=e.channel,u.ruleForm.country=e.country;const a=null==(l=u.options.platform.find((l=>l.label===e.platform)))?void 0:l.value;u.ruleForm.platform=a||1,u.ruleForm.revenue=e.revenue,u.ruleForm.title=e.title,u.ruleForm.adv_tracking_link=e.tracking_link,u.ruleForm.conversion_flow=9},xe=e=>{Array.isArray(e)?u.ruleForm.country=e:u.ruleForm.country=[e]};return(e,l)=>{const a=d("el-form-item"),r=d("el-button"),o=d("el-input"),n=d("el-option"),i=d("el-select"),s=d("el-radio"),F=d("el-radio-group"),k=d("el-switch"),V=d("el-form"),w=x("loading");return P((c(),p("div",null,[h(" form "),f(V,{enctype:"multipart/form-data",ref:(e,l)=>{l.ruleForm=e},rules:y(u).rules,model:y(u).ruleForm,"label-width":"240px","label-position":"right"},{default:_((()=>[m("div",$,[h(" Offer "),f(a,{label:"Offer:",prop:"offer"},{default:_((()=>[m("div",G,[m("span",{textContent:j(y(u).ruleForm.offer_id)},null,8,H)])])),_:1}),h(" Adv Offer "),f(a,{label:"Adv Offer:",prop:"adv_offer"},{default:_((()=>[m("div",Q,[f(o,{modelValue:y(u).search.adv_offer,"onUpdate:modelValue":l[0]||(l[0]=e=>y(u).search.adv_offer=e),placeholder:"Please input",class:"input-with-select"},{append:_((()=>[f(r,{type:"primary",icon:"Search",onClick:ke})])),_:1},8,["modelValue"])])])),_:1}),h(" Channel "),f(a,{label:"Channel:",prop:"channel"},{default:_((()=>[f(i,{filterable:"",class:"form-one",modelValue:y(u).ruleForm.channel,"onUpdate:modelValue":l[1]||(l[1]=e=>y(u).ruleForm.channel=e),clearable:"",placeholder:""},{default:_((()=>[(c(!0),p(v,null,b(y(u).options.channel,(e=>(c(),g(n,{key:e.id,label:e.short_name,value:e.short_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(" Channel Type "),f(a,{label:"Channel Type:",prop:"channel_type"},{default:_((()=>[f(F,{class:"form-one",modelValue:y(u).ruleForm.channel_type,"onUpdate:modelValue":l[2]||(l[2]=e=>y(u).ruleForm.channel_type=e)},{default:_((()=>[f(s,{label:1},{default:_((()=>[W])),_:1}),f(s,{label:2},{default:_((()=>[X])),_:1})])),_:1},8,["modelValue"])])),_:1}),h(" Adv Status "),f(a,{label:"Adv Status:",prop:"adv_status"},{default:_((()=>[m("div",Y,[1===y(u).ruleForm.adv_status?(c(),p("span",ee,"开")):h("v-if",!0),2===y(u).ruleForm.adv_status?(c(),p("span",le,"关")):h("v-if",!0)])])),_:1}),h(" conversion_flow "),f(a,{label:"Conversion Flow:",prop:"conversion_flow"},{default:_((()=>[f(i,{filterable:"",class:"form-one",modelValue:y(u).ruleForm.conversion_flow,"onUpdate:modelValue":l[3]||(l[3]=e=>y(u).ruleForm.conversion_flow=e),clearable:"",placeholder:""},{default:_((()=>[(c(!0),p(v,null,b(y(u).options.conversion_flow,(e=>(c(),g(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(" Status "),f(a,{label:"Status:",prop:"status"},{default:_((()=>[m("div",ae,[f(k,{modelValue:y(u).ruleForm.status,"onUpdate:modelValue":l[4]||(l[4]=e=>y(u).ruleForm.status=e),"active-value":1,"inactive-value":2},null,8,["modelValue"])])])),_:1}),h(" Offer Title "),f(a,{label:"Offer Title:",prop:"title"},{default:_((()=>[m("div",re,[f(o,{modelValue:y(u).ruleForm.title,"onUpdate:modelValue":l[5]||(l[5]=e=>y(u).ruleForm.title=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1}),h(" Package Name "),f(a,{label:"Package Name:",prop:"pkg"},{default:_((()=>[m("div",te,[f(o,{modelValue:y(u).ruleForm.pkg,"onUpdate:modelValue":l[6]||(l[6]=e=>y(u).ruleForm.pkg=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1}),h(" Attribute Provider "),f(a,{label:"Attribute Provider:",prop:"attribute_provider"},{default:_((()=>[f(i,{filterable:"",class:"form-one",modelValue:y(u).ruleForm.attribute_provider,"onUpdate:modelValue":l[7]||(l[7]=e=>y(u).ruleForm.attribute_provider=e),clearable:"",placeholder:""},{default:_((()=>[(c(!0),p(v,null,b(y(u).options.attribute_provider,(e=>(c(),g(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(" Pid "),f(a,{label:"Pid:",prop:"pid"},{default:_((()=>[m("div",oe,[f(o,{modelValue:y(u).ruleForm.pid,"onUpdate:modelValue":l[8]||(l[8]=e=>y(u).ruleForm.pid=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1}),h(" Platform "),f(a,{label:"Platform:",prop:"platform"},{default:_((()=>[f(i,{filterable:"",class:"form-one",modelValue:y(u).ruleForm.platform,"onUpdate:modelValue":l[9]||(l[9]=e=>y(u).ruleForm.platform=e),placeholder:""},{default:_((()=>[(c(!0),p(v,null,b(y(u).options.platform,(e=>(c(),g(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(" Country "),f(a,{label:"Country:",prop:"country"},{default:_((()=>[f(i,{filterable:"",class:"form-one",modelValue:y(u).ruleForm.country,"onUpdate:modelValue":l[10]||(l[10]=e=>y(u).ruleForm.country=e),multiple:"",clearable:"",placeholder:""},{default:_((()=>[(c(!0),p(v,null,b(y(u).options.country,(e=>(c(),g(n,{key:e.id,label:e.short_name+"-"+e.zh_cn,value:e.short_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(" Revenue "),f(a,{label:"Revenue:",prop:"revenue"},{default:_((()=>[m("div",ue,[f(o,{modelValue:y(u).ruleForm.revenue,"onUpdate:modelValue":l[11]||(l[11]=e=>y(u).ruleForm.revenue=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1}),h(" Manage Traffic "),f(a,{label:"Manage Traffic:",prop:"traffic"},{default:_((()=>[m("div",ne,[f(y(Z),{ref:(e,l)=>{l.traffic=e},list:y(u).ruleForm.traffic,"onUpdate:list":l[12]||(l[12]=e=>y(u).ruleForm.traffic=e),offer:y(u).ruleForm.offer_id,onKk:Fe},null,8,["list","offer"])])])),_:1}),h(" Adv Tracking Link "),f(a,{label:"Adv Tracking Link:",prop:"adv_tracking_link"},{default:_((()=>[m("div",ie,[f(o,{rows:3,type:"textarea",modelValue:y(u).ruleForm.adv_tracking_link,"onUpdate:modelValue":l[13]||(l[13]=e=>y(u).ruleForm.adv_tracking_link=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1}),h(" Target CVR "),f(a,{label:"Target CVR:",prop:"target_cvr"},{default:_((()=>[m("div",se,[f(o,{modelValue:y(u).ruleForm.target_cvr,"onUpdate:modelValue":l[14]||(l[14]=e=>y(u).ruleForm.target_cvr=e),type:"number",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1}),h(" CVR Status "),f(a,{label:"CVR Status:",prop:"cvr_status"},{default:_((()=>[m("div",de,[f(k,{modelValue:y(u).ruleForm.cvr_status,"onUpdate:modelValue":l[15]||(l[15]=e=>y(u).ruleForm.cvr_status=e),"active-value":1,"inactive-value":2},null,8,["modelValue"])])])),_:1}),h(" Site Type "),f(a,{label:"Site Type:",prop:"site_type"},{default:_((()=>[f(i,{filterable:"",class:"form-one",modelValue:y(u).ruleForm.site_type,"onUpdate:modelValue":l[16]||(l[16]=e=>y(u).ruleForm.site_type=e),clearable:"",placeholder:""},{default:_((()=>[(c(!0),p(v,null,b(y(u).options.site_type,(e=>(c(),g(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(" Site Value "),f(a,{label:"Site Value:",prop:"site_value",rules:y(he)?y(u).rules.site_value:y(u).rules.no_required},{default:_((()=>[m("div",ce,[f(o,{modelValue:y(u).ruleForm.site_value,"onUpdate:modelValue":l[17]||(l[17]=e=>y(u).ruleForm.site_value=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1},8,["rules"]),h(" S2S Async "),f(a,{label:"S2S Async:",prop:"is_s2s"},{default:_((()=>[m("div",pe,[f(k,{modelValue:y(u).ruleForm.is_s2s,"onUpdate:modelValue":l[18]||(l[18]=e=>y(u).ruleForm.is_s2s=e),"active-value":1,"inactive-value":2},null,8,["modelValue"])])])),_:1}),h(" S2S Tracking Link "),f(a,{label:"S2S Tracking Link:",prop:"s2s_tracking_link",rules:1===y(u).ruleForm.is_s2s?y(u).rules.s2s_tracking_link:y(u).rules.no_required},{default:_((()=>[m("div",me,[f(o,{rows:2,type:"textarea",modelValue:y(u).ruleForm.s2s_tracking_link,"onUpdate:modelValue":l[19]||(l[19]=e=>y(u).ruleForm.s2s_tracking_link=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1},8,["rules"]),h(" Preview URL "),f(a,{label:"Preview URL:",prop:"app_url",rules:1===y(u).ruleForm.is_s2s?y(u).rules.app_url:y(u).rules.no_required},{default:_((()=>[m("div",fe,[f(o,{rows:2,type:"textarea",modelValue:y(u).ruleForm.app_url,"onUpdate:modelValue":l[20]||(l[20]=e=>y(u).ruleForm.app_url=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1},8,["rules"]),h(" Description "),f(a,{label:"Description:",prop:"description"},{default:_((()=>[m("div",_e,[f(o,{rows:2,type:"textarea",modelValue:y(u).ruleForm.description,"onUpdate:modelValue":l[21]||(l[21]=e=>y(u).ruleForm.description=e),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])])),_:1}),h(" end ")])])),_:1},8,["rules","model"]),h(" form "),h(" footer "),m("div",ve,[f(r,{type:"primary",onClick:U(B,["prevent"])},{default:_((()=>[be])),_:1},8,["onClick"])])],512)),[[w,y(t)]])}}});export{ge as default};
