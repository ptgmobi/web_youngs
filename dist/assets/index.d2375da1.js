var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,s=(e,s)=>{for(var o in s||(s={}))t.call(s,o)&&i(e,o,s[o]);if(a)for(var o of a(s))l.call(s,o)&&i(e,o,s[o]);return e};import{ac as o,r as n,o as d,h as r,x as p,g as c,f as u,q as m,c as g,y as b,t as h,M as f,N as y,F as D,i as w}from"./vendor.169c14f2.js";import{w as v,a as _,g as j,b as V,s as C,c as k,d as P,e as T,f as x}from"./product.bfa599f9.js";import{P as F}from"./index.9f7a96ca.js";import{m as S}from"./message.c2d5aa05.js";import{m as E}from"./self.80fb1bc7.js";import{_ as A}from"./index.fd53d960.js";import{_ as I}from"./lodash.8be3df31.js";const O={id:"",name:"",product:[]},U={mixins:[E],components:{Pagination:F},directives:{waves:v},data:()=>({date:"",passwordType:"password",dialogVisible:!1,dialogType:"new",busData:{setting:{filterMethod:(e,a)=>a.label.indexOf(e)>-1},options:{product:[]},data:{id:"",name:"",product:[]},rules:{}},control:{search:""},list:[],pagination:{pageSizes:["10","20","40"],total:1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"}}}),computed:s({},o(["element"])),created(){this.getConfig(),this.init()},methods:{init(){this.getList()},async getConfig(){const{data:e}=await _({name:"",page:1,limit:999,project_id:"",order:"desc"});this.busData.options.product=e.list},async getList(){const{data:e}=await j();this.list=e},handleSearch(){},handleCreate(){this.dialogType="new",this.dialogVisible=!0;const e=new Date;this.date=e.getTime()},async handleEdit(e){this.dialogType="edit",this.busData.data.id=e.row.id;const{data:a}=await V(this.busData.data.id);this.busData.data.id=a.project.id,this.busData.data.name=a.project.name,this.busData.data.product=a.product,this.dialogVisible=!0;const t=new Date;this.date=t.getTime()},handleDelete(e){},roleChangeChoice(e,a){this.busData.choiceData[e]=a},clearBusData(){this.busData.data=this._.cloneDeep(O)},async submitFn(){if("new"===this.dialogType){const e={name:this.busData.data.name,product_id:this.busData.data.product},a=await C(e);a&&S(a),this.getList()}if("edit"===this.dialogType){const e={id:this.busData.data.id,name:this.busData.data.name,product_id:this.busData.data.product},a=await k(this.busData.data.id,e);a&&S(a)}this.clearBusData(),this.dialogVisible=!1}}},L={class:"app-container"},z=b(" 项目组 "),Q={style:{"text-align":"right"}},N=b("取消 "),q=b("确定"),M={class:"w100 control-box flex jc-end"},R={class:"flex flex-end"},B=b("搜索"),J=b("创建项目组"),K={class:"w100 flex"};var Y=A(U,[["render",function(e,a,t,l,i,s){const o=n("el-input"),D=n("el-form-item"),w=n("el-form"),v=n("el-button"),_=n("el-dialog"),j=n("el-table-column"),V=n("el-table"),C=n("pagination");return d(),r("div",L,[z,p(" dialog "),c(_,{modelValue:i.dialogVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>i.dialogVisible=e),title:"edit"===i.dialogType?"修改项目组":"创建项目组",width:"80%"},{default:u((()=>[c(w,{ref:"ruleForm",model:i.busData.data,rules:i.busData.rules,"label-width":"150px","label-position":"left"},{default:u((()=>[c(D,{label:"项目名称",prop:"name"},{default:u((()=>[c(o,{modelValue:i.busData.data.name,"onUpdate:modelValue":a[0]||(a[0]=e=>i.busData.data.name=e),placeholder:"",disabled:"edit"===i.dialogType},null,8,["modelValue","disabled"])])),_:1}),p(' <el-form-item label="产品" prop="project">\n          <el-select v-model="busData.data.product" filterable multiple class="w100" placeholder="产品">\n            <el-option\n              v-for="item in busData.options.product"\n              :key="item.id"\n              :label="item.name"\n              :value="item.id"\n              :disabled="item.status === \'2\'"\n            />\n          </el-select>\n        </el-form-item> ')])),_:1},8,["model","rules"]),m("div",Q,[c(v,{type:"danger",onClick:a[1]||(a[1]=e=>i.dialogVisible=!1)},{default:u((()=>[N])),_:1}),c(v,{type:"primary",onClick:s.submitFn},{default:u((()=>[q])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"]),p(" dialog "),m("div",M,[m("div",R,[p(' <el-input placeholder="请输入内容" v-model="control.search" class="input-with-select">\n          <el-button type="primary" slot="append">搜索</el-button>\n        </el-input> '),c(o,{modelValue:i.control.search,"onUpdate:modelValue":a[3]||(a[3]=e=>i.control.search=e),class:"mr-10",placeholder:"请输入内容"},null,8,["modelValue"]),c(v,{type:"primary",onClick:s.handleSearch},{default:u((()=>[B])),_:1},8,["onClick"]),e.judgePermissionElementFn("A-AP-PROJECT-ADD-V")?(d(),g(v,{key:0,type:"primary",onClick:s.handleCreate},{default:u((()=>[J])),_:1},8,["onClick"])):p("v-if",!0)])]),c(V,{data:i.list,style:{width:"100%","margin-top":"30px"},border:""},{default:u((()=>[c(j,{align:"center",label:"项目组ID"},{default:u((e=>[b(h(e.row.id),1)])),_:1}),c(j,{align:"center",label:"项目名称"},{default:u((e=>[b(h(e.row.name),1)])),_:1}),c(j,{align:"center",label:"产品数"},{default:u((e=>[b(h(e.row.product_count),1)])),_:1}),c(j,{align:"center",label:"创建时间"},{default:u((e=>[b(h(e.row.create_time),1)])),_:1}),p(' <el-table-column align="center" label="更新时间">\n        <template #default="scope">\n          {{ scope.row.id }}\n        </template>\n      </el-table-column> '),p(' <el-table-column align="center" label="操作">\n        <div #default="scope" class="flex">\n          <el-button v-if="judgePermissionElementFn(\'A-AP-PROJECT-EDIT-V\')" type="primary" size="small" @click="handleEdit(scope)">编辑</el-button>\n          <el-button v-if="judgePermissionElementFn(\'A-AP-PROJECT-DEL-V\')" type="danger" size="small" @click="handleDelete(scope)">删除</el-button>\n        </div>\n      </el-table-column> ')])),_:1},8,["data"]),p(" pagination "),m("div",K,[f(c(C,{total:i.pagination.total,"page-sizes":i.pagination.pageSizes,page:i.pagination.listQuery.page,limit:i.pagination.listQuery.limit,onPagination:s.init},null,8,["total","page-sizes","page","limit","onPagination"]),[[y,i.pagination.total]])])])}]]);const $={id:"",name:"",project:"",appid:"",projectId:"",appkey:"",status:"1"},G={mixins:[E],components:{Pagination:F},directives:{waves:v},data:()=>({date:"",statusMessage:"产品状态关闭后,产品数据将不在报表中显示",tableOrder:"desc",passwordType:"password",dialogVisible:!1,dialogType:"new",productStatus:"",busData:{setting:{filterMethod:(e,a)=>a.label.indexOf(e)>-1},options:{project:[],status:[{id:"1",name:"启动"},{id:"2",name:"禁止"}]},data:{id:"",name:"",project:"",appid:"",projectId:"",appkey:"",status:"1"},projectName:"",rules:{name:[{required:!0,message:"必填",trigger:["change","blur"]},{min:1,max:50,message:"字符长度为1-50",trigger:["change","blur"]}],project:[{required:!0,message:"必填",trigger:["change","blur"]}],appid:[{required:!1,message:"",trigger:["change","blur"]}],projectId:[{required:!1,message:"必填",trigger:["change","blur"]}],appkey:[{required:!1,message:"非必填",trigger:["change","blur"]}],status:[{required:!0,message:"必填",trigger:["change","blur"]}]}},control:{search:""},filters:{projectFilter:[],currentProjectFilter:""},list:[],pagination:{pageSizes:["10"],total:1,listQuery:{page:1,limit:10,importance:void 0,title:void 0,type:void 0,sort:"+id"}}}),created(){this.getConfig(),this.init()},methods:{init(){this.getList()},async getConfig(){const{data:e}=await j();this.busData.options.project=e,null==e||e.map((e=>{this.filters.projectFilter.push({text:e.name,value:e.id})}))},async getList(){const e={name:this.control.search,page:this.pagination.listQuery.page,limit:this.pagination.listQuery.limit,project_id:this.filters.currentProjectFilter,order:this.tableOrder},{data:a}=await _(e);this.list=a.list,this.pagination.total=a.count},handleSearch(){this.getList()},handleCreate(){this.dialogType="new",this.clearBusData(),this.dialogVisible=!0;const e=new Date;this.date=e.getTime()},async handleEdit(e){this.dialogType="edit",this.busData.data.id=e.row.id,this.busData.data.name=e.row.name,this.busData.data.appid=e.row.app_id,this.busData.data.project=e.row.project_id,this.busData.data.projectId=e.row.ss_project_id,this.busData.data.appkey=e.row.ry_appkey,this.dialogVisible=!0;const a=new Date;this.date=a.getTime()},handleDelete(e){},roleChangeChoice(e,a){this.busData.choiceData[e]=a},clearBusData(){this.busData.data=I.cloneDeep($)},async changeStatus(e,a){const t={id:a.id,status:a.status};await P(a.id,t)},async submitFn(){if("new"===this.dialogType){const e={name:this.busData.data.name,project_id:this.busData.data.project,app_id:this.busData.data.appid,ss_project_id:this.busData.data.projectId,ry_appkey:this.busData.data.appkey,status:this.busData.data.status},a=await T(e);a&&S(a),this.getList()}if("edit"===this.dialogType){const e={id:this.busData.data.id,name:this.busData.data.name,project_id:this.busData.data.project,app_id:this.busData.data.appid,ss_project_id:this.busData.data.projectId,ry_appkey:this.busData.data.appkey,status:this.busData.data.status},a=await x(this.busData.data.id,e);a&&S(a),this.getList()}this.clearBusData(),this.dialogVisible=!1,this.$refs.ruleForm.resetFields()},showCurrentProject(e){var a,t;return null==(t=(null==(a=this.busData.options.project)?void 0:a.filter((a=>a.id===e)))[0])?void 0:t.name},cancelFn(){this.dialogVisible=!1,this.$refs.ruleForm.resetFields()},filterChange(e){const a=Object.values(e)[0];this.filters.currentProjectFilter=a.length===this.filters.projectFilter.length?"":a,this.getList()},switchStatus(e,a){this.statusMessage="1"===e?"产品状态开启后，产品数据开始在平台上展示":"产品状态关闭后,产品数据将不在报表中显示"},cancelStatus(e){this.getList()},async confirmStatus(e){await P(e.id,{id:e.id,status:e.status}),this.getList()},sortChange(e,a,t){"ascending"===e.order?this.tableOrder="asc":"descending"===e.order&&(this.tableOrder="desc"),this.getList()}}},H={class:"app-container"},W={style:{"text-align":"right"}},X=b("取消"),Z=b("确认"),ee={class:"w100 control-box flex jc-end"},ae={class:"flex flex-end"},te=b("搜索"),le=b("创建产品"),ie={class:"flex"},se=b("编辑"),oe=b("删除"),ne={class:"w100 flex"};const de={components:{Project:Y,Product:A(G,[["render",function(e,a,t,l,i,s){const o=n("el-input"),v=n("el-form-item"),_=n("el-option"),j=n("el-select"),V=n("el-form"),C=n("el-button"),k=n("el-dialog"),P=n("el-table-column"),T=n("el-switch"),x=n("el-table"),F=n("pagination");return d(),r("div",H,[p(" dialog "),c(k,{modelValue:i.dialogVisible,"onUpdate:modelValue":a[5]||(a[5]=e=>i.dialogVisible=e),title:"edit"===i.dialogType?"编辑产品":"创建产品",width:"80%"},{default:u((()=>[c(V,{ref:"ruleForm",model:i.busData.data,rules:i.busData.rules,"label-width":"150px","label-position":"left"},{default:u((()=>[c(v,{label:"产品名称",prop:"name"},{default:u((()=>[c(o,{modelValue:i.busData.data.name,"onUpdate:modelValue":a[0]||(a[0]=e=>i.busData.data.name=e),placeholder:"请输入产品名称",disabled:"edit"===i.dialogType},null,8,["modelValue","disabled"])])),_:1}),c(v,{label:"项目组",prop:"project"},{default:u((()=>[c(j,{modelValue:i.busData.data.project,"onUpdate:modelValue":a[1]||(a[1]=e=>i.busData.data.project=e),class:"w100",placeholder:"请选择所属项目组",disabled:"edit"===i.dialogType},{default:u((()=>[(d(!0),r(D,null,w(i.busData.options.project,(e=>(d(),g(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),c(v,{label:"APP_ID",prop:"appid"},{default:u((()=>[c(o,{modelValue:i.busData.data.appid,"onUpdate:modelValue":a[2]||(a[2]=e=>i.busData.data.appid=e),placeholder:"请输入app_id"},null,8,["modelValue"])])),_:1}),c(v,{label:"数数项目ID",prop:"projectId"},{default:u((()=>[c(o,{modelValue:i.busData.data.projectId,"onUpdate:modelValue":a[3]||(a[3]=e=>i.busData.data.projectId=e),placeholder:"请输入数数项目ID",disabled:"edit"===i.dialogType},null,8,["modelValue","disabled"])])),_:1}),c(v,{label:"热云APPKEY",prop:"appkey"},{default:u((()=>[c(o,{modelValue:i.busData.data.appkey,"onUpdate:modelValue":a[4]||(a[4]=e=>i.busData.data.appkey=e),placeholder:"请输入热云APPKEY",disabled:"edit"===i.dialogType},null,8,["modelValue","disabled"])])),_:1}),p(' <el-form-item label="状态" prop="status">\n          <el-select v-model="busData.data.status" class="w100">\n            <el-option\n              v-for="item in busData.options.status"\n              :key="item.id"\n              :label="item.name"\n              :value="item.id"\n            />\n          </el-select>\n        </el-form-item> '),p(' <el-form-item label="产品配置" prop="conf">\n          <el-transfer\n            filterable\n            :filter-method="busData.setting.filterMethod"\n            filter-placeholder="请输入搜索"\n            v-model="busData.data.conf"\n            :data="busData.data.data"\n            :titles="[\'Source\', \'Target\']"\n          >\n          </el-transfer>\n        </el-form-item> ')])),_:1},8,["model","rules"]),m("div",W,[c(C,{type:"danger",onClick:s.cancelFn},{default:u((()=>[X])),_:1},8,["onClick"]),c(C,{type:"primary",onClick:s.submitFn},{default:u((()=>[Z])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"]),p(" dialog "),m("div",ee,[m("div",ae,[p(' <el-input placeholder="请输入内容" v-model="control.search" class="input-with-select">\n          <el-button type="primary" slot="append">搜索</el-button>\n        </el-input> '),c(o,{modelValue:i.control.search,"onUpdate:modelValue":a[6]||(a[6]=e=>i.control.search=e),class:"sw-200 mr-10",placeholder:"请输入产品名称或APPID"},null,8,["modelValue"]),c(C,{type:"primary",onClick:s.handleSearch},{default:u((()=>[te])),_:1},8,["onClick"]),e.judgePermissionElementFn("A-AP-PRODUCT-ADD-V")?(d(),g(C,{key:0,type:"primary",onClick:s.handleCreate},{default:u((()=>[le])),_:1},8,["onClick"])):p("v-if",!0)])]),c(x,{data:i.list,style:{width:"100%","margin-top":"30px"},border:"",onFilterChange:s.filterChange,onSortChange:s.sortChange},{default:u((()=>[c(P,{align:"center",label:"ID",prop:"id",sortable:"custom"}),c(P,{align:"center",label:"项目组",filters:i.filters.projectFilter},{default:u((e=>[m("span",null,h(s.showCurrentProject(e.row.project_id)),1)])),_:1},8,["filters"]),c(P,{align:"center",label:"产品名称"},{default:u((e=>[b(h(e.row.name),1)])),_:1}),c(P,{align:"center",label:"APP_ID"},{default:u((e=>[b(h(e.row.app_id),1)])),_:1}),c(P,{align:"center",label:"数数项目ID"},{default:u((e=>[b(h(e.row.ss_project_id),1)])),_:1}),c(P,{align:"center",label:"热云APPKEY"},{default:u((e=>[b(h(e.row.ry_appkey),1)])),_:1}),p(' <el-table-column align="center" label="最新版本">\n        <template #default="scope">\n          {{ scope.row.id }}\n        </template>\n      </el-table-column> '),c(P,{align:"center",label:"创建时间"},{default:u((e=>[b(h(e.row.create_time),1)])),_:1}),c(P,{align:"center",label:"更新时间"},{default:u((e=>[b(h(e.row.update_time),1)])),_:1}),c(P,{align:"center",label:"产品状态"},{default:u((e=>[p(' <el-popconfirm\n            :title="statusMessage"\n            @onConfirm="confirmStatus(scope.row)"\n            @onCancel="cancelStatus(scope.row)"\n          > '),c(T,{slot:"reference",modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":"1","inactive-value":"2",onChange:a=>s.switchStatus(a,e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),p(" </el-popconfirm> "),p(' <el-popover\n            v-model="productPopVisible"\n            placement="top"\n            width="200"\n          >\n            <p>确定删除吗？</p>\n            <div style="text-align: right; margin: 0">\n              <el-button type="text" @click="cancelStatus(scope.row)">取消</el-button>\n              <el-button type="text" @click="confirmStatus(scope.row)">确定</el-button>\n            </div>\n            <el-switch\n              slot="reference"\n              v-model="scope.row.status"\n              active-value="1"\n              inactive-value="2"\n              @change="switchStatus($event,scope.row)"\n            />\n          </el-popover> ')])),_:1}),e.judgePermissionElementFn("A-AP-PRODUCT-EDIT-V")?(d(),g(P,{key:0,align:"center",label:"操作"},{default:u((a=>[m("div",ie,[c(C,{type:"primary",size:"small",onClick:e=>s.handleEdit(a)},{default:u((()=>[se])),_:2},1032,["onClick"]),e.judgePermissionElementFn("A-AP-PRODUCT-DEL-V")?(d(),g(C,{key:0,type:"danger",size:"small",onClick:e=>s.handleDelete(a)},{default:u((()=>[oe])),_:2},1032,["onClick"])):p("v-if",!0)])])),_:1})):p("v-if",!0)])),_:1},8,["data","onFilterChange","onSortChange"]),p(" pagination "),m("div",ne,[f(c(F,{total:i.pagination.total,"page-sizes":i.pagination.pageSizes,page:i.pagination.listQuery.page,"onUpdate:page":a[7]||(a[7]=e=>i.pagination.listQuery.page=e),limit:i.pagination.listQuery.limit,"onUpdate:limit":a[8]||(a[8]=e=>i.pagination.listQuery.limit=e),onPagination:s.init},null,8,["total","page-sizes","page","limit","onPagination"]),[[y,i.pagination.total]])])])}]])},data:()=>({activeName:"product"}),computed:s({},o(["element"])),methods:{handleClick(e,a){this.activeName=e.name}}},re={class:"app-container"};var pe=A(de,[["render",function(e,a,t,l,i,s){const o=n("product"),m=n("el-tab-pane"),b=n("project"),h=n("el-tabs");return d(),r("div",re,[c(h,{modelValue:i.activeName,"onUpdate:modelValue":a[0]||(a[0]=e=>i.activeName=e),type:"card",onTabClick:s.handleClick},{default:u((()=>[c(m,{name:"product",label:"产品信息"},{default:u((()=>["product"===i.activeName?(d(),g(o,{key:0})):p("v-if",!0)])),_:1}),c(m,{name:"project",label:"项目组"},{default:u((()=>["project"===i.activeName?(d(),g(b,{key:0})):p("v-if",!0)])),_:1})])),_:1},8,["modelValue","onTabClick"])])}]]);export{pe as default};
