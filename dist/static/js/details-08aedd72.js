var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(r,t,a)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,o=(e,o)=>{for(var i in o||(o={}))t.call(o,i)&&l(e,i,o[i]);if(r)for(var i of r(o))a.call(o,i)&&l(e,i,o[i]);return e};import{d as i,a as n,r as s,e as c,w as d,I as u,a1 as p,M as f,m as _,s as m,n as g,z as v,c as h,p as y,v as b,x as F,q as k,O as w,P as A,b as O,A as q,L as x}from"./index-aa136589.js";import{m as D}from"./message-f935cb85.js";const V={class:"container"},S=b("div",{class:"flex jc-start content-li-title"},[b("div",{class:"num-circle"},"1"),b("h5",null,"Offer Basic Info")],-1),E={class:"content-con flex column"},j={class:"flex jc-start form-one radio-box"},C=["textContent"],N={class:"w100 flex"},P=O(" Save "),I=O(" 123 "),J={slot:"footer",class:"dialog-footer"},M=O("确 定"),U=i({setup(e){let{proxy:r}=x();n();const t="此项必填";let a=(e,r,t)=>{"AppsFlyer"===T.ruleForm.attribute_provider?T.ruleForm.tracking_link.includes(T.ruleForm.pkg_name)?t(void 0):t(new Error("Attribute Provider:为Appsflyer时Package Name的值必须包含在Traking Link中")):t(void 0)},l=s({offer_id:"",channel:"",copy_offer:"",offer_open_type:""}),i=s({channel:[{required:!0,message:t,trigger:["blur","change"]}],offer_open_type:[{required:!0,message:t,trigger:["blur","change"]}]}),O=s({channel:[],attribute_provider:["AppsFlyer","Branch","Adjust","Singular","AppMetrica"],time:[-1,...[...new Array(24)].map(((e,r)=>r))],platform:[{value:1,label:"Android"},{value:2,label:"iOS"}],country:[],site_id:["0.2","0.4","0.6","1","2","4","8","24","72","168"],category:[],devices:[]}),U=s({offer:{},index:null,cacheDevice:{}});c("");let B=c(0),L=c([0,100]),T=s({dialogVisibleDevice:!1,dialogVisibleSite:!1,search:{id:"",baseDeviceSelect:{},deviceData:{all:[],select:[],count:0}},type:"1",params:"",loading:!0,options:{channel:[],attribute_provider:["AppsFlyer","Branch","Adjust","Singular","AppMetrica"],time:[-1,...[...new Array(24)].map(((e,r)=>r))],platform:[{value:1,label:"Android"},{value:2,label:"iOS"}],country:[],site_id:["0.2","0.4","0.6","1","2","4","8","24","72","168"],category:[],devices:[]},ruleForm:{type:"",id:"",offer_id:void 0,operation_type:"",channel:"",copy_offer:"",attribute_provider:"AppsFlyer",title:"",tracking_link:"",pid:"",pkg_name:"",conversion_flow:"",event_name:"",payout:void 0,platform:"",country:"",max_clk_num:void 0,site_clk_limit:void 0,site_install_limitation:void 0,start_hour:"-1",end_hour:"-1",device:[],cutoff_start:void 0,cutoff_end:void 0,diy_siteid:"",site_id:"",hour:void 0,clk_id:"",site_clk_id:"",note:""},rules:{channel:[{required:!0,message:t,trigger:["blur","change"]}],attribute_provider:[{required:!0,message:t,trigger:["blur","change"]}],title:[{required:!0,message:t,trigger:["blur","change"]}],tracking_link:[{required:!0,message:t,trigger:["blur","change"]},{validator:(e,r,t)=>{new RegExp("\\s+","g").test(r)?t(new Error("链接中有空格")):t(void 0),t(void 0)}},{validator:(e,r,t)=>{/^http/.test(r)?t(void 0):t(new Error("必须为有效链接")),t(void 0)}},{validator:(e,r,t)=>{if("AppsFlyer"===T.ruleForm.attribute_provider){["af_sub_siteid","af_installpostback"].map((e=>{r.includes(e)&&t(new Error(`链接有错误，不能包含${e}`))}))}t(void 0)}},{validator:a}],pkg_name:[{required:!0,message:t,trigger:["blur","change"]},{validator:a}],conversion_flow:[{required:!0,message:t,trigger:["blur","change"]}],event_name:[{required:!0,message:t,trigger:["blur","change"]},{validator:(e,r,a)=>{"1"===T.ruleForm.conversion_flow?a(void 0):a(r?void 0:new Error(t))}}],payout:[{required:!0,message:t,trigger:["blur","change"]}],platform:[{required:!0,message:t,trigger:["blur","change"]}],country:[{required:!0,message:t,trigger:["blur","change"]}],max_clk_num:[{required:!0,message:t,trigger:["blur","change"]}],device:[{required:!0,validator:(e,r,t)=>{t(void 0)},trigger:["blur","change"]}],site_id:[{required:!0,validator:(e,r,a)=>{r?1===r||T.ruleForm.hour?a(void 0):a(new Error("请选择具体数值")):a(new Error(t))},trigger:["blur","change"]}],clk_id:[{required:!0,message:t,trigger:["blur","change"]}],start_hour:[{required:!1,validator:(e,r,a)=>{""!==r&&(""===T.ruleForm.end_hour?a(new Error(t)):a(void 0))},trigger:["blur","change"]}],end_hour:[{required:!1,validator:(e,r,a)=>{""!==r&&(""===T.ruleForm.start_hour?a(new Error(t)):a(void 0))},trigger:["blur","change"]}],cutoff_start:[{required:!0,trigger:["blur","change"]}],cutoff_end:[{required:!0,trigger:["blur","change"]}]},siteData:[]});const $=()=>{z("ruleForm")},z=e=>{r.$refs[e].validate((e=>{if(!e)return!1;G()}))},G=async()=>{let e;T.ruleForm;let r=o({},T.ruleForm);r.clk_id=parseFloat(r.clk_id),r.conversion_flow=parseFloat(r.conversion_flow),r.cutoff_end=parseFloat(r.cutoff_end),r.cutoff_start=parseFloat(r.cutoff_start),r.end_hour=parseFloat(r.end_hour),r.start_hour=parseFloat(r.start_hour),r.hour=parseFloat(r.hour),r.max_clk_num=parseFloat(r.max_clk_num),r.payout=parseFloat(r.payout),r.platform=parseFloat(r.platform),r.site_clk_id=parseFloat(r.site_clk_id),r.site_clk_limit=parseFloat(r.site_clk_limit),r.site_id=parseFloat(r.site_id),r.site_install_limitation=parseFloat(r.site_install_limitation),r.diy_siteid=JSON.stringify(r.diy_siteid),r.device=JSON.stringify(r.device),"1"===T.ruleForm.type&&(delete r.id,delete r.offer_id,e=await ApiOperationOfferCreate(r)),"2"===T.ruleForm.type&&(e=await ApiOperationOfferEdit(r)),D(e)&&window.close()},R=()=>{T.ruleForm.device=U.cacheDevice.select,T.dialogVisibleDevice=!1};d(L,((e,r)=>{(e=>{T.ruleForm.cutoff_start=e[0]/100,T.ruleForm.cutoff_end=e[1]/100})(e)}),{immediate:!0});u((()=>{const e=B.value,r=T.ruleForm.cutoff_start,t=T.ruleForm.cutoff_end;return{judge:((Number(t)-Number(r))*Number(e)).toFixed(0),all:Number(e).toFixed(0)}})),p((()=>{(async()=>{T.ruleForm.pkg_name,T.ruleForm.country,T.ruleForm.platform})()}));const H=async e=>{const r=await ApiGetCopyOfferData({offer_id:e}),{data:t}=r,a=((e,r)=>{let t={};return r.type,e.device&&(e.device=JSON.parse(e.device)),e.diy_siteid&&(e.diy_siteid=JSON.parse(e.diy_siteid)),"2"===r.type&&(t.id=e.id,t.offer_id=e.offer_id),t=o(o({},e),r),"1"===r.type&&(delete t.id,delete t.offer_id),t})(t,{type:T.ruleForm.type,isCopy:!0});T.ruleForm=o(o({},T.ruleForm),a)},K=()=>{const e=T.ruleForm.copy_offer;H(e)};return u((()=>{const e=T.ruleForm.tracking_link,r=T.ruleForm.attribute_provider;let t="";if("AppsFlyer"===r){const r=/pid=([\s\S]*)_int/g,a=[...e.matchAll(r)];if(0!==a.length)return t=a[0][1],T.ruleForm.pid=t,t}if("Adjust"===r){const r=/https:\/\/app.adjust.com\/([\s\S]*)\?/g,a=[...e.matchAll(r)];if(0!==a.length)return t=a[0][1],T.ruleForm.pid=t,t}return T.ruleForm.pid=t,t})),u((()=>{let e=0;if(U.cacheDevice,U.cacheDevice.hasOwnProperty("all")&&U.cacheDevice.hasOwnProperty("select")){let r=U.cacheDevice.all,t=U.cacheDevice.select;0!==r.length&&0!==t.length&&r.forEach((r=>{t.forEach((t=>{r.source===t.source&&r.label===t.label&&(e+=parseInt(r.device_count))}))})),T.search.deviceData.count=e}return null!=e?e:T.search.deviceData.count})),f((()=>{})),(e,r)=>{const t=_("el-form-item"),a=_("el-option"),o=_("el-select"),n=_("el-button"),s=_("el-input"),c=_("el-form"),d=_("el-dialog");return m(),g("div",V,[v(" form "),h(c,{ref_key:"ruleForm",ref:l,enctype:"multipart/form-data",rules:k(i),model:k(l),"label-width":"240px","label-position":"right"},{default:y((()=>[S,b("div",E,[v(" id "),h(t,{label:"ID:",prop:"offer_id"},{default:y((()=>[b("div",j,[b("span",{textContent:F(k(l).offer_id)},null,8,C)])])),_:1}),v(" channel "),h(t,{label:"Channel:",prop:"channel"},{default:y((()=>[h(o,{modelValue:k(l).channel,"onUpdate:modelValue":r[0]||(r[0]=e=>k(l).channel=e),filterable:"",class:"form-one",clearable:"",placeholder:""},{default:y((()=>[(m(!0),g(w,null,A(k(O).channel,(e=>(m(),q(a,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(" copy_offer "),h(t,{label:"Copy Offer:",prop:"copy_offer"},{default:y((()=>[h(s,{modelValue:k(l).copy_offer,"onUpdate:modelValue":r[1]||(r[1]=e=>k(l).copy_offer=e),modelModifiers:{trim:!0},class:"form-one copy-btn search-input",placeholder:""},{append:y((()=>[h(n,{slot:"append",type:"primary",icon:"Search",onClick:K})])),_:1},8,["modelValue"])])),_:1}),v(" offer_open_type "),h(t,{label:"Open Type:",prop:"offer_open_type"},{default:y((()=>[h(o,{modelValue:k(l).offer_open_type,"onUpdate:modelValue":r[2]||(r[2]=e=>k(l).offer_open_type=e),filterable:"",class:"form-one",clearable:"",placeholder:""},{default:y((()=>[(m(!0),g(w,null,A(k(T).options.channel,(e=>(m(),q(a,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])])),_:1},8,["rules","model"]),v(" form "),v(" footer "),b("div",N,[h(n,{type:"primary",onClick:$},{default:y((()=>[P])),_:1})]),v(" footer "),v(" dialog "),v(" device "),h(d,{modelValue:k(T).dialogVisibleDevice,"onUpdate:modelValue":r[3]||(r[3]=e=>k(T).dialogVisibleDevice=e),title:"Device",width:"90%"},{default:y((()=>[I,b("span",J,[v(' <el-button @click="cancleDevice">取 消</el-button> '),h(n,{type:"primary",onClick:R},{default:y((()=>[M])),_:1})])])),_:1},8,["modelValue"])])}}});export{U as default};
