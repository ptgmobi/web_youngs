import{d as e,h as l,r as a,L as r,q as t,c as s,z as o,e as i,s as m,v as u,x as d,P as n,o as f,K as c,A as p,f as v,g as _,E as y}from"./main-0a777472.js";import{s as g}from"./setting-c7abf732.js";import{b as F,c as b,d as h}from"./dsp-media-82eff567.js";import{A as x}from"./dsp-advertiser-4a2a0a9c.js";import{m as j}from"./message-d6ce123e.js";import{_ as w}from"./index-1624392f.js";import{u as q}from"./useUtils-9816d64a.js";import{d as V,e as U,i as C}from"./new-format-7f959bed.js";import{_ as k}from"./lodash-4786ff9c.js";import{u as A}from"./upload-5fd7378f.js";const D={class:"content-con from-one flex column"},L={class:"content-con from-one flex column"},M={class:"form-one flex jc-start"},P={class:"w100 flex"},R=e({__name:"details",setup(e){const{validate:R,uploadHttpRequest:z}=A,{adv_type:E,audience_manage_type:H}=g,{getRouterData:K,getCommonCountryList:N,goNewUrl:S}=q();let{proxy:$}=_();let B=l("create"),G=l([]);const I={id:void 0,name:"",descs:"",media_num:void 0,file_url:"",is_del:void 0},J=a({ruleForm:I,rules:{name:[{required:!0,message:"此项必填",trigger:["blur","change"]}]},options:{country:[{value:"",label:"",id:""}],advertiser:[{adv_id:"",name:""}],adv_type:E,audience_manage_type:H}}),O=()=>{$.$refs.ruleForm.validate((e=>{if(!e)return!1;W()}))},Q=["id","media_num"],T=["country"],W=async()=>{let e=n(J.ruleForm);if(e=V(e),e=U(e,Q),e=C(e,T),B.value,"create"===B.value){delete e.id;const l=await F(e);j(l)&&X()}if("edit"===B.value){const l=await b(e);j(l)&&X()}},X=()=>{S({url:"/media/custom/list"})},Y=(e,l)=>{},Z=(e,l)=>{let a=null==e?void 0:e.data;J.ruleForm.file_url=a,G.value.splice(0),G.value.push({name:a,url:a})},ee=(e,l)=>{y({message:"只能上传一个，请删除后重试",type:"warning"})},le=async e=>!0,ae=()=>{var e,l;let{query:a,params:r}=K();if(B.value=null!=(l=null==(e=a.type)?void 0:e.toString())?l:"",B.value,(async()=>{Promise.all([N(),x({limit:1e4,page:1})]).then((e=>{let l=e[0];J.options.country=l;let a=e[1];J.options.advertiser=a.data.data}))})(),"create"===B.value&&(J.ruleForm=k.cloneDeep(I)),"edit"===B.value){const{id:e}=r;(async(e,l)=>{const a=await h(e),{data:r}=a;J.ruleForm={...J.ruleForm,...r},J.ruleForm.file_url&&G.value.push({name:J.ruleForm.file_url,url:J.ruleForm.file_url}),J.ruleForm})(e)}};return r((()=>{ae()})),(e,l)=>{const a=t("el-input"),r=t("el-form-item"),n=t("el-button"),_=t("el-upload"),y=t("el-form");return f(),s("div",null,[o(" form "),i(y,{ref:"ruleForm",enctype:"multipart/form-data",rules:u(J).rules,model:u(J).ruleForm,"label-width":"150px","label-position":"right",class:"flex column",disabled:"edit"===u(B)&&2===u(J).ruleForm.is_del},{default:m((()=>[i(u(w),{title:"基础信息"}),d("div",D,[o(" 媒体列表名称 "),i(r,{class:"self-el-form-item",label:"媒体列表名称:",prop:"name"},{default:m((()=>[i(a,{modelValue:u(J).ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>u(J).ruleForm.name=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1}),o(" 描述 "),i(r,{class:"self-el-form-item",label:"描述:",prop:"descs"},{default:m((()=>[i(a,{modelValue:u(J).ruleForm.descs,"onUpdate:modelValue":l[1]||(l[1]=e=>u(J).ruleForm.descs=e),modelModifiers:{trim:!0},class:"form-one",placeholder:"",type:"textarea"},null,8,["modelValue"])])),_:1})]),i(u(w),{title:"选择媒体"}),d("div",L,[o(" 上传文件 "),i(r,{class:"self-el-form-item",label:"上传文件:",prop:"adv_type"},{default:m((()=>[d("div",M,[i(_,{class:"form-one",name:"url",action:"",limit:1,"list-type":"text","file-list":u(G),"onUpdate:file-list":l[2]||(l[2]=e=>c(G)?G.value=e:G=e),"on-remove":Y,"on-success":Z,"before-upload":le,"on-exceed":ee,"http-request":u(z)},{default:m((()=>[0===u(G).length?(f(),p(n,{key:0,type:"primary"},{default:m((()=>[v("上传媒体bundle")])),_:1})):o("v-if",!0)])),_:1},8,["file-list","http-request"])])])),_:1})])])),_:1},8,["rules","model","disabled"]),o(" form "),o(" footer "),d("div",P,[i(n,{type:"primary",onClick:O},{default:m((()=>[v(" 确认 ")])),_:1}),i(n,{type:"primary",onClick:X},{default:m((()=>[v(" 取消 ")])),_:1})])])}}});export{R as default};
