var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))i.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&s(e,l,a[l]);return e};import{_ as n,d,h as p,Z as u,r as c,w as m,b,L as v,q as g,$ as _,o as f,c as y,x as h,e as w,s as V,v as x,z as F,U as j,A as k,a8 as z,V as U,N as O,O as $,y as C,f as P}from"./main-c289050e.js";import{u as D,s as Q}from"./useUtils-034ffd86.js";import{s as S,A as I,a as A}from"./dsp-common-c0138de8.js";import{P as q}from"./index-19cba061.js";import{m as N}from"./message-7c571a95.js";import{_ as E}from"./lodash-6a3426b2.js";import{h as T,g as B}from"./new-format-0cb28217.js";import"./clipboard-polyfill.text.esm-fc4f7791.js";import{e as L,f as R,g as Z}from"./dsp-campaign-172ebb9a.js";const G={class:"controlBox w100 mb-10"},H={class:"flex jc-start flex-wrap w100"},J={class:"flex"},K={class:"flex"},M=P(" 查询 "),W={class:"mb-10 w100"},X=P("新建DPA模板"),Y={class:"pr"},ee={class:"flex jc-around"},ae=P("编辑"),le=P("归档"),te={class:"w100 flex"},ie={class:"img-box"},oe=["src"],se=d({name:"adserieslist"});var re,ne=n(d((re=r({},se),a(re,l({setup(e){const a=p(),l=p([{id:""}]),{status:t}=Q,{audit_status:i,feeds_num:o,creative_goals:s}=S,{goNewUrl:n,openAlert:d}=D(),P=u({status:"",dsp_category_id:"",creative_goals:"",audit_status:"",is_del:"1",value_type:"name",value:""}),se=p({}),re=p(!1),ne=c({preview_img:""});let de=c({dialogVisible:!1,cache:{item:{}},searchForm:P.value,useData:P.value,loading:!0,options:{status:t,audit_status:i,size:[],feeds_num:o,category:[],creative_goals:s,dpa_tpl:[],value_type:[{value:"name",label:"模板名称"},{value:"id",label:"模板ID"}]},list:[{id:1}],pagination:{pageSizes:[20,50,100,500,1e3],total:1,listQuery:{page:1,limit:50,importance:void 0,title:void 0,type:void 0,sort:"+id"}}});c({data:{mode:""},options:{mode:[{value:1,label:"开启"},{value:2,label:"暂停"},{value:0,label:"归档"}]}});const pe=e=>{l.value=e},ue=()=>{de.useData=E.cloneDeep(de.searchForm),ve()};p([]);const ce=()=>{n({url:"/campaign/dpa/create",query:{type:"create"}})},me=e=>async()=>{const{row:a,$index:l}=e,t=await(async e=>await Z({ids:e,is_del:2}))([a.id]);N(t)&&de.list.splice(l,1)};m((()=>l),((e,a)=>{e.value}),{immediate:!0,deep:!0});const be=e=>{let a=de.options.dpa_tpl.find((a=>a.id==e.row.follow_template_id));return a?(e.row.url=a.url,a.url):""},ve=async()=>{await(async()=>{Promise.all([R(),I(),A()]).then((e=>{let a=e[0].data.data;de.options.dpa_tpl=a.map((e=>(e.value=e.id,e.label=`${e.format}_${e.tpl_type}`,e.url=`https://staticdn.cloudmobi.net/dpa/demo/${e.format}_${e.tpl_type}_bg.png`,e)));let l=e[1].data;de.options.category=l.map((e=>(e.value=e.id,e.label=`${e.cn}-${e.en}`,e)));let t=e[2].data;de.options.size=t.map((e=>(e.value=e.size,e.label=e.size,e)))}))})(),de.loading=!0;let e=r(r({page:de.pagination.listQuery.page,limit:de.pagination.listQuery.limit},P.value),se.value);e[e.value_type]=e.value,delete e.value_type,delete e.value,e=T(e);const a=await L(e);if(a){const{data:e}=a;de.list=null==e?void 0:e.data,de.pagination.total=Number(e.count)}de.loading=!1};return b((()=>{})),v((()=>{ue()})),(e,l)=>{const t=g("el-option"),i=g("el-select"),o=g("el-form-item"),s=g("el-input"),r=g("el-checkbox"),p=g("el-button"),u=g("el-form"),c=g("el-table-column"),m=g("el-image"),b=g("el-dialog"),v=_("loading");return f(),y("div",null,[h("div",G,[w(u,{modelValue:x(de).searchForm,"onUpdate:modelValue":l[6]||(l[6]=e=>x(de).searchForm=e),inline:!0,class:"flex jc-between w100 ai-end"},{default:V((()=>[h("div",H,[F(" 选择适用商品 "),w(o,{label:""},{default:V((()=>[w(i,{modelValue:x(de).searchForm.dsp_category_id,"onUpdate:modelValue":l[0]||(l[0]=e=>x(de).searchForm.dsp_category_id=e),filterable:"",clearable:"",placeholder:"选择适用商品"},{default:V((()=>[(f(!0),y(O,null,$(x(de).options.category,(e=>(f(),k(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),F(" 选择创意目标 "),w(o,{label:""},{default:V((()=>[w(i,{modelValue:x(de).searchForm.creative_goals,"onUpdate:modelValue":l[1]||(l[1]=e=>x(de).searchForm.creative_goals=e),filterable:"",clearable:"",placeholder:"选择创意目标"},{default:V((()=>[(f(!0),y(O,null,$(x(de).options.creative_goals,(e=>(f(),k(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),F(" 所有审核状态 "),w(o,{label:""},{default:V((()=>[w(i,{modelValue:x(de).searchForm.audit_status,"onUpdate:modelValue":l[2]||(l[2]=e=>x(de).searchForm.audit_status=e),filterable:"",clearable:"",placeholder:"选择创意目标"},{default:V((()=>[(f(!0),y(O,null,$(x(de).options.audit_status,(e=>(f(),k(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),F(" 输入 "),w(o,{label:""},{default:V((()=>[w(s,{modelValue:x(de).searchForm.value,"onUpdate:modelValue":l[4]||(l[4]=e=>x(de).searchForm.value=e),placeholder:"请输入",class:"input-with-select"},{prepend:V((()=>[w(i,{modelValue:x(de).searchForm.value_type,"onUpdate:modelValue":l[3]||(l[3]=e=>x(de).searchForm.value_type=e),placeholder:"",class:"search-input-select",style:{width:"120px"}},{default:V((()=>[(f(!0),y(O,null,$(x(de).options.value_type,(e=>(f(),k(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),w(o,{label:""},{default:V((()=>[w(r,{modelValue:x(de).searchForm.is_del,"onUpdate:modelValue":l[5]||(l[5]=e=>x(de).searchForm.is_del=e),"true-label":"","false-label":"1",label:"包含已归档"},null,8,["modelValue"])])),_:1})]),h("div",J,[w(o,{class:"mr-0",style:{"margin-right":"0px"}},{default:V((()=>[h("div",K,[w(p,{type:"primary",onClick:ue},{default:V((()=>[M])),_:1}),F(' <el-button type="primary" @click="handleExportSearch">导出</el-button> ')])])),_:1})])])),_:1},8,["modelValue"]),F(' <el-input placeholder="请输入内容" v-model="state.searchForm.data" class=\'search-input\'>\n        <el-button slot="append" icon="Search" @click=\'searchFun\'></el-button>\n      </el-input> '),h("div",W,[w(p,{type:"primary",onClick:ce},{default:V((()=>[X])),_:1})])]),F(" table "),j((f(),k(x(z),{ref_key:"multipleTableRef",ref:a,center:"",data:x(de).list,class:"w100",border:"",onSelectionChange:pe},{default:V((()=>[w(c,{align:"center",type:"selection",width:"55"}),F(" 模板ID "),w(c,{sortable:"",prop:"id",label:"模板ID",align:"center"}),F(" 模板名称 "),w(c,{sortable:"",width:"120",prop:"name",label:"模板名称",align:"center"}),F(" 缩略图 "),w(c,{width:"120",prop:"url",label:"缩略图",align:"center"},{default:V((e=>[h("div",Y,[w(m,{class:"logo-img cp","z-index":9999,style:{width:"100px",height:"auto"},src:be(e),"preview-src-list":[be(e)],"initial-index":4,fit:"cover","preview-teleported":"true",onClick:a=>{return l=e.row.url,ne.preview_img=l,void(re.value=!0);var l}},null,8,["src","preview-src-list","onClick"])])])),_:1}),F(" 操作 "),w(c,{width:"200",label:"操作",align:"center"},{default:V((e=>[h("div",ee,[w(p,{class:"cp",type:"primary",onClick:a=>(({row:e})=>{const{id:a}=e;n({url:`/campaign/dpa/edit/${a}`,query:{type:"edit",campaign_type:e.type}})})(e)},{default:V((()=>[ae])),_:2},1032,["onClick"]),F(' <el-button\n              v-if="scope.row.is_del === 2"\n              class="cp"\n              type="default"\n              @click="editFn(scope)"\n            >查看</el-button> '),w(p,{class:"cp",type:"danger",onClick:a=>(async e=>{d({text:`确认归档${e.row.name}？`,title:"归档操作",buttonText:"确认"},me(e))})(e),disabled:2===e.row.is_del},{default:V((()=>[le])),_:2},1032,["onClick","disabled"])])])),_:1}),F(" 开关 "),F(' <el-table-column sortable\n        prop="status"\n        label="开关"\n        align="center"\n      >\n        <template #default="scope">\n          <el-switch\n            v-model="scope.row.status"\n            :active-value="1"\n            :inactive-value="2"\n            @click="changeStatus(scope)"\n          />\n        </template>\n      </el-table-column> '),F(" 审核状态 "),w(c,{sortable:"",prop:"audit_status",label:"审核状态",align:"center"},{default:V((e=>[h("span",null,C(x(B)(e.row.audit_status,x(de).options.audit_status)),1)])),_:1}),F(" Feeds个数 "),w(c,{sortable:"",width:"120",prop:"feeds_num",label:"Feeds个数",align:"center"}),F(" 适配尺寸 "),w(c,{sortable:"",width:"120",prop:"size",label:"适配尺寸",align:"center"},{default:V((e=>[h("span",null,C(x(B)(e.row.size,x(de).options.size)),1)])),_:1}),F(" 适用商品 "),w(c,{sortable:"",width:"120",prop:"dsp_category_id",label:"适用商品",align:"center"},{default:V((e=>[h("span",null,C(x(B)(e.row.dsp_category_id,x(de).options.category)),1)])),_:1}),F(" 创意目标 "),w(c,{sortable:"",width:"120",prop:"creative_goals",label:"创意目标",align:"center"},{default:V((e=>[h("span",null,C(x(B)(e.row.creative_goals,x(de).options.creative_goals)),1)])),_:1}),F(" 创建人 "),w(c,{sortable:"",width:"120",prop:"create_email",label:"创建人",align:"center"}),F(" 创建时间 "),w(c,{sortable:"",width:"160",prop:"create_time",label:"创建时间",align:"center"})])),_:1},8,["data"])),[[v,x(de).loading]]),F(" 分页 "),h("div",te,[j(w(q,{page:x(de).pagination.listQuery.page,"onUpdate:page":l[7]||(l[7]=e=>x(de).pagination.listQuery.page=e),limit:x(de).pagination.listQuery.limit,"onUpdate:limit":l[8]||(l[8]=e=>x(de).pagination.listQuery.limit=e),total:x(de).pagination.total,"page-sizes":x(de).pagination.pageSizes,onPagination:ve},null,8,["page","limit","total","page-sizes"]),[[U,x(de).pagination.total]])]),F(" 预览 "),w(b,{modelValue:re.value,"onUpdate:modelValue":l[9]||(l[9]=e=>re.value=e),title:"图片预览",width:"50%"},{default:V((()=>[h("div",ie,[h("img",{src:x(ne).preview_img,alt:""},null,8,oe)])])),_:1},8,["modelValue"])])}}})))),[["__scopeId","data-v-6d63a1fe"]]);export{ne as default};
