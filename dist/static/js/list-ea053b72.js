import{d as a,r as e,w as l,M as t,m as o,s as r,n,c as s,p as i,a as u,e as d,a5 as c,o as p,N as f,a6 as b,v as m,z as v,O as h,P as _,x as w,V as g,W as y,q as V,K as D,b as C,A as k}from"./index-b160a4d6.js";import{g as U,h as x,i as O,j as P,k as S,l as A,m as j,n as N,o as Q}from"./fenix-8f1866d2.js";import{P as E}from"./index-e884940e.js";import{h as I}from"./moment-56f006b0.js";import{m as T}from"./message-6c553f21.js";import{a as z,o as $}from"./new-format-f712eb45.js";const B=a({__name:"record",props:{busData:{require:!0,default:()=>({}),type:Object}},setup(a){const u=a,d=e({tableData:[{}]});return l((()=>u.busData.offer.offer_id),((a,e)=>{}),{immediate:!0}),t((()=>{u.busData,(async()=>{const a={offer_id:u.busData.offer.offer_id};d.tableData=[];const{data:e}=await U(a),l=e.sort(((a,e)=>{const l=Number(I(a.date,I.ISO_8601).format("X"));return Number(I(e.date,I.ISO_8601).format("X"))-l}));d.tableData=l})()})),(a,e)=>{const l=o("el-table-column"),t=o("el-table");return r(),n("div",null,[s(t,{data:d.tableData,style:{width:"100%"},border:""},{default:i((()=>[s(l,{fixed:"",prop:"date",label:"Date",align:"center"}),s(l,{fixed:"",prop:"record",label:"Record",align:"center"}),s(l,{fixed:"",prop:"email",label:"User",align:"center"})])),_:1},8,["data"])])}}}),F={class:"control-box w100 mb-10"},M={class:"mb-10"},R=C(" Offer Create "),q={class:"flex jc-start flex-wrap w100"},K={class:"flex"},X={class:"flex"},Z=C(" 查询 "),J={class:"body-box mt-10"},L={class:"flex"},W={key:0},G=C(" . "),H=C(" . "),Y=C(" . "),aa={class:"flex"},ea={class:"w100 flex"},la=a({name:"fenix-offer-list"}),ta=a({...la,setup(a){u(),d(!0);let l=d(!1);d(!1);const C=e({searchData:{adv_status:void 0,status:void 0,cvr_status:void 0,platform:void 0,attribute_provider:"",pub_name:"",offer_id:"",adv_offer:"",pkg:"",title:"",channel:"",pid:"",country:"",channel_type:void 0},tableData:[],options:{status:[{value:"1",label:"开"},{value:"2",label:"关"}],platform:[{value:"1",label:"Android"},{value:"2",label:"iOS"}],attribute_provider:[{value:"AppsFlyer",label:"AppsFlyer"},{value:"Branch",label:"Branch"},{value:"Adjust",label:"Adjust"},{value:"Singular",label:"Singular"},{value:"AppMetrica",label:"AppMetrica"}],pub:[{id:0,pub_name:""}],channel_type:[{value:"1",label:"BUZZ"},{value:"2",label:"SDK"}],dailyCapCount:{},cvr:{}},pagination:{pageSizes:["20","50","100","500","1000"],total:1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"}}});let U=e({});c(C,"tableData");const I=async()=>{const{data:a}=await j();C.options.pub=a},la=async()=>{const{data:a}=await N(),e={};for(const l in a)if(Object.prototype.hasOwnProperty.call(a,l)){const t=a[l].split("_"),o={click_w:t[0],installs:t[1],cvr_w:t[2]};e[l]=o}C.options.cvr=e},ta=async()=>{const{data:a}=await Q();C.options.dailyCapCount=a},oa=async()=>{let a={page:C.pagination.listQuery.page,limit:C.pagination.listQuery.limit};const e={...C.searchData};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const l=e[t];l&&(a[t]=l)}const l=await S(a);C.tableData=l.data.data,C.pagination.total=l.data.paging.count},ra=()=>{oa()},na=(a,e)=>{let l="";l=`${a.offer_id}_${e.slotid}`;const t=C.options.dailyCapCount[l];return t?`: ${t}`:""};p((()=>{})),t((()=>{(async()=>{Promise.all([I(),ta(),la()])})(),oa(),window.onpopstate=()=>{}})),f((()=>{})),b((()=>{}));return(a,e)=>{const t=o("el-button"),u=o("el-option"),d=o("el-select"),c=o("el-form-item"),p=o("el-input"),f=o("el-form"),b=o("el-table-column"),S=o("el-switch"),j=o("el-popconfirm"),N=o("el-table"),Q=o("el-dialog");return r(),n("div",null,[m("div",F,[m("div",M,[v(' <router-link to="/fenix/offer/create">\n          <el-button type="primary">\n            Offer Create\n          </el-button>\n        </router-link> '),s(t,{type:"primary",onClick:e[0]||(e[0]=a=>{$("/fenix/offer/create")})},{default:i((()=>[R])),_:1})]),s(f,{modelValue:C.searchData,"onUpdate:modelValue":e[14]||(e[14]=a=>C.searchData=a),inline:!0,class:"flex jc-between w100 ai-end"},{default:i((()=>[m("div",q,[s(c,{label:""},{default:i((()=>[s(d,{modelValue:C.searchData.adv_status,"onUpdate:modelValue":e[1]||(e[1]=a=>C.searchData.adv_status=a),clearable:"",class:"search-con",placeholder:"Adv Status"},{default:i((()=>[(r(!0),n(h,null,_(C.options.status,(a=>(r(),k(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(d,{modelValue:C.searchData.status,"onUpdate:modelValue":e[2]||(e[2]=a=>C.searchData.status=a),clearable:"",class:"search-con",placeholder:"Status"},{default:i((()=>[(r(!0),n(h,null,_(C.options.status,(a=>(r(),k(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(' <el-form-item label="">\n            <el-select v-model="state.searchData.cvr_status" clearable class="search-con" placeholder="Cvr Status">\n              <el-option\n                v-for="item in state.options.status"\n                :key="item.value"\n                :label="item.label"\n                :value="item.value"\n              />\n            </el-select>\n          </el-form-item> '),s(c,{label:""},{default:i((()=>[s(d,{modelValue:C.searchData.platform,"onUpdate:modelValue":e[3]||(e[3]=a=>C.searchData.platform=a),clearable:"",class:"search-con",placeholder:"Platform"},{default:i((()=>[(r(!0),n(h,null,_(C.options.platform,(a=>(r(),k(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(d,{modelValue:C.searchData.attribute_provider,"onUpdate:modelValue":e[4]||(e[4]=a=>C.searchData.attribute_provider=a),clearable:"",class:"search-con",placeholder:"Attribute Provider"},{default:i((()=>[(r(!0),n(h,null,_(C.options.attribute_provider,(a=>(r(),k(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(d,{modelValue:C.searchData.pub_name,"onUpdate:modelValue":e[5]||(e[5]=a=>C.searchData.pub_name=a),clearable:"",class:"search-con",placeholder:"Pub Name"},{default:i((()=>[(r(!0),n(h,null,_(C.options.pub,(a=>{var e;return r(),k(u,{key:a.id,label:a.pub_name,value:null!=(e=a.pub_name)?e:a.id},null,8,["label","value"])})),128))])),_:1},8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:C.searchData.offer_id,"onUpdate:modelValue":e[6]||(e[6]=a=>C.searchData.offer_id=a),placeholder:"Offer ID",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:C.searchData.adv_offer,"onUpdate:modelValue":e[7]||(e[7]=a=>C.searchData.adv_offer=a),placeholder:"Adv Offer",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:C.searchData.pkg,"onUpdate:modelValue":e[8]||(e[8]=a=>C.searchData.pkg=a),placeholder:"Pachage Name",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:C.searchData.title,"onUpdate:modelValue":e[9]||(e[9]=a=>C.searchData.title=a),placeholder:"Offer Title",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:C.searchData.channel,"onUpdate:modelValue":e[10]||(e[10]=a=>C.searchData.channel=a),placeholder:"Channel",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:C.searchData.country,"onUpdate:modelValue":e[11]||(e[11]=a=>C.searchData.country=a),placeholder:"Country",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:C.searchData.pid,"onUpdate:modelValue":e[12]||(e[12]=a=>C.searchData.pid=a),placeholder:"Pid",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(d,{modelValue:C.searchData.channel_type,"onUpdate:modelValue":e[13]||(e[13]=a=>C.searchData.channel_type=a),clearable:"",class:"search-con",placeholder:"Channel Type"},{default:i((()=>[(r(!0),n(h,null,_(C.options.channel_type,(a=>(r(),k(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),m("div",K,[s(c,{class:"mr-0",style:{"margin-right":"0px"}},{default:i((()=>[m("div",X,[s(t,{type:"primary",onClick:ra},{default:i((()=>[Z])),_:1}),v(' <el-button type="primary" @click="handleExportSearch">导出</el-button> ')])])),_:1})])])),_:1},8,["modelValue"]),v(' <el-input placeholder="请输入内容" v-model="searchData.data" class=\'search-input\'>\n        <el-button slot="append" icon="Search" @click=\'searchFun\'></el-button>\n      </el-input> ')]),v(" table "),m("div",J,[s(N,{data:C.tableData,class:"w100",height:"70vh",border:""},{default:i((()=>[s(b,{sortable:"",fixed:"",prop:"offer_id",label:"Offer ID",align:"center",width:"60"}),s(b,{sortable:"",fixed:"",prop:"adv_offer",label:"Adv Offer",align:"center",width:"87"}),s(b,{sortable:"",fixed:"",prop:"channel",label:"Channel",align:"center",width:"42"}),s(b,{sortable:"",prop:"revenue",label:"Revenue",align:"center",width:"45"}),s(b,{sortable:"",prop:"pkg",label:"Package Name",align:"center",width:"100"}),s(b,{sortable:"",prop:"title",label:"Offer Title",align:"center",width:"90"}),s(b,{sortable:"",prop:"pid",label:"Pid",align:"center",width:"77"}),s(b,{sortable:"",prop:"country",label:"Country",align:"center",width:"40"}),s(b,{sortable:"",label:"Adv Status",align:"center",width:"47"},{default:i((a=>[m("div",null,[m("span",null,w(1===a.row.adv_status?"开":"关"),1)])])),_:1}),s(b,{sortable:"",prop:"offer_id",label:"Click*w",align:"center",width:"55"},{default:i((a=>{var e;return[m("div",null,[m("span",null,w(null==(e=C.options.cvr[a.row.offer_id])?void 0:e.click_w),1)])]})),_:1}),s(b,{sortable:"",prop:"offer_id",label:"Installs",align:"center",width:"50"},{default:i((a=>{var e;return[m("div",null,[m("span",null,w(null==(e=C.options.cvr[a.row.offer_id])?void 0:e.installs),1)])]})),_:1}),s(b,{sortable:"",prop:"offer_id",label:"Cvr*w",align:"center",width:"48"},{default:i((a=>{var e;return[m("div",null,[m("span",null,w(null==(e=C.options.cvr[a.row.offer_id])?void 0:e.cvr_w),1)])]})),_:1}),s(b,{sortable:"",prop:"daily_cap",label:"Daily Cap",align:"center",width:"48"},{default:i((a=>[m("div",null,[m("span",null,w(a.row.daily_cap),1)])])),_:1}),s(b,{sortable:"",label:"Target Cvr*w",align:"center",width:"150"},{default:i((a=>[m("div",L,[s(p,{modelValue:a.row.target_cvr,"onUpdate:modelValue":e=>a.row.target_cvr=e,placeholder:"Please input",class:"input-with-select mr-5"},null,8,["modelValue","onUpdate:modelValue"]),s(t,{class:"mr-5 scale-button",type:"default",icon:"Edit",circle:"",onClick:e=>(async({row:a})=>{let e={id:a.id,target_cvr:a.target_cvr};e=z(e);const l=await P(e);T(l)})(a)},null,8,["onClick"]),s(S,{modelValue:a.row.cvr_status,"onUpdate:modelValue":e=>a.row.cvr_status=e,class:"scale-button","active-value":1,"inactive-value":2,onChange:e=>(async({row:a})=>{let e={id:a.id,cvr_status:a.cvr_status};e=z(e);const l=await O(e);T(l)||(a.cvr_status=1===a.cvr_status?2:1)})(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])),_:1}),s(b,{sortable:"",label:"Traffic Data",align:"left",width:"200"},{default:i((a=>[a.row.traffic?(r(),n("div",W,[(r(!0),n(h,null,_(JSON.parse(a.row.traffic),(e=>(r(),n("div",{key:e},[m("div",null,[m("span",null,w(1===e.pub_status?"开":"关"),1),G,m("span",null,w(e.pub),1),H,m("span",null,w(e.payout),1),Y,m("span",null,w(e.cap_daily),1),m("span",null,w(na(a.row,e)),1)])])))),128))])):v("v-if",!0)])),_:1}),s(b,{sortable:"",label:"Operation",align:"center",width:"130"},{default:i((a=>[v(' <router-link :to="getEditUrl(scope)">\n              <el-button\n                class="cp mr-5"\n                type="primary"\n                icon="Edit"\n                circle\n              ></el-button>\n            </router-link> '),s(t,{class:"cp mr-5",type:"primary",icon:"Edit",onClick:e=>(a=>{let e=(a=>`/fenix/offer/edit/${a.id}`)(a);$(e)})(a.row),circle:""},null,8,["onClick"]),s(S,{modelValue:a.row.status,"onUpdate:modelValue":e=>a.row.status=e,"active-value":1,"inactive-value":2,class:"mr-5",onChange:e=>(async({row:a})=>{const e={id:a.id,status:a.status},l=await x(e);T(l)||(a.status=1===a.status?2:1)})(a)},null,8,["modelValue","onUpdate:modelValue","onChange"]),s(j,{title:"删除后无法再生成该Offer ID，请谨慎操作！",onConfirm:e=>(async a=>{const{row:e}=a,l=await A(e.id);T(l)&&C.tableData.splice(a.$index,1)})(a)},{reference:i((()=>[s(t,{type:"danger",icon:"Delete",circle:""})])),_:2},1032,["onConfirm"])])),_:1}),s(b,{sortable:"",prop:"last_time",label:"Last Time",align:"center",width:"80"}),s(b,{sortable:"",label:"Platform",align:"center",width:"55"},{default:i((a=>[m("div",null,[m("span",null,w(1===a.row.platform?"Android":"iOS"),1)])])),_:1}),s(b,{sortable:"",prop:"attribute_provider",label:"Attribute Provider",align:"center",width:"80"}),s(b,{sortable:"",label:"Record",align:"center",width:"52"},{default:i((({row:a})=>[s(t,{class:"scale-button",icon:"View",circle:"",onClick:e=>(a=>{U.offer=a,l.value=!0})(a)},null,8,["onClick"])])),_:1}),s(b,{sortable:"",label:"Comment",align:"center",width:"150"},{default:i((a=>[m("div",aa,[s(p,{modelValue:a.row.description,"onUpdate:modelValue":e=>a.row.description=e,placeholder:"Please input",class:"input-with-select mr-5"},null,8,["modelValue","onUpdate:modelValue"]),s(t,{class:"scale-button",type:"default",icon:"Edit",circle:""})])])),_:1})])),_:1},8,["data"])]),v(" 分页 "),m("div",ea,[g(s(V(E),{page:C.pagination.listQuery.page,"onUpdate:page":e[15]||(e[15]=a=>C.pagination.listQuery.page=a),limit:C.pagination.listQuery.limit,"onUpdate:limit":e[16]||(e[16]=a=>C.pagination.listQuery.limit=a),total:C.pagination.total,"page-sizes":C.pagination.pageSizes,onPagination:oa},null,8,["page","limit","total","page-sizes"]),[[y,C.pagination.total]])]),v(" record "),s(Q,{modelValue:V(l),"onUpdate:modelValue":e[18]||(e[18]=a=>D(l)?l.value=a:l=a),title:"日志",width:"80%","destroy-on-close":""},{default:i((()=>[s(B,{modelValue:V(l),"onUpdate:modelValue":e[17]||(e[17]=a=>D(l)?l.value=a:l=a),"bus-data":V(U)},null,8,["modelValue","bus-data"])])),_:1},8,["modelValue"])])}}});export{ta as default};
