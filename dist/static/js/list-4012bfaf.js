import{d as a,r as e,w as l,L as t,q as o,o as r,c as n,e as s,s as i,a as u,h as d,a4 as c,b as p,M as f,a5 as b,x as m,z as v,U as h,V as _,v as w,K as g,f as y,N as V,O as D,A as C,y as k}from"./main-0a777472.js";import{g as U,h as x,i as O,j as P,k as S,l as A,m as j,n as N,o as Q}from"./fenix-38f35efe.js";import{P as E}from"./index-2575c6ed.js";import{h as I}from"./moment-56f006b0.js";import{m as T}from"./message-d6ce123e.js";import{o as z,a as $}from"./new-format-7f959bed.js";const B=a({__name:"record",props:{busData:{require:!0,default:()=>({}),type:Object}},setup(a){const u=a,d=e({tableData:[{}]});return l((()=>u.busData.offer.offer_id),((a,e)=>{}),{immediate:!0}),t((()=>{u.busData,(async()=>{const a={offer_id:u.busData.offer.offer_id};d.tableData=[];const{data:e}=await U(a),l=e.sort(((a,e)=>{const l=Number(I(a.date,I.ISO_8601).format("X"));return Number(I(e.date,I.ISO_8601).format("X"))-l}));d.tableData=l})()})),(a,e)=>{const l=o("el-table-column"),t=o("el-table");return r(),n("div",null,[s(t,{data:d.tableData,style:{width:"100%"},border:""},{default:i((()=>[s(l,{fixed:"",prop:"date",label:"Date",align:"center"}),s(l,{fixed:"",prop:"record",label:"Record",align:"center"}),s(l,{fixed:"",prop:"email",label:"User",align:"center"})])),_:1},8,["data"])])}}}),F={class:"control-box w100 mb-10"},M={class:"mb-10"},R={class:"flex jc-start flex-wrap w100"},q={class:"flex"},K={class:"flex"},L={class:"body-box mt-10"},X={class:"flex"},Z={key:0},J={class:"flex"},G={class:"w100 flex"},H=a({name:"fenix-offer-list"}),W=a({...H,setup(a){u(),d(!0);let l=d(!1);d(!1);const U=e({searchData:{adv_status:void 0,status:void 0,cvr_status:void 0,platform:void 0,attribute_provider:"",pub_name:"",offer_id:"",adv_offer:"",pkg:"",title:"",channel:"",pid:"",country:"",channel_type:void 0},tableData:[],options:{status:[{value:"1",label:"开"},{value:"2",label:"关"}],platform:[{value:"1",label:"Android"},{value:"2",label:"iOS"}],attribute_provider:[{value:"AppsFlyer",label:"AppsFlyer"},{value:"Branch",label:"Branch"},{value:"Adjust",label:"Adjust"},{value:"Singular",label:"Singular"},{value:"AppMetrica",label:"AppMetrica"}],pub:[{id:0,pub_name:""}],channel_type:[{value:"1",label:"BUZZ"},{value:"2",label:"SDK"}],dailyCapCount:{},cvr:{}},pagination:{pageSizes:["20","50","100","500","1000"],total:1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"}}});let I=e({});c(U,"tableData");const H=async()=>{const{data:a}=await A();U.options.pub=a},W=async()=>{const{data:a}=await j(),e={};for(const l in a)if(Object.prototype.hasOwnProperty.call(a,l)){const t=a[l].split("_"),o={click_w:t[0],installs:t[1],cvr_w:t[2]};e[l]=o}U.options.cvr=e},Y=async()=>{const{data:a}=await N();U.options.dailyCapCount=a},aa=async()=>{let a={page:U.pagination.listQuery.page,limit:U.pagination.listQuery.limit};const e={...U.searchData};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const l=e[t];l&&(a[t]=l)}const l=await x(a);U.tableData=l.data.data,U.pagination.total=l.data.paging.count},ea=()=>{aa()},la=(a,e)=>{let l="";l=`${a.offer_id}_${e.slotid}`;const t=U.options.dailyCapCount[l];return t?`: ${t}`:""};p((()=>{})),t((()=>{(async()=>{Promise.all([H(),Y(),W()])})(),aa(),window.onpopstate=()=>{}})),f((()=>{})),b((()=>{}));return(a,e)=>{const t=o("el-button"),u=o("el-option"),d=o("el-select"),c=o("el-form-item"),p=o("el-input"),f=o("el-form"),b=o("el-table-column"),x=o("el-switch"),A=o("el-popconfirm"),j=o("el-table"),N=o("el-dialog");return r(),n("div",null,[m("div",F,[m("div",M,[v(' <router-link to="/fenix/offer/create">\n          <el-button type="primary">\n            Offer Create\n          </el-button>\n        </router-link> '),s(t,{type:"primary",onClick:e[0]||(e[0]=a=>{z("/fenix/offer/create")})},{default:i((()=>[y(" Offer Create ")])),_:1})]),s(f,{modelValue:U.searchData,"onUpdate:modelValue":e[14]||(e[14]=a=>U.searchData=a),inline:!0,class:"flex jc-between w100 ai-end"},{default:i((()=>[m("div",R,[s(c,{label:""},{default:i((()=>[s(d,{modelValue:U.searchData.adv_status,"onUpdate:modelValue":e[1]||(e[1]=a=>U.searchData.adv_status=a),clearable:"",class:"search-con",placeholder:"Adv Status"},{default:i((()=>[(r(!0),n(V,null,D(U.options.status,(a=>(r(),C(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(d,{modelValue:U.searchData.status,"onUpdate:modelValue":e[2]||(e[2]=a=>U.searchData.status=a),clearable:"",class:"search-con",placeholder:"Status"},{default:i((()=>[(r(!0),n(V,null,D(U.options.status,(a=>(r(),C(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(' <el-form-item label="">\n            <el-select v-model="state.searchData.cvr_status" clearable class="search-con" placeholder="Cvr Status">\n              <el-option\n                v-for="item in state.options.status"\n                :key="item.value"\n                :label="item.label"\n                :value="item.value"\n              />\n            </el-select>\n          </el-form-item> '),s(c,{label:""},{default:i((()=>[s(d,{modelValue:U.searchData.platform,"onUpdate:modelValue":e[3]||(e[3]=a=>U.searchData.platform=a),clearable:"",class:"search-con",placeholder:"Platform"},{default:i((()=>[(r(!0),n(V,null,D(U.options.platform,(a=>(r(),C(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(d,{modelValue:U.searchData.attribute_provider,"onUpdate:modelValue":e[4]||(e[4]=a=>U.searchData.attribute_provider=a),clearable:"",class:"search-con",placeholder:"Attribute Provider"},{default:i((()=>[(r(!0),n(V,null,D(U.options.attribute_provider,(a=>(r(),C(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(d,{modelValue:U.searchData.pub_name,"onUpdate:modelValue":e[5]||(e[5]=a=>U.searchData.pub_name=a),clearable:"",class:"search-con",placeholder:"Pub Name"},{default:i((()=>[(r(!0),n(V,null,D(U.options.pub,(a=>{var e;return r(),C(u,{key:a.id,label:a.pub_name,value:null!=(e=a.pub_name)?e:a.id},null,8,["label","value"])})),128))])),_:1},8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:U.searchData.offer_id,"onUpdate:modelValue":e[6]||(e[6]=a=>U.searchData.offer_id=a),placeholder:"Offer ID",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:U.searchData.adv_offer,"onUpdate:modelValue":e[7]||(e[7]=a=>U.searchData.adv_offer=a),placeholder:"Adv Offer",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:U.searchData.pkg,"onUpdate:modelValue":e[8]||(e[8]=a=>U.searchData.pkg=a),placeholder:"Pachage Name",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:U.searchData.title,"onUpdate:modelValue":e[9]||(e[9]=a=>U.searchData.title=a),placeholder:"Offer Title",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:U.searchData.channel,"onUpdate:modelValue":e[10]||(e[10]=a=>U.searchData.channel=a),placeholder:"Channel",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:U.searchData.country,"onUpdate:modelValue":e[11]||(e[11]=a=>U.searchData.country=a),placeholder:"Country",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(p,{modelValue:U.searchData.pid,"onUpdate:modelValue":e[12]||(e[12]=a=>U.searchData.pid=a),placeholder:"Pid",class:"search-con"},null,8,["modelValue"])])),_:1}),s(c,{label:""},{default:i((()=>[s(d,{modelValue:U.searchData.channel_type,"onUpdate:modelValue":e[13]||(e[13]=a=>U.searchData.channel_type=a),clearable:"",class:"search-con",placeholder:"Channel Type"},{default:i((()=>[(r(!0),n(V,null,D(U.options.channel_type,(a=>(r(),C(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),m("div",q,[s(c,{class:"mr-0",style:{"margin-right":"0px"}},{default:i((()=>[m("div",K,[s(t,{type:"primary",onClick:ea},{default:i((()=>[y(" 查询 ")])),_:1}),v(' <el-button type="primary" @click="handleExportSearch">导出</el-button> ')])])),_:1})])])),_:1},8,["modelValue"]),v(' <el-input placeholder="请输入内容" v-model="searchData.data" class=\'search-input\'>\n        <el-button slot="append" icon="Search" @click=\'searchFun\'></el-button>\n      </el-input> ')]),v(" table "),m("div",L,[s(j,{data:U.tableData,class:"w100",height:"70vh",border:""},{default:i((()=>[s(b,{sortable:"",fixed:"",prop:"offer_id",label:"Offer ID",align:"center",width:"60"}),s(b,{sortable:"",fixed:"",prop:"adv_offer",label:"Adv Offer",align:"center",width:"87"}),s(b,{sortable:"",fixed:"",prop:"channel",label:"Channel",align:"center",width:"42"}),s(b,{sortable:"",prop:"revenue",label:"Revenue",align:"center",width:"45"}),s(b,{sortable:"",prop:"pkg",label:"Package Name",align:"center",width:"100"}),s(b,{sortable:"",prop:"title",label:"Offer Title",align:"center",width:"90"}),s(b,{sortable:"",prop:"pid",label:"Pid",align:"center",width:"77"}),s(b,{sortable:"",prop:"country",label:"Country",align:"center",width:"40"}),s(b,{sortable:"",label:"Adv Status",align:"center",width:"47"},{default:i((a=>[m("div",null,[m("span",null,k(1===a.row.adv_status?"开":"关"),1)])])),_:1}),s(b,{sortable:"",prop:"offer_id",label:"Click*w",align:"center",width:"55"},{default:i((a=>{var e;return[m("div",null,[m("span",null,k(null==(e=U.options.cvr[a.row.offer_id])?void 0:e.click_w),1)])]})),_:1}),s(b,{sortable:"",prop:"offer_id",label:"Installs",align:"center",width:"50"},{default:i((a=>{var e;return[m("div",null,[m("span",null,k(null==(e=U.options.cvr[a.row.offer_id])?void 0:e.installs),1)])]})),_:1}),s(b,{sortable:"",prop:"offer_id",label:"Cvr*w",align:"center",width:"48"},{default:i((a=>{var e;return[m("div",null,[m("span",null,k(null==(e=U.options.cvr[a.row.offer_id])?void 0:e.cvr_w),1)])]})),_:1}),s(b,{sortable:"",prop:"daily_cap",label:"Daily Cap",align:"center",width:"48"},{default:i((a=>[m("div",null,[m("span",null,k(a.row.daily_cap),1)])])),_:1}),s(b,{sortable:"",label:"Target Cvr*w",align:"center",width:"150"},{default:i((a=>[m("div",X,[s(p,{modelValue:a.row.target_cvr,"onUpdate:modelValue":e=>a.row.target_cvr=e,placeholder:"Please input",class:"input-with-select mr-5"},null,8,["modelValue","onUpdate:modelValue"]),s(t,{class:"mr-5 scale-button",type:"default",icon:"Edit",circle:"",onClick:e=>(async({row:a})=>{let e={id:a.id,target_cvr:a.target_cvr};e=$(e);const l=await S(e);T(l)})(a)},null,8,["onClick"]),s(x,{modelValue:a.row.cvr_status,"onUpdate:modelValue":e=>a.row.cvr_status=e,class:"scale-button","active-value":1,"inactive-value":2,onChange:e=>(async({row:a})=>{let e={id:a.id,cvr_status:a.cvr_status};e=$(e);const l=await P(e);T(l)||(a.cvr_status=1===a.cvr_status?2:1)})(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])),_:1}),s(b,{sortable:"",label:"Traffic Data",align:"left",width:"200"},{default:i((a=>[a.row.traffic?(r(),n("div",Z,[(r(!0),n(V,null,D(JSON.parse(a.row.traffic),(e=>(r(),n("div",{key:e},[m("div",null,[m("span",null,k(1===e.pub_status?"开":"关"),1),y(" . "),m("span",null,k(e.pub),1),y(" . "),m("span",null,k(e.payout),1),y(" . "),m("span",null,k(e.cap_daily),1),m("span",null,k(la(a.row,e)),1)])])))),128))])):v("v-if",!0)])),_:1}),s(b,{sortable:"",label:"Operation",align:"center",width:"130"},{default:i((a=>[v(' <router-link :to="getEditUrl(scope)">\n              <el-button\n                class="cp mr-5"\n                type="primary"\n                icon="Edit"\n                circle\n              ></el-button>\n            </router-link> '),s(t,{class:"cp mr-5",type:"primary",icon:"Edit",onClick:e=>(a=>{let e=(a=>`/fenix/offer/edit/${a.id}`)(a);z(e)})(a.row),circle:""},null,8,["onClick"]),s(x,{modelValue:a.row.status,"onUpdate:modelValue":e=>a.row.status=e,"active-value":1,"inactive-value":2,class:"mr-5",onChange:e=>(async({row:a})=>{const e={id:a.id,status:a.status},l=await O(e);T(l)||(a.status=1===a.status?2:1)})(a)},null,8,["modelValue","onUpdate:modelValue","onChange"]),s(A,{title:"删除后无法再生成该Offer ID，请谨慎操作！",onConfirm:e=>(async a=>{const{row:e}=a,l=await Q(e.id);T(l)&&U.tableData.splice(a.$index,1)})(a)},{reference:i((()=>[s(t,{type:"danger",icon:"Delete",circle:""})])),_:2},1032,["onConfirm"])])),_:1}),s(b,{sortable:"",prop:"last_time",label:"Last Time",align:"center",width:"80"}),s(b,{sortable:"",label:"Platform",align:"center",width:"55"},{default:i((a=>[m("div",null,[m("span",null,k(1===a.row.platform?"Android":"iOS"),1)])])),_:1}),s(b,{sortable:"",prop:"attribute_provider",label:"Attribute Provider",align:"center",width:"80"}),s(b,{sortable:"",label:"Record",align:"center",width:"52"},{default:i((({row:a})=>[s(t,{class:"scale-button",icon:"View",circle:"",onClick:e=>(a=>{I.offer=a,l.value=!0})(a)},null,8,["onClick"])])),_:1}),s(b,{sortable:"",label:"Comment",align:"center",width:"150"},{default:i((a=>[m("div",J,[s(p,{modelValue:a.row.description,"onUpdate:modelValue":e=>a.row.description=e,placeholder:"Please input",class:"input-with-select mr-5"},null,8,["modelValue","onUpdate:modelValue"]),s(t,{class:"scale-button",type:"default",icon:"Edit",circle:""})])])),_:1})])),_:1},8,["data"])]),v(" 分页 "),m("div",G,[h(s(w(E),{page:U.pagination.listQuery.page,"onUpdate:page":e[15]||(e[15]=a=>U.pagination.listQuery.page=a),limit:U.pagination.listQuery.limit,"onUpdate:limit":e[16]||(e[16]=a=>U.pagination.listQuery.limit=a),total:U.pagination.total,"page-sizes":U.pagination.pageSizes,onPagination:aa},null,8,["page","limit","total","page-sizes"]),[[_,U.pagination.total]])]),v(" record "),s(N,{modelValue:w(l),"onUpdate:modelValue":e[18]||(e[18]=a=>g(l)?l.value=a:l=a),title:"日志",width:"80%","destroy-on-close":""},{default:i((()=>[s(B,{modelValue:w(l),"onUpdate:modelValue":e[17]||(e[17]=a=>g(l)?l.value=a:l=a),"bus-data":w(I)},null,8,["modelValue","bus-data"])])),_:1},8,["modelValue"])])}}});export{W as default};
