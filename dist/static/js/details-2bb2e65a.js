import{_ as e,d as l,h as r,r as a,L as t,q as o,c as i,z as u,e as s,s as m,v as d,x as n,K as p,P as c,o as f,N as v,O as _,A as g,f as h,y,aa as F,g as w,E as b}from"./main-0a777472.js";import{u as V,s as U}from"./useUtils-9816d64a.js";import{b as x,c as z,d as q}from"./dsp-campaign-e75c5a1e.js";import{m as k}from"./message-d6ce123e.js";import{_ as j}from"./index-1624392f.js";import{d as L,e as C}from"./new-format-7f959bed.js";import{_ as $}from"./lodash-4786ff9c.js";import{u as M}from"./upload-5fd7378f.js";import"./dsp-advertiser-4a2a0a9c.js";const P={logo_type_reg:/png|jpg|jpeg/,logo_limit:3145728,logo_size:[{width:100,height:100},{width:500,height:500}],image_type_reg:/png|jpg|jpeg|gif/,image_limit:3145728,image_size:[{width:160,height:600},{width:250,height:250},{width:300,height:50},{width:300,height:250},{width:300,height:600},{width:320,height:50},{width:320,height:100},{width:320,height:480},{width:480,height:320},{width:628,height:1200},{width:728,height:90},{width:970,height:250},{width:1200,height:628}],video_type_reg:/mp4/,video_limit:10485760,video_duration:30,video_size:[{width:320,height:480},{width:480,height:320}],cover_image_type_reg:/png|jpg|jpeg|gif/,cover_image_limit:3145728,cover_image_size:[{width:320,height:480},{width:480,height:320}]};const R={class:"content-con from-one flex column"},D={class:"content-con from-one flex column"},S={key:0},B=["src"],I={class:"upload-video-control-box el-upload-list__item-actions flex"},N=["onClick"],A={class:"w100 flex"},E={class:"flex"},H=["src"],K=["src"];var O=e(l({__name:"details",setup(e){const{validate:l,uploadHttpRequest:O}=M,{ad_type:G,audit_status:J}=U,{logo_type_reg:Q,logo_limit:T,logo_size:W,image_type_reg:X,image_limit:Y,image_size:Z,video_type_reg:ee,video_limit:le,video_duration:re,video_size:ae,cover_image_type_reg:te,cover_image_limit:oe,cover_image_size:ie}=P,{getRouterData:ue,getCommonCountryList:se,goNewUrl:me}=V();let{proxy:de}=w();const ne=r(""),pe=r(""),ce=r(!1),fe="此项必填";let ve=r("create"),_e=r([]),ge=r([]),he=r([]),ye=r([]);const Fe={id:void 0,name:"",descs:"",type:1,url:"",audit_status:void 0,size:"",memory_size:"",format:"",duration:void 0,status:1,is_del:void 0,logo_url:"",title:"",main_body:"",actions:"",brand:"",cover_url:"",video_url:"",raw_file_image:void 0,raw_file_video:void 0},we=a({ruleForm:Fe,rules:{name:[{required:!0,message:fe,trigger:["blur","change"]}],title:[{required:!0,message:fe,trigger:["blur","change"]}],main_body:[{required:!0,message:fe,trigger:["blur","change"]}],actions:[{required:!0,message:fe,trigger:["blur","change"]}],brand:[{required:!0,message:fe,trigger:["blur","change"]}],url:[{required:!0,message:fe,trigger:["blur","change"]}],logo_url:[{required:!0,message:fe,trigger:["blur","change"]}],cover_url:[{required:!0,message:fe,trigger:["blur","change"]}]},options:{type:G,audit_status:J}}),be=()=>{Ue(we.ruleForm),de.$refs.ruleForm.validate((e=>{if(!e)return!1;xe()}))},Ve=["id","adv_series_type","adv_series_budget","duration"],Ue=e=>{let l=e.type;if(1===l||3===l){let l=e.raw_file_image;l&&(e.size=`${l.w}*${l.h}`,e.memory_size=`${(l.limit/1048576).toFixed(2)}MB`,e.format=l.type,delete e.duration)}if(2===l){let l=e.raw_file_video;l&&(e.size=`${l.w}*${l.h}`,e.memory_size=`${(l.limit/1048576).toFixed(2)}MB`,e.format=l.type,e.duration=l.duration.toFixed(0),e.url=e.video_url)}return e},xe=async()=>{let e=c(we.ruleForm),l=new URLSearchParams;l.append("type",e.type);let r=`type=${l.get("type")}`;if(e=L(e),e=C(e,Ve),ve.value,"create"===ve.value){delete e.id;const l=await x(r,e);k(l)&&ze()}if("edit"===ve.value){const l=await z(r,e);k(l)&&ze()}},ze=()=>{me({url:"/campaign/administration/list"})},qe=(e,l)=>{},ke=(e,l)=>{ge.value.splice(0)},je=e=>{ne.value=e.url;let l="",r=ee;X.test(ne.value)&&(l="image"),r.test(ne.value)&&(l="video"),pe.value=l,ce.value=!0},Le=(e,l)=>{let r=null==e?void 0:e.data;we.ruleForm.logo_url=r,he.value.splice(0),he.value.push({name:r,url:r})},Ce=(e,l)=>{let r=null==e?void 0:e.data;we.ruleForm.url=r,_e.value.splice(0),_e.value.push({name:r,url:r})},$e=(e,l)=>{let r=null==e?void 0:e.data;we.ruleForm.cover_url=r,ye.value.splice(0),ye.value.push({name:r,url:r})},Me=(e,l)=>{let r=null==e?void 0:e.data;we.ruleForm.video_url=r,ge.value.splice(0),ge.value.push({name:r,url:r})},Pe=async e=>l(e,"image",{type_reg:Q,limit:T,size:W}),Re=async e=>{const r={type_reg:X,limit:Y,size:Z};let a=await l(e,"image",r);return we.ruleForm.raw_file_image=a.data,a},De=async e=>l(e,"image",{type_reg:te,limit:oe,size:ie}),Se=async e=>{const r={type_reg:ee,limit:le,size:ae,duration:re};let a=await l(e,"video",r);return we.ruleForm.raw_file_video=a.data,a},Be=(e,l)=>{b({message:"只能上传一个，请删除后重试",type:"warning"})},Ie=()=>{var e,l;let{query:r,params:a}=ue();if(ve.value=null!=(l=null==(e=r.type)?void 0:e.toString())?l:"",ve.value,(async()=>{})(),"create"===ve.value&&(we.ruleForm=$.cloneDeep(Fe)),"edit"===ve.value){const{id:e}=a,{campaign_type:l}=r;(async(e,l)=>{let r=new URLSearchParams;r.append("type",l);let a=`type=${r.get("type")}`;const t=await q(e,a),{data:o}=t;we.ruleForm={...we.ruleForm,...o},we.ruleForm,1===we.ruleForm.type&&we.ruleForm.url&&_e.value.push({name:we.ruleForm.url,url:we.ruleForm.url}),2===we.ruleForm.type&&(we.ruleForm.url&&(ge.value.push({name:we.ruleForm.url,url:we.ruleForm.url}),we.ruleForm.video_url=we.ruleForm.url),we.ruleForm.logo_url&&he.value.push({name:we.ruleForm.logo_url,url:we.ruleForm.logo_url}),we.ruleForm.cover_url&&ye.value.push({name:we.ruleForm.cover_url,url:we.ruleForm.cover_url})),3===we.ruleForm.type&&(we.ruleForm.url&&_e.value.push({name:we.ruleForm.url,url:we.ruleForm.url}),we.ruleForm.logo_url&&he.value.push({name:we.ruleForm.logo_url,url:we.ruleForm.logo_url}))})(e,l)}};return t((()=>{Ie()})),(e,l)=>{const r=o("el-input"),a=o("el-form-item"),t=o("el-radio"),c=o("el-radio-group"),w=o("el-icon"),b=o("el-upload"),V=o("zoom-in"),U=o("Delete"),x=o("el-form"),z=o("el-button"),q=o("el-dialog");return f(),i("div",null,[u(" form "),s(x,{ref:"ruleForm",enctype:"multipart/form-data",rules:d(we).rules,model:d(we).ruleForm,"label-width":"150px","label-position":"right",class:"flex column",disabled:"edit"===d(ve)&&2===d(we).ruleForm.is_del},{default:m((()=>[s(d(j),{title:"基础信息"}),n("div",R,[u(" 创意名称 "),s(a,{class:"self-el-form-item",label:"创意名称:",prop:"name"},{default:m((()=>[s(r,{modelValue:d(we).ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>d(we).ruleForm.name=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1}),u(" 描述 "),s(a,{class:"self-el-form-item",label:"描述:",prop:"descs"},{default:m((()=>[s(r,{modelValue:d(we).ruleForm.descs,"onUpdate:modelValue":l[1]||(l[1]=e=>d(we).ruleForm.descs=e),modelModifiers:{trim:!0},class:"form-one",placeholder:"",type:"textarea"},null,8,["modelValue"])])),_:1})]),s(d(j),{title:"创意设计"}),n("div",D,[u(" 创意样式 "),s(a,{class:"self-el-form-item",label:"创意样式:",prop:"type"},{default:m((()=>[s(c,{class:"form-one",modelValue:d(we).ruleForm.type,"onUpdate:modelValue":l[2]||(l[2]=e=>d(we).ruleForm.type=e)},{default:m((()=>[(f(!0),i(v,null,_(d(we).options.type,(e=>(f(),g(t,{label:e.value},{default:m((()=>[h(y(e.label),1)])),_:2},1032,["label"])))),256))])),_:1},8,["modelValue"])])),_:1}),u(" 上传素材 --- 图片 "),1===d(we).ruleForm.type||3===d(we).ruleForm.type?(f(),g(a,{key:0,class:"self-el-form-item",label:"上传图片素材:",prop:"url"},{default:m((()=>[s(b,{class:"avatar-uploader",name:"url",action:"",limit:1,"list-type":"picture-card","file-list":d(_e),"onUpdate:file-list":l[3]||(l[3]=e=>p(_e)?_e.value=e:_e=e),"on-preview":je,"on-remove":qe,"on-success":Ce,"before-upload":Re,"on-exceed":Be,"http-request":d(O)},{default:m((()=>[u(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),s(w,null,{default:m((()=>[s(d(F))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):u("v-if",!0),u(" 上传素材 --- 视频 "),2===d(we).ruleForm.type?(f(),g(a,{key:1,class:"self-el-form-item",label:"上传视频素材:",prop:"url"},{default:m((()=>[s(b,{class:"avatar-uploader",name:"url",action:"",accept:"",limit:1,"list-type":"picture-card","file-list":d(ge),"onUpdate:file-list":l[4]||(l[4]=e=>p(ge)?ge.value=e:ge=e),"on-preview":je,"on-remove":qe,"on-success":Me,"before-upload":Se,"on-exceed":Be,"http-request":d(O)},{file:m((({file:e})=>[n("div",null,[0!==d(ge).length?(f(),i("div",S,[n("video",{src:d(we).ruleForm.video_url,class:"avatar video-avatar"}," 您的浏览器不支持视频播放 ",8,B),n("div",I,[n("span",{class:"el-upload-list__item-preview cp",onClick:l=>je(e)},[s(w,null,{default:m((()=>[s(V)])),_:1})],8,N),n("span",{class:"el-upload-list__item-preview cp",onClick:ke},[s(w,null,{default:m((()=>[s(U)])),_:1})])])])):u("v-if",!0)])])),default:m((()=>[s(w,null,{default:m((()=>[s(d(F))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):u("v-if",!0),u(" 上传封面 "),2===d(we).ruleForm.type?(f(),g(a,{key:2,class:"self-el-form-item",label:"上传封面:",prop:"cover_url"},{default:m((()=>[s(b,{class:"avatar-uploader",name:"cover_url",action:"",limit:1,"list-type":"picture-card","file-list":d(ye),"onUpdate:file-list":l[5]||(l[5]=e=>p(ye)?ye.value=e:ye=e),"on-preview":je,"on-remove":qe,"on-success":$e,"before-upload":De,"on-exceed":Be,"http-request":d(O)},{default:m((()=>[u(' <img v-if="fileListCoverUrl.length !== 0" :src="state.ruleForm.cover_url" :preview-src-list="[state.ruleForm.cover_url]" class="avatar" /> '),s(w,null,{default:m((()=>[s(d(F))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):u("v-if",!0),u(" 上传Logo "),3===d(we).ruleForm.type||2===d(we).ruleForm.type?(f(),g(a,{key:3,class:"self-el-form-item",label:"上传Logo:",prop:"url"},{default:m((()=>[s(b,{class:"avatar-uploader",name:"logo_url",action:"",limit:1,"list-type":"picture-card","file-list":d(he),"onUpdate:file-list":l[6]||(l[6]=e=>p(he)?he.value=e:he=e),"on-preview":je,"on-remove":qe,"on-success":Le,"before-upload":Pe,"on-exceed":Be,"http-request":d(O)},{default:m((()=>[u(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),s(w,null,{default:m((()=>[s(d(F))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):u("v-if",!0),u(" 标题 "),3===d(we).ruleForm.type||2===d(we).ruleForm.type?(f(),g(a,{key:4,class:"self-el-form-item",label:"标题:",prop:"title"},{default:m((()=>[s(r,{modelValue:d(we).ruleForm.title,"onUpdate:modelValue":l[7]||(l[7]=e=>d(we).ruleForm.title=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):u("v-if",!0),u(" 正文 "),3===d(we).ruleForm.type||2===d(we).ruleForm.type?(f(),g(a,{key:5,class:"self-el-form-item",label:"正文:",prop:"main_body"},{default:m((()=>[s(r,{modelValue:d(we).ruleForm.main_body,"onUpdate:modelValue":l[8]||(l[8]=e=>d(we).ruleForm.main_body=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):u("v-if",!0),u(" 行动号召 "),3===d(we).ruleForm.type?(f(),g(a,{key:6,class:"self-el-form-item",label:"行动号召:",prop:"actions"},{default:m((()=>[s(r,{modelValue:d(we).ruleForm.actions,"onUpdate:modelValue":l[9]||(l[9]=e=>d(we).ruleForm.actions=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):u("v-if",!0),u(" 品牌 "),3===d(we).ruleForm.type?(f(),g(a,{key:7,class:"self-el-form-item",label:"品牌:",prop:"brand"},{default:m((()=>[s(r,{modelValue:d(we).ruleForm.brand,"onUpdate:modelValue":l[10]||(l[10]=e=>d(we).ruleForm.brand=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):u("v-if",!0),u(" {{state.ruleForm.raw_file_image}}\n        <br>\n        {{state.ruleForm.raw_file_video}}\n        <br>\n        {{fileListVideoUrl}}\n        {{fileListUrl}}\n        <br>\n        {{fileListVideoUrl}}\n        <br>\n        {{fileListLogoUrl}}\n        <br>\n        {{fileListCoverUrl}}\n        <br> ")])])),_:1},8,["rules","model","disabled"]),u(" form "),u(" footer "),n("div",A,[s(z,{type:"primary",onClick:be},{default:m((()=>[h(" 确认 ")])),_:1}),s(z,{type:"primary",onClick:ze},{default:m((()=>[h(" 取消 ")])),_:1})]),u(" 图片预览 "),s(q,{modelValue:d(ce),"onUpdate:modelValue":l[11]||(l[11]=e=>p(ce)?ce.value=e:null)},{default:m((()=>[n("div",E,["image"===d(pe)?(f(),i("img",{key:0,"w-full":"",src:d(ne),alt:"Preview Image"},null,8,H)):u("v-if",!0),"video"===d(pe)?(f(),i("video",{key:1,"w-full":"",src:d(ne),alt:"Preview Video",controls:""},null,8,K)):u("v-if",!0)])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0b7edd8c"]]);export{O as default};
