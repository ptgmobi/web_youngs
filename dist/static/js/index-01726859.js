import{_ as e,q as a,o as t,c as i,z as l,e as s,s as o,N as n,O as d,A as r,x as p,f as u,y as c,U as m,V as g}from"./main-0a777472.js";import{m as h}from"./vuex.esm-bundler-f200bff2.js";import{w as b,a as f,g as y,b as D,s as w,c as v,d as _,e as j,f as C}from"./product-d3451b3b.js";import{P as V}from"./index-2575c6ed.js";import{m as k}from"./message-d6ce123e.js";import{m as P}from"./self-732f5551.js";import{_ as T}from"./lodash-4786ff9c.js";const x={id:"",name:"",product:[]},F={components:{Pagination:V},directives:{waves:b},mixins:[P],data:()=>({date:"",passwordType:"password",dialogVisible:!1,dialogType:"new",busData:{setting:{filterMethod:(e,a)=>a.label.indexOf(e)>-1},options:{product:[]},data:{id:"",name:"",product:[]},rules:{}},control:{search:""},list:[],pagination:{pageSizes:["10","20","40"],total:1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"}}}),computed:{...h(["element"])},created(){this.getConfig(),this.init()},methods:{init(){this.getList()},async getConfig(){const{data:e}=await f({name:"",page:1,limit:999,project_id:"",order:"desc"});this.busData.options.product=e},async getList(){const e=await y(),{data:a}=e;this.list=a},handleSearch(){},handleCreate(){this.dialogType="new",this.dialogVisible=!0;const e=new Date;this.date=e.getTime()},async handleEdit(e){this.dialogType="edit",this.busData.data.id=e.row.id;const{data:a}=await D(this.busData.data.id);this.busData.data.id=a.project.id,this.busData.data.name=a.project.name,this.busData.data.product=a.product_id,this.dialogVisible=!0;const t=new Date;this.date=t.getTime()},handleDelete(e){},roleChangeChoice(e,a){this.busData.choiceData[e]=a},clearBusData(){this.busData.data=T.cloneDeep(x)},async submitFn(){if("new"===this.dialogType){const e={name:this.busData.data.name,product_id:this.busData.data.product},a=await w(e);a&&k(a),this.getList()}if("edit"===this.dialogType){const e={id:this.busData.data.id,name:this.busData.data.name,product_id:this.busData.data.product},a=await v(this.busData.data.id,e);a&&k(a)}this.clearBusData(),this.dialogVisible=!1}}},S={class:"app-container"},A={style:{"text-align":"right"}},E={class:"w100 control-box flex jc-end"},U={class:"flex flex-end"},I={class:"flex"},L={class:"w100 flex"};const O={id:"",name:"",project:"",appid:"",projectId:"",appkey:"",status:"1"},z={class:"app-container"},Q={style:{"text-align":"right"}},N={class:"w100 control-box flex jc-end"},q={class:"flex flex-end"},M={class:"w100 flex"};const R={components:{Project:e(F,[["render",function(e,h,b,f,y,D){const w=a("el-input"),v=a("el-form-item"),_=a("el-option"),j=a("el-select"),C=a("el-form"),V=a("el-button"),k=a("el-dialog"),P=a("el-table-column"),T=a("el-table"),x=a("pagination");return t(),i("div",S,[l(" dialog "),s(k,{modelValue:y.dialogVisible,"onUpdate:modelValue":h[3]||(h[3]=e=>y.dialogVisible=e),title:"edit"===y.dialogType?"修改项目组":"创建项目组",width:"80%"},{default:o((()=>[s(C,{ref:"ruleForm",model:y.busData.data,rules:y.busData.rules,"label-width":"150px","label-position":"left"},{default:o((()=>[s(v,{label:"项目名称",prop:"name"},{default:o((()=>[s(w,{modelValue:y.busData.data.name,"onUpdate:modelValue":h[0]||(h[0]=e=>y.busData.data.name=e),placeholder:"",disabled:"edit"===y.dialogType},null,8,["modelValue","disabled"])])),_:1}),s(v,{label:"产品",prop:"project"},{default:o((()=>[s(j,{modelValue:y.busData.data.product,"onUpdate:modelValue":h[1]||(h[1]=e=>y.busData.data.product=e),filterable:"",multiple:"",class:"w100",placeholder:"产品"},{default:o((()=>[(t(!0),i(n,null,d(y.busData.options.product,(e=>(t(),r(_,{key:e.id,label:e.name,value:e.id,disabled:"2"===e.status},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),p("div",A,[s(V,{type:"danger",onClick:h[2]||(h[2]=e=>y.dialogVisible=!1)},{default:o((()=>[u(" 取消 ")])),_:1}),s(V,{type:"primary",onClick:D.submitFn},{default:o((()=>[u(" 确定 ")])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"]),l(" dialog "),p("div",E,[p("div",U,[l(' <el-input placeholder="请输入内容" v-model="control.search" class="input-with-select">\n          <el-button type="primary" slot="append">搜索</el-button>\n        </el-input> '),s(w,{modelValue:y.control.search,"onUpdate:modelValue":h[4]||(h[4]=e=>y.control.search=e),class:"mr-10",placeholder:"请输入内容"},null,8,["modelValue"]),s(V,{type:"primary",onClick:D.handleSearch},{default:o((()=>[u(" 搜索 ")])),_:1},8,["onClick"]),e.judgePermissionElementFn("A-AP-PROJECT-ADD-V")?(t(),r(V,{key:0,type:"primary",onClick:D.handleCreate},{default:o((()=>[u(" 创建项目组 ")])),_:1},8,["onClick"])):l("v-if",!0)])]),s(T,{data:y.list,style:{width:"100%","margin-top":"30px"},border:""},{default:o((()=>[s(P,{align:"center",label:"项目组ID"},{default:o((e=>[u(c(e.row.id),1)])),_:1}),s(P,{align:"center",label:"项目名称"},{default:o((e=>[u(c(e.row.name),1)])),_:1}),s(P,{align:"center",label:"产品数"},{default:o((e=>[u(c(e.row.product_count),1)])),_:1}),s(P,{align:"center",label:"创建时间"},{default:o((e=>[u(c(e.row.create_time),1)])),_:1}),s(P,{align:"center",label:"更新时间"},{default:o((e=>[u(c(e.row.id),1)])),_:1}),s(P,{align:"center",label:"操作"},{default:o((a=>[p("div",I,[e.judgePermissionElementFn("A-AP-PROJECT-EDIT-V")?(t(),r(V,{key:0,type:"primary",size:"small",onClick:e=>D.handleEdit(a)},{default:o((()=>[u(" 编辑 ")])),_:2},1032,["onClick"])):l("v-if",!0),e.judgePermissionElementFn("A-AP-PROJECT-DEL-V")?(t(),r(V,{key:1,type:"danger",size:"small",onClick:e=>D.handleDelete(a)},{default:o((()=>[u(" 删除 ")])),_:2},1032,["onClick"])):l("v-if",!0)])])),_:1})])),_:1},8,["data"]),l(" pagination "),p("div",L,[m(s(x,{page:y.pagination.listQuery.page,"onUpdate:page":h[5]||(h[5]=e=>y.pagination.listQuery.page=e),limit:y.pagination.listQuery.limit,"onUpdate:limit":h[6]||(h[6]=e=>y.pagination.listQuery.limit=e),total:y.pagination.total,"page-sizes":y.pagination.pageSizes,onPagination:D.init},null,8,["page","limit","total","page-sizes","onPagination"]),[[g,y.pagination.total]])])])}]]),Product:e({components:{Pagination:V},directives:{waves:b},mixins:[P],data:()=>({date:"",statusMessage:"产品状态关闭后,产品数据将不在报表中显示",tableOrder:"desc",passwordType:"password",dialogVisible:!1,dialogType:"new",productStatus:"",busData:{setting:{filterMethod:(e,a)=>a.label.indexOf(e)>-1},options:{project:[],status:[{id:"1",name:"启动"},{id:"2",name:"禁止"}]},data:{id:"",name:"",project:"",appid:"",projectId:"",appkey:"",status:"1"},projectName:"",rules:{name:[{required:!0,message:"必填",trigger:["change","blur"]},{min:1,max:50,message:"字符长度为1-50",trigger:["change","blur"]}],project:[{required:!0,message:"必填",trigger:["change","blur"]}],status:[{required:!0,message:"必填",trigger:["change","blur"]}],appid:[{required:!1,message:"必填",trigger:["change","blur"]}],projectId:[{required:!1,message:"必填",trigger:["change","blur"]}],appkey:[{required:!1,message:"非必填",trigger:["change","blur"]}]}},control:{search:""},filters:{projectFilter:[],currentProjectFilter:""},list:[],pagination:{pageSizes:["10"],total:1,listQuery:{page:1,limit:10,importance:void 0,title:void 0,type:void 0,sort:"+id"}}}),created(){this.getConfig(),this.init()},methods:{init(){this.getList()},async getConfig(){const{data:e}=await y();this.busData.options.project=e,null==e||e.map((e=>{this.filters.projectFilter.push({text:e.name,value:e.id})}))},async getList(){const e={name:this.control.search,page:this.pagination.listQuery.page,limit:this.pagination.listQuery.limit,project_id:this.filters.currentProjectFilter,order:this.tableOrder},{data:a}=(await f(e),await f(e));this.list=a},handleSearch(){this.getList()},handleCreate(){this.dialogType="new",this.clearBusData(),this.dialogVisible=!0;const e=new Date;this.date=e.getTime()},async handleEdit(e){this.dialogType="edit",this.busData.data.id=e.row.id,this.busData.data.name=e.row.name,this.busData.data.appid=e.row.app_id,this.busData.data.project=e.row.project_id,this.busData.data.projectId=e.row.ss_project_id,this.busData.data.appkey=e.row.ry_appkey,this.dialogVisible=!0;const a=new Date;this.date=a.getTime()},handleDelete(e){},roleChangeChoice(e,a){this.busData.choiceData[e]=a},clearBusData(){this.busData.data=T.cloneDeep(O)},async changeStatus(e,a){const t={id:a.id,status:a.status},i=await _(a.id,t);k(i)},async submitFn(){if("new"===this.dialogType){const e={name:this.busData.data.name,project_id:this.busData.data.project,app_id:this.busData.data.appid,ss_project_id:this.busData.data.projectId,ry_appkey:this.busData.data.appkey,status:Number(this.busData.data.status)},a=await j(e);a&&k(a),this.getList()}if("edit"===this.dialogType){const e={id:this.busData.data.id,name:this.busData.data.name,project_id:this.busData.data.project,app_id:this.busData.data.appid,ss_project_id:this.busData.data.projectId,ry_appkey:this.busData.data.appkey,status:Number(this.busData.data.status)},a=await C(this.busData.data.id,e);a&&k(a),this.getList()}this.clearBusData(),this.dialogVisible=!1,this.$refs.ruleForm.resetFields()},showCurrentProject(e){var a,t;return null==(t=(null==(a=this.busData.options.project)?void 0:a.filter((a=>a.id===e)))[0])?void 0:t.name},cancelFn(){this.dialogVisible=!1,this.$refs.ruleForm.resetFields()},filterChange(e){const a=Object.values(e)[0];this.filters.currentProjectFilter=a.length===this.filters.projectFilter.length?"":a,this.getList()},switchStatus(e,a){this.statusMessage=1===e?"产品状态开启后，产品数据开始在平台上展示":"产品状态关闭后,产品数据将不在报表中显示"},cancelStatus(e){this.getList()},async confirmStatus(e){await _(e.id,{id:e.id,status:e.status}),this.getList()},sortChange(e,a,t){"ascending"===e.order?this.tableOrder="asc":"descending"===e.order&&(this.tableOrder="desc"),this.getList()}}},[["render",function(e,h,b,f,y,D){const w=a("el-input"),v=a("el-form-item"),_=a("el-option"),j=a("el-select"),C=a("el-form"),V=a("el-button"),k=a("el-dialog"),P=a("el-table-column"),T=a("el-switch"),x=a("el-table"),F=a("pagination");return t(),i("div",z,[l(" dialog "),s(k,{modelValue:y.dialogVisible,"onUpdate:modelValue":h[2]||(h[2]=e=>y.dialogVisible=e),title:"edit"===y.dialogType?"编辑产品":"创建产品",width:"80%"},{default:o((()=>[s(C,{ref:"ruleForm",model:y.busData.data,rules:y.busData.rules,"label-width":"150px","label-position":"left"},{default:o((()=>[s(v,{label:"产品名称",prop:"name"},{default:o((()=>[s(w,{modelValue:y.busData.data.name,"onUpdate:modelValue":h[0]||(h[0]=e=>y.busData.data.name=e),placeholder:"请输入产品名称",disabled:"edit"===y.dialogType},null,8,["modelValue","disabled"])])),_:1}),s(v,{label:"项目组",prop:"project"},{default:o((()=>[s(j,{modelValue:y.busData.data.project,"onUpdate:modelValue":h[1]||(h[1]=e=>y.busData.data.project=e),class:"w100",placeholder:"请选择所属项目组"},{default:o((()=>[(t(!0),i(n,null,d(y.busData.options.project,(e=>(t(),r(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),l(' <el-form-item label="APP_ID" prop="appid">\n          <el-input v-model="busData.data.appid" placeholder="请输入app_id" />\n        </el-form-item>\n        <el-form-item label="数数项目ID" prop="projectId">\n          <el-input v-model="busData.data.projectId" placeholder="请输入数数项目ID" :disabled="dialogType===\'edit\'" />\n        </el-form-item>\n        <el-form-item label="热云APPKEY" prop="appkey">\n          <el-input v-model="busData.data.appkey" placeholder="请输入热云APPKEY" :disabled="dialogType===\'edit\'" />\n        </el-form-item>\n        <el-form-item label="状态" prop="status">\n          <el-select v-model="busData.data.status" class="w100">\n            <el-option\n              v-for="item in busData.options.status"\n              :key="item.id"\n              :label="item.name"\n              :value="item.id"\n            />\n          </el-select>\n        </el-form-item>\n        <el-form-item label="产品配置" prop="conf">\n          <el-transfer\n            filterable\n            :filter-method="busData.setting.filterMethod"\n            filter-placeholder="请输入搜索"\n            v-model="busData.data.conf"\n            :data="busData.data.data"\n            :titles="[\'Source\', \'Target\']"\n          >\n          </el-transfer>\n        </el-form-item> ')])),_:1},8,["model","rules"]),p("div",Q,[s(V,{type:"danger",onClick:D.cancelFn},{default:o((()=>[u(" 取消 ")])),_:1},8,["onClick"]),s(V,{type:"primary",onClick:D.submitFn},{default:o((()=>[u(" 确认 ")])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"]),l(" dialog "),p("div",N,[p("div",q,[l(' <el-input placeholder="请输入内容" v-model="control.search" class="input-with-select">\n          <el-button type="primary" slot="append">搜索</el-button>\n        </el-input> '),s(w,{modelValue:y.control.search,"onUpdate:modelValue":h[3]||(h[3]=e=>y.control.search=e),class:"sw-200 mr-10",placeholder:"请输入产品名称或APPID"},null,8,["modelValue"]),s(V,{type:"primary",onClick:D.handleSearch},{default:o((()=>[u(" 搜索 ")])),_:1},8,["onClick"]),e.judgePermissionElementFn("A-AP-PRODUCT-ADD-V")?(t(),r(V,{key:0,type:"primary",onClick:D.handleCreate},{default:o((()=>[u(" 创建产品 ")])),_:1},8,["onClick"])):l("v-if",!0)])]),s(x,{data:y.list,style:{width:"100%","margin-top":"30px"},border:"",onFilterChange:D.filterChange,onSortChange:D.sortChange},{default:o((()=>[s(P,{align:"center",label:"ID",prop:"id",sortable:"custom"}),s(P,{align:"center",label:"项目组",filters:y.filters.projectFilter},{default:o((e=>[u(c(D.showCurrentProject(e.row.project_id)),1)])),_:1},8,["filters"]),s(P,{align:"center",label:"产品名称"},{default:o((e=>[u(c(e.row.name),1)])),_:1}),s(P,{align:"center",label:"创建时间"},{default:o((e=>[u(c(e.row.create_time),1)])),_:1}),s(P,{align:"center",label:"更新时间"},{default:o((e=>[u(c(e.row.update_time),1)])),_:1}),s(P,{align:"center",label:"产品状态"},{default:o((e=>[l(' <el-popconfirm\n            :title="statusMessage"\n            @onConfirm="confirmStatus(scope.row)"\n            @onCancel="cancelStatus(scope.row)"\n          > '),s(T,{slot:"reference",modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":2,onChange:a=>D.changeStatus(a,e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),l(" </el-popconfirm> "),l(' <el-popover\n            v-model="productPopVisible"\n            placement="top"\n            width="200"\n          >\n            <p>确定删除吗？</p>\n            <div style="text-align: right; margin: 0">\n              <el-button type="text" @click="cancelStatus(scope.row)">取消</el-button>\n              <el-button type="text" @click="confirmStatus(scope.row)">确定</el-button>\n            </div>\n            <el-switch\n              slot="reference"\n              v-model="scope.row.status"\n              active-value="1"\n              inactive-value="2"\n              @change="switchStatus($event, scope.row)"\n            />\n          </el-popover> ')])),_:1}),l(' <el-table-column v-if="judgePermissionElementFn(\'A-AP-PRODUCT-EDIT-V\')" align="center" label="操作">\n        <template #default="scope">\n          <div class="flex">\n            <el-button type="primary" size="small" @click="handleEdit(scope)">编辑</el-button>\n            <el-button v-if="judgePermissionElementFn(\'A-AP-PRODUCT-DEL-V\')" type="danger" size="small" @click="handleDelete(scope)">删除</el-button>\n          </div>\n        </template>\n      </el-table-column> ')])),_:1},8,["data","onFilterChange","onSortChange"]),l(" pagination "),p("div",M,[m(s(F,{page:y.pagination.listQuery.page,"onUpdate:page":h[4]||(h[4]=e=>y.pagination.listQuery.page=e),limit:y.pagination.listQuery.limit,"onUpdate:limit":h[5]||(h[5]=e=>y.pagination.listQuery.limit=e),total:y.pagination.total,"page-sizes":y.pagination.pageSizes,onPagination:D.init},null,8,["page","limit","total","page-sizes","onPagination"]),[[g,y.pagination.total]])])])}]])},data:()=>({activeName:"product"}),computed:{...h(["element"])},methods:{handleClick(e,a){this.activeName=e.props.name}}},B={class:"app-container"};var J=e(R,[["render",function(e,n,d,p,u,c){const m=a("product"),g=a("el-tab-pane"),h=a("project"),b=a("el-tabs");return t(),i("div",B,[s(b,{modelValue:u.activeName,"onUpdate:modelValue":n[0]||(n[0]=e=>u.activeName=e),type:"card",onTabClick:c.handleClick},{default:o((()=>[s(g,{name:"product",label:"产品信息"},{default:o((()=>["product"===u.activeName?(t(),r(m,{key:0})):l("v-if",!0)])),_:1}),s(g,{name:"project",label:"项目组"},{default:o((()=>["project"===u.activeName?(t(),r(h,{key:0})):l("v-if",!0)])),_:1})])),_:1},8,["modelValue","onTabClick"])])}]]);export{J as default};
