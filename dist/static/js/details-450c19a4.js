var e=Object.defineProperty,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,t=(l,r,a)=>r in l?e(l,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[r]=a,o=(e,o)=>{for(var i in o||(o={}))r.call(o,i)&&t(e,i,o[i]);if(l)for(var i of l(o))a.call(o,i)&&t(e,i,o[i]);return e};import{_ as i,d as u,h as s,r as m,L as d,q as n,o as p,c,z as v,e as f,s as g,v as _,x as h,P as y,N as F,O as b,A as w,f as V,y as U,K as x,a9 as z,g as j,E as q}from"./main-f5fc11c6.js";import{b as k,c as L,d as P}from"./dsp-campaign-14e24a60.js";import{m as C}from"./message-63eca02f.js";import{_ as $}from"./index-5d1349db.js";import{u as M}from"./useUtils-e29f5423.js";import{d as O,e as R}from"./new-format-35937e70.js";import{_ as S}from"./lodash-d099a0b1.js";import{u as D}from"./upload-a54a4e8d.js";import"./dsp-advertiser-133f6b15.js";const I={logo_type_reg:/png|jpg|jpeg/,logo_limit:3145728,logo_size:[{width:100,height:100},{width:500,height:500}],image_type_reg:/png|jpg|jpeg|gif/,image_limit:3145728,image_size:[{width:160,height:600},{width:250,height:250},{width:300,height:50},{width:300,height:250},{width:300,height:600},{width:320,height:50},{width:320,height:100},{width:320,height:480},{width:480,height:320},{width:628,height:1200},{width:728,height:90},{width:970,height:250},{width:1200,height:628}],video_type_reg:/mp4/,video_limit:10485760,video_duration:30,video_size:[{width:320,height:480},{width:480,height:320}],cover_image_type_reg:/png|jpg|jpeg|gif/,cover_image_limit:3145728,cover_image_size:[{width:320,height:480},{width:480,height:320}]};const B={class:"content-con from-one flex column"},E={class:"content-con from-one flex column"},N={key:0},A=["src"],H={class:"upload-video-control-box el-upload-list__item-actions flex"},K=["onClick"],G={class:"w100 flex"},J=V(" 确认 "),Q=V(" 取消 "),T={class:"flex"},W=["src"],X=["src"];var Y=i(u({setup(e){const{validate:l,uploadHttpRequest:r}=D,{logo_type_reg:a,logo_limit:t,logo_size:i,image_type_reg:u,image_limit:Y,image_size:Z,video_type_reg:ee,video_limit:le,video_duration:re,video_size:ae,cover_image_type_reg:te,cover_image_limit:oe,cover_image_size:ie}=I,{getRouterData:ue,getCommonCountryList:se,goNewUrl:me}=M();let{proxy:de}=j();const ne=s(""),pe=s(""),ce=s(!1),ve="此项必填";let fe=s("create"),ge=s([]),_e=s([]),he=s([]),ye=s([]);const Fe={id:void 0,name:"",descs:"",type:1,url:"",audit_status:void 0,size:"",memory_size:"",format:"",duration:void 0,status:1,is_del:void 0,logo_url:"",title:"",main_body:"",actions:"",brand:"",cover_url:"",video_url:"",raw_file_image:void 0,raw_file_video:void 0},be=m({ruleForm:Fe,rules:{name:[{required:!0,message:ve,trigger:["blur","change"]}],title:[{required:!0,message:ve,trigger:["blur","change"]}],main_body:[{required:!0,message:ve,trigger:["blur","change"]}],actions:[{required:!0,message:ve,trigger:["blur","change"]}],brand:[{required:!0,message:ve,trigger:["blur","change"]}],url:[{required:!0,message:ve,trigger:["blur","change"]}],logo_url:[{required:!0,message:ve,trigger:["blur","change"]}],cover_url:[{required:!0,message:ve,trigger:["blur","change"]}]},options:{type:[{value:1,label:"图片"},{value:2,label:"视频"},{value:3,label:"原生"}],audit_status:[{value:1,label:"未审核"},{value:2,label:"审核通过"},{value:3,label:"审核未通过"}]}}),we=()=>{Ue(be.ruleForm),de.$refs.ruleForm.validate((e=>{if(!e)return!1;xe()}))},Ve=["id","adv_series_type","adv_series_budget","duration"],Ue=e=>{let l=e.type;if(1===l||3===l){let l=e.raw_file_image;l&&(e.size=`${l.w}*${l.h}`,e.memory_size=`${(l.limit/1048576).toFixed(2)}MB`,e.format=l.type,delete e.duration)}if(2===l){let l=e.raw_file_video;l&&(e.size=`${l.w}*${l.h}`,e.memory_size=`${(l.limit/1048576).toFixed(2)}MB`,e.format=l.type,e.duration=l.duration.toFixed(0),e.url=e.video_url)}return e},xe=async()=>{let e=y(be.ruleForm),l=new URLSearchParams;l.append("type",e.type);let r=`type=${l.get("type")}`;if(e=O(e),e=R(e,Ve),fe.value,"create"===fe.value){delete e.id;const l=await k(r,e);C(l)&&ze()}if("edit"===fe.value){const l=await L(r,e);C(l)&&ze()}},ze=()=>{me({url:"/campaign/administration/list"})},je=(e,l)=>{},qe=(e,l)=>{_e.value.splice(0)},ke=e=>{ne.value=e.url;let l="",r=ee;u.test(ne.value)&&(l="image"),r.test(ne.value)&&(l="video"),pe.value=l,ce.value=!0},Le=(e,l)=>{let r=null==e?void 0:e.data;be.ruleForm.logo_url=r,he.value.splice(0),he.value.push({name:r,url:r})},Pe=(e,l)=>{let r=null==e?void 0:e.data;be.ruleForm.url=r,ge.value.splice(0),ge.value.push({name:r,url:r})},Ce=(e,l)=>{let r=null==e?void 0:e.data;be.ruleForm.cover_url=r,ye.value.splice(0),ye.value.push({name:r,url:r})},$e=(e,l)=>{let r=null==e?void 0:e.data;be.ruleForm.video_url=r,_e.value.splice(0),_e.value.push({name:r,url:r})},Me=async e=>l(e,"image",{type_reg:a,limit:t,size:i}),Oe=async e=>{const r={type_reg:u,limit:Y,size:Z};let a=await l(e,"image",r);return be.ruleForm.raw_file_image=a.data,a},Re=async e=>l(e,"image",{type_reg:te,limit:oe,size:ie}),Se=async e=>{const r={type_reg:ee,limit:le,size:ae,duration:re};let a=await l(e,"video",r);return be.ruleForm.raw_file_video=a.data,a},De=(e,l)=>{q({message:"只能上传一个，请删除后重试",type:"warning"})},Ie=()=>{var e,l;let{query:r,params:a}=ue();if(fe.value=null!=(l=null==(e=r.type)?void 0:e.toString())?l:"",fe.value,(async()=>{})(),"create"===fe.value&&(be.ruleForm=S.cloneDeep(Fe)),"edit"===fe.value){const{id:e}=a,{campaign_type:l}=r;(async(e,l)=>{let r=new URLSearchParams;r.append("type",l);let a=`type=${r.get("type")}`;const t=await P(e,a),{data:i}=t;be.ruleForm=o(o({},be.ruleForm),i),be.ruleForm,1===be.ruleForm.type&&be.ruleForm.url&&ge.value.push({name:be.ruleForm.url,url:be.ruleForm.url}),2===be.ruleForm.type&&(be.ruleForm.url&&(_e.value.push({name:be.ruleForm.url,url:be.ruleForm.url}),be.ruleForm.video_url=be.ruleForm.url),be.ruleForm.logo_url&&he.value.push({name:be.ruleForm.logo_url,url:be.ruleForm.logo_url}),be.ruleForm.cover_url&&ye.value.push({name:be.ruleForm.cover_url,url:be.ruleForm.cover_url})),3===be.ruleForm.type&&(be.ruleForm.url&&ge.value.push({name:be.ruleForm.url,url:be.ruleForm.url}),be.ruleForm.logo_url&&he.value.push({name:be.ruleForm.logo_url,url:be.ruleForm.logo_url}))})(e,l)}};return d((()=>{Ie()})),(e,l)=>{const a=n("el-input"),t=n("el-form-item"),o=n("el-radio"),i=n("el-radio-group"),u=n("el-icon"),s=n("el-upload"),m=n("zoom-in"),d=n("Delete"),y=n("el-form"),j=n("el-button"),q=n("el-dialog");return p(),c("div",null,[v(" form "),f(y,{ref:"ruleForm",enctype:"multipart/form-data",rules:_(be).rules,model:_(be).ruleForm,"label-width":"150px","label-position":"right",class:"flex column",disabled:"edit"===_(fe)&&2===_(be).ruleForm.is_del},{default:g((()=>[f(_($),{title:"基础信息"}),h("div",B,[v(" 创意名称 "),f(t,{class:"self-el-form-item",label:"创意名称:",prop:"name"},{default:g((()=>[f(a,{modelValue:_(be).ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>_(be).ruleForm.name=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1}),v(" 描述 "),f(t,{class:"self-el-form-item",label:"描述:",prop:"descs"},{default:g((()=>[f(a,{modelValue:_(be).ruleForm.descs,"onUpdate:modelValue":l[1]||(l[1]=e=>_(be).ruleForm.descs=e),modelModifiers:{trim:!0},class:"form-one",placeholder:"",type:"textarea"},null,8,["modelValue"])])),_:1})]),f(_($),{title:"创意设计"}),h("div",E,[v(" 创意样式 "),f(t,{class:"self-el-form-item",label:"创意样式:",prop:"type"},{default:g((()=>[f(i,{class:"form-one",modelValue:_(be).ruleForm.type,"onUpdate:modelValue":l[2]||(l[2]=e=>_(be).ruleForm.type=e)},{default:g((()=>[(p(!0),c(F,null,b(_(be).options.type,(e=>(p(),w(o,{label:e.value},{default:g((()=>[V(U(e.label),1)])),_:2},1032,["label"])))),256))])),_:1},8,["modelValue"])])),_:1}),v(" 上传素材 --- 图片 "),1===_(be).ruleForm.type||3===_(be).ruleForm.type?(p(),w(t,{key:0,class:"self-el-form-item",label:"上传图片素材:",prop:"url"},{default:g((()=>[f(s,{class:"avatar-uploader",name:"url",action:"",limit:1,"list-type":"picture-card","file-list":_(ge),"onUpdate:file-list":l[3]||(l[3]=e=>x(ge)?ge.value=e:ge=e),"on-preview":ke,"on-remove":je,"on-success":Pe,"before-upload":Oe,"on-exceed":De,"http-request":_(r)},{default:g((()=>[v(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),f(u,null,{default:g((()=>[f(_(z))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):v("v-if",!0),v(" 上传素材 --- 视频 "),2===_(be).ruleForm.type?(p(),w(t,{key:1,class:"self-el-form-item",label:"上传视频素材:",prop:"url"},{default:g((()=>[f(s,{class:"avatar-uploader",name:"url",action:"",accept:"",limit:1,"list-type":"picture-card","file-list":_(_e),"onUpdate:file-list":l[4]||(l[4]=e=>x(_e)?_e.value=e:_e=e),"on-preview":ke,"on-remove":je,"on-success":$e,"before-upload":Se,"on-exceed":De,"http-request":_(r)},{file:g((({file:e})=>[h("div",null,[0!==_(_e).length?(p(),c("div",N,[h("video",{src:_(be).ruleForm.video_url,class:"avatar video-avatar"}," 您的浏览器不支持视频播放 ",8,A),h("div",H,[h("span",{class:"el-upload-list__item-preview cp",onClick:l=>ke(e)},[f(u,null,{default:g((()=>[f(m)])),_:1})],8,K),h("span",{class:"el-upload-list__item-preview cp",onClick:qe},[f(u,null,{default:g((()=>[f(d)])),_:1})])])])):v("v-if",!0)])])),default:g((()=>[f(u,null,{default:g((()=>[f(_(z))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):v("v-if",!0),v(" 上传封面 "),2===_(be).ruleForm.type?(p(),w(t,{key:2,class:"self-el-form-item",label:"上传封面:",prop:"cover_url"},{default:g((()=>[f(s,{class:"avatar-uploader",name:"cover_url",action:"",limit:1,"list-type":"picture-card","file-list":_(ye),"onUpdate:file-list":l[5]||(l[5]=e=>x(ye)?ye.value=e:ye=e),"on-preview":ke,"on-remove":je,"on-success":Ce,"before-upload":Re,"on-exceed":De,"http-request":_(r)},{default:g((()=>[v(' <img v-if="fileListCoverUrl.length !== 0" :src="state.ruleForm.cover_url" :preview-src-list="[state.ruleForm.cover_url]" class="avatar" /> '),f(u,null,{default:g((()=>[f(_(z))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):v("v-if",!0),v(" 上传Logo "),3===_(be).ruleForm.type||2===_(be).ruleForm.type?(p(),w(t,{key:3,class:"self-el-form-item",label:"上传Logo:",prop:"url"},{default:g((()=>[f(s,{class:"avatar-uploader",name:"logo_url",action:"",limit:1,"list-type":"picture-card","file-list":_(he),"onUpdate:file-list":l[6]||(l[6]=e=>x(he)?he.value=e:he=e),"on-preview":ke,"on-remove":je,"on-success":Le,"before-upload":Me,"on-exceed":De,"http-request":_(r)},{default:g((()=>[v(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),f(u,null,{default:g((()=>[f(_(z))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):v("v-if",!0),v(" 标题 "),3===_(be).ruleForm.type||2===_(be).ruleForm.type?(p(),w(t,{key:4,class:"self-el-form-item",label:"标题:",prop:"title"},{default:g((()=>[f(a,{modelValue:_(be).ruleForm.title,"onUpdate:modelValue":l[7]||(l[7]=e=>_(be).ruleForm.title=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):v("v-if",!0),v(" 正文 "),3===_(be).ruleForm.type||2===_(be).ruleForm.type?(p(),w(t,{key:5,class:"self-el-form-item",label:"正文:",prop:"main_body"},{default:g((()=>[f(a,{modelValue:_(be).ruleForm.main_body,"onUpdate:modelValue":l[8]||(l[8]=e=>_(be).ruleForm.main_body=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):v("v-if",!0),v(" 行动号召 "),3===_(be).ruleForm.type?(p(),w(t,{key:6,class:"self-el-form-item",label:"行动号召:",prop:"actions"},{default:g((()=>[f(a,{modelValue:_(be).ruleForm.actions,"onUpdate:modelValue":l[9]||(l[9]=e=>_(be).ruleForm.actions=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):v("v-if",!0),v(" 品牌 "),3===_(be).ruleForm.type?(p(),w(t,{key:7,class:"self-el-form-item",label:"品牌:",prop:"brand"},{default:g((()=>[f(a,{modelValue:_(be).ruleForm.brand,"onUpdate:modelValue":l[10]||(l[10]=e=>_(be).ruleForm.brand=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):v("v-if",!0),v(" {{state.ruleForm.raw_file_image}}\n        <br>\n        {{state.ruleForm.raw_file_video}}\n        <br>\n        {{fileListVideoUrl}}\n        {{fileListUrl}}\n        <br>\n        {{fileListVideoUrl}}\n        <br>\n        {{fileListLogoUrl}}\n        <br>\n        {{fileListCoverUrl}}\n        <br> ")])])),_:1},8,["rules","model","disabled"]),v(" form "),v(" footer "),h("div",G,[f(j,{type:"primary",onClick:we},{default:g((()=>[J])),_:1}),f(j,{type:"primary",onClick:ze},{default:g((()=>[Q])),_:1})]),v(" 图片预览 "),f(q,{modelValue:ce.value,"onUpdate:modelValue":l[11]||(l[11]=e=>ce.value=e)},{default:g((()=>[h("div",T,["image"===pe.value?(p(),c("img",{key:0,"w-full":"",src:ne.value,alt:"Preview Image"},null,8,W)):v("v-if",!0),"video"===pe.value?(p(),c("video",{key:1,"w-full":"",src:ne.value,alt:"Preview Video",controls:""},null,8,X)):v("v-if",!0)])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0b7edd8c"]]);export{Y as default};
