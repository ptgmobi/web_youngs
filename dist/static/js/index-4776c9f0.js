var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(a,t,i)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,s=(e,s)=>{for(var o in s||(s={}))t.call(s,o)&&l(e,o,s[o]);if(a)for(var o of a(s))i.call(s,o)&&l(e,o,s[o]);return e};import{af as o,r as n,o as d,i as r,g as p,v as c,f as u,F as m,j as g,s as h,c as b,x as f,t as y,P as D,Q as w}from"./vendor-b395509e.js";import{w as v,a as j,g as _,b as C,s as V,c as k,d as P,e as T,f as x}from"./product-fa4489be.js";import{P as F}from"./index-4356e8a4.js";import{m as S}from"./message-2bc78ae8.js";import{m as E}from"./self-0bdab18c.js";import{_ as O}from"./lodash-8aca15e5.js";import{_ as A}from"./index-91f5eb17.js";const U={id:"",name:"",product:[]},I={mixins:[E],components:{Pagination:F},directives:{waves:v},data:()=>({date:"",passwordType:"password",dialogVisible:!1,dialogType:"new",busData:{setting:{filterMethod:(e,a)=>a.label.indexOf(e)>-1},options:{product:[]},data:{id:"",name:"",product:[]},rules:{}},control:{search:""},list:[],pagination:{pageSizes:["10","20","40"],total:1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"}}}),computed:s({},o(["element"])),created(){this.getConfig(),this.init()},methods:{init(){this.getList()},async getConfig(){const{data:e}=await j({name:"",page:1,limit:999,project_id:"",order:"desc"});this.busData.options.product=e},async getList(){const e=await _(),{data:a}=e;this.list=a},handleSearch(){},handleCreate(){this.dialogType="new",this.dialogVisible=!0;const e=new Date;this.date=e.getTime()},async handleEdit(e){this.dialogType="edit",this.busData.data.id=e.row.id;const{data:a}=await C(this.busData.data.id);this.busData.data.id=a.project.id,this.busData.data.name=a.project.name,this.busData.data.product=a.product_id,this.dialogVisible=!0;const t=new Date;this.date=t.getTime()},handleDelete(e){},roleChangeChoice(e,a){this.busData.choiceData[e]=a},clearBusData(){this.busData.data=O.cloneDeep(U)},async submitFn(){if("new"===this.dialogType){const e={name:this.busData.data.name,product_id:this.busData.data.product},a=await V(e);a&&S(a),this.getList()}if("edit"===this.dialogType){const e={id:this.busData.data.id,name:this.busData.data.name,product_id:this.busData.data.product},a=await k(this.busData.data.id,e);a&&S(a)}this.clearBusData(),this.dialogVisible=!1}}},L={class:"app-container"},Q={style:{"text-align":"right"}},z=f("取消"),N=f("确定"),q={class:"w100 control-box flex jc-end"},M={class:"flex flex-end"},R=f("搜索"),B=f(" 创建项目组 "),J={class:"flex"},$=f(" 编辑 "),K=f(" 删除 "),Y={class:"w100 flex"};var G=A(I,[["render",function(e,a,t,i,l,s){const o=n("el-input"),v=n("el-form-item"),j=n("el-option"),_=n("el-select"),C=n("el-form"),V=n("el-button"),k=n("el-dialog"),P=n("el-table-column"),T=n("el-table"),x=n("pagination");return d(),r("div",L,[p(" dialog "),c(k,{modelValue:l.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=e=>l.dialogVisible=e),title:"edit"===l.dialogType?"修改项目组":"创建项目组",width:"80%"},{default:u((()=>[c(C,{ref:"ruleForm",model:l.busData.data,rules:l.busData.rules,"label-width":"150px","label-position":"left"},{default:u((()=>[c(v,{label:"项目名称",prop:"name"},{default:u((()=>[c(o,{modelValue:l.busData.data.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.busData.data.name=e),placeholder:"",disabled:"edit"===l.dialogType},null,8,["modelValue","disabled"])])),_:1}),c(v,{label:"产品",prop:"project"},{default:u((()=>[c(_,{modelValue:l.busData.data.product,"onUpdate:modelValue":a[1]||(a[1]=e=>l.busData.data.product=e),filterable:"",multiple:"",class:"w100",placeholder:"产品"},{default:u((()=>[(d(!0),r(m,null,g(l.busData.options.product,(e=>(d(),b(j,{key:e.id,label:e.name,value:e.id,disabled:"2"===e.status},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),h("div",Q,[c(V,{type:"danger",onClick:a[2]||(a[2]=e=>l.dialogVisible=!1)},{default:u((()=>[z])),_:1}),c(V,{type:"primary",onClick:s.submitFn},{default:u((()=>[N])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"]),p(" dialog "),h("div",q,[h("div",M,[p(' <el-input placeholder="请输入内容" v-model="control.search" class="input-with-select">\n          <el-button type="primary" slot="append">搜索</el-button>\n        </el-input> '),c(o,{modelValue:l.control.search,"onUpdate:modelValue":a[4]||(a[4]=e=>l.control.search=e),class:"mr-10",placeholder:"请输入内容"},null,8,["modelValue"]),c(V,{type:"primary",onClick:s.handleSearch},{default:u((()=>[R])),_:1},8,["onClick"]),e.judgePermissionElementFn("A-AP-PROJECT-ADD-V")?(d(),b(V,{key:0,type:"primary",onClick:s.handleCreate},{default:u((()=>[B])),_:1},8,["onClick"])):p("v-if",!0)])]),c(T,{data:l.list,style:{width:"100%","margin-top":"30px"},border:""},{default:u((()=>[c(P,{align:"center",label:"项目组ID"},{default:u((e=>[f(y(e.row.id),1)])),_:1}),c(P,{align:"center",label:"项目名称"},{default:u((e=>[f(y(e.row.name),1)])),_:1}),c(P,{align:"center",label:"产品数"},{default:u((e=>[f(y(e.row.product_count),1)])),_:1}),c(P,{align:"center",label:"创建时间"},{default:u((e=>[f(y(e.row.create_time),1)])),_:1}),c(P,{align:"center",label:"更新时间"},{default:u((e=>[f(y(e.row.id),1)])),_:1}),c(P,{align:"center",label:"操作"},{default:u((a=>[h("div",J,[e.judgePermissionElementFn("A-AP-PROJECT-EDIT-V")?(d(),b(V,{key:0,type:"primary",size:"small",onClick:e=>s.handleEdit(a)},{default:u((()=>[$])),_:2},1032,["onClick"])):p("v-if",!0),e.judgePermissionElementFn("A-AP-PROJECT-DEL-V")?(d(),b(V,{key:1,type:"danger",size:"small",onClick:e=>s.handleDelete(a)},{default:u((()=>[K])),_:2},1032,["onClick"])):p("v-if",!0)])])),_:1})])),_:1},8,["data"]),p(" pagination "),h("div",Y,[D(c(x,{total:l.pagination.total,"page-sizes":l.pagination.pageSizes,page:l.pagination.listQuery.page,"onUpdate:page":a[5]||(a[5]=e=>l.pagination.listQuery.page=e),limit:l.pagination.listQuery.limit,"onUpdate:limit":a[6]||(a[6]=e=>l.pagination.listQuery.limit=e),onPagination:s.init},null,8,["total","page-sizes","page","limit","onPagination"]),[[w,l.pagination.total]])])])}]]);const H={id:"",name:"",project:"",appid:"",projectId:"",appkey:"",status:"1"},W={mixins:[E],components:{Pagination:F},directives:{waves:v},data:()=>({date:"",statusMessage:"产品状态关闭后,产品数据将不在报表中显示",tableOrder:"desc",passwordType:"password",dialogVisible:!1,dialogType:"new",productStatus:"",busData:{setting:{filterMethod:(e,a)=>a.label.indexOf(e)>-1},options:{project:[],status:[{id:"1",name:"启动"},{id:"2",name:"禁止"}]},data:{id:"",name:"",project:"",appid:"",projectId:"",appkey:"",status:"1"},projectName:"",rules:{name:[{required:!0,message:"必填",trigger:["change","blur"]},{min:1,max:50,message:"字符长度为1-50",trigger:["change","blur"]}],project:[{required:!0,message:"必填",trigger:["change","blur"]}],status:[{required:!0,message:"必填",trigger:["change","blur"]}],appid:[{required:!1,message:"必填",trigger:["change","blur"]}],projectId:[{required:!1,message:"必填",trigger:["change","blur"]}],appkey:[{required:!1,message:"非必填",trigger:["change","blur"]}]}},control:{search:""},filters:{projectFilter:[],currentProjectFilter:""},list:[],pagination:{pageSizes:["10"],total:1,listQuery:{page:1,limit:10,importance:void 0,title:void 0,type:void 0,sort:"+id"}}}),created(){this.getConfig(),this.init()},methods:{init(){this.getList()},async getConfig(){const{data:e}=await _();this.busData.options.project=e,null==e||e.map((e=>{this.filters.projectFilter.push({text:e.name,value:e.id})}))},async getList(){const e={name:this.control.search,page:this.pagination.listQuery.page,limit:this.pagination.listQuery.limit,project_id:this.filters.currentProjectFilter,order:this.tableOrder},{data:a}=(await j(e),await j(e));this.list=a},handleSearch(){this.getList()},handleCreate(){this.dialogType="new",this.clearBusData(),this.dialogVisible=!0;const e=new Date;this.date=e.getTime()},async handleEdit(e){this.dialogType="edit",this.busData.data.id=e.row.id,this.busData.data.name=e.row.name,this.busData.data.appid=e.row.app_id,this.busData.data.project=e.row.project_id,this.busData.data.projectId=e.row.ss_project_id,this.busData.data.appkey=e.row.ry_appkey,this.dialogVisible=!0;const a=new Date;this.date=a.getTime()},handleDelete(e){},roleChangeChoice(e,a){this.busData.choiceData[e]=a},clearBusData(){this.busData.data=O.cloneDeep(H)},async changeStatus(e,a){const t={id:a.id,status:a.status},i=await P(a.id,t);S(i)},async submitFn(){if("new"===this.dialogType){const e={name:this.busData.data.name,project_id:this.busData.data.project,app_id:this.busData.data.appid,ss_project_id:this.busData.data.projectId,ry_appkey:this.busData.data.appkey,status:Number(this.busData.data.status)},a=await T(e);a&&S(a),this.getList()}if("edit"===this.dialogType){const e={id:this.busData.data.id,name:this.busData.data.name,project_id:this.busData.data.project,app_id:this.busData.data.appid,ss_project_id:this.busData.data.projectId,ry_appkey:this.busData.data.appkey,status:Number(this.busData.data.status)},a=await x(this.busData.data.id,e);a&&S(a),this.getList()}this.clearBusData(),this.dialogVisible=!1,this.$refs.ruleForm.resetFields()},showCurrentProject(e){var a,t;return null==(t=(null==(a=this.busData.options.project)?void 0:a.filter((a=>a.id===e)))[0])?void 0:t.name},cancelFn(){this.dialogVisible=!1,this.$refs.ruleForm.resetFields()},filterChange(e){const a=Object.values(e)[0];this.filters.currentProjectFilter=a.length===this.filters.projectFilter.length?"":a,this.getList()},switchStatus(e,a){this.statusMessage=1===e?"产品状态开启后，产品数据开始在平台上展示":"产品状态关闭后,产品数据将不在报表中显示"},cancelStatus(e){this.getList()},async confirmStatus(e){await P(e.id,{id:e.id,status:e.status}),this.getList()},sortChange(e,a,t){"ascending"===e.order?this.tableOrder="asc":"descending"===e.order&&(this.tableOrder="desc"),this.getList()}}},X={class:"app-container"},Z={style:{"text-align":"right"}},ee=f("取消"),ae=f("确认"),te={class:"w100 control-box flex jc-end"},ie={class:"flex flex-end"},le=f("搜索"),se=f(" 创建产品 "),oe={class:"w100 flex"};const ne={components:{Project:G,Product:A(W,[["render",function(e,a,t,i,l,s){const o=n("el-input"),v=n("el-form-item"),j=n("el-option"),_=n("el-select"),C=n("el-form"),V=n("el-button"),k=n("el-dialog"),P=n("el-table-column"),T=n("el-switch"),x=n("el-table"),F=n("pagination");return d(),r("div",X,[p(" dialog "),c(k,{modelValue:l.dialogVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>l.dialogVisible=e),title:"edit"===l.dialogType?"编辑产品":"创建产品",width:"80%"},{default:u((()=>[c(C,{ref:"ruleForm",model:l.busData.data,rules:l.busData.rules,"label-width":"150px","label-position":"left"},{default:u((()=>[c(v,{label:"产品名称",prop:"name"},{default:u((()=>[c(o,{modelValue:l.busData.data.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.busData.data.name=e),placeholder:"请输入产品名称",disabled:"edit"===l.dialogType},null,8,["modelValue","disabled"])])),_:1}),c(v,{label:"项目组",prop:"project"},{default:u((()=>[c(_,{modelValue:l.busData.data.project,"onUpdate:modelValue":a[1]||(a[1]=e=>l.busData.data.project=e),class:"w100",placeholder:"请选择所属项目组"},{default:u((()=>[(d(!0),r(m,null,g(l.busData.options.project,(e=>(d(),b(j,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(' <el-form-item label="APP_ID" prop="appid">\n          <el-input v-model="busData.data.appid" placeholder="请输入app_id" />\n        </el-form-item>\n        <el-form-item label="数数项目ID" prop="projectId">\n          <el-input v-model="busData.data.projectId" placeholder="请输入数数项目ID" :disabled="dialogType===\'edit\'" />\n        </el-form-item>\n        <el-form-item label="热云APPKEY" prop="appkey">\n          <el-input v-model="busData.data.appkey" placeholder="请输入热云APPKEY" :disabled="dialogType===\'edit\'" />\n        </el-form-item>\n        <el-form-item label="状态" prop="status">\n          <el-select v-model="busData.data.status" class="w100">\n            <el-option\n              v-for="item in busData.options.status"\n              :key="item.id"\n              :label="item.name"\n              :value="item.id"\n            />\n          </el-select>\n        </el-form-item>\n        <el-form-item label="产品配置" prop="conf">\n          <el-transfer\n            filterable\n            :filter-method="busData.setting.filterMethod"\n            filter-placeholder="请输入搜索"\n            v-model="busData.data.conf"\n            :data="busData.data.data"\n            :titles="[\'Source\', \'Target\']"\n          >\n          </el-transfer>\n        </el-form-item> ')])),_:1},8,["model","rules"]),h("div",Z,[c(V,{type:"danger",onClick:s.cancelFn},{default:u((()=>[ee])),_:1},8,["onClick"]),c(V,{type:"primary",onClick:s.submitFn},{default:u((()=>[ae])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"]),p(" dialog "),h("div",te,[h("div",ie,[p(' <el-input placeholder="请输入内容" v-model="control.search" class="input-with-select">\n          <el-button type="primary" slot="append">搜索</el-button>\n        </el-input> '),c(o,{modelValue:l.control.search,"onUpdate:modelValue":a[3]||(a[3]=e=>l.control.search=e),class:"sw-200 mr-10",placeholder:"请输入产品名称或APPID"},null,8,["modelValue"]),c(V,{type:"primary",onClick:s.handleSearch},{default:u((()=>[le])),_:1},8,["onClick"]),e.judgePermissionElementFn("A-AP-PRODUCT-ADD-V")?(d(),b(V,{key:0,type:"primary",onClick:s.handleCreate},{default:u((()=>[se])),_:1},8,["onClick"])):p("v-if",!0)])]),c(x,{data:l.list,style:{width:"100%","margin-top":"30px"},border:"",onFilterChange:s.filterChange,onSortChange:s.sortChange},{default:u((()=>[c(P,{align:"center",label:"ID",prop:"id",sortable:"custom"}),c(P,{align:"center",label:"项目组",filters:l.filters.projectFilter},{default:u((e=>[f(y(s.showCurrentProject(e.row.project_id)),1)])),_:1},8,["filters"]),c(P,{align:"center",label:"产品名称"},{default:u((e=>[f(y(e.row.name),1)])),_:1}),c(P,{align:"center",label:"创建时间"},{default:u((e=>[f(y(e.row.create_time),1)])),_:1}),c(P,{align:"center",label:"更新时间"},{default:u((e=>[f(y(e.row.update_time),1)])),_:1}),c(P,{align:"center",label:"产品状态"},{default:u((e=>[p(' <el-popconfirm\n            :title="statusMessage"\n            @onConfirm="confirmStatus(scope.row)"\n            @onCancel="cancelStatus(scope.row)"\n          > '),c(T,{slot:"reference",modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":2,onChange:a=>s.changeStatus(a,e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),p(" </el-popconfirm> "),p(' <el-popover\n            v-model="productPopVisible"\n            placement="top"\n            width="200"\n          >\n            <p>确定删除吗？</p>\n            <div style="text-align: right; margin: 0">\n              <el-button type="text" @click="cancelStatus(scope.row)">取消</el-button>\n              <el-button type="text" @click="confirmStatus(scope.row)">确定</el-button>\n            </div>\n            <el-switch\n              slot="reference"\n              v-model="scope.row.status"\n              active-value="1"\n              inactive-value="2"\n              @change="switchStatus($event, scope.row)"\n            />\n          </el-popover> ')])),_:1}),p(' <el-table-column v-if="judgePermissionElementFn(\'A-AP-PRODUCT-EDIT-V\')" align="center" label="操作">\n        <template #default="scope">\n          <div class="flex">\n            <el-button type="primary" size="small" @click="handleEdit(scope)">编辑</el-button>\n            <el-button v-if="judgePermissionElementFn(\'A-AP-PRODUCT-DEL-V\')" type="danger" size="small" @click="handleDelete(scope)">删除</el-button>\n          </div>\n        </template>\n      </el-table-column> ')])),_:1},8,["data","onFilterChange","onSortChange"]),p(" pagination "),h("div",oe,[D(c(F,{total:l.pagination.total,"page-sizes":l.pagination.pageSizes,page:l.pagination.listQuery.page,"onUpdate:page":a[4]||(a[4]=e=>l.pagination.listQuery.page=e),limit:l.pagination.listQuery.limit,"onUpdate:limit":a[5]||(a[5]=e=>l.pagination.listQuery.limit=e),onPagination:s.init},null,8,["total","page-sizes","page","limit","onPagination"]),[[w,l.pagination.total]])])])}]])},data:()=>({activeName:"product"}),computed:s({},o(["element"])),methods:{handleClick(e,a){this.activeName=e.props.name}}},de={class:"app-container"};var re=A(ne,[["render",function(e,a,t,i,l,s){const o=n("product"),m=n("el-tab-pane"),g=n("project"),h=n("el-tabs");return d(),r("div",de,[c(h,{modelValue:l.activeName,"onUpdate:modelValue":a[0]||(a[0]=e=>l.activeName=e),type:"card",onTabClick:s.handleClick},{default:u((()=>[c(m,{name:"product",label:"产品信息"},{default:u((()=>["product"===l.activeName?(d(),b(o,{key:0})):p("v-if",!0)])),_:1}),c(m,{name:"project",label:"项目组"},{default:u((()=>["project"===l.activeName?(d(),b(g,{key:0})):p("v-if",!0)])),_:1})])),_:1},8,["modelValue","onTabClick"])])}]]);export{re as default};
