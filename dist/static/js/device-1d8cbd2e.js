import{d as e,r as l,w as t,M as s,m as a,s as o,n as r,v as u,c,p as n,q as p,b as d,x as b}from"./index-6f4b8479.js";import{b as i}from"./format-15e3f823.js";import{_ as m}from"./lodash-d786f6f0.js";const f={class:"full"},h={class:"w100 flex mt-20"},_=u("span",null,"选中合计：",-1),w=["textContent"],j=e({props:{all:{require:!0,default:()=>({}),type:Object},select:{require:!0,default:()=>({}),type:Object}},emits:["kk","count","up"],setup(e,{emit:j}){const v=e;let O=[];const x=l({search:{id:""},test:"",set:new Set,setObj:{},spanArr:O,all:O,select:O,statisticsCount:0}),C=()=>{let e=[...x.set].map((e=>e=[e,!1]));x.setObj=Object.fromEntries(e),V()},V=()=>{Object.keys(x.setObj).forEach((e=>{let l=[];x.all.forEach((t=>{t.source===e&&l.push(t.select_status)})),x.setObj[e]=!0,l.includes(!1)&&(x.setObj[e]=!1)})),g()},g=()=>{let e=x.all.reduce(((e,l)=>l.select_status?e+parseInt(l.device_count):e),0);x.statisticsCount=i(e),j("count",e)},A=()=>{let e=[],l=0;x.all.forEach((t=>{t.select_status&&(e.push({source:t.source,label:t.label}),l+=parseInt(t.device_count))})),j("kk",e)},k=(e,l)=>{x.spanArr=[];let t=0;for(var s=0;s<e.length;s++)0===s?x.spanArr.push(1):e[s][l]===e[s-1][l]?(x.spanArr[t]+=1,x.spanArr.push(0)):(x.spanArr.push(1),t=s)},I=({row:e,column:l,rowIndex:t,columnIndex:s})=>{if(0===s){const e=x.spanArr[t];return{rowspan:e,colspan:e>0?1:0}}};return t((()=>v.all),((e,l)=>{v.all&&v.all.length>0&&(x.all=m.cloneDeep(v.all),x.select=m.cloneDeep(v.select),x.set=new Set,x.all.map((e=>(e.select_status=!1,x.set.add(e.source),x.select.map((l=>(e.source===l.source&&e.label===l.label&&(e.select_status=!0),e))),e))),x.all.sort(((e,l)=>e.label>l.label?1:e.label<l.label?-1:1)),x.all.sort(((e,l)=>e.source>l.source?1:e.source<l.source?-1:1)),k(x.all,"source"),C())}),{immediate:!0}),s((()=>{})),(e,l)=>{const t=a("el-checkbox"),s=a("el-table-column"),m=a("el-table");return o(),r("div",null,[u("div",f,[c(m,{data:p(x).all,"span-method":I,border:"",style:{width:"100%","margin-top":"20px"}},{default:n((()=>[c(s,{prop:"source",label:"Source",width:"180"},{default:n((e=>[c(t,{modelValue:p(x).setObj[e.row.source],"onUpdate:modelValue":l=>p(x).setObj[e.row.source]=l,onChange:l=>{return t=e.row.source,s=p(x).setObj[e.row.source],x.all.map((e=>{e.source===t&&(e.select_status=s)})),V(),void A();var t,s}},{default:n((()=>[d(b(e.row.source),1)])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),c(s,{prop:"label",label:"Label"}),c(s,{prop:"slot_id",label:"Slot ID"}),c(s,{prop:"device_count",label:"Count"},{default:n((e=>[u("span",null,b(p(i)(e.row.device_count)),1)])),_:1}),c(s,{prop:"select",label:"Select"},{default:n((e=>[c(t,{modelValue:e.row.select_status,"onUpdate:modelValue":l=>e.row.select_status=l,onChange:l=>(e.row,V(),void A())},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1})])),_:1},8,["data"]),u("div",h,[_,u("span",{textContent:b(p(x).statisticsCount)},null,8,w)])])])}}});export{j as _};
