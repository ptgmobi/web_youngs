var e=Object.defineProperty,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,a=(l,r,t)=>r in l?e(l,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[r]=t,o=(e,o)=>{for(var i in o||(o={}))r.call(o,i)&&a(e,i,o[i]);if(l)for(var i of l(o))t.call(o,i)&&a(e,i,o[i]);return e};import{E as i,_ as u,d as s,h as m,r as d,L as n,q as c,o as p,c as f,z as v,e as g,s as _,v as h,x as y,P as w,N as F,O as b,A as U,f as V,y as z,K as j,a9 as P,g as q}from"./main-dae9cd13.js";import{b as L,c as x,d as k}from"./dsp-campaign-fbd07c68.js";import{m as O}from"./message-2d1d3f7c.js";import{_ as R}from"./index-d2a78e62.js";import{u as C}from"./useUtils-0c0cc193.js";import{d as $,e as M}from"./new-format-299c060c.js";import{_ as S}from"./lodash-edd1f566.js";import{e as D}from"./dsp-advertiser-7caa14fa.js";const I=e=>{let l=e.filter((e=>"rejected"===e.status)),r={};if(0!==l.length)r={status:!1,msg:l.map((e=>e.reason)).join(",")},i.error(r.msg);else{let l={};e.map((e=>{let r=e.value;for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const e=r[t];e&&(l[t]=e)}})),r={status:!0,msg:"success",data:l}}return r};var E={validate:async(e,l,r)=>{const{type_reg:t,size:a,limit:o,duration:i}=r;if("image"===l){let l={w:"",h:"",limit:e.size,type:e.type};const r=new Promise((function(l,r){let t=(window.URL||window.webkitURL).createObjectURL(e),o={},i=new Image;i.onload=function(){let e=i.width,t=i.height,u=a.find((l=>l.width===e&&l.height===t));o.w=e,o.h=t,u?l(o):r("图片尺寸错误")},i.src=t})),i=new Promise((function(r,a){let o=e.type,i=t.test(o);i?r(l):a("图片类型错误")})),u=new Promise((function(r,t){e.size<=o?r(l):t("图片大小错误")})),s=await Promise.allSettled([r,i,u]).then((e=>e));return new Promise(((e,l)=>{let r=I(s);r.status?e(r):l("error")}))}if("video"===l){let l={w:"",h:"",limit:e.size,type:e.type,duration:""};const r=new Promise((function(r,t){let o=URL.createObjectURL(e),u=document.createElement("video");u.onloadedmetadata=function(e){URL.revokeObjectURL(o);let s=u.duration,m=u.videoWidth,d=u.videoHeight;return a.find((e=>e.width===m&&e.height===d))?s<=i?(l.w=m,l.h=d,l.duration=s,r(l)):t("视频时长错误"):t("视频尺寸错误")},u.src=o,u.load()})),u=new Promise((function(r,a){let o=e.type;t.test(o)?r(l):a("视频类型错误")})),s=new Promise((function(r,t){e.size<=o?r(l):t("视频大小错误")})),m=await Promise.allSettled([r,u,s]).then((e=>e));return new Promise(((e,l)=>{let r=I(m);r.status?e(r):l("error")}))}},uploadHttpRequest:async e=>{const l=new FormData;l.append("logo_url",e.file);return await D(l)}};const H={logo_type_reg:/png|jpg|jpeg/,logo_limit:3145728,logo_size:[{width:100,height:100},{width:500,height:500}],image_type_reg:/png|jpg|jpeg|gif/,image_limit:3145728,image_size:[{width:160,height:600},{width:250,height:250},{width:300,height:50},{width:300,height:250},{width:300,height:600},{width:320,height:50},{width:320,height:100},{width:320,height:480},{width:480,height:320},{width:628,height:1200},{width:728,height:90},{width:970,height:250},{width:1200,height:628}],video_type_reg:/mp4/,video_limit:10485760,video_duration:30,video_size:[{width:320,height:480},{width:480,height:320}],cover_image_type_reg:/png|jpg|jpeg|gif/,cover_image_limit:3145728,cover_image_size:[{width:320,height:480},{width:480,height:320}]};const B={class:"content-con from-one flex column"},N={class:"content-con from-one flex column"},A={key:0},K=["src"],W={class:"upload-video-control-box el-upload-list__item-actions flex"},G=["onClick"],J={class:"w100 flex"},Q=V(" 确认 "),T=V(" 取消 "),X={class:"flex"},Y=["src"],Z=["src"];var ee=u(s({setup(e){const{validate:l,uploadHttpRequest:r}=E,{logo_type_reg:t,logo_limit:a,logo_size:u,image_type_reg:s,image_limit:D,image_size:I,video_type_reg:ee,video_limit:le,video_duration:re,video_size:te,cover_image_type_reg:ae,cover_image_limit:oe,cover_image_size:ie}=H,{getRouterData:ue,getCommonCountryList:se,goNewUrl:me}=C();let{proxy:de}=q();const ne=m(""),ce=m(""),pe=m(!1),fe="此项必填";let ve=m("create"),ge=m([]),_e=m([]),he=m([]),ye=m([]);const we={id:void 0,name:"",descs:"",type:1,url:"",audit_status:void 0,size:"",memory_size:"",format:"",duration:void 0,status:1,is_del:void 0,logo_url:"",title:"",main_body:"",actions:"",brand:"",cover_url:"",video_url:"",raw_file_image:void 0,raw_file_video:void 0},Fe=d({ruleForm:we,rules:{name:[{required:!0,message:fe,trigger:["blur","change"]}],title:[{required:!0,message:fe,trigger:["blur","change"]}],main_body:[{required:!0,message:fe,trigger:["blur","change"]}],actions:[{required:!0,message:fe,trigger:["blur","change"]}],brand:[{required:!0,message:fe,trigger:["blur","change"]}],url:[{required:!0,message:fe,trigger:["blur","change"]}],logo_url:[{required:!0,message:fe,trigger:["blur","change"]}],cover_url:[{required:!0,message:fe,trigger:["blur","change"]}]},options:{type:[{value:1,label:"图片"},{value:2,label:"视频"},{value:3,label:"原生"}],audit_status:[{value:1,label:"未审核"},{value:2,label:"审核通过"},{value:3,label:"审核未通过"}]}}),be=()=>{de.$refs.ruleForm.validate((e=>{if(!e)return!1;Ve()}))},Ue=["id","adv_series_type","adv_series_budget"],Ve=async()=>{let e=w(Fe.ruleForm),l=new URLSearchParams;l.append("type",e.type);let r=`type=${l.get("type")}`;if((e=>{let l=e.type;if(1===l||3===l){let l=e.raw_file_image;l&&(e.size=`${l.w}*${l.h}`,e.memory_size=`${(l.limit/1048576).toFixed(2)}MB`,e.format=l.type,delete e.duration)}if(2===l){let l=e.raw_file_video;l&&(e.size=`${l.w}*${l.h}`,e.memory_size=`${(l.limit/1048576).toFixed(2)}MB`,e.format=l.type,e.duration=l.duration,e.url=e.video_url)}})(e),e=$(e),e=M(e,Ue),ve.value,"create"===ve.value){delete e.id;const l=await L(r,e);O(l)&&ze()}if("edit"===ve.value){const l=await x(r,e);O(l)&&ze()}},ze=()=>{me({url:"/campaign/administration/list"})},je=(e,l)=>{},Pe=(e,l)=>{_e.value.splice(0)},qe=e=>{ne.value=e.url;let l="",r=ee;s.test(ne.value)&&(l="image"),r.test(ne.value)&&(l="video"),ce.value=l,pe.value=!0},Le=(e,l)=>{let r=null==e?void 0:e.data;Fe.ruleForm.logo_url=r,he.value.splice(0),he.value.push({name:r,url:r})},xe=(e,l)=>{let r=null==e?void 0:e.data;Fe.ruleForm.url=r,ge.value.splice(0),ge.value.push({name:r,url:r})},ke=(e,l)=>{let r=null==e?void 0:e.data;Fe.ruleForm.cover_url=r,ye.value.splice(0),ye.value.push({name:r,url:r})},Oe=(e,l)=>{let r=null==e?void 0:e.data;Fe.ruleForm.video_url=r,_e.value.splice(0),_e.value.push({name:r,url:r})},Re=async e=>l(e,"image",{type_reg:t,limit:a,size:u}),Ce=async e=>{const r={type_reg:s,limit:D,size:I};let t=await l(e,"image",r);return Fe.ruleForm.raw_file_image=t.data,t},$e=async e=>l(e,"image",{type_reg:ae,limit:oe,size:ie}),Me=async e=>{const r={type_reg:ee,limit:le,size:te,duration:re};let t=await l(e,"video",r);return Fe.ruleForm.raw_file_video=t.data,t},Se=(e,l)=>{i({message:"只能上传一个，请删除后重试",type:"warning"})},De=()=>{var e,l;let{query:r,params:t}=ue();if(ve.value=null!=(l=null==(e=r.type)?void 0:e.toString())?l:"",ve.value,(async()=>{})(),"create"===ve.value&&(Fe.ruleForm=S.cloneDeep(we)),"edit"===ve.value){const{id:e}=t,{campaign_type:l}=r;(async(e,l)=>{let r=new URLSearchParams;r.append("type",l);let t=`type=${r.get("type")}`;const a=await k(e,t),{data:i}=a;Fe.ruleForm=o(o({},Fe.ruleForm),i),Fe.ruleForm,1===Fe.ruleForm.type&&Fe.ruleForm.url&&ge.value.push({name:Fe.ruleForm.url,url:Fe.ruleForm.url}),2===Fe.ruleForm.type&&(Fe.ruleForm.url&&(_e.value.push({name:Fe.ruleForm.url,url:Fe.ruleForm.url}),Fe.ruleForm.video_url=Fe.ruleForm.url),Fe.ruleForm.logo_url&&he.value.push({name:Fe.ruleForm.logo_url,url:Fe.ruleForm.logo_url}),Fe.ruleForm.cover_url&&ye.value.push({name:Fe.ruleForm.cover_url,url:Fe.ruleForm.cover_url})),3===Fe.ruleForm.type&&(Fe.ruleForm.url&&ge.value.push({name:Fe.ruleForm.url,url:Fe.ruleForm.url}),Fe.ruleForm.logo_url&&he.value.push({name:Fe.ruleForm.logo_url,url:Fe.ruleForm.logo_url}))})(e,l)}};return n((()=>{De()})),(e,l)=>{const t=c("el-input"),a=c("el-form-item"),o=c("el-radio"),i=c("el-radio-group"),u=c("el-icon"),s=c("el-upload"),m=c("zoom-in"),d=c("Delete"),n=c("el-form"),w=c("el-button"),q=c("el-dialog");return p(),f("div",null,[v(" form "),g(n,{ref:"ruleForm",enctype:"multipart/form-data",rules:h(Fe).rules,model:h(Fe).ruleForm,"label-width":"150px","label-position":"right",class:"flex column",disabled:"edit"===h(ve)&&2===h(Fe).ruleForm.is_del},{default:_((()=>[g(h(R),{title:"基础信息"}),y("div",B,[v(" 创意名称 "),g(a,{class:"self-el-form-item",label:"创意名称:",prop:"name"},{default:_((()=>[g(t,{modelValue:h(Fe).ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>h(Fe).ruleForm.name=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1}),v(" 描述 "),g(a,{class:"self-el-form-item",label:"描述:",prop:"descs"},{default:_((()=>[g(t,{modelValue:h(Fe).ruleForm.descs,"onUpdate:modelValue":l[1]||(l[1]=e=>h(Fe).ruleForm.descs=e),modelModifiers:{trim:!0},class:"form-one",placeholder:"",type:"textarea"},null,8,["modelValue"])])),_:1})]),g(h(R),{title:"创意设计"}),y("div",N,[v(" 创意样式 "),g(a,{class:"self-el-form-item",label:"创意样式:",prop:"type"},{default:_((()=>[g(i,{class:"form-one",modelValue:h(Fe).ruleForm.type,"onUpdate:modelValue":l[2]||(l[2]=e=>h(Fe).ruleForm.type=e)},{default:_((()=>[(p(!0),f(F,null,b(h(Fe).options.type,(e=>(p(),U(o,{label:e.value},{default:_((()=>[V(z(e.label),1)])),_:2},1032,["label"])))),256))])),_:1},8,["modelValue"])])),_:1}),v(" 上传素材 --- 图片 "),1===h(Fe).ruleForm.type||3===h(Fe).ruleForm.type?(p(),U(a,{key:0,class:"self-el-form-item",label:"上传图片素材:",prop:"url"},{default:_((()=>[g(s,{class:"avatar-uploader",name:"url",action:"",limit:1,"list-type":"picture-card","file-list":h(ge),"onUpdate:file-list":l[3]||(l[3]=e=>j(ge)?ge.value=e:ge=e),"on-preview":qe,"on-remove":je,"on-success":xe,"before-upload":Ce,"on-exceed":Se,"http-request":h(r)},{default:_((()=>[v(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),g(u,null,{default:_((()=>[g(h(P))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):v("v-if",!0),v(" 上传素材 --- 视频 "),2===h(Fe).ruleForm.type?(p(),U(a,{key:1,class:"self-el-form-item",label:"上传视频素材:",prop:"url"},{default:_((()=>[g(s,{class:"avatar-uploader",name:"url",action:"",accept:"",limit:1,"list-type":"picture-card","file-list":h(_e),"onUpdate:file-list":l[4]||(l[4]=e=>j(_e)?_e.value=e:_e=e),"on-preview":qe,"on-remove":je,"on-success":Oe,"before-upload":Me,"on-exceed":Se,"http-request":h(r)},{file:_((({file:e})=>[y("div",null,[0!==h(_e).length?(p(),f("div",A,[y("video",{src:h(Fe).ruleForm.video_url,class:"avatar video-avatar"}," 您的浏览器不支持视频播放 ",8,K),y("div",W,[y("span",{class:"el-upload-list__item-preview cp",onClick:l=>qe(e)},[g(u,null,{default:_((()=>[g(m)])),_:1})],8,G),y("span",{class:"el-upload-list__item-preview cp",onClick:Pe},[g(u,null,{default:_((()=>[g(d)])),_:1})])])])):v("v-if",!0)])])),default:_((()=>[g(u,null,{default:_((()=>[g(h(P))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):v("v-if",!0),v(" 上传封面 "),2===h(Fe).ruleForm.type?(p(),U(a,{key:2,class:"self-el-form-item",label:"上传封面:",prop:"cover_url"},{default:_((()=>[g(s,{class:"avatar-uploader",name:"cover_url",action:"",limit:1,"list-type":"picture-card","file-list":h(ye),"onUpdate:file-list":l[5]||(l[5]=e=>j(ye)?ye.value=e:ye=e),"on-preview":qe,"on-remove":je,"on-success":ke,"before-upload":$e,"on-exceed":Se,"http-request":h(r)},{default:_((()=>[v(' <img v-if="fileListCoverUrl.length !== 0" :src="state.ruleForm.cover_url" :preview-src-list="[state.ruleForm.cover_url]" class="avatar" /> '),g(u,null,{default:_((()=>[g(h(P))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):v("v-if",!0),v(" 上传Logo "),3===h(Fe).ruleForm.type||2===h(Fe).ruleForm.type?(p(),U(a,{key:3,class:"self-el-form-item",label:"上传Logo:",prop:"url"},{default:_((()=>[g(s,{class:"avatar-uploader",name:"logo_url",action:"",limit:1,"list-type":"picture-card","file-list":h(he),"onUpdate:file-list":l[6]||(l[6]=e=>j(he)?he.value=e:he=e),"on-preview":qe,"on-remove":je,"on-success":Le,"before-upload":Re,"on-exceed":Se,"http-request":h(r)},{default:_((()=>[v(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),g(u,null,{default:_((()=>[g(h(P))])),_:1})])),_:1},8,["file-list","http-request"])])),_:1})):v("v-if",!0),v(" 标题 "),3===h(Fe).ruleForm.type||2===h(Fe).ruleForm.type?(p(),U(a,{key:4,class:"self-el-form-item",label:"标题:",prop:"title"},{default:_((()=>[g(t,{modelValue:h(Fe).ruleForm.title,"onUpdate:modelValue":l[7]||(l[7]=e=>h(Fe).ruleForm.title=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):v("v-if",!0),v(" 正文 "),3===h(Fe).ruleForm.type||2===h(Fe).ruleForm.type?(p(),U(a,{key:5,class:"self-el-form-item",label:"正文:",prop:"main_body"},{default:_((()=>[g(t,{modelValue:h(Fe).ruleForm.main_body,"onUpdate:modelValue":l[8]||(l[8]=e=>h(Fe).ruleForm.main_body=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):v("v-if",!0),v(" 行动号召 "),3===h(Fe).ruleForm.type?(p(),U(a,{key:6,class:"self-el-form-item",label:"行动号召:",prop:"actions"},{default:_((()=>[g(t,{modelValue:h(Fe).ruleForm.actions,"onUpdate:modelValue":l[9]||(l[9]=e=>h(Fe).ruleForm.actions=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):v("v-if",!0),v(" 品牌 "),3===h(Fe).ruleForm.type?(p(),U(a,{key:7,class:"self-el-form-item",label:"品牌:",prop:"brand"},{default:_((()=>[g(t,{modelValue:h(Fe).ruleForm.brand,"onUpdate:modelValue":l[10]||(l[10]=e=>h(Fe).ruleForm.brand=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):v("v-if",!0),v(" {{state.ruleForm.raw_file_image}}\n        <br>\n        {{state.ruleForm.raw_file_video}}\n        <br>\n        {{fileListVideoUrl}}\n        {{fileListUrl}}\n        <br>\n        {{fileListVideoUrl}}\n        <br>\n        {{fileListLogoUrl}}\n        <br>\n        {{fileListCoverUrl}}\n        <br> ")])])),_:1},8,["rules","model","disabled"]),v(" form "),v(" footer "),y("div",J,[g(w,{type:"primary",onClick:be},{default:_((()=>[Q])),_:1}),g(w,{type:"primary",onClick:ze},{default:_((()=>[T])),_:1})]),v(" 图片预览 "),g(q,{modelValue:pe.value,"onUpdate:modelValue":l[11]||(l[11]=e=>pe.value=e)},{default:_((()=>[y("div",X,["image"===ce.value?(p(),f("img",{key:0,"w-full":"",src:ne.value,alt:"Preview Image"},null,8,Y)):v("v-if",!0),"video"===ce.value?(p(),f("video",{key:1,"w-full":"",src:ne.value,alt:"Preview Video",controls:""},null,8,Z)):v("v-if",!0)])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0b7edd8c"]]);export{ee as default};
