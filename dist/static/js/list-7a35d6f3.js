var ue=Object.defineProperty;var G=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var z=(h,d,_)=>d in h?ue(h,d,{enumerable:!0,configurable:!0,writable:!0,value:_}):h[d]=_,M=(h,d)=>{for(var _ in d||(d={}))ie.call(d,_)&&z(h,_,d[_]);if(G)for(var _ of G(d))de.call(d,_)&&z(h,_,d[_]);return h};import{d as L,z as $,w as ce,C as X,r as f,o as p,k as v,x as a,h as n,j as o,f as pe,a as I,al as fe,g as me,am as be,v as i,i as V,N as _e,O as ve,ae as Z,F as C,l as x,t as D,y as F,c as U}from"./vendor-bf64253d.js";import{g as he,h as ge,i as De,j as ye,k as we,l as Ve,m as Ce,n as xe,o as ke}from"./fenix-515b4b88.js";import{P as Oe}from"./index-839d96b8.js";import{h as S}from"./moment-1cf83a0b.js";import{m as P}from"./message-da701484.js";import{a as q}from"./new-format-b98ea9a0.js";import"./index-30657850.js";const Ue=L({props:{busData:{require:!0,default:()=>({}),type:Object}},setup(h){const d=h,j=$({tableData:[{}]}),R=async()=>{const A={offer_id:d.busData.offer.offer_id};j.tableData=[];const{data:l}=await he(A),k=l.sort((O,B)=>{const E=Number(S(O.date,S.ISO_8601).format("X")),T=Number(S(B.date,S.ISO_8601).format("X"));return E-T});j.tableData=k};return ce(()=>d.busData.offer.offer_id,(A,l)=>{},{immediate:!0}),X(()=>{console.log(d.busData),R()}),(A,l)=>{const k=f("el-table-column"),O=f("el-table");return p(),v("div",null,[a(O,{data:o(j).tableData,style:{width:"100%"},border:""},{default:n(()=>[a(k,{fixed:"",prop:"date",label:"Date",align:"center"}),a(k,{fixed:"",prop:"record",label:"Record",align:"center"}),a(k,{fixed:"",prop:"email",label:"User",align:"center"})]),_:1},8,["data"])])}}}),Fe={class:"control-box w100 mb-10"},je={class:"mb-10"},Ae=F(" Offer Create "),Se={class:"flex jc-start flex-wrap w100"},Pe={class:"flex"},Be={class:"flex"},Ee=F(" \u67E5\u8BE2 "),Te={class:"body-box mt-10"},Ne={class:"flex"},$e={key:0},Ie=F(" . "),Re=F(" . "),Qe=F(" . "),Ge={class:"flex"},ze={class:"w100 flex"},We=L({setup(h){pe(),I(!0);let d=I(!1);I(!1);const l=$({searchData:{adv_status:void 0,status:void 0,cvr_status:void 0,platform:void 0,attribute_provider:"",pub_name:"",offer_id:"",adv_offer:"",pkg:"",title:"",channel:"",country:"",channel_type:void 0},tableData:[],options:{status:[{value:1,label:"\u5F00"},{value:2,label:"\u5173"}],platform:[{value:1,label:"Android"},{value:2,label:"iOS"}],attribute_provider:[{value:"AppsFlyer",label:"AppsFlyer"},{value:"Branch",label:"Branch"},{value:"Adjust",label:"Adjust"},{value:"Singular",label:"Singular"},{value:"AppMetrica",label:"AppMetrica"}],pub:[{id:"",pub_name:""}],channel_type:[{value:"1",label:"BUZZ"},{value:"2",label:"SDK"}],dailyCapCount:{},cvr:{}},pagination:{pageSizes:["20","50","100","500","1000"],total:1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"}}});let O=$({});fe(l,"tableData");const B=({row:s})=>`/fenix/offer/edit/${s.id}`,E=async({row:s})=>{console.log(s);const t={id:s.id,status:s.status},u=await De(t);P(u)||(s.status=s.status===1?2:1)},T=async({row:s})=>{let t={id:s.id,cvr_status:s.cvr_status};t=q(t);const u=await ye(t);P(u)||(s.cvr_status=s.cvr_status===1?2:1)},J=async({row:s})=>{let t={id:s.id,target_cvr:s.target_cvr};t=q(t);const u=await we(t);P(u)},K=async()=>{const{data:s}=await Ve();l.options.pub=s},H=async()=>{const{data:s}=await Ce(),t={};for(const u in s)if(Object.prototype.hasOwnProperty.call(s,u)){const m=s[u].split("_"),y={click_w:m[0],installs:m[1],cvr_w:m[2]};t[u]=y}l.options.cvr=t},W=async()=>{const{data:s}=await xe();l.options.dailyCapCount=s},Y=async()=>Promise.all([K(),W(),H()]),N=async()=>{let s={page:l.pagination.listQuery.page,limit:l.pagination.listQuery.limit};const t=M({},l.searchData);for(const g in t)if(Object.prototype.hasOwnProperty.call(t,g)){const m=t[g];m&&(s[g]=m)}const u=await ge(s);l.tableData=u.data.data,l.pagination.total=u.data.paging.count},ee=()=>{N()},ae=async s=>{const{row:t}=s,u=await ke(t.id);P(u)&&l.tableData.splice(s.$index,1)},le=(s,t)=>{let u="";u=`${s.offer_id}_${t.slotid}`;const g=l.options.dailyCapCount[u];return g?`: ${g}`:""};me(()=>{}),X(()=>{Y(),N(),window.onpopstate=()=>{console.log("onpopstate")}}),be(()=>{});const te=s=>{O.offer=s,d.value=!0};return(s,t)=>{const u=f("el-button"),g=f("router-link"),m=f("el-option"),y=f("el-select"),b=f("el-form-item"),w=f("el-input"),oe=f("el-form"),c=f("el-table-column"),Q=f("el-switch"),ne=f("el-popconfirm"),se=f("el-table"),re=f("el-dialog");return p(),v("div",null,[i("div",Fe,[i("div",je,[a(g,{to:"/fenix/offer/create"},{default:n(()=>[a(u,{type:"primary"},{default:n(()=>[Ae]),_:1})]),_:1})]),a(oe,{modelValue:o(l).searchData,"onUpdate:modelValue":t[12]||(t[12]=e=>o(l).searchData=e),inline:!0,class:"flex jc-between w100 ai-end"},{default:n(()=>[i("div",Se,[a(b,{label:""},{default:n(()=>[a(y,{modelValue:o(l).searchData.adv_status,"onUpdate:modelValue":t[0]||(t[0]=e=>o(l).searchData.adv_status=e),clearable:"",class:"search-con",placeholder:"Adv Status"},{default:n(()=>[(p(!0),v(C,null,x(o(l).options.status,e=>(p(),U(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(y,{modelValue:o(l).searchData.status,"onUpdate:modelValue":t[1]||(t[1]=e=>o(l).searchData.status=e),clearable:"",class:"search-con",placeholder:"Status"},{default:n(()=>[(p(!0),v(C,null,x(o(l).options.status,e=>(p(),U(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),V(` <el-form-item label="">
            <el-select v-model="state.searchData.cvr_status" clearable class="search-con" placeholder="Cvr Status">
              <el-option
                v-for="item in state.options.status"
                :key="item.value"
                :label="item.label"
                :value="item.value"
              />
            </el-select>
          </el-form-item> `),a(b,{label:""},{default:n(()=>[a(y,{modelValue:o(l).searchData.platform,"onUpdate:modelValue":t[2]||(t[2]=e=>o(l).searchData.platform=e),clearable:"",class:"search-con",placeholder:"Platform"},{default:n(()=>[(p(!0),v(C,null,x(o(l).options.platform,e=>(p(),U(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(y,{modelValue:o(l).searchData.attribute_provider,"onUpdate:modelValue":t[3]||(t[3]=e=>o(l).searchData.attribute_provider=e),clearable:"",class:"search-con",placeholder:"Attribute Provider"},{default:n(()=>[(p(!0),v(C,null,x(o(l).options.attribute_provider,e=>(p(),U(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(y,{modelValue:o(l).searchData.pub_name,"onUpdate:modelValue":t[4]||(t[4]=e=>o(l).searchData.pub_name=e),clearable:"",class:"search-con",placeholder:"Pub Name"},{default:n(()=>[(p(!0),v(C,null,x(o(l).options.pub,e=>(p(),U(m,{key:e.id,label:e.pub_name,value:e.pub_name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(w,{modelValue:o(l).searchData.offer_id,"onUpdate:modelValue":t[5]||(t[5]=e=>o(l).searchData.offer_id=e),placeholder:"Offer ID",class:"search-con"},null,8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(w,{modelValue:o(l).searchData.adv_offer,"onUpdate:modelValue":t[6]||(t[6]=e=>o(l).searchData.adv_offer=e),placeholder:"Adv Offer",class:"search-con"},null,8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(w,{modelValue:o(l).searchData.pkg,"onUpdate:modelValue":t[7]||(t[7]=e=>o(l).searchData.pkg=e),placeholder:"Pachage Name",class:"search-con"},null,8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(w,{modelValue:o(l).searchData.title,"onUpdate:modelValue":t[8]||(t[8]=e=>o(l).searchData.title=e),placeholder:"Offer Title",class:"search-con"},null,8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(w,{modelValue:o(l).searchData.channel,"onUpdate:modelValue":t[9]||(t[9]=e=>o(l).searchData.channel=e),placeholder:"Channel",class:"search-con"},null,8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(w,{modelValue:o(l).searchData.country,"onUpdate:modelValue":t[10]||(t[10]=e=>o(l).searchData.country=e),placeholder:"Country",class:"search-con"},null,8,["modelValue"])]),_:1}),a(b,{label:""},{default:n(()=>[a(y,{modelValue:o(l).searchData.channel_type,"onUpdate:modelValue":t[11]||(t[11]=e=>o(l).searchData.channel_type=e),clearable:"",class:"search-con",placeholder:"Channel Type"},{default:n(()=>[(p(!0),v(C,null,x(o(l).options.channel_type,e=>(p(),U(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),i("div",Pe,[a(b,{class:"mr-0",style:{"margin-right":"0px"}},{default:n(()=>[i("div",Be,[a(u,{type:"primary",onClick:ee},{default:n(()=>[Ee]),_:1}),V(' <el-button type="primary" @click="handleExportSearch">\u5BFC\u51FA</el-button> ')])]),_:1})])]),_:1},8,["modelValue"]),V(` <el-input placeholder="\u8BF7\u8F93\u5165\u5185\u5BB9" v-model="searchData.data" class='search-input'>
        <el-button slot="append" icon="Search" @click='searchFun'></el-button>
      </el-input> `)]),V(" table "),i("div",Te,[a(se,{data:o(l).tableData,class:"w100",height:"60vh",border:""},{default:n(()=>[a(c,{fixed:"",prop:"offer_id",label:"Offer ID",align:"center",width:"60"}),a(c,{fixed:"",prop:"adv_offer",label:"Adv Offer",align:"center",width:"87"}),a(c,{fixed:"",prop:"channel",label:"Channel",align:"center",width:"42"}),a(c,{prop:"revenue",label:"Revenue",align:"center",width:"45"}),a(c,{prop:"pkg",label:"Package Name",align:"center",width:"100"}),a(c,{prop:"title",label:"Offer Title",align:"center",width:"90"}),a(c,{prop:"pid",label:"Pid",align:"center",width:"77"}),a(c,{prop:"country",label:"Country",align:"center",width:"40"}),a(c,{label:"Adv Status",align:"center",width:"47"},{default:n(e=>[i("div",null,[i("span",null,D(e.row.adv_status===1?"\u5F00":"\u5173"),1)])]),_:1}),a(c,{prop:"offer_id",label:"Click*w",align:"center",width:"55"},{default:n(e=>{var r;return[i("div",null,[i("span",null,D((r=o(l).options.cvr[e.row.offer_id])==null?void 0:r.click_w),1)])]}),_:1}),a(c,{prop:"offer_id",label:"Installs",align:"center",width:"50"},{default:n(e=>{var r;return[i("div",null,[i("span",null,D((r=o(l).options.cvr[e.row.offer_id])==null?void 0:r.installs),1)])]}),_:1}),a(c,{prop:"offer_id",label:"Cvr*w",align:"center",width:"48"},{default:n(e=>{var r;return[i("div",null,[i("span",null,D((r=o(l).options.cvr[e.row.offer_id])==null?void 0:r.cvr_w),1)])]}),_:1}),a(c,{label:"Target Cvr*w",align:"center",width:"150"},{default:n(e=>[i("div",Ne,[a(w,{modelValue:e.row.target_cvr,"onUpdate:modelValue":r=>e.row.target_cvr=r,placeholder:"Please input",class:"input-with-select mr-5"},null,8,["modelValue","onUpdate:modelValue"]),a(u,{class:"mr-5 scale-button",type:"default",icon:"Edit",circle:"",onClick:r=>J(e)},null,8,["onClick"]),a(Q,{modelValue:e.row.cvr_status,"onUpdate:modelValue":r=>e.row.cvr_status=r,class:"scale-button","active-value":1,"inactive-value":2,onChange:r=>T(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),a(c,{label:"Traffic Data",align:"left",width:"200"},{default:n(e=>[e.row.traffic?(p(),v("div",$e,[(p(!0),v(C,null,x(JSON.parse(e.row.traffic),r=>(p(),v("div",{key:r},[i("div",null,[i("span",null,D(r.pub_status===1?"\u5F00":"\u5173"),1),Ie,i("span",null,D(r.pub),1),Re,i("span",null,D(r.payout),1),Qe,i("span",null,D(r.cap_daily),1),i("span",null,D(le(e.row,r)),1)])]))),128))])):V("v-if",!0)]),_:1}),a(c,{label:"Operation",align:"center",width:"130"},{default:n(e=>[a(g,{to:B(e)},{default:n(()=>[a(u,{class:"cp mr-5",type:"primary",icon:"Edit",circle:""})]),_:2},1032,["to"]),a(Q,{modelValue:e.row.status,"onUpdate:modelValue":r=>e.row.status=r,"active-value":1,"inactive-value":2,class:"mr-5",onChange:r=>E(e)},null,8,["modelValue","onUpdate:modelValue","onChange"]),a(ne,{title:"\u5220\u9664\u540E\u65E0\u6CD5\u518D\u751F\u6210\u8BE5Offer ID\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",onConfirm:r=>ae(e)},{reference:n(()=>[a(u,{type:"danger",icon:"Delete",circle:""})]),_:2},1032,["onConfirm"])]),_:1}),a(c,{label:"Platform",align:"center",width:"55"},{default:n(e=>[i("div",null,[i("span",null,D(e.row.platform===1?"Android":"iOS"),1)])]),_:1}),a(c,{prop:"attribute_provider",label:"Attribute Provider",align:"center",width:"80"}),a(c,{label:"Record",align:"center",width:"52"},{default:n(({row:e})=>[a(u,{class:"scale-button",icon:"View",circle:"",onClick:r=>te(e)},null,8,["onClick"])]),_:1}),a(c,{label:"Comment",align:"center",width:"150"},{default:n(e=>[i("div",Ge,[a(w,{modelValue:e.row.description,"onUpdate:modelValue":r=>e.row.description=r,placeholder:"Please input",class:"input-with-select mr-5"},null,8,["modelValue","onUpdate:modelValue"]),a(u,{class:"scale-button",type:"default",icon:"Edit",circle:""})])]),_:1})]),_:1},8,["data"])]),V(" \u5206\u9875 "),i("div",ze,[_e(a(o(Oe),{page:o(l).pagination.listQuery.page,"onUpdate:page":t[13]||(t[13]=e=>o(l).pagination.listQuery.page=e),limit:o(l).pagination.listQuery.limit,"onUpdate:limit":t[14]||(t[14]=e=>o(l).pagination.listQuery.limit=e),total:o(l).pagination.total,"page-sizes":o(l).pagination.pageSizes,onPagination:N},null,8,["page","limit","total","page-sizes"]),[[ve,o(l).pagination.total]])]),V(" record "),a(re,{modelValue:o(d),"onUpdate:modelValue":t[16]||(t[16]=e=>Z(d)?d.value=e:d=e),title:"\u65E5\u5FD7",width:"80%","destroy-on-close":""},{default:n(()=>[a(Ue,{modelValue:o(d),"onUpdate:modelValue":t[15]||(t[15]=e=>Z(d)?d.value=e:d=e),"bus-data":o(O)},null,8,["modelValue","bus-data"])]),_:1},8,["modelValue"])])}}});export{We as default};
