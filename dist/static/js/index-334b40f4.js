import{d as a,r as e,L as l,M as t,q as s,o,c as n,x as r,e as d,s as u,v as c,N as i,O as p,A as m,z as b,f,P as v,_ as y,w as h,y as _,G as g,H as x,I as j}from"./main-ce43ffdd.js";import{f as w,h as V,i as D,j as k}from"./overview-3c9a7585.js";import{g as A,a as C,t as P}from"./format-00f0450d.js";import{_ as S}from"./lodash-6b3789ad.js";import{h as U}from"./new-format-368dcfb0.js";import{_ as M}from"./index-b51c8894.js";import{W as O}from"./index-6728f053.js";import"./moment-56f006b0.js";const Y={class:"white-bg control-box flex jc-between ai-start p0-0"},N={class:"flex jc-start flex-wrap ai-start"},E={class:"flex"},q=a({__name:"search",emits:["emitParent"],setup(a,{emit:y}){const h={adtype:"",channel_type:"",user_name:"",slot:"",country:"",date:A(6,"day")},_=e({shortcuts:[{text:"今天",value:A(0,"day")},{text:"昨天",value:()=>C(1,1,"day")},{text:"最近7天",value:()=>A(6,"day")},{text:"最近30天",value:()=>A(29,"day")}],options:{adtype:["ssp","fenix"],channel_type:[{value:1,label:"代理"},{value:2,label:"API"},{value:3,label:"直客"}],country:[{value:"",label:""}],user_name:[{label:"",value:""}],slot:[{value:"",label:""}]},data:h}),g=async()=>{const{data:a}=await w();_.options.user_name=null==a?void 0:a.user_name,_.options.slot=null==a?void 0:a.slot,_.options.country=null==a?void 0:a.country},x=()=>{},j=()=>{console.warn("set search data"),y("emitParent",S.cloneDeep(v(_.data)))};return l((()=>{g(),j()})),t((()=>{g(),j()})),(a,e)=>{const l=s("el-date-picker"),t=s("el-form-item"),v=s("el-option"),y=s("el-select"),h=s("el-button"),g=s("el-form");return o(),n("div",null,[r("div",Y,[d(g,{inline:!0,model:c(_).data,class:"flex jc-between ai-start w100"},{default:u((()=>[r("div",N,[d(t,{label:"日期选择"},{default:u((()=>[d(l,{modelValue:c(_).data.date,"onUpdate:modelValue":e[0]||(e[0]=a=>c(_).data.date=a),class:"search-con",type:"daterange","unlink-panels":"",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:c(_).shortcuts,clearable:!1},null,8,["modelValue","shortcuts"])])),_:1}),d(t,{label:"分成方法"},{default:u((()=>[d(y,{modelValue:c(_).data.adtype,"onUpdate:modelValue":e[1]||(e[1]=a=>c(_).data.adtype=a),class:"search-con",clearable:"",placeholder:"搜索",onChange:x},{default:u((()=>[(o(!0),n(i,null,p(c(_).options.adtype,(a=>(o(),m(v,{key:a,label:a,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(t,{label:"业务类型"},{default:u((()=>[d(y,{modelValue:c(_).data.channel_type,"onUpdate:modelValue":e[2]||(e[2]=a=>c(_).data.channel_type=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:x},{default:u((()=>[b(' <div class="flex jc-between p10 pt-0">\n                <el-button type="primary" plain size="mini" @click="selectAllProduct()">全选</el-button>\n                <el-button size="mini" type="danger" plain @click="unSelectedAllProduct()">清空</el-button>\n              </div> '),(o(!0),n(i,null,p(c(_).options.channel_type,((a,e)=>(o(),m(v,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(t,{label:"User Name"},{default:u((()=>[d(y,{modelValue:c(_).data.user_name,"onUpdate:modelValue":e[3]||(e[3]=a=>c(_).data.user_name=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:x},{default:u((()=>[(o(!0),n(i,null,p(c(_).options.user_name,((a,e)=>(o(),m(v,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(t,{label:"Slot"},{default:u((()=>[d(y,{modelValue:c(_).data.slot,"onUpdate:modelValue":e[4]||(e[4]=a=>c(_).data.slot=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:x},{default:u((()=>[(o(!0),n(i,null,p(c(_).options.slot,((a,e)=>(o(),m(v,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(t,{label:"国家"},{default:u((()=>[d(y,{modelValue:c(_).data.country,"onUpdate:modelValue":e[5]||(e[5]=a=>c(_).data.country=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:x},{default:u((()=>[(o(!0),n(i,null,p(c(_).options.country,((a,e)=>(o(),m(v,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),r("div",null,[r("div",E,[d(h,{type:"primary",onClick:j},{default:u((()=>[f(" 查询 ")])),_:1})])])])),_:1},8,["model"])])])}}});const I=a=>(g("data-v-422fd230"),a=a(),x(),a),z={class:"flex flex-wrap jc-between"},G={class:"flex jc-between"},H={key:0,class:"color_primary"},L=I((()=>r("span",{class:"small_icon"},"$",-1))),R={key:1,class:"color_primary"},$=I((()=>r("span",{class:"small_icon"},"%",-1)));var T=y(a({__name:"card",props:{json:{require:!0,default:{},type:Object}},setup(a){const t=e({baseData:a.json,data:{},titleMap:{profit:"毛利合计",revenue:"收入合计",cost:"支出合计",profit_rate:"毛利率"},groupVal:["profit","revenue","cost"],groupRate:["profit_rate"]});return h((()=>t.baseData),((a,e)=>{console.warn("get card data"),(async()=>{let a={...t.baseData.data};a=U(a);const{data:e}=await V(a);if(Array.isArray(e)&&0!==e.length)t.data=e[0];else for(const l in t.data)Object.prototype.hasOwnProperty.call(t.data,l)&&(t.data[l]=0)})()}),{deep:!0}),l((()=>{})),(a,e)=>{const l=s("el-card");return o(),n("div",null,[r("div",z,[(o(!0),n(i,null,p(t.titleMap,((a,e)=>(o(),m(l,{class:"box-card m10"},{default:u((()=>[r("div",G,[r("h3",null,_(t.titleMap[e]),1),t.groupVal.includes(e)?(o(),n("h2",H,[L,f(" "+_(t.data[e]),1)])):b("v-if",!0),t.groupRate.includes(e)?(o(),n("h2",R,[f(_(c(P)(100*t.data[e]))+" ",1),$])):b("v-if",!0)])])),_:2},1024)))),256))])])}}}),[["__scopeId","data-v-422fd230"]]);const W=a({__name:"chart",props:{json:{require:!0,default:{},type:Object}},setup(a){const l=a,t=e({data:{target:"cost"},options:{target:[{value:"profit",label:"毛利"},{value:"revenue",label:"收入"},{value:"cost",label:"支出"},{value:"profit_rate",label:"毛利率"}]}}),b=e({data:l.json,baseCharData:{},chartData:{tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{show:!0,backgroundColor:"#6a7985"}}},legend:{show:!0,data:["all"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"",type:"line",stack:"Total",emphasis:{focus:"series"},data:[]}]}});h((()=>b.data),((a,e)=>{console.warn("get chart data"),g()}),{deep:!0});const f=()=>{var a;let e=t.options.target.find((a=>a.value===t.data.target));return null!=(a=null==e?void 0:e.label)?a:""},v=["6"],y=()=>{_()},_=()=>{var a;let e=t.data.target,l=null!=(a=b.baseCharData[e])?a:[];if(v.includes(t.data.target.toString())){let a=l.map((a=>P(100*a,2)));b.chartData.series[0].data=a}else{let a=l.map((a=>P(a,2)));b.chartData.series[0].data=a}b.chartData.series[0].name=f()},g=async()=>{var a;let e={...b.data.data};e=U(e),b.chartData.xAxis[0].data=[],b.chartData.series[0].data=[];const{data:l}=await D(e);b.baseCharData=l,b.chartData.xAxis[0].data=null!=(a=null==l?void 0:l.date)?a:[],b.chartData.series[0].name=f(),_()};return(a,e)=>{const l=s("el-option"),f=s("el-select"),v=s("el-form-item"),h=s("el-form");return o(),n("div",null,[r("div",null,[d(h,{inline:!0,model:t.data,class:"flex jc-between w100"},{default:u((()=>[d(v,{label:"指标"},{default:u((()=>[d(f,{modelValue:t.data.target,"onUpdate:modelValue":e[0]||(e[0]=a=>t.data.target=a),placeholder:"Select",onChange:y},{default:u((()=>[(o(!0),n(i,null,p(t.options.target,(a=>(o(),m(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])]),r("div",null,[d(c(M),{"chart-data":b.chartData},null,8,["chart-data"])])])}}}),B={class:"mt-20"},F={class:"flex jc-end mb-10"},J=a({__name:"table",props:{json:{require:!0,default:{},type:Object}},setup(a){let l=e({data:a.json,list:[],exportExcel:{buttonName:"导出",tHeader:["日期"],filterVal:["date"],fileName:"profit"}}),t=e([{value:"user_id",label:"User ID"},{value:"account_email",label:"Account Email"},{value:"user_name",label:"User Name"},{value:"profit",label:"毛利"},{value:"revenue",label:"收入"},{value:"cost",label:"支出"},{value:"profit_rate",label:"毛利率"}]);h((()=>l.data),((a,e)=>{console.warn("get table data"),f()}),{deep:!0});const f=async()=>{let a={...l.data.data};a=U(a),l.list=[];const{data:e}=await k(a);l.list=e};let v=["profit_rate"],y=j((()=>{let a=[];return l.list.map((e=>{let l={},t={...e};for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)){const e=t[a];v.includes(a)?l[a]=`${P(100*e,2)}%`:l[a]=e}a.push(l)})),a}));const _=j((()=>t.map((a=>a.label)))),g=j((()=>t.map((a=>a.value))));return(a,e)=>{const f=s("el-table-column"),v=s("el-table");return o(),n("div",B,[r("div",F,[d(O,{"button-name":c(l).exportExcel.buttonName,list:c(y),"t-header":c(_),"filter-val":c(g),filename:c(l).exportExcel.fileName},null,8,["button-name","list","t-header","filter-val","filename"])]),b(" table "),d(v,{center:"",data:c(y),class:"w100",border:""},{default:u((()=>[(o(!0),n(i,null,p(c(t),(a=>{var e;return o(),m(f,{key:a.value,prop:a.value,label:a.label,fixed:null!=(e=null==a?void 0:a.fixed)&&e,align:"center"},null,8,["prop","label","fixed"])})),128))])),_:1},8,["data"])])}}}),K={class:"app-container"},Q=a({name:"Profit"}),X=a({...Q,setup(a){let l=e({data:{adtype:"",channel_type:"",user_name:"",slot:"",country:"",st:"",et:""}});const t=a=>{l.data.adtype=a.adtype,l.data.channel_type=a.channel_type,l.data.user_name=a.user_name,l.data.slot=a.slot,l.data.country=a.country,l.data.st=a.date[0],l.data.et=a.date[1]};return(a,e)=>(o(),n("div",K,[d(c(q),{onEmitParent:t}),d(c(T),{json:c(l)},null,8,["json"]),d(c(W),{json:c(l)},null,8,["json"]),d(c(J),{json:c(l)},null,8,["json"])]))}});export{X as default};
