import{d as e,h as l,r as a,I as o,L as s,q as t,c as r,z as d,e as i,s as u,v as m,x as n,P as p,o as f,N as c,O as _,A as g,y as b,f as v,g as y}from"./main-ce43ffdd.js";import{u as F,s as V}from"./useUtils-d1805f03.js";import{s as h,A as w,a as x}from"./dsp-common-1d93861f.js";import{h as z,i as j,j as U,e as q,f as k}from"./dsp-campaign-556f35e6.js";import{m as $}from"./message-1c1d9ef1.js";import{_ as C}from"./index-aa162cf4.js";import{d as D,e as I,i as A}from"./new-format-368dcfb0.js";import{_ as L}from"./lodash-6b3789ad.js";const M={class:"content-con from-one flex column"},N={class:"content-con from-one flex column"},P={class:"w100 flex jc-between ai-start"},O={class:"w100 flex"},R=e({__name:"details",setup(e){const{status:R,audit_status:S}=V,{feeds_num:B,dsp_category_id:E,creative_goals:G}=h,{getRouterData:H,getCommonCountryList:J,goNewUrl:K}=F();let{proxy:Q}=y();const T="此项必填";let W=l("create");l([]);const X={id:void 0,name:"",descs:"",size:"",feeds_num:void 0,dsp_category_id:void 0,creative_goals:"",follow_template_id:void 0,audit_status:3,is_del:1},Y=a({ruleForm:X,rules:{name:[{required:!0,message:T,trigger:["blur","change"]}],size:[{required:!0,message:T,trigger:["blur","change"]}],feeds_num:[{required:!0,message:T,trigger:["blur","change"]}],dsp_category_id:[{required:!0,message:T,trigger:["blur","change"]}],creative_goals:[{required:!0,message:T,trigger:["blur","change"]}],follow_template_id:[{required:!0,message:T,trigger:["blur","change"]}]},options:{audit_status:S,size:[],feeds_num:B,category:[],creative_goals:G,dpa_tpl:[],dpa:[]}}),Z=()=>{Q.$refs.ruleForm.validate((e=>{if(!e)return!1;ae()}))},ee=["id","feeds_num","dsp_category_id","follow_template_id","audit_status","is_del"],le=["country"],ae=async()=>{let e=p(Y.ruleForm);if(e=D(e),e=I(e,ee),e=A(e,le),W.value,"create"===W.value){delete e.id;const l=await z(e);$(l)&&oe()}if("edit"===W.value){const l=await j(e);$(l)&&oe()}},oe=()=>{K({url:"/campaign/dpa/list"})},se=o((()=>{Y.options.dpa_tpl.map((e=>(Y.options.dpa.map((l=>{e.id===l.follow_template_id&&(e.id,e.disabled=!0)})),e))),Y.options.dpa_tpl})),te=()=>{var e,l;let{query:a,params:o}=H();if(W.value=null!=(l=null==(e=a.type)?void 0:e.toString())?l:"",W.value,(async()=>{Promise.all([q({limit:1e4,page:1}),k(),w(),x()]).then((e=>{Y.options.dpa=e[0].data.data;let l=e[1].data.data;Y.options.dpa_tpl=l.map((e=>(e.value=e.id,e.label=`${e.format}_${e.tpl_type}`,e.url=`https://staticdn.cloudmobi.net/dpa/demo/${e.format}_${e.tpl_type}_bg.png`,e.disabled=!1,e)));let a=e[2].data;Y.options.category=a.map((e=>(e.value=e.id,e.label=`${e.cn}-${e.en}`,e)));let o=e[3].data;Y.options.size=o.map((e=>(e.value=e.size,e.label=e.size,e)))}))})(),"create"===W.value&&(Y.ruleForm=L.cloneDeep(X)),"edit"===W.value){const{id:e}=o;(async e=>{const l=await U(e),{data:a}=l;Y.ruleForm={...Y.ruleForm,...a},Y.ruleForm})(e)}};return s((()=>{te()})),(e,l)=>{const a=t("el-input"),o=t("el-form-item"),s=t("el-option"),p=t("el-select"),y=t("el-form"),F=t("el-button");return f(),r("div",null,[d(" form "),i(y,{ref:"ruleForm",enctype:"multipart/form-data",rules:m(Y).rules,model:m(Y).ruleForm,"label-width":"150px","label-position":"right",class:"flex column",disabled:"edit"===m(W)&&2===m(Y).ruleForm.is_del},{default:u((()=>[i(m(C),{title:"基础信息"}),n("div",M,[d(" 模板名称 "),i(o,{class:"self-el-form-item",label:"模板名称:",prop:"name"},{default:u((()=>[i(a,{modelValue:m(Y).ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>m(Y).ruleForm.name=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1}),d(" 描述 "),i(o,{class:"self-el-form-item",label:"描述:",prop:"descs"},{default:u((()=>[i(a,{modelValue:m(Y).ruleForm.descs,"onUpdate:modelValue":l[1]||(l[1]=e=>m(Y).ruleForm.descs=e),modelModifiers:{trim:!0},class:"form-one",placeholder:"",type:"textarea"},null,8,["modelValue"])])),_:1}),d(" 适配尺寸 "),i(o,{class:"self-el-form-item",label:"适配尺寸:",prop:"size"},{default:u((()=>[i(p,{modelValue:m(Y).ruleForm.size,"onUpdate:modelValue":l[2]||(l[2]=e=>m(Y).ruleForm.size=e),filterable:"",placeholder:"请选择",class:"form-one"},{default:u((()=>[(f(!0),r(c,null,_(m(Y).options.size,(e=>(f(),g(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(" Feeds个数 "),i(o,{class:"self-el-form-item",label:"Feeds个数:",prop:"feeds_num"},{default:u((()=>[i(p,{modelValue:m(Y).ruleForm.feeds_num,"onUpdate:modelValue":l[3]||(l[3]=e=>m(Y).ruleForm.feeds_num=e),filterable:"",placeholder:"请选择",class:"form-one"},{default:u((()=>[(f(!0),r(c,null,_(m(Y).options.feeds_num,(e=>(f(),g(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(" 适用商品 "),i(o,{class:"self-el-form-item",label:"适用商品:",prop:"dsp_category_id"},{default:u((()=>[i(p,{modelValue:m(Y).ruleForm.dsp_category_id,"onUpdate:modelValue":l[4]||(l[4]=e=>m(Y).ruleForm.dsp_category_id=e),filterable:"",placeholder:"请选择",class:"form-one"},{default:u((()=>[(f(!0),r(c,null,_(m(Y).options.category,(e=>(f(),g(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(" 创意目标 "),i(o,{class:"self-el-form-item",label:"创意目标:",prop:"creative_goals"},{default:u((()=>[i(p,{modelValue:m(Y).ruleForm.creative_goals,"onUpdate:modelValue":l[5]||(l[5]=e=>m(Y).ruleForm.creative_goals=e),filterable:"",placeholder:"请选择",class:"form-one"},{default:u((()=>[(f(!0),r(c,null,_(m(Y).options.creative_goals,(e=>(f(),g(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),i(m(C),{title:"模板内容"}),n("div",N,[d(" 关联模板ID "),i(o,{class:"self-el-form-item",label:"关联模板ID:",prop:"follow_template_id"},{default:u((()=>[i(p,{modelValue:m(Y).ruleForm.follow_template_id,"onUpdate:modelValue":l[6]||(l[6]=e=>m(Y).ruleForm.follow_template_id=e),filterable:"",placeholder:"请选择",class:"form-one",disabled:"create"!==m(W)},{default:u((()=>[(f(!0),r(c,null,_(m(se),(e=>(f(),g(s,{key:e.value,label:e.label,value:e.value,disabled:e.disable},{default:u((()=>[n("div",P,[n("span",null,b(e.label),1),d(' <div class="img-box">\n                  <img :src="item.url" alt="">\n                </div> ')])])),_:2},1032,["label","value","disabled"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})])])),_:1},8,["rules","model","disabled"]),d(" form "),d(" footer "),n("div",O,[i(F,{type:"primary",onClick:Z},{default:u((()=>[v(" 确认 ")])),_:1}),i(F,{type:"primary",onClick:oe},{default:u((()=>[v(" 取消 ")])),_:1})])])}}});export{R as default};
