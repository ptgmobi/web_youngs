import{d as a,r as e,L as l,M as t,q as s,o as n,c as o,x as r,e as d,s as c,v as u,N as i,O as p,A as v,z as m,f as b,P as g,_ as f,w as h,y,G as _,H as x,I as w}from"./main-0a777472.js";import{g as k,a as j,b as V,c as S,d as D,e as P}from"./overview-c0a031d4.js";import{_ as C}from"./lodash-4786ff9c.js";import{t as O,g as A,a as Y}from"./format-00f0450d.js";import{h as B}from"./new-format-7f959bed.js";import{_ as M}from"./index-77425971.js";import"./moment-56f006b0.js";const U={class:"white-bg control-box flex jc-between ai-start p0-0"},q={class:"flex jc-start flex-wrap"},G={class:"flex"},$=a({__name:"search",emits:["emitParent"],setup(a,{emit:f}){const h=e({options:{channel_type:[{value:1,label:"代理"},{value:2,label:"API"},{value:3,label:"直客"},{value:6,label:"Yohoads"}],platform:[{value:1,label:"Android"},{value:2,label:"iOS"}],country:[{value:"",label:""}],channel:[{label:"",value:""}],pkg:[{value:"",label:""}]},data:{channel_type:"",platform:"",channel:"",country:"",pkg:""}}),y=async()=>{const a=await Promise.all([await k(),j(),V()]),[e,l,t]=a;h.options.country=e.data,h.options.channel=l.data,h.options.pkg=t.data},_=()=>{},x=()=>{},w=()=>{},S=()=>{},D=()=>{},P=()=>{console.warn("set search data"),f("emitParent",C.cloneDeep(g(h.data)))};return l((()=>{y(),P()})),t((()=>{y(),P()})),(a,e)=>{const l=s("el-option"),t=s("el-select"),g=s("el-form-item"),f=s("el-button"),y=s("el-form");return n(),o("div",null,[r("div",U,[d(y,{inline:!0,model:u(h).data,class:"flex jc-between ai-start w100"},{default:c((()=>[r("div",q,[d(g,{label:"广告主类型"},{default:c((()=>[d(t,{modelValue:u(h).data.channel_type,"onUpdate:modelValue":e[0]||(e[0]=a=>u(h).data.channel_type=a),class:"search-con",clearable:"",placeholder:"搜索",onChange:_},{default:c((()=>[(n(!0),o(i,null,p(u(h).options.channel_type,(a=>(n(),v(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(g,{label:"平台"},{default:c((()=>[d(t,{modelValue:u(h).data.platform,"onUpdate:modelValue":e[1]||(e[1]=a=>u(h).data.platform=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:x},{default:c((()=>[m(' <div class="flex jc-between p10 pt-0">\n                <el-button type="primary" plain size="mini" @click="selectAllProduct()">全选</el-button>\n                <el-button size="mini" type="danger" plain @click="unSelectedAllProduct()">清空</el-button>\n              </div> '),(n(!0),o(i,null,p(u(h).options.platform,((a,e)=>(n(),v(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(g,{label:"国家"},{default:c((()=>[d(t,{modelValue:u(h).data.country,"onUpdate:modelValue":e[2]||(e[2]=a=>u(h).data.country=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:w},{default:c((()=>[(n(!0),o(i,null,p(u(h).options.country,((a,e)=>(n(),v(l,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(g,{label:"Channel"},{default:c((()=>[d(t,{modelValue:u(h).data.channel,"onUpdate:modelValue":e[3]||(e[3]=a=>u(h).data.channel=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:S},{default:c((()=>[(n(!0),o(i,null,p(u(h).options.channel,((a,e)=>(n(),v(l,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(g,{label:"Pkg"},{default:c((()=>[d(t,{modelValue:u(h).data.pkg,"onUpdate:modelValue":e[4]||(e[4]=a=>u(h).data.pkg=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:D},{default:c((()=>[(n(!0),o(i,null,p(u(h).options.pkg,((a,e)=>(n(),v(l,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),r("div",null,[r("div",G,[d(f,{type:"primary",onClick:P},{default:c((()=>[b(" 查询 ")])),_:1})])])])),_:1},8,["model"])])])}}});const z=a=>(_("data-v-7f4b3e65"),a=a(),x(),a),I={class:"flex flex-wrap jc-between"},E={class:"card-header"},L={key:0},H={class:"mt-10 mb-10"},N={key:0},T={key:1},F={class:"valueBox"},J={class:"value-box"},K=z((()=>r("span",null,"日环比:",-1))),Q={class:"value-right"},R={key:0},W={key:1},X={key:2},Z={class:"value-val"},aa={class:"valueBox"},ea={class:"value-box"},la=z((()=>r("span",null,"周同比:",-1))),ta={class:"value-right"},sa={key:0},na={key:1},oa={key:2},ra={class:"value-val"},da={class:"valueBox"},ca={class:"value-box"},ua=z((()=>r("span",null,"7日均:",-1))),ia={key:0},pa={key:1},va={class:"valueBox"},ma={class:"value-box"},ba=z((()=>r("span",null,"30日均:",-1))),ga={key:0},fa={key:1},ha={key:1},ya=z((()=>r("div",{class:"mt-10 mb-10",style:{height:"21px"}},null,-1))),_a={class:"valueBox"},xa={class:"value-box"},wa=z((()=>r("span",null,"收入:",-1))),ka={class:"value-right"},ja={class:"value-val"},Va={class:"valueBox"},Sa={class:"value-box"},Da=z((()=>r("span",null,"支出:",-1))),Pa={class:"value-right"},Ca={class:"value-val"},Oa={class:"valueBox"},Aa={class:"value-box"},Ya=z((()=>r("span",null,"毛利:",-1))),Ba={class:"value-right"},Ma={class:"value-val"},Ua={class:"valueBox"},qa={class:"value-box"},Ga=z((()=>r("span",null,"日均毛利:",-1))),$a={class:"value-right"},za={class:"value-val"};var Ia=f(a({__name:"card",props:{json:{require:!0,default:()=>({}),type:Object}},setup(a){const t=e({baseData:a.json,data:{},titleMap:{yesterday_revenue:"昨日收入",yesterday_gross_profit:"昨日毛利",yesterday_gross_margin:"昨日毛利率",accumulated_month:"本月累计",accumulated_quarter:"本季度累计"},titleGroup:["yesterday_revenue","yesterday_gross_profit","yesterday_gross_margin"],titleGroup1:["accumulated_month","accumulated_quarter"]}),b=a=>{let e=100*Math.abs(a);return`${O(e,2)}%`};return h((()=>t.baseData),((a,e)=>{console.warn("get card data"),(async()=>{t.data=[];let a={...t.baseData.data};delete a.date,a=B(a);const{data:e}=await S(a);t.data=e})()}),{deep:!0}),l((()=>{})),(a,e)=>{const l=s("caret-bottom"),g=s("el-icon"),f=s("caret-top"),h=s("el-card");return n(),o("div",null,[r("div",I,[(n(!0),o(i,null,p(t.data,((a,e)=>(n(),v(h,{class:"box-card m10"},{header:c((()=>[r("div",E,[r("h3",null,y(t.titleMap[e]),1)])])),default:c((()=>[r("div",null,[t.titleGroup.includes(e.toString())?(n(),o("div",L,[r("h4",null,y(a.date),1),r("div",H,[m(" <h2 v-if=\"item.hasOwnProperty('revenue')\">$ {{item.revenue}}</h2>\n              <h2 v-if=\"item.hasOwnProperty('rate')\">{{item.rate * 100}} %</h2> "),"yesterday_gross_margin"!==e.toString()?(n(),o("h2",N," $ "+y(a.revenue),1)):m("v-if",!0),"yesterday_gross_margin"===e.toString()?(n(),o("h2",T,y(u(O)(100*a.revenue,2))+" % ",1)):m("v-if",!0)]),r("div",F,[r("div",J,[K,r("span",Q,[a.dod<0?(n(),o("span",R,[d(g,{class:"el-svg-icon color_down"},{default:c((()=>[d(l)])),_:1})])):m("v-if",!0),a.dod>0?(n(),o("span",W,[d(g,{class:"el-svg-icon color_up"},{default:c((()=>[d(f)])),_:1})])):(n(),o("span",X)),r("span",Z,y(b(a.dod)),1)])])]),r("div",aa,[r("div",ea,[la,r("span",ta,[a.wow<0?(n(),o("span",sa,[d(g,{class:"el-svg-icon color_down"},{default:c((()=>[d(l)])),_:1})])):m("v-if",!0),a.wow>0?(n(),o("span",na,[d(g,{class:"el-svg-icon color_up"},{default:c((()=>[d(f)])),_:1})])):(n(),o("span",oa)),r("span",ra,y(b(a.wow)),1)])])]),r("div",da,[r("div",ca,[ua,"yesterday_gross_margin"!==e.toString()?(n(),o("span",ia,y(a.d7),1)):m("v-if",!0),"yesterday_gross_margin"===e.toString()?(n(),o("span",pa,y(b(a.d7)),1)):m("v-if",!0)])]),r("div",va,[r("div",ma,[ba,"yesterday_gross_margin"!==e.toString()?(n(),o("span",ga,y(a.d30),1)):m("v-if",!0),"yesterday_gross_margin"===e.toString()?(n(),o("span",fa,y(b(a.d30)),1)):m("v-if",!0)])])])):m("v-if",!0),t.titleGroup1.includes(e.toString())?(n(),o("div",ha,[r("h4",null,y(a.date),1),ya,r("div",_a,[r("div",xa,[wa,r("span",ka,[r("span",ja,y(a.revenue),1)])])]),r("div",Va,[r("div",Sa,[Da,r("span",Pa,[r("span",Ca,y(a.cost),1)])])]),r("div",Oa,[r("div",Aa,[Ya,r("span",Ba,[r("span",Ma,y(a.profit),1)])])]),r("div",Ua,[r("div",qa,[Ga,r("span",$a,[r("span",za,y(a.avg_profit),1)])])])])):m("v-if",!0)])])),_:2},1024)))),256))])])}}}),[["__scopeId","data-v-7f4b3e65"]]);const Ea=a({__name:"chart",props:{json:{require:!0,default:{},type:Object}},setup(a){const l=a,t=e({data:{target:5},options:{target:[{value:1,label:"转化"},{value:2,label:"单价"},{value:3,label:"收入"},{value:4,label:"支出"},{value:5,label:"毛利"},{value:6,label:"毛利率(单位为%)"}]}}),m=e({data:l.json,chartData:{tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{show:!0,backgroundColor:"#6a7985"}}},legend:{show:!0,data:["all"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"",type:"line",stack:"Total",emphasis:{focus:"series"},data:[]}]}});h((()=>m.data),((a,e)=>{console.warn("get chart data"),g()}),{deep:!0});const b=["6"],g=async()=>{var a,e;let l={...m.data.data,target:t.data.target};l=B(l),m.chartData.xAxis[0].data=[],m.chartData.series[0].data=[];const s=(()=>{var a;let e=t.options.target.find((a=>a.value===t.data.target));return null!=(a=null==e?void 0:e.label)?a:"test"})();m.chartData.legend.data=[s],m.chartData.series[0].name=s;const{data:n}=await D(l);m.chartData.xAxis[0].data=null!=(a=null==n?void 0:n.date)?a:[];let o=null!=(e=null==n?void 0:n.data)?e:[];if(b.includes(t.data.target.toString())){let a=o.map((a=>O(100*a,2)));m.chartData.series[0].data=a}else{let a=o.map((a=>O(a,2)));m.chartData.series[0].data=a}};return(a,e)=>{const l=s("el-option"),b=s("el-select"),f=s("el-form-item"),h=s("el-form");return n(),o("div",null,[r("div",null,[d(h,{inline:!0,model:t.data,class:"flex jc-between w100"},{default:c((()=>[d(f,{label:"指标"},{default:c((()=>[d(b,{modelValue:t.data.target,"onUpdate:modelValue":e[0]||(e[0]=a=>t.data.target=a),placeholder:"Select",onChange:g},{default:c((()=>[(n(!0),o(i,null,p(t.options.target,(a=>(n(),v(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])]),r("div",null,[d(u(M),{"chart-data":m.chartData},null,8,["chart-data"])])])}}}),La={class:"control-box mt-20"},Ha={class:"flex jc-start"},Na=a({__name:"date",emits:["emitParent"],setup(a,{emit:l}){let t=e({shortcuts:[{text:"今天",value:A(0,"day")},{text:"昨天",value:()=>Y(1,1,"day")},{text:"最近7天",value:()=>A(6,"day")},{text:"最近30天",value:()=>A(29,"day")}],data:{search:{date:A(6,"day")}}});return h((()=>t.data.search.date),((a,e)=>{console.warn("set search date"),l("emitParent",[...t.data.search.date])}),{immediate:!0}),(a,e)=>{const l=s("el-date-picker"),i=s("el-form-item"),p=s("el-form");return n(),o("div",La,[d(p,{inline:!0,model:u(t).data,class:"flex jc-between"},{default:c((()=>[r("div",Ha,[d(i,{label:"日期选择"},{default:c((()=>[d(l,{modelValue:u(t).data.search.date,"onUpdate:modelValue":e[0]||(e[0]=a=>u(t).data.search.date=a),class:"mr-10 mb-10",type:"daterange","unlink-panels":"",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:u(t).shortcuts,clearable:!1},null,8,["modelValue","shortcuts"])])),_:1})])])),_:1},8,["model"])])}}}),Ta={class:"mt-20"},Fa=a({__name:"table",props:{json:{require:!0,default:{},type:Object}},setup(a){let l=e({data:a.json,list:[]});h((()=>l.data),((a,e)=>{console.warn("get table data"),t()}),{deep:!0});const t=async()=>{let a={...l.data.data};a=B(a),l.list=[];const{data:e}=await P(a);l.list=e};let r=w((()=>{let a=[];return l.list.map((e=>{let l={},t={...e};for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)){const e=t[a];a.includes("rate")?l[a]=`${O(100*e,2)}%`:l[a]=O(e,2)}a.push(l)})),a}));return(a,e)=>{const l=s("el-table-column"),t=s("el-table");return n(),o("div",Ta,[m(" table "),d(t,{center:"",data:u(r),class:"w100",height:"87vh",border:""},{default:c((()=>[d(l,{fixed:"",prop:"date",label:"日期",align:"center"}),m(' <el-table-column fixed prop="type" label="广告主类型" align="center"></el-table-column>\n      <el-table-column prop="channel" label="Channel" align="center"></el-table-column>\n      <el-table-column prop="platform" label="平台" align="center"></el-table-column>\n      <el-table-column prop="country" label="国家" align="center"></el-table-column>\n      <el-table-column prop="pkg" label="Pkg" align="center"></el-table-column> '),d(l,{prop:"conversion",label:"转化数",align:"center"}),d(l,{prop:"revenue",label:"收入",align:"center"}),d(l,{prop:"cost",label:"支出",align:"center"}),d(l,{prop:"profit",label:"毛利",align:"center"}),d(l,{prop:"profit_rate",label:"毛利率",align:"center"})])),_:1},8,["data"])])}}}),Ja={class:"app-container"},Ka=a({name:"Overview"}),Qa=a({...Ka,setup(a){let l=e({data:{channel_type:[],platform:[],channel:[],country:[],pkg:[],st:"",et:""}}),t=e({data:{channel_type:[],platform:[],channel:[],country:[],pkg:[]}}),s=e({data:{st:"",et:""}});const r=a=>{t.data={...a},l.data={...t.data,...s.data}},c=a=>{s.data={st:a[0],et:a[1]},l.data={...t.data,...s.data}};return(a,e)=>(n(),o("div",Ja,[d(u($),{onEmitParent:r}),d(u(Ia),{json:u(t)},null,8,["json"]),d(u(Na),{onEmitParent:c}),d(u(Ea),{json:u(l)},null,8,["json"]),d(u(Fa),{json:u(l)},null,8,["json"])]))}});export{Qa as default};
