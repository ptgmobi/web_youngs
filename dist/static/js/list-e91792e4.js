import{_ as e,d as a,a0 as l,e as t,r as i,M as o,N as n,m as c,a1 as r,s,n as d,v as u,z as p,c as m,p as f,q as h,O as b,P as v,V as g,A as _,b as y,x as w,W as V}from"./index-b160a4d6.js";import{P as k}from"./index-e884940e.js";import{_ as D,A as x,a as C,b as F,c as U,d as z,e as j,f as A}from"./device-f73dd217.js";import{m as P}from"./message-6c553f21.js";import{_ as S}from"./lodash-ad752a46.js";import{a as O,o as N}from"./new-format-f712eb45.js";import{b as E}from"./format-75dc684c.js";import"./moment-56f006b0.js";const Q={class:"controlBox w100 mb-10"},$={class:"mb-10"},B=y("Offer Create"),I={class:"flex jc-start flex-wrap w100"},M={class:"flex"},J={class:"flex"},L=y(" 查询 "),T={class:"flex jc-start"},q=y("批量修改当前页面内所有offer的device"),K={class:"flex jc-around"},W={class:"flex jc-around"},G={class:"flex jc-around"},H=["textContent"],R={class:"flex jc-around"},X={class:"w100 flex"},Y={class:"dialog-footer"},Z=y("确 定"),ee=a({name:"buzz-async"});var ae=e(a({...ee,setup(e){const a=l({attribute_provider:[],platform:[],package_name:"",channel:"",id:"",offer_title:"",country:"",pid:""});let ee=t(!1),ae=i({offer:{},index:null,cacheDevice:{},cacheDeviceCount:0}),le=i({dialogVisible:!1,dialogVisibleDevice:!1,cache:{item:{},device:{}},searchForm:a.value,useData:a.value,loading:!0,options:{cutoff_start:[...new Array(20)].map(((e,a)=>{const l=5*a/100;return{value:l,label:`${(100*Number(l)).toFixed(0)}%`}})),cutoff_end:[...new Array(20)].map(((e,a)=>{const l=(5*a+5)/100;return{value:l,label:`${(100*Number(l)).toFixed(0)}%`}})),attribute_provider:[{value:"AppsFlyer",label:"AppsFlyer"},{value:"Branch",label:"Branch"},{value:"Adjust",label:"Adjust"},{value:"Singular",label:"Singular"},{value:"AppMetrica",label:"AppMetrica"}],platform:[{value:"1",label:"Android"},{value:"2",label:"iOS"}]},list:[],pagination:{pageSizes:["20","50","100","500","1000"],total:1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"}}});const te=()=>{le.useData=S.cloneDeep(le.searchForm),ne()},ie=()=>{N("/buzz/buzz-async-create")},oe=e=>`/buzz/buzz-async-edit/${e.id}`,ne=async()=>{le.loading=!0;let e={page:le.pagination.listQuery.page,page_size:le.pagination.listQuery.limit};le.useData.attribute_provider&&(e.attribute_provider=le.useData.attribute_provider),le.useData.platform&&(e.platform=le.useData.platform),le.useData.package_name&&(e.pkg_name=le.useData.package_name),le.useData.channel&&(e.channel=le.useData.channel),le.useData.id&&(e.offer_id=le.useData.id),le.useData.offer_title&&(e.title=le.useData.offer_title),le.useData.country&&(e.country=le.useData.country),le.useData.pid&&(e.tracking_link=le.useData.pid);const a=await U(e),{data:l}=a,{page:t}=l;le.list=null==l?void 0:l.data,le.pagination.total=Number(t.count),le.loading=!1},ce=async(e,a)=>{ee.value=!1,le.dialogVisibleDevice=!0,ae.offer=a,ae.index=e;const l={id:a.id,platform:a.platform,country:a.country},{data:t}=await z(l);ae.cacheDevice.all=t.all,ae.cacheDevice.select=t.select},re=e=>{ae.cacheDevice.select=e},se=e=>{ae.cacheDeviceCount=e},de=async()=>{if(!0===ee.value){let e=le.list.map((e=>e.id)),a=0!==e.length?e.join(","):"";if(a){const e={ids:a,device:JSON.stringify(ae.cacheDevice.select)},l=await j(e);P(l)&&(le.dialogVisibleDevice=!1,ne())}}else{const e={id:ae.offer.id,device:JSON.stringify(ae.cacheDevice.select)},a=await A(e);P(a)&&(le.dialogVisibleDevice=!1,ae.offer.device_count=ae.cacheDeviceCount)}};return o((()=>{te()})),n((()=>{})),(e,a)=>{const l=c("el-button"),t=c("el-option"),i=c("el-select"),o=c("el-form-item"),n=c("el-input"),U=c("el-form"),z=c("el-table-column"),j=c("el-switch"),A=c("el-table"),S=c("el-dialog"),ue=r("loading");return s(),d("div",null,[u("div",Q,[u("div",$,[p(' <router-link to="/buzz/buzz-async-create">\n          <el-button type="primary">\n            Offer Create\n          </el-button>\n        </router-link> '),m(l,{type:"primary",onClick:ie},{default:f((()=>[B])),_:1})]),m(U,{modelValue:h(le).searchForm,"onUpdate:modelValue":a[8]||(a[8]=e=>h(le).searchForm=e),inline:!0,class:"flex jc-between w100 ai-end"},{default:f((()=>[u("div",I,[m(o,{label:""},{default:f((()=>[m(i,{modelValue:h(le).searchForm.attribute_provider,"onUpdate:modelValue":a[0]||(a[0]=e=>h(le).searchForm.attribute_provider=e),clearable:"",class:"search-con",placeholder:"Attribute Provider",style:{"min-width":"140px"}},{default:f((()=>[(s(!0),d(b,null,v(h(le).options.attribute_provider,(e=>(s(),_(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(o,{label:""},{default:f((()=>[m(i,{modelValue:h(le).searchForm.platform,"onUpdate:modelValue":a[1]||(a[1]=e=>h(le).searchForm.platform=e),clearable:"",class:"search-con",placeholder:"Platform",style:{"min-width":"95px"}},{default:f((()=>[(s(!0),d(b,null,v(h(le).options.platform,(e=>(s(),_(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(o,{label:""},{default:f((()=>[m(n,{modelValue:h(le).searchForm.package_name,"onUpdate:modelValue":a[2]||(a[2]=e=>h(le).searchForm.package_name=e),placeholder:"Package Name",class:"search-con",style:{"min-width":"120px"}},null,8,["modelValue"])])),_:1}),m(o,{label:""},{default:f((()=>[m(n,{modelValue:h(le).searchForm.channel,"onUpdate:modelValue":a[3]||(a[3]=e=>h(le).searchForm.channel=e),placeholder:"Channel",class:"search-con",style:{"min-width":"80px"}},null,8,["modelValue"])])),_:1}),m(o,{label:""},{default:f((()=>[m(n,{modelValue:h(le).searchForm.id,"onUpdate:modelValue":a[4]||(a[4]=e=>h(le).searchForm.id=e),placeholder:"ID",class:"search-con"},null,8,["modelValue"])])),_:1}),m(o,{label:""},{default:f((()=>[m(n,{modelValue:h(le).searchForm.offer_title,"onUpdate:modelValue":a[5]||(a[5]=e=>h(le).searchForm.offer_title=e),placeholder:"Offer Title",class:"search-con",style:{"min-width":"90px"}},null,8,["modelValue"])])),_:1}),m(o,{label:""},{default:f((()=>[m(n,{modelValue:h(le).searchForm.country,"onUpdate:modelValue":a[6]||(a[6]=e=>h(le).searchForm.country=e),placeholder:"Country",class:"search-con",style:{"min-width":"80px"}},null,8,["modelValue"])])),_:1}),m(o,{label:""},{default:f((()=>[m(n,{modelValue:h(le).searchForm.pid,"onUpdate:modelValue":a[7]||(a[7]=e=>h(le).searchForm.pid=e),placeholder:"Pid",class:"search-con"},null,8,["modelValue"])])),_:1})]),u("div",M,[m(o,{class:"mr-0",style:{"margin-right":"0px"}},{default:f((()=>[u("div",J,[m(l,{type:"primary",onClick:te},{default:f((()=>[L])),_:1}),p(' <el-button type="primary" @click="handleExportSearch">导出</el-button> ')])])),_:1})])])),_:1},8,["modelValue"]),p(' <el-input placeholder="请输入内容" v-model="data.searchForm.data" class=\'search-input\'>\n        <el-button slot="append" icon="Search" @click=\'searchFun\'></el-button>\n      </el-input> '),p(" 批量修改设备信息 "),u("div",T,[m(l,{class:"cp",type:"primary",icon:"Edit",onClick:a[9]||(a[9]=e=>(()=>{let e=0!==le.list.length?le.list[0]:"";e&&(ce(0,e),ee.value=!0)})())},{default:f((()=>[q])),_:1})])]),p(" table "),g((s(),_(A,{center:"",data:h(le).list,class:"w100",height:"70vh",border:""},{default:f((()=>[m(z,{fixed:"",prop:"offer_id",label:"Offer ID",align:"center",width:"70"}),m(z,{fixed:"",prop:"channel",label:"Channel",align:"center",width:"60"}),m(z,{prop:"pkg_name",label:"Package Name",align:"center",width:"110"}),m(z,{prop:"title",label:"Offer Title",align:"center"}),m(z,{prop:"attribute_provider",label:"Attribute Provider",align:"center",width:"80"}),m(z,{prop:"pid",label:"Pid",align:"center",width:"90"}),m(z,{prop:"platform",label:"Platform",align:"center",width:"65"},{default:f((e=>[y(w(1===Number(e.row.platform)?"Android":"iOS"),1)])),_:1}),m(z,{prop:"country",label:"Country",align:"center",width:"57"}),m(z,{prop:"payout",label:"Payout",align:"center",width:"55"}),m(z,{prop:"p_type",label:"Delivery mode",align:"center",width:"75"},{default:f((e=>[u("span",null,w(1==e.row.p_type?"算法":"标签"),1)])),_:1}),m(z,{label:"Click Limitation",width:"150",align:"center"},{default:f((e=>[u("div",K,[m(n,{modelValue:e.row.max_clk_num,"onUpdate:modelValue":a=>e.row.max_clk_num=a,placeholder:""},null,8,["modelValue","onUpdate:modelValue"]),m(l,{class:"cp ml-10 scale-button",type:"primary",icon:"Edit",circle:"",onClick:a=>(async e=>{let a={id:e.id,max_clk_num:parseFloat(e.max_clk_num)},l=await x(a);P(l)})(e.row)},null,8,["onClick"])])])),_:1}),m(z,{label:"Site Click Limitation",width:"150",align:"center"},{default:f((e=>[u("div",W,[m(n,{modelValue:e.row.site_clk_limit,"onUpdate:modelValue":a=>e.row.site_clk_limit=a,placeholder:""},null,8,["modelValue","onUpdate:modelValue"]),m(l,{class:"cp ml-10 scale-button",type:"primary",icon:"Edit",circle:"",onClick:a=>(async e=>{let a={id:e.id,site_clk_limit:parseFloat(e.site_clk_limit)},l=await C(a);P(l)})(e.row)},null,8,["onClick"])])])),_:1}),m(z,{label:"Select Device",width:"120",align:"center"},{default:f((e=>[u("div",G,[e.row.device_count?(s(),d("span",{key:0,textContent:w(e.row.device_count?h(E)(e.row.device_count):"")},null,8,H)):p("v-if",!0),m(l,{class:"cp ml-10 scale-button",type:"primary",icon:"Edit",circle:"",onClick:a=>ce(e.$index,e.row)},null,8,["onClick"])])])),_:1}),m(z,{label:"Operation",align:"center"},{default:f((e=>[u("div",R,[p(' <router-link :to="getEditUrl(scope.row)">\n              <el-button\n                class="cp mr-10"\n                type="primary"\n                icon="Edit"\n                circle\n              ></el-button>\n            </router-link> '),m(l,{class:"cp mr-10",type:"primary",icon:"Edit",circle:"",onClick:a=>(e=>{let a=oe(e);N(a)})(e.row)},null,8,["onClick"]),m(j,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":2,onChange:a=>(async e=>{let a={id:e.id,status:e.status};a=O(a);const l=await F(a);P(l)})(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])),_:1})])),_:1},8,["data"])),[[ue,h(le).loading]]),p(" 分页 "),u("div",X,[g(m(h(k),{page:h(le).pagination.listQuery.page,"onUpdate:page":a[10]||(a[10]=e=>h(le).pagination.listQuery.page=e),limit:h(le).pagination.listQuery.limit,"onUpdate:limit":a[11]||(a[11]=e=>h(le).pagination.listQuery.limit=e),total:h(le).pagination.total,"page-sizes":h(le).pagination.pageSizes,onPagination:ne},null,8,["page","limit","total","page-sizes"]),[[V,h(le).pagination.total]])]),p(" device "),m(S,{modelValue:h(le).dialogVisibleDevice,"onUpdate:modelValue":a[14]||(a[14]=e=>h(le).dialogVisibleDevice=e),title:"Device"},{default:f((()=>[h(le).dialogVisibleDevice?(s(),_(D,{key:0,all:h(ae).cacheDevice.all,"onUpdate:all":a[12]||(a[12]=e=>h(ae).cacheDevice.all=e),select:h(ae).cacheDevice.select,"onUpdate:select":a[13]||(a[13]=e=>h(ae).cacheDevice.select=e),onKk:re,onCount:se},null,8,["all","select"])):p("v-if",!0),u("span",Y,[p(' <el-button @click="cancleDevice">取 消</el-button> '),m(l,{type:"primary",onClick:de},{default:f((()=>[Z])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0fe780f4"]]);export{ae as default};
