var F=Object.defineProperty,N=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var k=(e,t,a)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,w=(e,t)=>{for(var a in t||(t={}))S.call(t,a)&&k(e,a,t[a]);if(A)for(var a of A(t))O.call(t,a)&&k(e,a,t[a]);return e},T=(e,t)=>N(e,B(t));import{K as b,r as c,o as m,c as f,h as s,x as n,v as y,k as I,i as C,y as u,t as V}from"./vendor-bf64253d.js";import{g as L,a as K,s as U,b as z}from"./power-54938aa4.js";import{h as H}from"./format-b76f9697.js";import{_ as x}from"./lodash-05c10b51.js";import{_ as E}from"./index-e71c7b30.js";import{m as v}from"./message-da701484.js";import{m as q}from"./self-969efc17.js";import"./moment-1cf83a0b.js";const G={props:{title:{default:"title",type:String},data:{default(){return[]},type:Array},item:{default(){return{}},type:Object},choice:{default(){return[]},type:Array},name:{default:"name",type:String},date:{default:0,type:Number}},data(){return{filterApiText:"",list:[],choiceArr:[],checkStrictly:!1,defaultProps:{children:"children",label:"label"}}},computed:{handleTree(){return H(this.list)},handleRef(){return`tree${this.name}`}},watch:{date(){this.init()},choice:{immediate:!0,handler(e,t){this.$nextTick(()=>{this.$refs[this.handleRef].setCheckedKeys([]),e&&e.forEach(a=>{const o=this.$refs[this.handleRef].getNode(a);o&&o.isLeaf&&this.$refs[this.handleRef].setChecked(o,!0)})})}},filterApiText(e){this.$refs[this.handleRef]&&this.$refs[this.handleRef].filter(e)}},created(){this.list=x.cloneDeep(this.data)},methods:{async init(){this.filterApiText=""},changeOneFn(e,t){const a=[...this.$refs[this.handleRef].getCheckedKeys(),...this.$refs[this.handleRef].getHalfCheckedKeys()];this.$emit("changeChoiceData",this.name,a)},filterApiNode(e,t){return e?t[this.defaultProps.label].includes(e):!0},checkApiTree(e,t,a){const o=this.handleChoiceApiDataPermissionID,l=this.dialogData.treeData.choiceApiData.find(d=>d.permission_id===e.id);var r=l==null?void 0:l.id;t?(this.dialogData.treeData.choiceApiDataAdd.includes(e.id)||o.includes(e.id)||this.dialogData.treeData.choiceApiDataAdd.push(e.id),this.dialogData.treeData.choiceApiDataAdd.includes(r)&&(this.dialogData.treeData.choiceApiDataDel=this.dialogData.treeData.choiceApiDataDel.filter(d=>d!==r))):(this.dialogData.treeData.choiceApiDataDel.includes(r)||l&&this.dialogData.treeData.choiceApiDataDel.push(r),this.dialogData.treeData.choiceApiDataAdd.includes(e.id)&&(this.dialogData.treeData.choiceApiDataAdd=this.dialogData.treeData.choiceApiDataAdd.filter(d=>d!==e.id)))},generateRoutes(e,t="/"){const a=[];for(let{route:o}of e){if(o.hidden)continue;const i=this.onlyOneShowingChild(o.children,o);o.children&&i&&!o.alwaysShow&&(o=i);const l={path:b.resolve(t,o.path),title:o.title,name:o.name};o.children&&(l.children=this.generateRoutes(o.children,l.path)),a.push(l)}return a},generateArr(e){let t=[];return e.forEach(a=>{if(t.push(a),a.children){const o=this.generateArr(a.children);o.length>0&&(t=[...t,...o])}}),t},generateTree(e,t="/",a){const o=[];for(const i of e){const l=b.resolve(t,i.path);i.children&&(i.children=this.generateTree(i.children,l,a)),(a.includes(l)||i.children&&i.children.length>=1)&&o.push(i)}return o},onlyOneShowingChild(e=[],t){let a=null;const o=e.filter(i=>!i.hidden);return o.length===1?(a=o[0],a.path=b.resolve(t.path,a.path),a):o.length===0?(a=T(w({},t),{path:"",noShowingChildren:!0}),a):!1}}},J={class:""};function M(e,t,a,o,i,l){const r=c("el-input"),d=c("el-tree"),p=c("el-form-item"),D=c("el-form");return m(),f(D,{"label-width":"150px","label-position":"top"},{default:s(()=>[n(p,{label:a.title},{default:s(()=>[y("div",J,[n(r,{modelValue:i.filterApiText,"onUpdate:modelValue":t[0]||(t[0]=_=>i.filterApiText=_),class:"w100",placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4"},null,8,["modelValue"]),n(d,{ref:l.handleRef,data:l.handleTree,props:i.defaultProps,"show-checkbox":"","node-key":"id",class:"permission-tree","default-checked-keys":i.choiceArr,"filter-node-method":l.filterApiNode,"default-expand-all":!0,onCheck:l.changeOneFn},null,8,["data","props","default-checked-keys","filter-node-method","onCheck"])])]),_:1},8,["label"])]),_:1})}var Q=E(G,[["render",M]]);const W={element:[],menu:[],operation:[],permission:[]},X={components:{RoleTree:Q},mixins:[q],data(){return{date:"",list:[],data:{},dialogVisible:!1,dialogType:"",busData:{item:{type:""},choiceData:{menu:[],element:[],operation:[]}}}},created(){this.getList()},methods:{async getList(){const{data:e}=await L();this.data=e,this.list=e.permission},clearBusData(){this.busData.choiceData=x.cloneDeep(W)},handleCreate(){this.dialogType="new",this.busData.item.type="",this.clearBusData(),this.dialogVisible=!0;const e=new Date;this.date=e.getTime()},async handleEdit(e){this.dialogType="edit",this.busData.item=e.row;const{data:t}=await K(this.busData.item.id);this.busData.choiceData=t,this.dialogVisible=!0;const a=new Date;this.date=a.getTime()},handleDelete(e){},roleChangeChoice(e,t){console.log(t),this.busData.choiceData[e]=t},async submitFn(){if(this.dialogType==="new"){const e={type:this.busData.item.type,menu_id:this.busData.choiceData.menu,element_id:this.busData.choiceData.element,operation_id:this.busData.choiceData.operation},t=await U(e);t&&v(t),this.getList()}if(this.dialogType==="edit"){const e={permission_id:this.busData.item.id,menu_id:this.busData.choiceData.menu,element_id:this.busData.choiceData.element,operation_id:this.busData.choiceData.operation},t=await z(this.busData.item.id,e);t&&v(t)}this.dialogVisible=!1}}},Y={class:"app-container"},Z=u(" \u65B0\u5EFA "),$=u(" \u4FEE\u6539 "),ee=u(" \u5220\u9664 "),te={class:"flex jc-between ai-start"},ie={slot:"footer",class:"dialog-footer"},ae=u(" \u53D6 \u6D88 "),oe=u(" \u786E \u5B9A ");function le(e,t,a,o,i,l){const r=c("el-button"),d=c("el-table-column"),p=c("el-table"),D=c("el-input"),_=c("el-form-item"),P=c("el-form"),g=c("role-tree"),R=c("el-dialog");return m(),I("div",Y,[e.judgePermissionElementFn("A-AP-ADD-V")?(m(),f(r,{key:0,type:"primary",onClick:l.handleCreate},{default:s(()=>[Z]),_:1},8,["onClick"])):C("v-if",!0),n(p,{data:i.list,style:{width:"100%","margin-top":"30px"},border:""},{default:s(()=>[n(d,{align:"center",label:"ID"},{default:s(h=>[u(V(h.row.id),1)]),_:1}),n(d,{align:"center",label:"Type"},{default:s(h=>[u(V(h.row.type),1)]),_:1}),n(d,{align:"center",label:"Operations"},{default:s(h=>[e.judgePermissionElementFn("A-AP-EDIT-V")?(m(),f(r,{key:0,type:"primary",size:"small",onClick:j=>l.handleEdit(h)},{default:s(()=>[$]),_:2},1032,["onClick"])):C("v-if",!0),e.judgePermissionElementFn("A-AP-DEL-V")?(m(),f(r,{key:1,type:"danger",size:"small",onClick:j=>l.handleDelete(h)},{default:s(()=>[ee]),_:2},1032,["onClick"])):C("v-if",!0)]),_:1})]),_:1},8,["data"]),n(R,{modelValue:i.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=h=>i.dialogVisible=h),title:i.dialogType==="edit"?"Edit Role":"New Role",width:"90%"},{default:s(()=>[n(P,{"label-width":"150px","label-position":"left"},{default:s(()=>[n(_,{label:"Name"},{default:s(()=>[n(D,{modelValue:i.busData.item.type,"onUpdate:modelValue":t[0]||(t[0]=h=>i.busData.item.type=h),placeholder:"Role Name",disabled:i.dialogType==="edit"},null,8,["modelValue","disabled"])]),_:1})]),_:1}),y("div",te,[n(g,{ref:"roleroute",item:i.busData.item,data:i.data.menu,date:i.date,choice:i.busData.choiceData.menu,title:"\u8DEF\u7531\u6743\u9650",name:"menu",class:"col-auto-8 m0-10",onChangeChoiceData:l.roleChangeChoice},null,8,["item","data","date","choice","onChangeChoiceData"]),n(g,{ref:"rolebutton",item:i.busData.item,data:i.data.element,date:i.date,choice:i.busData.choiceData.element,title:"\u6309\u94AE\u6743\u9650",name:"element",class:"col-auto-8 m0-10",onChangeChoiceData:l.roleChangeChoice},null,8,["item","data","date","choice","onChangeChoiceData"]),n(g,{ref:"roleapi",item:i.busData.item,data:i.data.operation,date:i.date,choice:i.busData.choiceData.operation,title:"API\u6743\u9650",name:"operation",class:"col-auto-8 m0-10",onChangeChoiceData:l.roleChangeChoice},null,8,["item","data","date","choice","onChangeChoiceData"])]),y("div",ie,[n(r,{onClick:t[1]||(t[1]=h=>i.dialogVisible=!1)},{default:s(()=>[ae]),_:1}),n(r,{type:"primary",onClick:l.submitFn},{default:s(()=>[oe]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"])])}var pe=E(X,[["render",le]]);export{pe as default};
