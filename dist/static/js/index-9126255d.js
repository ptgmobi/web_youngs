var a=Object.defineProperty,e=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(e,l,t)=>l in e?a(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t,n=(a,e)=>{for(var l in e||(e={}))o.call(e,l)&&s(a,l,e[l]);if(t)for(var l of t(e))r.call(e,l)&&s(a,l,e[l]);return a};import{d,r as u,L as c,M as i,q as p,o as m,c as b,x as f,e as v,s as y,v as h,N as _,O as g,A as j,z as x,f as w,P as V,_ as D,w as O,y as k,D as P,F as A,I as C}from"./main-665d1af0.js";import{f as S,h as U,i as M,j as Y}from"./overview-b6065311.js";import{g as N,a as E,t as I}from"./format-15e3f823.js";import{_ as q}from"./lodash-1f0c0f2f.js";import{h as z}from"./new-format-478034c0.js";import{_ as L}from"./index-5c625cd2.js";import{W as R}from"./index-f2a9ec9f.js";import"./moment-9bd84dc2.js";const $={class:"white-bg control-box flex jc-between ai-start p0-0"},F={class:"flex jc-start flex-wrap ai-start"},G={class:"flex"},H=w(" 查询 "),T=d({emits:["emitParent"],setup(a,{emit:e}){const l={adtype:"",channel_type:"",user_name:"",slot:"",country:"",date:N(6,"day")},t=u({shortcuts:[{text:"今天",value:N(0,"day")},{text:"昨天",value:()=>E(1,1,"day")},{text:"最近7天",value:()=>N(6,"day")},{text:"最近30天",value:()=>N(29,"day")}],options:{adtype:["ssp","fenix"],channel_type:[{value:1,label:"代理"},{value:2,label:"API"},{value:3,label:"直客"}],country:[{value:"",label:""}],user_name:[{label:"",value:""}],slot:[{value:"",label:""}]},data:l}),o=async()=>{const{data:a}=await S();t.options.user_name=null==a?void 0:a.user_name,t.options.slot=null==a?void 0:a.slot,t.options.country=null==a?void 0:a.country},r=()=>{},s=()=>{console.warn("set search data"),e("emitParent",q.cloneDeep(V(t.data)))};return c((()=>{o(),s()})),i((()=>{o(),s()})),(a,e)=>{const l=p("el-date-picker"),o=p("el-form-item"),n=p("el-option"),d=p("el-select"),u=p("el-button"),c=p("el-form");return m(),b("div",null,[f("div",$,[v(c,{inline:!0,model:h(t).data,class:"flex jc-between ai-start w100"},{default:y((()=>[f("div",F,[v(o,{label:"日期选择"},{default:y((()=>[v(l,{modelValue:h(t).data.date,"onUpdate:modelValue":e[0]||(e[0]=a=>h(t).data.date=a),class:"search-con",type:"daterange","unlink-panels":"",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:h(t).shortcuts,clearable:!1},null,8,["modelValue","shortcuts"])])),_:1}),v(o,{label:"分成方法"},{default:y((()=>[v(d,{modelValue:h(t).data.adtype,"onUpdate:modelValue":e[1]||(e[1]=a=>h(t).data.adtype=a),class:"search-con",clearable:"",placeholder:"搜索",onChange:r},{default:y((()=>[(m(!0),b(_,null,g(h(t).options.adtype,(a=>(m(),j(n,{key:a,label:a,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(o,{label:"业务类型"},{default:y((()=>[v(d,{modelValue:h(t).data.channel_type,"onUpdate:modelValue":e[2]||(e[2]=a=>h(t).data.channel_type=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:r},{default:y((()=>[x(' <div class="flex jc-between p10 pt-0">\n                <el-button type="primary" plain size="mini" @click="selectAllProduct()">全选</el-button>\n                <el-button size="mini" type="danger" plain @click="unSelectedAllProduct()">清空</el-button>\n              </div> '),(m(!0),b(_,null,g(h(t).options.channel_type,((a,e)=>(m(),j(n,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(o,{label:"User Name"},{default:y((()=>[v(d,{modelValue:h(t).data.user_name,"onUpdate:modelValue":e[3]||(e[3]=a=>h(t).data.user_name=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:r},{default:y((()=>[(m(!0),b(_,null,g(h(t).options.user_name,((a,e)=>(m(),j(n,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(o,{label:"Slot"},{default:y((()=>[v(d,{modelValue:h(t).data.slot,"onUpdate:modelValue":e[4]||(e[4]=a=>h(t).data.slot=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:r},{default:y((()=>[(m(!0),b(_,null,g(h(t).options.slot,((a,e)=>(m(),j(n,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(o,{label:"国家"},{default:y((()=>[v(d,{modelValue:h(t).data.country,"onUpdate:modelValue":e[5]||(e[5]=a=>h(t).data.country=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:r},{default:y((()=>[(m(!0),b(_,null,g(h(t).options.country,((a,e)=>(m(),j(n,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),f("div",null,[f("div",G,[v(u,{type:"primary",onClick:s},{default:y((()=>[H])),_:1})])])])),_:1},8,["model"])])])}}});const W=a=>(P("data-v-422fd230"),a=a(),A(),a),B={class:"flex flex-wrap jc-between"},J={class:"flex jc-between"},K={key:0,class:"color_primary"},Q=W((()=>f("span",{class:"small_icon"},"$",-1))),X={key:1,class:"color_primary"},Z=W((()=>f("span",{class:"small_icon"},"%",-1)));var aa=D(d({props:{json:{require:!0,default:{},type:Object}},setup(a){const e=u({baseData:a.json,data:{},titleMap:{profit:"毛利合计",revenue:"收入合计",cost:"支出合计",profit_rate:"毛利率"},groupVal:["profit","revenue","cost"],groupRate:["profit_rate"]});return O((()=>e.baseData),((a,l)=>{console.warn("get card data"),(async()=>{let a=n({},e.baseData.data);a=z(a);const{data:l}=await U(a);if(Array.isArray(l)&&0!==l.length)e.data=l[0];else for(const t in e.data)Object.prototype.hasOwnProperty.call(e.data,t)&&(e.data[t]=0)})()}),{deep:!0}),c((()=>{})),(a,l)=>{const t=p("el-card");return m(),b("div",null,[f("div",B,[(m(!0),b(_,null,g(h(e).titleMap,((a,l)=>(m(),j(t,{class:"box-card m10"},{default:y((()=>[f("div",J,[f("h3",null,k(h(e).titleMap[l]),1),h(e).groupVal.includes(l)?(m(),b("h2",K,[Q,w(" "+k(h(e).data[l]),1)])):x("v-if",!0),h(e).groupRate.includes(l)?(m(),b("h2",X,[w(k(h(I)(100*h(e).data[l]))+" ",1),Z])):x("v-if",!0)])])),_:2},1024)))),256))])])}}}),[["__scopeId","data-v-422fd230"]]);const ea=d({props:{json:{require:!0,default:{},type:Object}},setup(a){const e=a,l=u({data:{target:"cost"},options:{target:[{value:"profit",label:"毛利"},{value:"revenue",label:"收入"},{value:"cost",label:"支出"},{value:"profit_rate",label:"毛利率"}]}}),t=u({data:e.json,baseCharData:{},chartData:{tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{show:!0,backgroundColor:"#6a7985"}}},legend:{show:!0,data:["all"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"",type:"line",stack:"Total",emphasis:{focus:"series"},data:[]}]}});O((()=>t.data),((a,e)=>{console.warn("get chart data"),c()}),{deep:!0});const o=()=>{var a;let e=l.options.target.find((a=>a.value===l.data.target));return null!=(a=null==e?void 0:e.label)?a:""},r=["6"],s=()=>{d()},d=()=>{var a;let e=l.data.target,s=null!=(a=t.baseCharData[e])?a:[];if(r.includes(l.data.target.toString())){let a=s.map((a=>I(100*a,2)));t.chartData.series[0].data=a}else{let a=s.map((a=>I(a,2)));t.chartData.series[0].data=a}t.chartData.series[0].name=o()},c=async()=>{var a;let e=n({},t.data.data);e=z(e),t.chartData.xAxis[0].data=[],t.chartData.series[0].data=[];const{data:l}=await M(e);t.baseCharData=l,t.chartData.xAxis[0].data=null!=(a=null==l?void 0:l.date)?a:[],t.chartData.series[0].name=o(),d()};return(a,e)=>{const o=p("el-option"),r=p("el-select"),n=p("el-form-item"),d=p("el-form");return m(),b("div",null,[f("div",null,[v(d,{inline:!0,model:h(l).data,class:"flex jc-between w100"},{default:y((()=>[v(n,{label:"指标"},{default:y((()=>[v(r,{modelValue:h(l).data.target,"onUpdate:modelValue":e[0]||(e[0]=a=>h(l).data.target=a),placeholder:"Select",onChange:s},{default:y((()=>[(m(!0),b(_,null,g(h(l).options.target,(a=>(m(),j(o,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])]),f("div",null,[v(h(L),{"chart-data":h(t).chartData},null,8,["chart-data"])])])}}}),la={class:"mt-20"},ta={class:"flex jc-end mb-10"},oa=d({props:{json:{require:!0,default:{},type:Object}},setup(a){let e=u({data:a.json,list:[],exportExcel:{buttonName:"导出",tHeader:["日期"],filterVal:["date"],fileName:"profit"}}),l=u([{value:"user_id",label:"User ID"},{value:"account_email",label:"Account Email"},{value:"user_name",label:"User Name"},{value:"profit",label:"毛利"},{value:"revenue",label:"收入"},{value:"cost",label:"支出"},{value:"profit_rate",label:"毛利率"}]);O((()=>e.data),((a,e)=>{console.warn("get table data"),t()}),{deep:!0});const t=async()=>{let a=n({},e.data.data);a=z(a),e.list=[];const{data:l}=await Y(a);e.list=l};let o=["profit_rate"],r=C((()=>{let a=[];return e.list.map((e=>{let l={},t=n({},e);for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)){const e=t[a];o.includes(a)?l[a]=`${I(100*e,2)}%`:l[a]=e}a.push(l)})),a}));const s=C((()=>l.map((a=>a.label)))),d=C((()=>l.map((a=>a.value))));return(a,t)=>{const o=p("el-table-column"),n=p("el-table");return m(),b("div",la,[f("div",ta,[v(R,{"button-name":h(e).exportExcel.buttonName,list:h(r),"t-header":h(s),"filter-val":h(d),filename:h(e).exportExcel.fileName},null,8,["button-name","list","t-header","filter-val","filename"])]),x(" table "),v(n,{center:"",data:h(r),class:"w100",border:""},{default:y((()=>[(m(!0),b(_,null,g(h(l),(a=>{var e;return m(),j(o,{key:a.value,prop:a.value,label:a.label,fixed:null!=(e=null==a?void 0:a.fixed)&&e,align:"center"},null,8,["prop","label","fixed"])})),128))])),_:1},8,["data"])])}}}),ra={class:"app-container"},sa=d({name:"Profit"}),na=d((da=n({},sa),e(da,l({setup(a){let e=u({data:{adtype:"",channel_type:"",user_name:"",slot:"",country:"",st:"",et:""}});const l=a=>{e.data.adtype=a.adtype,e.data.channel_type=a.channel_type,e.data.user_name=a.user_name,e.data.slot=a.slot,e.data.country=a.country,e.data.st=a.date[0],e.data.et=a.date[1]};return(a,t)=>(m(),b("div",ra,[v(h(T),{onEmitParent:l}),v(h(aa),{json:h(e)},null,8,["json"]),v(h(ea),{json:h(e)},null,8,["json"]),v(h(oa),{json:h(e)},null,8,["json"])]))}}))));var da;export{na as default};
