import{d as a,r as e,M as l,N as t,m as s,s as n,n as o,v as r,c as d,p as c,O as u,P as i,A as p,z as v,b as m,Q as b,_ as g,w as h,x as f,q as y,G as _,H as x,I as w}from"./index-b160a4d6.js";import{g as k,a as j,b as V,c as S,d as D,e as P}from"./overview-e30e7450.js";import{_ as C}from"./lodash-ad752a46.js";import{t as O,g as A,a as Y}from"./format-75dc684c.js";import{h as B}from"./new-format-f712eb45.js";import{_ as M}from"./index-2ea29ab0.js";import"./moment-56f006b0.js";const U={class:"white-bg control-box flex jc-between ai-start p0-0"},q={class:"flex jc-start flex-wrap"},G={class:"flex"},$=m(" 查询 "),z=a({__name:"search",emits:["emitParent"],setup(a,{emit:m}){const g=e({options:{channel_type:[{value:1,label:"代理"},{value:2,label:"API"},{value:3,label:"直客"},{value:6,label:"Yohoads"}],platform:[{value:1,label:"Android"},{value:2,label:"iOS"}],country:[{value:"",label:""}],channel:[{label:"",value:""}],pkg:[{value:"",label:""}]},data:{channel_type:"",platform:"",channel:"",country:"",pkg:""}}),h=async()=>{const a=await Promise.all([await k(),j(),V()]),[e,l,t]=a;g.options.country=e.data,g.options.channel=l.data,g.options.pkg=t.data},f=()=>{},y=()=>{},_=()=>{},x=()=>{},w=()=>{},S=()=>{console.warn("set search data"),m("emitParent",C.cloneDeep(b(g.data)))};return l((()=>{h(),S()})),t((()=>{h(),S()})),(a,e)=>{const l=s("el-option"),t=s("el-select"),m=s("el-form-item"),b=s("el-button"),h=s("el-form");return n(),o("div",null,[r("div",U,[d(h,{inline:!0,model:g.data,class:"flex jc-between ai-start w100"},{default:c((()=>[r("div",q,[d(m,{label:"广告主类型"},{default:c((()=>[d(t,{modelValue:g.data.channel_type,"onUpdate:modelValue":e[0]||(e[0]=a=>g.data.channel_type=a),class:"search-con",clearable:"",placeholder:"搜索",onChange:f},{default:c((()=>[(n(!0),o(u,null,i(g.options.channel_type,(a=>(n(),p(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(m,{label:"平台"},{default:c((()=>[d(t,{modelValue:g.data.platform,"onUpdate:modelValue":e[1]||(e[1]=a=>g.data.platform=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:y},{default:c((()=>[v(' <div class="flex jc-between p10 pt-0">\n                <el-button type="primary" plain size="mini" @click="selectAllProduct()">全选</el-button>\n                <el-button size="mini" type="danger" plain @click="unSelectedAllProduct()">清空</el-button>\n              </div> '),(n(!0),o(u,null,i(g.options.platform,((a,e)=>(n(),p(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(m,{label:"国家"},{default:c((()=>[d(t,{modelValue:g.data.country,"onUpdate:modelValue":e[2]||(e[2]=a=>g.data.country=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:_},{default:c((()=>[(n(!0),o(u,null,i(g.options.country,((a,e)=>(n(),p(l,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(m,{label:"Channel"},{default:c((()=>[d(t,{modelValue:g.data.channel,"onUpdate:modelValue":e[3]||(e[3]=a=>g.data.channel=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:x},{default:c((()=>[(n(!0),o(u,null,i(g.options.channel,((a,e)=>(n(),p(l,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(m,{label:"Pkg"},{default:c((()=>[d(t,{modelValue:g.data.pkg,"onUpdate:modelValue":e[4]||(e[4]=a=>g.data.pkg=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:w},{default:c((()=>[(n(!0),o(u,null,i(g.options.pkg,((a,e)=>(n(),p(l,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),r("div",null,[r("div",G,[d(b,{type:"primary",onClick:S},{default:c((()=>[$])),_:1})])])])),_:1},8,["model"])])])}}});const I=a=>(_("data-v-7f4b3e65"),a=a(),x(),a),E={class:"flex flex-wrap jc-between"},H={class:"card-header"},L={key:0},N={class:"mt-10 mb-10"},Q={key:0},T={key:1},F={class:"valueBox"},J={class:"value-box"},K=I((()=>r("span",null,"日环比:",-1))),R={class:"value-right"},W={key:0},X={key:1},Z={key:2},aa={class:"value-val"},ea={class:"valueBox"},la={class:"value-box"},ta=I((()=>r("span",null,"周同比:",-1))),sa={class:"value-right"},na={key:0},oa={key:1},ra={key:2},da={class:"value-val"},ca={class:"valueBox"},ua={class:"value-box"},ia=I((()=>r("span",null,"7日均:",-1))),pa={key:0},va={key:1},ma={class:"valueBox"},ba={class:"value-box"},ga=I((()=>r("span",null,"30日均:",-1))),ha={key:0},fa={key:1},ya={key:1},_a=I((()=>r("div",{class:"mt-10 mb-10",style:{height:"21px"}},null,-1))),xa={class:"valueBox"},wa={class:"value-box"},ka=I((()=>r("span",null,"收入:",-1))),ja={class:"value-right"},Va={class:"value-val"},Sa={class:"valueBox"},Da={class:"value-box"},Pa=I((()=>r("span",null,"支出:",-1))),Ca={class:"value-right"},Oa={class:"value-val"},Aa={class:"valueBox"},Ya={class:"value-box"},Ba=I((()=>r("span",null,"毛利:",-1))),Ma={class:"value-right"},Ua={class:"value-val"},qa={class:"valueBox"},Ga={class:"value-box"},$a=I((()=>r("span",null,"日均毛利:",-1))),za={class:"value-right"},Ia={class:"value-val"};var Ea=g(a({__name:"card",props:{json:{require:!0,default:()=>({}),type:Object}},setup(a){const t=e({baseData:a.json,data:{},titleMap:{yesterday_revenue:"昨日收入",yesterday_gross_profit:"昨日毛利",yesterday_gross_margin:"昨日毛利率",accumulated_month:"本月累计",accumulated_quarter:"本季度累计"},titleGroup:["yesterday_revenue","yesterday_gross_profit","yesterday_gross_margin"],titleGroup1:["accumulated_month","accumulated_quarter"]}),m=a=>{let e=100*Math.abs(a);return`${O(e,2)}%`};return h((()=>t.baseData),((a,e)=>{console.warn("get card data"),(async()=>{t.data=[];let a={...t.baseData.data};delete a.date,a=B(a);const{data:e}=await S(a);t.data=e})()}),{deep:!0}),l((()=>{})),(a,e)=>{const l=s("caret-bottom"),b=s("el-icon"),g=s("caret-top"),h=s("el-card");return n(),o("div",null,[r("div",E,[(n(!0),o(u,null,i(t.data,((a,e)=>(n(),p(h,{class:"box-card m10"},{header:c((()=>[r("div",H,[r("h3",null,f(t.titleMap[e]),1)])])),default:c((()=>[r("div",null,[t.titleGroup.includes(e.toString())?(n(),o("div",L,[r("h4",null,f(a.date),1),r("div",N,[v(" <h2 v-if=\"item.hasOwnProperty('revenue')\">$ {{item.revenue}}</h2>\n              <h2 v-if=\"item.hasOwnProperty('rate')\">{{item.rate * 100}} %</h2> "),"yesterday_gross_margin"!==e.toString()?(n(),o("h2",Q," $ "+f(a.revenue),1)):v("v-if",!0),"yesterday_gross_margin"===e.toString()?(n(),o("h2",T,f(y(O)(100*a.revenue,2))+" % ",1)):v("v-if",!0)]),r("div",F,[r("div",J,[K,r("span",R,[a.dod<0?(n(),o("span",W,[d(b,{class:"el-svg-icon color_down"},{default:c((()=>[d(l)])),_:1})])):v("v-if",!0),a.dod>0?(n(),o("span",X,[d(b,{class:"el-svg-icon color_up"},{default:c((()=>[d(g)])),_:1})])):(n(),o("span",Z)),r("span",aa,f(m(a.dod)),1)])])]),r("div",ea,[r("div",la,[ta,r("span",sa,[a.wow<0?(n(),o("span",na,[d(b,{class:"el-svg-icon color_down"},{default:c((()=>[d(l)])),_:1})])):v("v-if",!0),a.wow>0?(n(),o("span",oa,[d(b,{class:"el-svg-icon color_up"},{default:c((()=>[d(g)])),_:1})])):(n(),o("span",ra)),r("span",da,f(m(a.wow)),1)])])]),r("div",ca,[r("div",ua,[ia,"yesterday_gross_margin"!==e.toString()?(n(),o("span",pa,f(a.d7),1)):v("v-if",!0),"yesterday_gross_margin"===e.toString()?(n(),o("span",va,f(m(a.d7)),1)):v("v-if",!0)])]),r("div",ma,[r("div",ba,[ga,"yesterday_gross_margin"!==e.toString()?(n(),o("span",ha,f(a.d30),1)):v("v-if",!0),"yesterday_gross_margin"===e.toString()?(n(),o("span",fa,f(m(a.d30)),1)):v("v-if",!0)])])])):v("v-if",!0),t.titleGroup1.includes(e.toString())?(n(),o("div",ya,[r("h4",null,f(a.date),1),_a,r("div",xa,[r("div",wa,[ka,r("span",ja,[r("span",Va,f(a.revenue),1)])])]),r("div",Sa,[r("div",Da,[Pa,r("span",Ca,[r("span",Oa,f(a.cost),1)])])]),r("div",Aa,[r("div",Ya,[Ba,r("span",Ma,[r("span",Ua,f(a.profit),1)])])]),r("div",qa,[r("div",Ga,[$a,r("span",za,[r("span",Ia,f(a.avg_profit),1)])])])])):v("v-if",!0)])])),_:2},1024)))),256))])])}}}),[["__scopeId","data-v-7f4b3e65"]]);const Ha=a({__name:"chart",props:{json:{require:!0,default:{},type:Object}},setup(a){const l=a,t=e({data:{target:5},options:{target:[{value:1,label:"转化"},{value:2,label:"单价"},{value:3,label:"收入"},{value:4,label:"支出"},{value:5,label:"毛利"},{value:6,label:"毛利率(单位为%)"}]}}),v=e({data:l.json,chartData:{tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{show:!0,backgroundColor:"#6a7985"}}},legend:{show:!0,data:["all"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"",type:"line",stack:"Total",emphasis:{focus:"series"},data:[]}]}});h((()=>v.data),((a,e)=>{console.warn("get chart data"),b()}),{deep:!0});const m=["6"],b=async()=>{var a,e;let l={...v.data.data,target:t.data.target};l=B(l),v.chartData.xAxis[0].data=[],v.chartData.series[0].data=[];const s=(()=>{var a;let e=t.options.target.find((a=>a.value===t.data.target));return null!=(a=null==e?void 0:e.label)?a:"test"})();v.chartData.legend.data=[s],v.chartData.series[0].name=s;const{data:n}=await D(l);v.chartData.xAxis[0].data=null!=(a=null==n?void 0:n.date)?a:[];let o=null!=(e=null==n?void 0:n.data)?e:[];if(m.includes(t.data.target.toString())){let a=o.map((a=>O(100*a,2)));v.chartData.series[0].data=a}else{let a=o.map((a=>O(a,2)));v.chartData.series[0].data=a}};return(a,e)=>{const l=s("el-option"),m=s("el-select"),g=s("el-form-item"),h=s("el-form");return n(),o("div",null,[r("div",null,[d(h,{inline:!0,model:t.data,class:"flex jc-between w100"},{default:c((()=>[d(g,{label:"指标"},{default:c((()=>[d(m,{modelValue:t.data.target,"onUpdate:modelValue":e[0]||(e[0]=a=>t.data.target=a),placeholder:"Select",onChange:b},{default:c((()=>[(n(!0),o(u,null,i(t.options.target,(a=>(n(),p(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])]),r("div",null,[d(y(M),{"chart-data":v.chartData},null,8,["chart-data"])])])}}}),La={class:"control-box mt-20"},Na={class:"flex jc-start"},Qa=a({__name:"date",emits:["emitParent"],setup(a,{emit:l}){let t=e({shortcuts:[{text:"今天",value:A(0,"day")},{text:"昨天",value:()=>Y(1,1,"day")},{text:"最近7天",value:()=>A(6,"day")},{text:"最近30天",value:()=>A(29,"day")}],data:{search:{date:A(6,"day")}}});return h((()=>t.data.search.date),((a,e)=>{console.warn("set search date"),l("emitParent",[...t.data.search.date])}),{immediate:!0}),(a,e)=>{const l=s("el-date-picker"),u=s("el-form-item"),i=s("el-form");return n(),o("div",La,[d(i,{inline:!0,model:y(t).data,class:"flex jc-between"},{default:c((()=>[r("div",Na,[d(u,{label:"日期选择"},{default:c((()=>[d(l,{modelValue:y(t).data.search.date,"onUpdate:modelValue":e[0]||(e[0]=a=>y(t).data.search.date=a),class:"mr-10 mb-10",type:"daterange","unlink-panels":"",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:y(t).shortcuts,clearable:!1},null,8,["modelValue","shortcuts"])])),_:1})])])),_:1},8,["model"])])}}}),Ta={class:"mt-20"},Fa=a({__name:"table",props:{json:{require:!0,default:{},type:Object}},setup(a){let l=e({data:a.json,list:[]});h((()=>l.data),((a,e)=>{console.warn("get table data"),t()}),{deep:!0});const t=async()=>{let a={...l.data.data};a=B(a),l.list=[];const{data:e}=await P(a);l.list=e};let r=w((()=>{let a=[];return l.list.map((e=>{let l={},t={...e};for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)){const e=t[a];a.includes("rate")?l[a]=`${O(100*e,2)}%`:l[a]=O(e,2)}a.push(l)})),a}));return(a,e)=>{const l=s("el-table-column"),t=s("el-table");return n(),o("div",Ta,[v(" table "),d(t,{center:"",data:y(r),class:"w100",height:"87vh",border:""},{default:c((()=>[d(l,{fixed:"",prop:"date",label:"日期",align:"center"}),v(' <el-table-column fixed prop="type" label="广告主类型" align="center"></el-table-column>\n      <el-table-column prop="channel" label="Channel" align="center"></el-table-column>\n      <el-table-column prop="platform" label="平台" align="center"></el-table-column>\n      <el-table-column prop="country" label="国家" align="center"></el-table-column>\n      <el-table-column prop="pkg" label="Pkg" align="center"></el-table-column> '),d(l,{prop:"conversion",label:"转化数",align:"center"}),d(l,{prop:"revenue",label:"收入",align:"center"}),d(l,{prop:"cost",label:"支出",align:"center"}),d(l,{prop:"profit",label:"毛利",align:"center"}),d(l,{prop:"profit_rate",label:"毛利率",align:"center"})])),_:1},8,["data"])])}}}),Ja={class:"app-container"},Ka=a({name:"Overview"}),Ra=a({...Ka,setup(a){let l=e({data:{channel_type:[],platform:[],channel:[],country:[],pkg:[],st:"",et:""}}),t=e({data:{channel_type:[],platform:[],channel:[],country:[],pkg:[]}}),s=e({data:{st:"",et:""}});const r=a=>{t.data={...a},l.data={...t.data,...s.data}},c=a=>{s.data={st:a[0],et:a[1]},l.data={...t.data,...s.data}};return(a,e)=>(n(),o("div",Ja,[d(y(z),{onEmitParent:r}),d(y(Ea),{json:y(t)},null,8,["json"]),d(y(Qa),{onEmitParent:c}),d(y(Ha),{json:y(l)},null,8,["json"]),d(y(Fa),{json:y(l)},null,8,["json"])]))}});export{Ra as default};
