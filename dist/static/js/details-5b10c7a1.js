var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,t=(l,a,r)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[a]=r,o=(e,o)=>{for(var s in o||(o={}))a.call(o,s)&&t(e,s,o[s]);if(l)for(var s of l(o))r.call(o,s)&&t(e,s,o[s]);return e};import{d as s,h as i,r as m,L as u,q as d,o as n,c as f,z as c,e as p,s as v,v as y,x as b,P as _,K as g,A as F,f as j,g as h,E as x}from"./main-c289050e.js";import{s as w}from"./setting-c7abf732.js";import{b as q,c as O,d as V}from"./dsp-media-93cb6169.js";import{A as P}from"./dsp-advertiser-d95bf0ce.js";import{m as U}from"./message-7c571a95.js";import{_ as C}from"./index-0855a96e.js";import{u as k}from"./useUtils-034ffd86.js";import{d as A,e as D,i as E}from"./new-format-0cb28217.js";import{_ as L}from"./lodash-6a3426b2.js";import{u as M}from"./upload-55b5b058.js";const R={class:"content-con from-one flex column"},S={class:"content-con from-one flex column"},z={class:"form-one flex jc-start"},H=j("上传媒体bundle"),I={class:"w100 flex"},K=j(" 确认 "),N=j(" 取消 "),$=s({setup(e){const{validate:l,uploadHttpRequest:a}=M,{adv_type:r,audience_manage_type:t}=w,{getRouterData:s,getCommonCountryList:j,goNewUrl:$}=k();let{proxy:B}=h();let G=i("create"),J=i([]);const Q={id:void 0,name:"",descs:"",media_num:void 0,file_url:"",is_del:void 0},T=m({ruleForm:Q,rules:{name:[{required:!0,message:"此项必填",trigger:["blur","change"]}]},options:{country:[{value:"",label:"",id:""}],advertiser:[{adv_id:"",name:""}],adv_type:r,audience_manage_type:t}}),W=()=>{B.$refs.ruleForm.validate((e=>{if(!e)return!1;Z()}))},X=["id","media_num"],Y=["country"],Z=async()=>{let e=_(T.ruleForm);if(e=A(e),e=D(e,X),e=E(e,Y),G.value,"create"===G.value){delete e.id;const l=await q(e);U(l)&&ee()}if("edit"===G.value){const l=await O(e);U(l)&&ee()}},ee=()=>{$({url:"/media/custom/list"})},le=(e,l)=>{},ae=(e,l)=>{let a=null==e?void 0:e.data;T.ruleForm.file_url=a,J.value.splice(0),J.value.push({name:a,url:a})},re=(e,l)=>{x({message:"只能上传一个，请删除后重试",type:"warning"})},te=async e=>!0,oe=()=>{var e,l;let{query:a,params:r}=s();if(G.value=null!=(l=null==(e=a.type)?void 0:e.toString())?l:"",G.value,(async()=>{Promise.all([j(),P({limit:1e4,page:1})]).then((e=>{let l=e[0];T.options.country=l;let a=e[1];T.options.advertiser=a.data.data}))})(),"create"===G.value&&(T.ruleForm=L.cloneDeep(Q)),"edit"===G.value){const{id:e}=r;(async(e,l)=>{const a=await V(e),{data:r}=a;T.ruleForm=o(o({},T.ruleForm),r),T.ruleForm.file_url&&J.value.push({name:T.ruleForm.file_url,url:T.ruleForm.file_url}),T.ruleForm})(e)}};return u((()=>{oe()})),(e,l)=>{const r=d("el-input"),t=d("el-form-item"),o=d("el-button"),s=d("el-upload"),i=d("el-form");return n(),f("div",null,[c(" form "),p(i,{ref:"ruleForm",enctype:"multipart/form-data",rules:y(T).rules,model:y(T).ruleForm,"label-width":"150px","label-position":"right",class:"flex column",disabled:"edit"===y(G)&&2===y(T).ruleForm.is_del},{default:v((()=>[p(y(C),{title:"基础信息"}),b("div",R,[c(" 媒体列表名称 "),p(t,{class:"self-el-form-item",label:"媒体列表名称:",prop:"name"},{default:v((()=>[p(r,{modelValue:y(T).ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>y(T).ruleForm.name=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1}),c(" 描述 "),p(t,{class:"self-el-form-item",label:"描述:",prop:"descs"},{default:v((()=>[p(r,{modelValue:y(T).ruleForm.descs,"onUpdate:modelValue":l[1]||(l[1]=e=>y(T).ruleForm.descs=e),modelModifiers:{trim:!0},class:"form-one",placeholder:"",type:"textarea"},null,8,["modelValue"])])),_:1})]),p(y(C),{title:"选择媒体"}),b("div",S,[c(" 上传文件 "),p(t,{class:"self-el-form-item",label:"上传文件:",prop:"adv_type"},{default:v((()=>[b("div",z,[p(s,{class:"form-one",name:"url",action:"",limit:1,"list-type":"text","file-list":y(J),"onUpdate:file-list":l[2]||(l[2]=e=>g(J)?J.value=e:J=e),"on-remove":le,"on-success":ae,"before-upload":te,"on-exceed":re,"http-request":y(a)},{default:v((()=>[0===y(J).length?(n(),F(o,{key:0,type:"primary"},{default:v((()=>[H])),_:1})):c("v-if",!0)])),_:1},8,["file-list","http-request"])])])),_:1})])])),_:1},8,["rules","model","disabled"]),c(" form "),c(" footer "),b("div",I,[p(o,{type:"primary",onClick:W},{default:v((()=>[K])),_:1}),p(o,{type:"primary",onClick:ee},{default:v((()=>[N])),_:1})])])}}});export{$ as default};
