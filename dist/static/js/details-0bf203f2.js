var e=Object.defineProperty,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,r=(e,r)=>{for(var i in r||(r={}))t.call(r,i)&&o(e,i,r[i]);if(l)for(var i of l(r))a.call(r,i)&&o(e,i,r[i]);return e};import{_ as i,d as s,h as u,r as d,L as n,q as m,o as c,c as f,z as p,e as v,s as g,v as h,x as _,P as y,N as w,O as b,A as F,f as U,y as V,K as j,a9 as P,g as k}from"./main-4108d4c8.js";import{c as L,d as R,e as z}from"./dsp-adcontrol-8ad7d853.js";import{e as x}from"./dsp-advertiser-08383083.js";import{m as O}from"./message-c3fe1e43.js";import{_ as q}from"./index-bfd9e067.js";import{u as M}from"./useUtils-d0d2ed59.js";import{d as I,e as C}from"./new-format-e2d0b76c.js";import{s as E}from"./validate-31aaa08c.js";import{_ as H}from"./lodash-cc1290e8.js";const S={logo_type_reg:/png|jpg/g,logo_limit:3145728,logo_size:[{width:100,height:100},{width:500,height:500}],image_type_reg:/png|jpg|gif/g,image_limit:3145728,image_size:[{width:160,height:600},{width:250,height:250},{width:300,height:50},{width:300,height:250},{width:300,height:600},{width:320,height:50},{width:320,height:100},{width:320,height:480},{width:480,height:320},{width:628,height:1200},{width:728,height:90},{width:970,height:250},{width:1200,height:628}],video_type_reg:/mp4/g,video_limit:10485760,video_duration:30,video_size:[{width:320,height:480},{width:480,height:320}]},{logo_type_reg:W,logo_limit:D,logo_size:N,image_type_reg:$,image_limit:A,image_size:K,video_type_reg:B,video_limit:G,video_duration:J,video_size:Q}=S;var T={validate:async(e,l)=>{if("logo"===l){const l=new Promise((function(l,t){let a=window.URL||window.webkitURL,o=new Image;o.onload=function(){let e=o.width,a=o.height;N.find((l=>l.width===e&&l.height===a))?l(null):t("图片尺寸错误")},o.src=a.createObjectURL(e)})),t=new Promise((function(l,t){let a=e.type;W.test(a)?l(null):t("图片类型错误")})),a=new Promise((function(l,t){e.size<=D?l(null):t("图片大小错误")}));return Promise.allSettled([l,t,a]).then((e=>e))}if("image"===l){const l=new Promise((function(l,t){let a=window.URL||window.webkitURL,o=new Image;o.onload=function(){let e=o.width,a=o.height;K.find((l=>l.width===e&&l.height===a))?l(!0):t("图片尺寸错误")},o.src=a.createObjectURL(e)})),t=new Promise((function(l,t){let a=e.type;$.test(a)?l(!0):t("图片类型错误")})),a=new Promise((function(l,t){e.size>A?l(!0):t("图片大小错误")}));return Promise.allSettled(l,t,a).then((e=>e)).finally((e=>{}))}"video"===l&&new Promise((function(l,t){let a=URL.createObjectURL(e),o=document.createElement("video");o.onloadedmetadata=function(e){URL.revokeObjectURL(a);let t=o.videoWidth,r=o.videoHeight;o.videoWidth,o.videoHeight;let i=Q.find((e=>e.width===t&&e.height===r));i=!0,l(null)},o.src=a,o.load()}))}};const X={class:"content-con from-one flex column"},Y={class:"content-con from-one flex column"},Z=["src"],ee={class:"w100 flex"},le=U(" 确认 "),te=U(" 取消 "),ae={class:"flex"},oe=["src"],re=["src"];var ie=i(s({setup(e){const{validate:l}=T,{logo_type_reg:t,logo_limit:a,logo_size:o,image_type_reg:i,image_limit:s,image_size:W,video_type_reg:D,video_limit:N,video_duration:$,video_size:A}=S,{getRouterData:K,getCommonCountryList:B,goNewUrl:G}=M();let{proxy:J}=k();const Q=u(""),ie=u(""),se=u(!1),ue="此项必填";let de=u("create"),ne=u([]),me=u([]),ce=u([]),fe=u([]);const pe={id:void 0,name:"",desc:"",type:1,url:"",audit_status:void 0,size:"",memory_size:"",format:"",duration:void 0,status:1,is_del:void 0,logo_url:"",title:"",main_body:"",actions:"",brand:"",cover_url:""},ve=(e,l,t)=>{const{max:a}=e;E(l,a)?t(void 0):t(new Error("值的长度不能大于${}"))},ge=d({ruleForm:pe,rules:{adv_series_name:[{required:!0,message:ue,trigger:["blur","change"]},{validator:ve,max:100,trigger:["blur","change"]}],adv_id:[{required:!0,message:ue,trigger:["blur","change"]}],desc:[{validator:ve,max:200,trigger:["blur","change"]}],adv_series_type:[{required:!0,message:ue,trigger:["blur","change"]}],adv_series_budget:[{required:!0,message:ue,trigger:["blur","change"]}]},options:{type:[{value:1,label:"图片"},{value:2,label:"视频"},{value:3,label:"原生"}],audit_status:[{value:1,label:"未审核"},{value:2,label:"审核通过"},{value:3,label:"审核未通过"}]}}),he=()=>{J.$refs.ruleForm.validate((e=>{if(!e)return!1;ye()}))},_e=["id","adv_series_type","adv_series_budget"],ye=async()=>{let e=y(ge.ruleForm);if(e=I(e),e=C(e,_e),"create"===de.value){delete e.id;const l=await L(e);O(l)&&we()}if("edit"===de.value){const l=await R(e);O(l)&&we()}},we=()=>{G({url:"/adcontrol/adseries/list"})},be=(e,l)=>{},Fe=e=>{Q.value=e.url;let l="",t=D;i.test(Q.value)&&(l="image"),t.test(Q.value)&&(l="video"),ie.value=l,se.value=!0},Ue=(e,l)=>{ge.ruleForm.url=null==e?void 0:e.data,ne.value.splice(0),ne.value.push({name:"",url:null==e?void 0:e.data})},Ve=(e,l)=>{ge.ruleForm.url=null==e?void 0:e.data,ce.value.splice(0),ce.value.push({name:"",url:null==e?void 0:e.data})},je=(e,l)=>{ge.ruleForm.cover_url=null==e?void 0:e.data,fe.value.splice(0),fe.value.push({name:"",url:null==e?void 0:e.data})},Pe=async e=>{const l=new FormData;l.append("logo_url",e.file);return await x(l)},ke=async e=>{const t=await l(e,"logo");return t},Le=async e=>l(e,"image"),Re=async e=>{let l=e.type;const t=l.includes("image"),a=l.includes("video"),o=e.size/1048576<100,r=new Promise((function(l,o){let r=window.URL||window.webkitURL;if(t){let t=new Image;t.onload=function(){let e=100!==t.width&&100!==t.height;e=!0,l(null)},t.src=r.createObjectURL(e)}if(a){let t=r.createObjectURL(e),a=document.createElement("video");a.onloadedmetadata=function(e){r.revokeObjectURL(t),a.videoWidth,a.videoHeight;let o=100!==a.videoWidth||100!==a.videoHeight;o=!0,l(null)},a.src=t,a.load(),l(null)}})).then((()=>e),(()=>(console.error("图片尺寸过大,请上传100*100尺寸的图片"),Promise.reject())));return t||console.error("格式错误，请上传图片格式"),o||console.error("文件过大，文件大小不超过100M"),r},ze=()=>{var e,l;let{query:t,params:a}=K();if(de.value=null!=(l=null==(e=t.type)?void 0:e.toString())?l:"",(async()=>{})(),"create"===de.value&&(ge.ruleForm=H.cloneDeep(pe)),"edit"===de.value){const{id:e}=a;(async e=>{const l=await z(e),{data:t}=l;ge.ruleForm=r(r({},ge.ruleForm),t),ge.ruleForm})(e)}};return n((()=>{ze()})),(e,l)=>{const t=m("el-input"),a=m("el-form-item"),o=m("el-radio"),r=m("el-radio-group"),i=m("el-icon"),s=m("el-upload"),u=m("el-form"),d=m("el-button"),n=m("el-dialog");return c(),f("div",null,[p(" form "),v(u,{ref:"ruleForm",enctype:"multipart/form-data",rules:h(ge).rules,model:h(ge).ruleForm,"label-width":"150px","label-position":"right",class:"flex column",disabled:"edit"===h(de)&&2===h(ge).ruleForm.is_del},{default:g((()=>[v(h(q),{title:"基础信息"}),_("div",X,[p(" 创意名称 "),v(a,{class:"self-el-form-item",label:"创意名称:",prop:"name"},{default:g((()=>[v(t,{modelValue:h(ge).ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>h(ge).ruleForm.name=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1}),p(" 描述 "),v(a,{class:"self-el-form-item",label:"描述:",prop:"desc"},{default:g((()=>[v(t,{modelValue:h(ge).ruleForm.desc,"onUpdate:modelValue":l[1]||(l[1]=e=>h(ge).ruleForm.desc=e),modelModifiers:{trim:!0},class:"form-one",placeholder:"",type:"textarea"},null,8,["modelValue"])])),_:1})]),v(h(q),{title:"创意设计"}),_("div",Y,[p(" 创意样式 "),v(a,{class:"self-el-form-item",label:"创意样式:",prop:"type"},{default:g((()=>[v(r,{class:"form-one",modelValue:h(ge).ruleForm.type,"onUpdate:modelValue":l[2]||(l[2]=e=>h(ge).ruleForm.type=e)},{default:g((()=>[(c(!0),f(w,null,b(h(ge).options.type,(e=>(c(),F(o,{label:e.value},{default:g((()=>[U(V(e.label),1)])),_:2},1032,["label"])))),256))])),_:1},8,["modelValue"])])),_:1}),p(" 上传素材 --- 图片 "),1===h(ge).ruleForm.type?(c(),F(a,{key:0,class:"self-el-form-item",label:"上传图片素材:",prop:"url"},{default:g((()=>[v(s,{class:"avatar-uploader",name:"url",action:"","list-type":"picture-card","file-list":h(ne),"onUpdate:file-list":l[3]||(l[3]=e=>j(ne)?ne.value=e:ne=e),"on-preview":Fe,"on-remove":be,"on-success":Ue,"before-upload":Le,"http-request":Pe},{default:g((()=>[p(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),v(i,null,{default:g((()=>[v(h(P))])),_:1})])),_:1},8,["file-list"])])),_:1})):p("v-if",!0),p(" 上传素材 --- 视频 "),2===h(ge).ruleForm.type?(c(),F(a,{key:1,class:"self-el-form-item",label:"上传视频素材:",prop:"url"},{default:g((()=>[v(s,{class:"avatar-uploader",name:"url",action:"",limit:1,"show-file-list":!1,"file-list":h(me),"onUpdate:file-list":l[4]||(l[4]=e=>j(me)?me.value=e:me=e),"on-preview":Fe,"on-remove":be,"on-success":Ue,"before-upload":Re,"http-request":Pe},{default:g((()=>[h(ge).ruleForm.url?(c(),f("video",{key:0,src:h(ge).ruleForm.url,alt:"Video",controls:""},null,8,Z)):(c(),F(i,{key:1,class:"avatar-uploader-icon"},{default:g((()=>[v(h(P))])),_:1}))])),_:1},8,["file-list"])])),_:1})):p("v-if",!0),p(" 上传封面 "),2===h(ge).ruleForm.type?(c(),F(a,{key:2,class:"self-el-form-item",label:"上传封面:",prop:"cover_url"},{default:g((()=>[v(s,{class:"avatar-uploader",name:"cover_url",action:"","list-type":"picture-card","file-list":h(fe),"onUpdate:file-list":l[5]||(l[5]=e=>j(fe)?fe.value=e:fe=e),"on-preview":Fe,"on-remove":be,"on-success":je,"before-upload":Re,"http-request":Pe},{default:g((()=>[p(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),v(i,null,{default:g((()=>[v(h(P))])),_:1})])),_:1},8,["file-list"])])),_:1})):p("v-if",!0),p(" 上传Logo "),3===h(ge).ruleForm.type||2===h(ge).ruleForm.type?(c(),F(a,{key:3,class:"self-el-form-item",label:"上传Logo:",prop:"url"},{default:g((()=>[v(s,{class:"avatar-uploader",name:"logo_url",action:"","list-type":"picture-card","file-list":h(ce),"onUpdate:file-list":l[6]||(l[6]=e=>j(ce)?ce.value=e:ce=e),"on-preview":Fe,"on-remove":be,"on-success":Ve,"before-upload":ke,"http-request":Pe},{default:g((()=>[p(' <img v-if="state.ruleForm.url" :src="state.ruleForm.url" :preview-src-list="[state.ruleForm.url]" class="avatar" />\n            <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon> '),v(i,null,{default:g((()=>[v(h(P))])),_:1})])),_:1},8,["file-list"])])),_:1})):p("v-if",!0),p(" 标题 "),3===h(ge).ruleForm.type||2===h(ge).ruleForm.type?(c(),F(a,{key:4,class:"self-el-form-item",label:"标题:",prop:"title"},{default:g((()=>[v(t,{modelValue:h(ge).ruleForm.title,"onUpdate:modelValue":l[7]||(l[7]=e=>h(ge).ruleForm.title=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):p("v-if",!0),p(" 正文 "),3===h(ge).ruleForm.type||2===h(ge).ruleForm.type?(c(),F(a,{key:5,class:"self-el-form-item",label:"正文:",prop:"main_body"},{default:g((()=>[v(t,{modelValue:h(ge).ruleForm.main_body,"onUpdate:modelValue":l[8]||(l[8]=e=>h(ge).ruleForm.main_body=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):p("v-if",!0),p(" 行动号召 "),3===h(ge).ruleForm.type?(c(),F(a,{key:6,class:"self-el-form-item",label:"行动号召:",prop:"actions"},{default:g((()=>[v(t,{modelValue:h(ge).ruleForm.actions,"onUpdate:modelValue":l[9]||(l[9]=e=>h(ge).ruleForm.actions=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):p("v-if",!0),p(" 品牌 "),3===h(ge).ruleForm.type?(c(),F(a,{key:7,class:"self-el-form-item",label:"品牌:",prop:"brand"},{default:g((()=>[v(t,{modelValue:h(ge).ruleForm.brand,"onUpdate:modelValue":l[10]||(l[10]=e=>h(ge).ruleForm.brand=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1})):p("v-if",!0)])])),_:1},8,["rules","model","disabled"]),p(" form "),p(" footer "),_("div",ee,[v(d,{type:"primary",onClick:he},{default:g((()=>[le])),_:1}),v(d,{type:"primary",onClick:we},{default:g((()=>[te])),_:1})]),p(" 图片预览 "),v(n,{modelValue:se.value,"onUpdate:modelValue":l[11]||(l[11]=e=>se.value=e)},{default:g((()=>[_("div",ae,["image"===ie.value?(c(),f("img",{key:0,"w-full":"",src:Q.value,alt:"Preview Image"},null,8,oe)):p("v-if",!0),"video"===ie.value?(c(),f("video",{key:1,"w-full":"",src:Q.value,alt:"Preview Video",controls:""},null,8,re)):p("v-if",!0)])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0b7edd8c"]]);export{ie as default};
