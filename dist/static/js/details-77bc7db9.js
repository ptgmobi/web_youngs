var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,t=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,r=(e,r)=>{for(var s in r||(r={}))a.call(r,s)&&t(e,s,r[s]);if(l)for(var s of l(r))o.call(r,s)&&t(e,s,r[s]);return e};import{d as s,h as d,r as i,I as u,L as m,q as n,o as p,c as f,z as c,e as _,s as b,v as g,x as v,P as y,N as F,O as h,A as V,y as w,f as j,g as x}from"./main-f5fc11c6.js";import{s as z,A as U,a as q}from"./dsp-common-a86c9ff4.js";import{h as k,i as O,j as $,e as P,f as C}from"./dsp-campaign-14e24a60.js";import{m as D}from"./message-63eca02f.js";import{_ as I}from"./index-5d1349db.js";import{u as A}from"./useUtils-e29f5423.js";import{d as L,e as M,i as N}from"./new-format-35937e70.js";import{_ as S}from"./lodash-d099a0b1.js";const E={class:"content-con from-one flex column"},R={class:"content-con from-one flex column"},B={class:"w100 flex jc-between ai-start"},G={class:"w100 flex"},H=j(" 确认 "),J=j(" 取消 "),K=s({setup(e){const{audit_status:l,feeds_num:a,dsp_category_id:o,creative_goals:t}=z,{getRouterData:s,getCommonCountryList:j,goNewUrl:K}=A();let{proxy:Q}=x();const T="此项必填";let W=d("create");d([]);const X={id:void 0,name:"",descs:"",size:"",feeds_num:void 0,dsp_category_id:void 0,creative_goals:"",follow_template_id:void 0,audit_status:3,is_del:1},Y=i({ruleForm:X,rules:{name:[{required:!0,message:T,trigger:["blur","change"]}],size:[{required:!0,message:T,trigger:["blur","change"]}],feeds_num:[{required:!0,message:T,trigger:["blur","change"]}],dsp_category_id:[{required:!0,message:T,trigger:["blur","change"]}],creative_goals:[{required:!0,message:T,trigger:["blur","change"]}],follow_template_id:[{required:!0,message:T,trigger:["blur","change"]}]},options:{audit_status:l,size:[],feeds_num:a,category:[],creative_goals:t,dpa_tpl:[],dpa:[]}}),Z=()=>{Q.$refs.ruleForm.validate((e=>{if(!e)return!1;ae()}))},ee=["id","feeds_num","dsp_category_id","follow_template_id","audit_status","is_del"],le=["country"],ae=async()=>{let e=y(Y.ruleForm);if(e=L(e),e=M(e,ee),e=N(e,le),W.value,"create"===W.value){delete e.id;const l=await k(e);D(l)&&oe()}if("edit"===W.value){const l=await O(e);D(l)&&oe()}},oe=()=>{K({url:"/campaign/dpa/list"})},te=u((()=>{Y.options.dpa_tpl.map((e=>(Y.options.dpa.map((l=>{e.id===l.follow_template_id&&(e.id,e.disabled=!0)})),e))),Y.options.dpa_tpl})),re=()=>{var e,l;let{query:a,params:o}=s();if(W.value=null!=(l=null==(e=a.type)?void 0:e.toString())?l:"",W.value,(async()=>{Promise.all([P({limit:1e4,page:1}),C(),U(),q()]).then((e=>{Y.options.dpa=e[0].data.data;let l=e[1].data.data;Y.options.dpa_tpl=l.map((e=>(e.value=e.id,e.label=`${e.format}_${e.tpl_type}`,e.url=`https://staticdn.cloudmobi.net/dpa/demo/${e.format}_${e.tpl_type}_bg.png`,e.disabled=!1,e)));let a=e[2].data;Y.options.category=a.map((e=>(e.value=e.id,e.label=`${e.cn}-${e.en}`,e)));let o=e[3].data;Y.options.size=o.map((e=>(e.value=e.size,e.label=e.size,e)))}))})(),"create"===W.value&&(Y.ruleForm=S.cloneDeep(X)),"edit"===W.value){const{id:e}=o;(async e=>{const l=await $(e),{data:a}=l;Y.ruleForm=r(r({},Y.ruleForm),a),Y.ruleForm})(e)}};return m((()=>{re()})),(e,l)=>{const a=n("el-input"),o=n("el-form-item"),t=n("el-option"),r=n("el-select"),s=n("el-form"),d=n("el-button");return p(),f("div",null,[c(" form "),_(s,{ref:"ruleForm",enctype:"multipart/form-data",rules:g(Y).rules,model:g(Y).ruleForm,"label-width":"150px","label-position":"right",class:"flex column",disabled:"edit"===g(W)&&2===g(Y).ruleForm.is_del},{default:b((()=>[_(g(I),{title:"基础信息"}),v("div",E,[c(" 模板名称 "),_(o,{class:"self-el-form-item",label:"模板名称:",prop:"name"},{default:b((()=>[_(a,{modelValue:g(Y).ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>g(Y).ruleForm.name=e),modelModifiers:{trim:!0},class:"form-one",placeholder:""},null,8,["modelValue"])])),_:1}),c(" 描述 "),_(o,{class:"self-el-form-item",label:"描述:",prop:"descs"},{default:b((()=>[_(a,{modelValue:g(Y).ruleForm.descs,"onUpdate:modelValue":l[1]||(l[1]=e=>g(Y).ruleForm.descs=e),modelModifiers:{trim:!0},class:"form-one",placeholder:"",type:"textarea"},null,8,["modelValue"])])),_:1}),c(" 适配尺寸 "),_(o,{class:"self-el-form-item",label:"适配尺寸:",prop:"size"},{default:b((()=>[_(r,{modelValue:g(Y).ruleForm.size,"onUpdate:modelValue":l[2]||(l[2]=e=>g(Y).ruleForm.size=e),filterable:"",placeholder:"请选择",class:"form-one"},{default:b((()=>[(p(!0),f(F,null,h(g(Y).options.size,(e=>(p(),V(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(" Feeds个数 "),_(o,{class:"self-el-form-item",label:"Feeds个数:",prop:"feeds_num"},{default:b((()=>[_(r,{modelValue:g(Y).ruleForm.feeds_num,"onUpdate:modelValue":l[3]||(l[3]=e=>g(Y).ruleForm.feeds_num=e),filterable:"",placeholder:"请选择",class:"form-one"},{default:b((()=>[(p(!0),f(F,null,h(g(Y).options.feeds_num,(e=>(p(),V(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(" 适用商品 "),_(o,{class:"self-el-form-item",label:"适用商品:",prop:"dsp_category_id"},{default:b((()=>[_(r,{modelValue:g(Y).ruleForm.dsp_category_id,"onUpdate:modelValue":l[4]||(l[4]=e=>g(Y).ruleForm.dsp_category_id=e),filterable:"",placeholder:"请选择",class:"form-one"},{default:b((()=>[(p(!0),f(F,null,h(g(Y).options.category,(e=>(p(),V(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(" 创意目标 "),_(o,{class:"self-el-form-item",label:"创意目标:",prop:"creative_goals"},{default:b((()=>[_(r,{modelValue:g(Y).ruleForm.creative_goals,"onUpdate:modelValue":l[5]||(l[5]=e=>g(Y).ruleForm.creative_goals=e),filterable:"",placeholder:"请选择",class:"form-one"},{default:b((()=>[(p(!0),f(F,null,h(g(Y).options.creative_goals,(e=>(p(),V(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),_(g(I),{title:"模板内容"}),v("div",R,[c(" 关联模板ID "),_(o,{class:"self-el-form-item",label:"关联模板ID:",prop:"follow_template_id"},{default:b((()=>[_(r,{modelValue:g(Y).ruleForm.follow_template_id,"onUpdate:modelValue":l[6]||(l[6]=e=>g(Y).ruleForm.follow_template_id=e),filterable:"",placeholder:"请选择",class:"form-one",disabled:"create"!==g(W)},{default:b((()=>[(p(!0),f(F,null,h(g(te),(e=>(p(),V(t,{key:e.value,label:e.label,value:e.value,disabled:e.disable},{default:b((()=>[v("div",B,[v("span",null,w(e.label),1),c(' <div class="img-box">\n                  <img :src="item.url" alt="">\n                </div> ')])])),_:2},1032,["label","value","disabled"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})])])),_:1},8,["rules","model","disabled"]),c(" form "),c(" footer "),v("div",G,[_(d,{type:"primary",onClick:Z},{default:b((()=>[H])),_:1}),_(d,{type:"primary",onClick:oe},{default:b((()=>[J])),_:1})])])}}});export{K as default};
