import{d as a,r as e,M as l,N as t,m as s,s as n,n as o,v as r,c as d,p as u,O as c,P as i,A as p,z as m,b,Q as f,_ as v,w as y,x as h,q as _,G as g,H as x,I as j}from"./index-b160a4d6.js";import{f as w,h as V,i as D,j as k}from"./overview-e30e7450.js";import{g as A,a as C,t as P}from"./format-75dc684c.js";import{_ as S}from"./lodash-ad752a46.js";import{h as U}from"./new-format-f712eb45.js";import{_ as M}from"./index-2ea29ab0.js";import{W as O}from"./index-910d5050.js";import"./moment-56f006b0.js";const Y={class:"white-bg control-box flex jc-between ai-start p0-0"},N={class:"flex jc-start flex-wrap ai-start"},E={class:"flex"},q=b(" 查询 "),I=a({__name:"search",emits:["emitParent"],setup(a,{emit:b}){const v={adtype:"",channel_type:"",user_name:"",slot:"",country:"",date:A(6,"day")},y=e({shortcuts:[{text:"今天",value:A(0,"day")},{text:"昨天",value:()=>C(1,1,"day")},{text:"最近7天",value:()=>A(6,"day")},{text:"最近30天",value:()=>A(29,"day")}],options:{adtype:["ssp","fenix"],channel_type:[{value:1,label:"代理"},{value:2,label:"API"},{value:3,label:"直客"}],country:[{value:"",label:""}],user_name:[{label:"",value:""}],slot:[{value:"",label:""}]},data:v}),h=async()=>{const{data:a}=await w();y.options.user_name=null==a?void 0:a.user_name,y.options.slot=null==a?void 0:a.slot,y.options.country=null==a?void 0:a.country},_=()=>{},g=()=>{console.warn("set search data"),b("emitParent",S.cloneDeep(f(y.data)))};return l((()=>{h(),g()})),t((()=>{h(),g()})),(a,e)=>{const l=s("el-date-picker"),t=s("el-form-item"),b=s("el-option"),f=s("el-select"),v=s("el-button"),h=s("el-form");return n(),o("div",null,[r("div",Y,[d(h,{inline:!0,model:y.data,class:"flex jc-between ai-start w100"},{default:u((()=>[r("div",N,[d(t,{label:"日期选择"},{default:u((()=>[d(l,{modelValue:y.data.date,"onUpdate:modelValue":e[0]||(e[0]=a=>y.data.date=a),class:"search-con",type:"daterange","unlink-panels":"",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:y.shortcuts,clearable:!1},null,8,["modelValue","shortcuts"])])),_:1}),d(t,{label:"分成方法"},{default:u((()=>[d(f,{modelValue:y.data.adtype,"onUpdate:modelValue":e[1]||(e[1]=a=>y.data.adtype=a),class:"search-con",clearable:"",placeholder:"搜索",onChange:_},{default:u((()=>[(n(!0),o(c,null,i(y.options.adtype,(a=>(n(),p(b,{key:a,label:a,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(t,{label:"业务类型"},{default:u((()=>[d(f,{modelValue:y.data.channel_type,"onUpdate:modelValue":e[2]||(e[2]=a=>y.data.channel_type=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:_},{default:u((()=>[m(' <div class="flex jc-between p10 pt-0">\n                <el-button type="primary" plain size="mini" @click="selectAllProduct()">全选</el-button>\n                <el-button size="mini" type="danger" plain @click="unSelectedAllProduct()">清空</el-button>\n              </div> '),(n(!0),o(c,null,i(y.options.channel_type,((a,e)=>(n(),p(b,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(t,{label:"User Name"},{default:u((()=>[d(f,{modelValue:y.data.user_name,"onUpdate:modelValue":e[3]||(e[3]=a=>y.data.user_name=a),class:"search-con",clearable:"",placeholder:"搜索",filterable:"",onChange:_},{default:u((()=>[(n(!0),o(c,null,i(y.options.user_name,((a,e)=>(n(),p(b,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(t,{label:"Slot"},{default:u((()=>[d(f,{modelValue:y.data.slot,"onUpdate:modelValue":e[4]||(e[4]=a=>y.data.slot=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:_},{default:u((()=>[(n(!0),o(c,null,i(y.options.slot,((a,e)=>(n(),p(b,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(t,{label:"国家"},{default:u((()=>[d(f,{modelValue:y.data.country,"onUpdate:modelValue":e[5]||(e[5]=a=>y.data.country=a),class:"search-con",clearable:"",placeholder:"搜索","collapse-tags":"",filterable:"",onChange:_},{default:u((()=>[(n(!0),o(c,null,i(y.options.country,((a,e)=>(n(),p(b,{key:a.toString(),label:a.toString(),value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),r("div",null,[r("div",E,[d(v,{type:"primary",onClick:g},{default:u((()=>[q])),_:1})])])])),_:1},8,["model"])])])}}});const z=a=>(g("data-v-422fd230"),a=a(),x(),a),G={class:"flex flex-wrap jc-between"},H={class:"flex jc-between"},R={key:0,class:"color_primary"},$=z((()=>r("span",{class:"small_icon"},"$",-1))),L={key:1,class:"color_primary"},Q=z((()=>r("span",{class:"small_icon"},"%",-1)));var T=v(a({__name:"card",props:{json:{require:!0,default:{},type:Object}},setup(a){const t=e({baseData:a.json,data:{},titleMap:{profit:"毛利合计",revenue:"收入合计",cost:"支出合计",profit_rate:"毛利率"},groupVal:["profit","revenue","cost"],groupRate:["profit_rate"]});return y((()=>t.baseData),((a,e)=>{console.warn("get card data"),(async()=>{let a={...t.baseData.data};a=U(a);const{data:e}=await V(a);if(Array.isArray(e)&&0!==e.length)t.data=e[0];else for(const l in t.data)Object.prototype.hasOwnProperty.call(t.data,l)&&(t.data[l]=0)})()}),{deep:!0}),l((()=>{})),(a,e)=>{const l=s("el-card");return n(),o("div",null,[r("div",G,[(n(!0),o(c,null,i(t.titleMap,((a,e)=>(n(),p(l,{class:"box-card m10"},{default:u((()=>[r("div",H,[r("h3",null,h(t.titleMap[e]),1),t.groupVal.includes(e)?(n(),o("h2",R,[$,b(" "+h(t.data[e]),1)])):m("v-if",!0),t.groupRate.includes(e)?(n(),o("h2",L,[b(h(_(P)(100*t.data[e]))+" ",1),Q])):m("v-if",!0)])])),_:2},1024)))),256))])])}}}),[["__scopeId","data-v-422fd230"]]);const W=a({__name:"chart",props:{json:{require:!0,default:{},type:Object}},setup(a){const l=a,t=e({data:{target:"cost"},options:{target:[{value:"profit",label:"毛利"},{value:"revenue",label:"收入"},{value:"cost",label:"支出"},{value:"profit_rate",label:"毛利率"}]}}),m=e({data:l.json,baseCharData:{},chartData:{tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{show:!0,backgroundColor:"#6a7985"}}},legend:{show:!0,data:["all"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"",type:"line",stack:"Total",emphasis:{focus:"series"},data:[]}]}});y((()=>m.data),((a,e)=>{console.warn("get chart data"),g()}),{deep:!0});const b=()=>{var a;let e=t.options.target.find((a=>a.value===t.data.target));return null!=(a=null==e?void 0:e.label)?a:""},f=["6"],v=()=>{h()},h=()=>{var a;let e=t.data.target,l=null!=(a=m.baseCharData[e])?a:[];if(f.includes(t.data.target.toString())){let a=l.map((a=>P(100*a,2)));m.chartData.series[0].data=a}else{let a=l.map((a=>P(a,2)));m.chartData.series[0].data=a}m.chartData.series[0].name=b()},g=async()=>{var a;let e={...m.data.data};e=U(e),m.chartData.xAxis[0].data=[],m.chartData.series[0].data=[];const{data:l}=await D(e);m.baseCharData=l,m.chartData.xAxis[0].data=null!=(a=null==l?void 0:l.date)?a:[],m.chartData.series[0].name=b(),h()};return(a,e)=>{const l=s("el-option"),b=s("el-select"),f=s("el-form-item"),y=s("el-form");return n(),o("div",null,[r("div",null,[d(y,{inline:!0,model:t.data,class:"flex jc-between w100"},{default:u((()=>[d(f,{label:"指标"},{default:u((()=>[d(b,{modelValue:t.data.target,"onUpdate:modelValue":e[0]||(e[0]=a=>t.data.target=a),placeholder:"Select",onChange:v},{default:u((()=>[(n(!0),o(c,null,i(t.options.target,(a=>(n(),p(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])]),r("div",null,[d(_(M),{"chart-data":m.chartData},null,8,["chart-data"])])])}}}),B={class:"mt-20"},F={class:"flex jc-end mb-10"},J=a({__name:"table",props:{json:{require:!0,default:{},type:Object}},setup(a){let l=e({data:a.json,list:[],exportExcel:{buttonName:"导出",tHeader:["日期"],filterVal:["date"],fileName:"profit"}}),t=e([{value:"user_id",label:"User ID"},{value:"account_email",label:"Account Email"},{value:"user_name",label:"User Name"},{value:"profit",label:"毛利"},{value:"revenue",label:"收入"},{value:"cost",label:"支出"},{value:"profit_rate",label:"毛利率"}]);y((()=>l.data),((a,e)=>{console.warn("get table data"),b()}),{deep:!0});const b=async()=>{let a={...l.data.data};a=U(a),l.list=[];const{data:e}=await k(a);l.list=e};let f=["profit_rate"],v=j((()=>{let a=[];return l.list.map((e=>{let l={},t={...e};for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)){const e=t[a];f.includes(a)?l[a]=`${P(100*e,2)}%`:l[a]=e}a.push(l)})),a}));const h=j((()=>t.map((a=>a.label)))),g=j((()=>t.map((a=>a.value))));return(a,e)=>{const b=s("el-table-column"),f=s("el-table");return n(),o("div",B,[r("div",F,[d(O,{"button-name":_(l).exportExcel.buttonName,list:_(v),"t-header":_(h),"filter-val":_(g),filename:_(l).exportExcel.fileName},null,8,["button-name","list","t-header","filter-val","filename"])]),m(" table "),d(f,{center:"",data:_(v),class:"w100",border:""},{default:u((()=>[(n(!0),o(c,null,i(_(t),(a=>{var e;return n(),p(b,{key:a.value,prop:a.value,label:a.label,fixed:null!=(e=null==a?void 0:a.fixed)&&e,align:"center"},null,8,["prop","label","fixed"])})),128))])),_:1},8,["data"])])}}}),K={class:"app-container"},X=a({name:"Profit"}),Z=a({...X,setup(a){let l=e({data:{adtype:"",channel_type:"",user_name:"",slot:"",country:"",st:"",et:""}});const t=a=>{l.data.adtype=a.adtype,l.data.channel_type=a.channel_type,l.data.user_name=a.user_name,l.data.slot=a.slot,l.data.country=a.country,l.data.st=a.date[0],l.data.et=a.date[1]};return(a,e)=>(n(),o("div",K,[d(_(I),{onEmitParent:t}),d(_(T),{json:_(l)},null,8,["json"]),d(_(W),{json:_(l)},null,8,["json"]),d(_(J),{json:_(l)},null,8,["json"])]))}});export{Z as default};
