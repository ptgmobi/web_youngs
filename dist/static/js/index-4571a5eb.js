var z=Object.defineProperty;var A=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var U=(a,e,u)=>e in a?z(a,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[e]=u,F=(a,e)=>{for(var u in e||(e={}))N.call(e,u)&&U(a,u,e[u]);if(A)for(var u of A(e))Q.call(e,u)&&U(a,u,e[u]);return a};import{ai as q,u as L,r as c,k as w,i as p,x as l,h as i,v as C,c as m,N as W,O as M,o as n,F as y,l as v,y as r,t as f}from"./vendor-f1931894.js";import{w as I,g as G,a as J,b as H}from"./product-8329438d.js";import{P as K}from"./index-fc37c9ae.js";import{P as X,g as Y,a as Z,s as $,b as ee,c as te,d as ae}from"./WwChangePass-767c0db6.js";import{g as se}from"./role-5957dd93.js";import{g as le}from"./station-0370b615.js";import{m as j}from"./message-c1123ca0.js";import{_ as ie,v as oe}from"./index-819d7207.js";import{_ as E}from"./lodash-43532635.js";import{m as ue}from"./self-f44b0ce3.js";const S={email:"",username:"",password:"",password_re:"",comment:"",position_id:[],position_ischange:!1,role_id:[],role_ischange:!1,project_id:[],project_ischange:!1,product_id:[],product_ischange:!1,status:1},ne={components:{Pagination:K,WwChangePass:X},directives:{waves:I},filters:{handlePositions(a){}},mixins:[ue],data(){const a=(d,s,o)=>{s===""?o(new Error("\u8BF7\u8F93\u5165\u90AE\u7BB1")):oe(s)?o():o(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u683C\u5F0F"))},e=(d,s,o)=>{s===""?o(new Error("\u8BF7\u8F93\u5165\u5BC6\u7801")):(this.busData.data.password_re!==""&&this.$refs.ruleForm.validateField("password_re"),o())},u=(d,s,o)=>{s===""?o(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801")):s!==this.busData.data.password?o(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!")):o()};return{dialogVisiblePass:!1,dialogVisible:!1,dialogType:"new",busData:{options:{position:[],role:[],project:[],product:[],productArr:[]},oldData:{},data:E.cloneDeep(S),rules:{email:[{required:!0,message:"\u5FC5\u586B",trigger:["change","blur"]},{validator:a}],username:[{required:!0,message:"\u5FC5\u586B",trigger:["change","blur"]},{min:6,max:50,message:"\u957F\u5EA6\u5728 6 \u5230 50 \u4E2A\u5B57\u7B26",trigger:"blur"}],password:[{required:!0,message:"\u5FC5\u586B",trigger:["change","blur"]},{min:8,max:16,message:"\u957F\u5EA6\u5728 8 \u5230 16 \u4E2A\u5B57\u7B26",trigger:"blur"},{validator:e}],password_re:[{required:!0,message:"\u5FC5\u586B",trigger:["change","blur"]},{min:8,max:16,message:"\u957F\u5EA6\u5728 8 \u5230 16 \u4E2A\u5B57\u7B26",trigger:"blur"},{validator:u}],comment:[{required:!1,message:"\u5FC5\u586B",trigger:["change","blur"]}],role_id:[{required:!1,message:"\u5FC5\u586B",trigger:["change","blur"]}],position_id:[{required:!0,message:"\u5FC5\u586B",trigger:["change","blur"]}]}},control:{search:""},list:[],pagination:{pageSizes:["10","20","40","100"],total:1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"}}}},computed:F({},q(["rolesMap","element"])),watch:{"busData.data.project":{handler(a,e){console.log(a)},immediate:!1}},created(){this.getConfig(),this.init();const a=L();console.log(a.getters.element)},methods:{handleProjectFn(a){return this.busData.options.project.filter(u=>a.includes(u.id))},changeUserStatus(a,e){console.log(a,e)},async getConfig(){const{data:a}=await G();this.busData.options.project=a;const e={name:"",page:1,limit:999,project_id:"",order:"desc"},{data:u}=await J(e);this.busData.options.productArr=u;const{data:d}=await le();this.busData.options.position=d;const{data:s}=await se();this.busData.options.role=s},init(){this.getList()},getUserProject(a){return a&&this.busData.options.project.filter(e=>a.includes(Number(e.id))).map(e=>e.name).join(",")},getUserProduct(a){return a&&this.busData.options.productArr.filter(e=>a.includes(Number(e.id))).map(e=>e.name).join(",")},getUserPosition(a){return a&&this.busData.options.position.filter(e=>a.includes(e.id)).map(e=>e.name).join(",")},async getList(){const a={username:this.control.search,page:this.pagination.listQuery.page,limit:this.pagination.listQuery.limit},{data:e}=await Y(a);this.list=e.data,this.pagination.total=e.paging.count},handleSearch(){this.pagination.listQuery.page=1,this.getList()},handleCreate(){this.dialogType="new",this.dialogVisible=!0,this.clearBusData()},async handleEdit(a){this.dialogType="edit",this.dialogVisible=!0,this.clearBusData(),this.busData.data.id=a.row.id;const{data:e}=await Z(this.busData.data.id);this.busData.oldData=E.cloneDeep(e);const u=E.cloneDeep(e);this.busData.data=F(F(F({},this.busData.data),u),u.user),this.choiceProject()},confirmFun(a){this.$refs[a].validate(e=>{if(e)console.log("submit!"),this.handleSubmitFn();else return console.log("error submit!!"),!1})},async handleSubmitFn(){if(this.dialogType==="new"){const a=E.cloneDeep(this.busData.data),e=await $(a).catch(u=>{console.log(u);const{data:{data:d}}=u;for(const s in d)if(Object.hasOwnProperty.call(d,s)){const o=d[s];this.$message.error(o)}});e&&(j(e),this.getList(),this.clearBusData(),this.dialogVisible=!1)}if(this.dialogType==="edit"){const a=E.cloneDeep(this.busData.data),e=await ee(this.busData.data.id,a);e&&(j(e),this.clearBusData(),this.dialogVisible=!1)}},handleDelete(a){this.$confirm("\u786E\u5B9A\u5220\u9664?","\u8B66\u544A",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{this.list.splice(a.$index,1),this.$message({type:"success",message:"Delete succed!"})}).catch(e=>{console.error(e)})},clearBusData(){this.busData.data=E.cloneDeep(S),this.busData.oldData={},this.$nextTick(()=>{this.$refs.ruleForm.clearValidate()})},async changeStatus(a,e){const u={id:e.id,status:e.status},d=await te(e.id,u);j(d)},handleEditPass(a){this.dialogVisiblePass=!0,this.busData.data.id=a.row.id},cancelPass(a){this.dialogVisiblePass=!1},async confirmPass(a){const e={id:this.busData.data.id,password:a.pass,password_re:a.checkPass},u=await ae(this.busData.data.id,e);j(u),this.dialogVisiblePass=!1},selectChangeFn(a){this.busData.data[`${a}_ischange`]=!0},async choiceProject(){console.log(this.busData.data);let a=[];this.busData.data.project_id&&(a=[...this.busData.data.project_id]);const e=[];if(a.length!==0){await Promise.all(a.map(async d=>{const{data:s}=await H(d);return s.product_id.length!==0&&s.product_id.forEach(o=>{e.push(o)}),d}));const u=Array.from(new Set(e));this.busData.options.product=this.handleProductsFn(u)}},handleProductsFn(a){const e=[];return this.busData.options.productArr.map(u=>{a.includes(u.id)&&e.push(u)}),e},unSelectedAll(){this.busData.data.product_id=[],this.busData.data.product_ischange=!0},selectAll(){const a=[];this.busData.options.product.map(e=>{a.push(e.id)}),this.busData.data.product_id=a,this.busData.data.product_ischange=!0}}},re={class:"app-container"},de=r(" \u5168\u9009 "),pe=r(" \u6E05\u7A7A "),ce={style:{"text-align":"right"}},me=r(" \u53D6\u6D88 "),ge=r(" \u786E\u5B9A "),he={class:"w100 control-box flex jc-end"},be={class:"flex flex-end"},fe=r(" \u641C\u7D22 "),De=r(" \u6DFB\u52A0\u7528\u6237 "),_e={class:"flex"},we=r(" \u4FEE\u6539 "),Ee=r(" \u4FEE\u6539\u5BC6\u7801 "),Fe=r(" \u5220\u9664 "),Ce={class:"w100 flex"};function ye(a,e,u,d,s,o){const D=c("el-input"),g=c("el-form-item"),B=c("el-option"),V=c("el-select"),h=c("el-button"),x=c("el-form"),P=c("el-dialog"),k=c("ww-change-pass"),b=c("el-table-column"),T=c("el-switch"),R=c("el-table"),O=c("pagination");return n(),w("div",re,[p(" dialog "),l(P,{modelValue:s.dialogVisible,"onUpdate:modelValue":e[17]||(e[17]=t=>s.dialogVisible=t),title:s.dialogType==="edit"?"Edit User":"New User",width:"80%"},{default:i(()=>[l(x,{ref:"ruleForm",model:s.busData.data,rules:s.busData.rules,"label-width":"150px","label-position":"left"},{default:i(()=>[l(g,{label:"\u90AE\u7BB1",prop:"email"},{default:i(()=>[l(D,{modelValue:s.busData.data.email,"onUpdate:modelValue":e[0]||(e[0]=t=>s.busData.data.email=t),placeholder:"\u90AE\u7BB1",disabled:s.dialogType==="edit"},null,8,["modelValue","disabled"])]),_:1}),l(g,{label:"\u7528\u6237\u540D",prop:"username"},{default:i(()=>[l(D,{modelValue:s.busData.data.username,"onUpdate:modelValue":e[1]||(e[1]=t=>s.busData.data.username=t),placeholder:"\u7528\u6237\u540D\u5FC5\u987B\u5927\u4E8E6\u4F4D"},null,8,["modelValue"])]),_:1}),s.dialogType==="new"?(n(),w(y,{key:0},[l(g,{label:"\u5BC6\u7801",prop:"password",autocomplete:"off"},{default:i(()=>[l(D,{modelValue:s.busData.data.password,"onUpdate:modelValue":e[2]||(e[2]=t=>s.busData.data.password=t),type:"password",placeholder:""},null,8,["modelValue"])]),_:1}),l(g,{label:"\u518D\u6B21\u8F93\u5165\u5BC6\u7801",prop:"password_re",autocomplete:"off"},{default:i(()=>[l(D,{modelValue:s.busData.data.password_re,"onUpdate:modelValue":e[3]||(e[3]=t=>s.busData.data.password_re=t),type:"password",placeholder:""},null,8,["modelValue"])]),_:1})],64)):p("v-if",!0),l(g,{label:"\u63CF\u8FF0",prop:"comment"},{default:i(()=>[l(D,{modelValue:s.busData.data.comment,"onUpdate:modelValue":e[4]||(e[4]=t=>s.busData.data.comment=t),placeholder:"\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),l(g,{label:"\u5C97\u4F4D\u6743\u9650",prop:"position_id"},{default:i(()=>[l(V,{modelValue:s.busData.data.position_id,"onUpdate:modelValue":e[5]||(e[5]=t=>s.busData.data.position_id=t),filterable:"",multiple:"",class:"w100",placeholder:"\u5C97\u4F4D\u6743\u9650",disabled:!a.judgePermissionElementFn("A-AU-USER-FORM-POSITION-C"),onChange:e[6]||(e[6]=t=>o.selectChangeFn("position"))},{default:i(()=>[(n(!0),w(y,null,v(s.busData.options.position,t=>(n(),m(B,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(g,{label:"\u89D2\u8272\u6743\u9650",prop:"role_id"},{default:i(()=>[l(V,{modelValue:s.busData.data.role_id,"onUpdate:modelValue":e[7]||(e[7]=t=>s.busData.data.role_id=t),filterable:"",multiple:"",class:"w100",placeholder:"\u89D2\u8272\u6743\u9650",disabled:!a.judgePermissionElementFn("A-AU-USER-FORM-ROLE-C"),onChange:e[8]||(e[8]=t=>o.selectChangeFn("role"))},{default:i(()=>[(n(!0),w(y,null,v(s.busData.options.role,t=>(n(),m(B,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(g,{label:"\u6240\u5C5E\u9879\u76EE\u7EC4",prop:"project_id"},{default:i(()=>[l(V,{modelValue:s.busData.data.project_id,"onUpdate:modelValue":e[9]||(e[9]=t=>s.busData.data.project_id=t),filterable:"",multiple:"",class:"w100",placeholder:"\u6240\u5C5E\u9879\u76EE\u7EC4",disabled:!a.judgePermissionElementFn("A-AU-USER-FORM-PROJECT-C"),onChange:e[10]||(e[10]=t=>(o.selectChangeFn("project"),o.choiceProject()))},{default:i(()=>[(n(!0),w(y,null,v(s.busData.options.project,t=>(n(),m(B,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(g,{label:"\u53EF\u67E5\u770B\u4EA7\u54C1",prop:"product_id"},{default:i(()=>[l(V,{modelValue:s.busData.data.product_id,"onUpdate:modelValue":e[13]||(e[13]=t=>s.busData.data.product_id=t),filterable:"",multiple:"",class:"w100",placeholder:"\u9ED8\u8BA4\u5168\u90E8",disabled:!a.judgePermissionElementFn("A-AU-USER-FORM-PRODUCT-C"),onChange:e[14]||(e[14]=t=>o.selectChangeFn("product"))},{default:i(()=>[l(h,{style:{float:"left","margin-left":"20px","z-index":"1"},type:"primary",plain:"",onClick:e[11]||(e[11]=t=>o.selectAll())},{default:i(()=>[de]),_:1}),l(h,{style:{float:"right","margin-right":"20px","z-index":"1"},type:"danger",plain:"",onClick:e[12]||(e[12]=t=>o.unSelectedAll())},{default:i(()=>[pe]),_:1}),(n(!0),w(y,null,v(s.busData.options.product,t=>(n(),m(B,{key:t.id,label:t.name,value:t.id,style:{clear:"both"}},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","rules"]),C("div",ce,[l(h,{type:"danger",onClick:e[15]||(e[15]=t=>s.dialogVisible=!1)},{default:i(()=>[me]),_:1}),l(h,{type:"primary",onClick:e[16]||(e[16]=t=>o.confirmFun("ruleForm"))},{default:i(()=>[ge]),_:1})])]),_:1},8,["modelValue","title"]),p(" dialog "),p(" dialog "),l(P,{modelValue:s.dialogVisiblePass,"onUpdate:modelValue":e[18]||(e[18]=t=>s.dialogVisiblePass=t),title:"\u4FEE\u6539\u5BC6\u7801",width:"80%"},{default:i(()=>[s.dialogVisiblePass?(n(),m(k,{key:0,is_change:!1,"is-dialog":!0,onWwpassCancel:o.cancelPass,onWwpassConfirm:o.confirmPass},null,8,["onWwpassCancel","onWwpassConfirm"])):p("v-if",!0)]),_:1},8,["modelValue"]),p(" dialog "),C("div",he,[C("div",be,[p(` <el-input placeholder="\u8BF7\u8F93\u5165\u5185\u5BB9" v-model="control.search" class="input-with-select">
          <el-button type="primary" slot="append">\u641C\u7D22</el-button>
        </el-input> `),l(D,{modelValue:s.control.search,"onUpdate:modelValue":e[19]||(e[19]=t=>s.control.search=t),class:"mr-10",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"]),l(h,{type:"primary",onClick:o.handleSearch},{default:i(()=>[fe]),_:1},8,["onClick"]),a.judgePermissionElementFn("A-AU-USER-ADD-V")?(n(),m(h,{key:0,type:"primary",onClick:o.handleCreate},{default:i(()=>[De]),_:1},8,["onClick"])):p("v-if",!0)])]),l(R,{data:s.list,style:{width:"100%","margin-top":"30px"},border:""},{default:i(()=>[l(b,{align:"center",label:"\u90AE\u7BB1"},{default:i(t=>[r(f(t.row.email),1)]),_:1}),l(b,{align:"center",label:"\u7528\u6237\u540D"},{default:i(t=>[r(f(t.row.username),1)]),_:1}),l(b,{align:"center",label:"\u6240\u5C5E\u9879\u76EE\u7EC4"},{default:i(t=>[r(f(o.getUserProject(t.row.project_id)),1)]),_:1}),l(b,{align:"center",label:"\u7528\u6237\u6743\u9650"},{default:i(t=>[r(f(o.getUserPosition(t.row.position_id)),1)]),_:1}),l(b,{align:"center",label:"\u53EF\u67E5\u770B\u4EA7\u54C1"},{default:i(t=>[r(f(t.row.product_id),1)]),_:1}),l(b,{align:"center",label:"\u521B\u5EFA\u65E5\u671F"},{default:i(t=>[r(f(t.row.create_date),1)]),_:1}),l(b,{align:"center",label:"\u6700\u540E\u8BBF\u95EE\u65E5\u671F"},{default:i(t=>[r(f(t.row.update_date),1)]),_:1}),l(b,{align:"center",label:"\u7528\u6237\u72B6\u6001"},{default:i(t=>[a.judgePermissionElementFn("A-AU-USER-STATUS-V")?(n(),m(T,{key:0,modelValue:t.row.status,"onUpdate:modelValue":_=>t.row.status=_,"active-value":1,"inactive-value":2,onChange:_=>o.changeStatus(_,t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])):p("v-if",!0)]),_:1}),l(b,{align:"center",label:"\u64CD\u4F5C",width:"250"},{default:i(t=>[C("div",_e,[a.judgePermissionElementFn("A-AU-USER-EDIT-V")?(n(),m(h,{key:0,type:"primary",size:"small",onClick:_=>o.handleEdit(t)},{default:i(()=>[we]),_:2},1032,["onClick"])):p("v-if",!0),a.judgePermissionElementFn("A-AU-USER-PASS-V")?(n(),m(h,{key:1,type:"primary",size:"small",onClick:_=>o.handleEditPass(t)},{default:i(()=>[Ee]),_:2},1032,["onClick"])):p("v-if",!0),a.judgePermissionElementFn("A-AU-USER-DEL-V")?(n(),m(h,{key:2,type:"danger",size:"small",onClick:_=>o.handleDelete(t)},{default:i(()=>[Fe]),_:2},1032,["onClick"])):p("v-if",!0)])]),_:1})]),_:1},8,["data"]),p(" pagination "),C("div",Ce,[W(l(O,{page:s.pagination.listQuery.page,"onUpdate:page":e[20]||(e[20]=t=>s.pagination.listQuery.page=t),limit:s.pagination.listQuery.limit,"onUpdate:limit":e[21]||(e[21]=t=>s.pagination.listQuery.limit=t),total:s.pagination.total,"page-sizes":s.pagination.pageSizes,onPagination:o.init},null,8,["page","limit","total","page-sizes","onPagination"]),[[M,s.pagination.total]])])])}var Re=ie(ne,[["render",ye]]);export{Re as default};
