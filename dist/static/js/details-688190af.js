var he=Object.defineProperty;var te=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var re=(k,h,f)=>h in k?he(k,h,{enumerable:!0,configurable:!0,writable:!0,value:f}):k[h]=f,Y=(k,h)=>{for(var f in h||(h={}))Ve.call(h,f)&&re(k,f,h[f]);if(te)for(var f of te(h))we.call(h,f)&&re(k,f,h[f]);return k};import{d as Q,z as R,w as W,C as ae,r as m,o as b,k as $,v as i,x as l,h as a,F as z,l as I,c as L,j as t,i as _,y as O,a as N,b as M,al as xe,t as G,ae as X,q as ke,s as Ce,m as oe,f as Ee,ag as ue,ak as Ae,N as qe,J as Se,R as De}from"./vendor-f1931894.js";import{_ as se}from"./lodash-43532635.js";import{l as je,p as Be,q as $e,r as Ue,s as Oe,t as Pe,u as Le,v as Te,w as Re}from"./fenix-d95ec862.js";import{c as Ne}from"./clipboard-a08de50c.js";import{m as ze}from"./message-c1123ca0.js";import{b as ne,r as Ie}from"./new-format-4ed41873.js";import{_ as ie}from"./index-819d7207.js";const Me={class:"flex jc-end"},Ge=O(" Add "),Ke={class:"flex"},Je=O(" Copy "),Ze=Q({props:{list:{require:!0,default:()=>[],type:Array},offer:{require:!0,default:"",type:String}},emits:["kk","up"],setup(k,{emit:h}){const f=k,p=R({pub:[{id:"",pub_name:""}]}),C={"55527824":.1,"95108831":.1,"95846929":.005,"59845210":.005};let g=R({manage_traffic:[]});const j={pub:"",slotid:"",payout:void 0,cap_daily:void 0,pub_status:1,pub_tracking_link:""},P=()=>{g.manage_traffic.push(se.cloneDeep(j))},v=d=>{const s=d.$index;g.manage_traffic.splice(s,1)},E=d=>{const{row:s}=d,c="http://track.adsforward.com/api/track?offer={offer}&mid={slot}&pub_id={siteid}&gaid={gaid}&idfa={idfa}&click_id={clickid}&ip={ip}&ua={ua}&osv={osv}&lang={lang}";s.pub_tracking_link=c;const V=p.pub.find(D=>D.pub_name===s.pub);console.log(V),s.slotid=V.slot_id,s.pub_status=V.status,s.pub_tracking_link=c.replace("{offer}",f.offer).replace("{slot}",V.slot_id),C[V.slot_id]&&(s.payout=C[V.slot_id])},e=({row:d})=>{const{pub_tracking_link:s}=d;Ne(s)},S=({row:d})=>{console.log(d)},F=async()=>{console.log("traffic init");const{data:d}=await je();p.pub=d};return W(()=>f.list,(d,s)=>{g.manage_traffic=d},{immediate:!0,deep:!0}),W(()=>g.manage_traffic,(d,s)=>{},{immediate:!0,deep:!0}),ae(()=>{F(),P()}),(d,s)=>{const c=m("el-button"),V=m("el-option"),D=m("el-select"),U=m("el-table-column"),y=m("el-input"),T=m("el-switch"),K=m("el-table");return b(),$("div",null,[i("div",Me,[l(c,{type:"primary",onClick:P},{default:a(()=>[Ge]),_:1})]),l(K,{class:"mt-10",data:t(g).manage_traffic,style:{width:"100%"},border:""},{default:a(()=>[l(U,{label:"Pub Name",align:"center"},{default:a(w=>[l(D,{modelValue:w.row.pub,"onUpdate:modelValue":x=>w.row.pub=x,filterable:"",clearable:"",placeholder:"",onChange:x=>E(w)},{default:a(()=>[(b(!0),$(z,null,I(t(p).pub,x=>{var J;return b(),L(V,{key:x.id,label:x.pub_name,value:(J=x.pub_name)!=null?J:x.id},null,8,["label","value"])}),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(U,{label:"Payout",align:"center"},{default:a(w=>[l(y,{modelValue:w.row.payout,"onUpdate:modelValue":x=>w.row.payout=x,type:"number",min:"0",step:"0.001",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(U,{label:"Cap Daily",align:"center"},{default:a(w=>[l(y,{modelValue:w.row.cap_daily,"onUpdate:modelValue":x=>w.row.cap_daily=x,type:"number",min:"0",step:"0.001",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(U,{label:"Operation",align:"center",width:"180px"},{default:a(w=>[i("div",Ke,[l(c,{class:"mr-10",type:"danger",icon:"Delete",circle:"",onClick:x=>v(w)},null,8,["onClick"]),l(T,{modelValue:w.row.pub_status,"onUpdate:modelValue":x=>w.row.pub_status=x,"active-value":1,"inactive-value":2,class:"mr-10",onChange:x=>S(w)},null,8,["modelValue","onUpdate:modelValue","onChange"]),w.row.pub_tracking_link?(b(),L(c,{key:0,class:"cp",type:"primary",onClick:x=>e(w)},{default:a(()=>[Je]),_:2},1032,["onClick"])):_("v-if",!0)])]),_:1})]),_:1},8,["data"])])}}}),He={class:"w100"},Qe={class:"content-con flex column"},We={class:"flex jc-start ai-center form-one"},Xe={class:"w100 flex mt-10"},Ye=O("Save"),el=Q({emits:["update:visible","uploadData"],setup(k,{emit:h}){const f=N(),p=/^[0-9a-z]{8,8}$/;let C=(E,e,S)=>{if(e!==""){const F=ne(e,1,p).type;S(F?void 0:new Error("\u683C\u5F0F\u9519\u8BEF\uFF01"))}else S(new Error("\u5FC5\u586B\u9879"))};const g=M(()=>ne(j.ruleForm.site_list,1,p).data);let j=R({ruleForm:{site_list:""},rules:{site_list:[{required:!0,message:"\u5FC5\u586B\u9879",trigger:["blur"]},{validator:C,trigger:["blur"]}]}});const P=E=>{!E||E.validate(e=>{if(e)console.log("submit!"),v();else return console.log("error submit!"),!1})},v=()=>{h("uploadData",g.value),j.ruleForm.site_list="",h("update:visible",!1)};return(E,e)=>{const S=m("el-input"),F=m("el-form-item"),d=m("el-form"),s=m("el-button");return b(),$("div",He,[l(d,{ref_key:"ruleFormRef",ref:f,enctype:"multipart/form-data",rules:t(j).rules,model:t(j).ruleForm,"label-width":"140px","label-position":"right"},{default:a(()=>[i("div",Qe,[_(" Offer "),l(F,{label:"Site:",prop:"site_list"},{default:a(()=>[i("div",We,[l(S,{modelValue:t(j).ruleForm.site_list,"onUpdate:modelValue":e[0]||(e[0]=c=>t(j).ruleForm.site_list=c),rows:4,type:"textarea",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1}),_(" end ")])]),_:1},8,["rules","model"]),i("div",Xe,[l(s,{type:"primary",onClick:e[1]||(e[1]=c=>P(f.value))},{default:a(()=>[Ye]),_:1})])])}}});const ll=k=>(ke("data-v-661f6240"),k=k(),Ce(),k),tl={class:"w100"},rl=ll(()=>i("div",{class:"mb-10"},null,-1)),al={class:"control-box flex jc-between ai-start w100"},ol=O("\u589E\u91CF\u751F\u6210"),ul=O("\u6279\u91CF\u4E0A\u4F20"),sl=O("\u6E05\u7A7A"),nl={class:"body-box mt-10"},il={class:"flex"},dl=Q({props:{msg:{require:!0,default:()=>"",type:String}},emits:["update:msg"],setup(k,{emit:h}){const f=k;let p=N(!1),g=R({ruleForm:{site_num:0,site_value:(F=>F?F.split(","):[])(f.msg)},rules:{}});const j=M(()=>g.ruleForm.site_value);M(()=>g.ruleForm.site_value.length);const P=()=>{if(g.ruleForm.site_num>0){let F=Math.floor(g.ruleForm.site_num);for(let d=0;d<F;d++){const s=Ie(8);g.ruleForm.site_value.push(s)}}g.ruleForm.site_num=0},v=()=>{p.value=!0},E=()=>{g.ruleForm.site_value=[]},e=F=>{const{$index:d,row:s}=F;console.log(d,s),g.ruleForm.site_value.splice(d,1)},S=F=>{F.map(d=>{g.ruleForm.site_value.push(d[0])})};return xe(()=>{const F=g.ruleForm.site_value.join(",");h("update:msg",F)}),(F,d)=>{const s=m("el-button"),c=m("el-input"),V=m("el-table-column"),D=m("el-table"),U=m("el-dialog");return b(),$("div",tl,[rl,_(" \u64CD\u4F5C "),i("div",al,[l(c,{modelValue:t(g).ruleForm.site_num,"onUpdate:modelValue":d[0]||(d[0]=y=>t(g).ruleForm.site_num=y),placeholder:"Please input",type:"number",max:"1000",class:"input-with-select search-con"},{append:a(()=>[l(s,{onClick:P},{default:a(()=>[ol]),_:1})]),_:1},8,["modelValue"]),l(s,{class:"cp mb-10",onClick:v,type:"primary"},{default:a(()=>[ul]),_:1}),l(s,{class:"cp mb-10",onClick:E,type:"primary"},{default:a(()=>[sl]),_:1})]),_(" table "),i("div",nl,[l(D,{data:t(j),class:"w100",height:"400px",border:""},{default:a(()=>[l(V,{label:"site_id",align:"center"},{default:a(y=>[i("div",null,[i("span",null,G(y.row),1)])]),_:1}),l(V,{label:"\u8BBE\u7F6E",align:"center"},{default:a(y=>[i("div",il,[l(s,{type:"danger",icon:"Delete",circle:"",onClick:T=>e(y)},null,8,["onClick"])])]),_:1})]),_:1},8,["data"])]),_(" dialog "),l(U,{modelValue:t(p),"onUpdate:modelValue":d[2]||(d[2]=y=>X(p)?p.value=y:p=y),title:"site",width:"60%"},{default:a(()=>[l(el,{visible:t(p),"onUpdate:visible":d[1]||(d[1]=y=>X(p)?p.value=y:p=y),onUploadData:S},null,8,["visible"])]),_:1},8,["modelValue"])])}}});var _l=ie(dl,[["__scopeId","data-v-661f6240"]]);const cl={class:"content-con flex column"},ml={class:"flex jc-start ai-center form-one"},pl=["textContent"],fl={class:"flex jc-start ai-center form-one"},vl=["textContent"],gl={class:"flex jc-start ai-center form-one"},Fl={class:"ml-10"},bl={class:"flex jc-start ai-center form-one"},yl={class:"ml-10"},hl={class:"flex jc-start ai-center form-one"},Vl=O("\u9ED8\u8BA4"),wl=O("\u81EA\u5B9A\u4E49"),xl={class:"ml-10"},kl={class:"flex jc-start ai-center form-one"},Cl={class:"flex jc-start ai-center form-one"},El={class:"ml-10"},Al={class:"flex jc-start ai-center form-one"},ql={class:"flex jc-start ai-center form-one"},Sl={class:"w100 flex"},Dl=O(" \u63D0\u4EA4 "),jl=Q({props:{msg:{require:!0,default:()=>({}),type:Object}},emits:["update:visible","updateData"],setup(k,{emit:h}){const f=k,p=N();let C={required:"\u5FC5\u586B\u9879"};const g=(d,s,c)=>{s&&s.split(",").length>1e3?c(new Error("site value \u7684\u503C\u4E0D\u53EF\u5927\u4E8E1000\u4E2A")):c(void 0)},j=(d,s,c)=>{s?parseInt(s)===parseFloat(s)?Number(s)>5?c(void 0):c(new Error("\u5FC5\u987B\u4E3A\u5927\u4E8E5\u7684\u6574\u6570")):c(new Error("\u5FC5\u987B\u4E3A\u6574\u6570")):c(void 0)},P=R({offer_id:[{required:!0,message:C.required,trigger:["blur","change"]}],adv_offer:[{required:!0,message:C.required,trigger:["blur","change"]}],status_day:[{required:!0,message:C.required,trigger:["blur","change"]}],day_limit:[{required:!0,message:C.required,trigger:["blur","change"]},{validator:j,trigger:["blur","change"]}],day_limit_type:[{required:!0,message:C.required,trigger:["blur","change"]}],day_limit_value:[{required:!0,message:C.required,trigger:["blur","change"]}],status_hour:[{required:!0,message:C.required,trigger:["blur","change"]}],site_value_required:[{required:!0,message:C.required,trigger:["blur","change"]},{validator:g,trigger:["blur","change"]}],site_value_no_required:[{required:!1,message:C.required,trigger:["blur","change"]},{validator:g,trigger:["blur","change"]}]});let v=R({ruleForm:{offer_id:"",adv_offer:"",channel_type:2,status_day:2,day_limit:15,day_limit_type:1,day_limit_value:"",status_hour:2,site_value:""}});const E=M(()=>v.ruleForm.site_value?v.ruleForm.site_value.split(",").length:0),e=M(()=>f.msg.site_type==="rule_value");W(()=>f.msg,(d,s)=>{let c=f.msg.fenix_site,V=c.status_day||2,D=c.status_hour||2;f.msg.channel_type===2&&(V=2,D=2),v.ruleForm={offer_id:c.offer_id||f.msg.offer_id,adv_offer:c.adv_offer||f.msg.adv_offer,channel_type:f.msg.channel_type,status_day:V,day_limit:c.day_limit||15,day_limit_type:c.day_limit_type||1,day_limit_value:c.day_limit_value||"",status_hour:D,site_value:f.msg.site_value}},{deep:!0,immediate:!0});const S=d=>{!d||d.validate(s=>{if(s)console.log("submit!"),F();else return console.log("error submit!"),!1})},F=()=>{h("updateData",v.ruleForm),h("update:visible",!1)};return(d,s)=>{const c=m("el-form-item"),V=m("el-switch"),D=m("info-filled"),U=m("el-icon"),y=m("el-tooltip"),T=m("el-input"),K=m("el-radio"),w=m("el-radio-group"),x=m("el-form"),J=m("el-button");return b(),$("div",null,[l(x,{ref_key:"ruleFormRef",ref:p,enctype:"multipart/form-data",rules:t(P),model:t(v).ruleForm,"label-width":"150px","label-position":"right"},{default:a(()=>[i("div",cl,[_(" Offer "),l(c,{label:"Offer:",prop:"offer_id"},{default:a(()=>[i("div",ml,[i("span",{textContent:G(t(v).ruleForm.offer_id)},null,8,pl)])]),_:1}),_(" Offer "),l(c,{label:"Adv Offer:",prop:"adv_offer"},{default:a(()=>[i("div",fl,[i("span",{textContent:G(t(v).ruleForm.adv_offer)},null,8,vl)])]),_:1}),_(" Offer "),l(c,{label:"\u5206\u5929\u4F18\u9009:",prop:"status_day"},{default:a(()=>[i("div",gl,[l(V,{disabled:f.msg.channel_type==2,modelValue:t(v).ruleForm.status_day,"onUpdate:modelValue":s[0]||(s[0]=q=>t(v).ruleForm.status_day=q),"active-value":1,"inactive-value":2},null,8,["disabled","modelValue"]),i("span",Fl,[l(y,{content:"\u6839\u636E\u6628\u5929\u6570\u636E\u7B5B\u9009\u7B26\u5408\u6761\u4EF6\u7684site_id\u4F7F\u7528",placement:"right-start"},{default:a(()=>[l(U,null,{default:a(()=>[l(D)]),_:1})]),_:1})])])]),_:1}),l(c,{label:"\u5206\u5929\u4F18\u9009\u542F\u52A8\u6761\u4EF6:",prop:"day_limit"},{default:a(()=>[i("div",bl,[l(T,{modelValue:t(v).ruleForm.day_limit,"onUpdate:modelValue":s[1]||(s[1]=q=>t(v).ruleForm.day_limit=q),placeholder:"\u9ED8\u8BA4\u503C\u4E3A15",min:"5",step:"1",class:"input-with-select",type:"number"},null,8,["modelValue"]),i("span",yl,[l(y,{content:"\u5F53\u6628\u5929site_id\u7684\u5E73\u5747install\u6570\u5927\u4E8E\u7B49\u4E8E\u8BBE\u5B9A\u503C\u65F6\u624D\u542F\u52A8\u81EA\u52A8\u4F18\u9009\uFF0C\u9ED8\u8BA4\u8BBE\u7F6E\u4E3A15",placement:"bottom"},{default:a(()=>[l(U,null,{default:a(()=>[l(D)]),_:1})]),_:1})])])]),_:1}),l(c,{label:"\u5206\u5929\u4F18\u9009install\u9650\u5236:",prop:"day_limit_type"},{default:a(()=>[i("div",hl,[l(w,{class:"flex",modelValue:t(v).ruleForm.day_limit_type,"onUpdate:modelValue":s[2]||(s[2]=q=>t(v).ruleForm.day_limit_type=q)},{default:a(()=>[l(K,{label:1},{default:a(()=>[Vl]),_:1}),l(K,{label:2},{default:a(()=>[wl]),_:1})]),_:1},8,["modelValue"]),i("span",xl,[l(y,{content:"\u6839\u636Esite_id\u7684install\u6570\u7B5B\u9009\uFF0C\u4EC5\u4F7F\u7528\u5927\u4E8E\u7B49\u4E8E\u8BBE\u5B9A\u503C\u7684site_id\uFF0C\u9ED8\u8BA4\u503C\u4E3A\u6628\u5929\u5747\u503C\u9664\u4EE55",placement:"right-start"},{default:a(()=>[l(U,null,{default:a(()=>[l(D)]),_:1})]),_:1})])])]),_:1}),t(v).ruleForm.day_limit_type===2?(b(),L(c,{key:0,label:"\u5206\u5929\u4F18\u9009install\u9650\u5236\u503C:",prop:"day_limit_value"},{default:a(()=>[i("div",kl,[l(T,{type:"number",modelValue:t(v).ruleForm.day_limit_value,"onUpdate:modelValue":s[3]||(s[3]=q=>t(v).ruleForm.day_limit_value=q),placeholder:"",class:"input-with-select"},null,8,["modelValue"])])]),_:1})):_("v-if",!0),l(c,{label:"\u5206\u65F6\u4F18\u9009:",prop:"status_hour"},{default:a(()=>[i("div",Cl,[l(V,{disabled:f.msg.channel_type==2,modelValue:t(v).ruleForm.status_hour,"onUpdate:modelValue":s[4]||(s[4]=q=>t(v).ruleForm.status_hour=q),"active-value":1,"inactive-value":2},null,8,["disabled","modelValue"]),i("span",El,[l(y,{content:"\u6839\u636E\u524D6\u5C0F\u65F6\u548C\u524D2\u5C0F\u65F6\u6570\u636E\u7B5B\u9009\u7B26\u5408\u6761\u4EF6\u7684site_id\u4F7F\u7528\uFF0C\u6682\u4E0D\u652F\u6301\u81EA\u5B9A\u4E49",placement:"right-start"},{default:a(()=>[l(U,null,{default:a(()=>[l(D)]),_:1})]),_:1})])])]),_:1}),l(c,{label:"\u5F53\u524D\u6E20\u9053\u6570:",prop:"site_value",rules:t(e)?t(P).site_value_required:t(P).site_value_no_required},{default:a(()=>[i("div",Al,[l(T,{type:"hidden",modelValue:t(E),"onUpdate:modelValue":s[5]||(s[5]=q=>X(E)?E.value=q:null),disabled:""},null,8,["modelValue"]),O(" "+G(t(E)),1)])]),_:1},8,["rules"]),l(c,{label:""},{default:a(()=>[i("div",ql,[l(_l,{msg:t(v).ruleForm.site_value,"onUpdate:msg":s[6]||(s[6]=q=>t(v).ruleForm.site_value=q)},null,8,["msg"])])]),_:1}),_(" end ")])]),_:1},8,["rules","model"]),_(" form "),_(" footer "),i("div",Sl,[l(J,{type:"primary",onClick:s[7]||(s[7]=oe(q=>S(p.value),["prevent"]))},{default:a(()=>[Dl]),_:1})])])}}});const Bl={class:"content-con flex column"},$l={class:"flex jc-start ai-center form-one"},Ul=["textContent"],Ol={class:"flex jc-start ai-center form-one"},Pl=O(" BUZZ "),Ll=O(" SDK "),Tl={class:"flex jc-start ai-center form-one"},Rl={key:0},Nl={key:1},zl={class:"flex jc-start ai-center form-one"},Il={class:"flex jc-start ai-center form-one"},Ml={class:"flex jc-start ai-center form-one"},Gl={class:"flex jc-start ai-center form-one"},Kl={class:"flex jc-start ai-center form-one"},Jl={class:"form-one"},Zl={class:"flex jc-start ai-center form-one"},Hl={class:"flex jc-start ai-center form-one"},Ql={class:"flex jc-start ai-center form-one"},Wl={class:"form-one"},Xl={class:"flex ai-center jc-start mb-10"},Yl={class:"text-wrap"},et={class:"flex jc-start ai-center form-one"},lt={class:"flex jc-start ai-center form-one"},tt={class:"flex jc-start ai-center form-one"},rt={class:"flex jc-start ai-center form-one"},at={class:"w100 flex"},ot=O(" Save "),ut=Q({setup(k){let{proxy:h}=De();const f=Ee(),p={required:"\u6B64\u9879\u5FC5\u586B"},C=u=>{let r=!0;return u.map(n=>{for(const A in n)if(Object.prototype.hasOwnProperty.call(n,A)){const B=n[A];if((B===""||B===void 0)&&B!==0){r=!1;break}}}),r},g=(u,r,n)=>{r&&r.split(",").length>1e3?n(new Error("site value \u7684\u503C\u4E0D\u53EF\u5927\u4E8E1000\u4E2A")):n(void 0)};let j=(u,r,n)=>{r.length!==0?C(r)?n(void 0):n(new Error("\u4E0D\u5141\u8BB8\u6709\u7A7A\u503C")):n(void 0)},P=(u,r,n)=>{r.length!==0?r.length>1?n(new Error("\u53EA\u80FD\u586B\u9009\u4E00\u4E2A\u56FD\u5BB6")):n(void 0):n(new Error(p.required))};const v={id:void 0,offer_id:"",adv_offer:"",create_type:1,channel:"",channel_type:1,adv_status:1,conversion_flow:void 0,status:1,title:"",pkg:"",attribute_provider:"",pid:"",platform:1,country:[],revenue:void 0,traffic:[],adtype:38,update_date:"",adv_tracking_link:"",target_cvr:void 0,cvr_status:2,is_s2s:2,s2s_tracking_link:"",app_url:"",site_type:"rule_value",site_value:"",description:"",fenix_site:{}};let E=N(!1);const e=R({options:{channel:[{id:"",short_name:""}],country:[{id:"",short_name:"",zh_cn:""}],conversion_flow:[{value:1,label:"CPI"},{value:2,label:"CPA"},{value:9,label:"SDK"}],platform:[{value:1,label:"Android"},{value:2,label:"iOS"}],site_type:[{value:"rule_sdkindex",label:"\u5339\u914DSDK\u81EA\u5B9A\u4E49"},{value:"rule_pubredirect",label:"\u900F\u4F20\u6E20\u9053ID"},{value:"rule_slotid",label:"\u6E20\u9053slotid"},{value:"rule_value",label:"\u56FA\u5B9A\u503C"}],attribute_provider:[{value:"AppsFlyer",label:"AppsFlyer"},{value:"Branch",label:"Branch"},{value:"Adjust",label:"Adjust"},{value:"Singular",label:"Singular"},{value:"AppMetrica",label:"AppMetrica"}]},rules:{no_required:[{required:!1}],channel:[{required:!0,message:p.required,trigger:["blur","change"]}],channel_type:[{required:!0,message:p.required,trigger:["blur","change"]}],status:[{required:!0,message:p.required,trigger:["blur","change"]}],title:[{required:!0,message:p.required,trigger:["blur","change"]}],pkg:[{required:!0,message:p.required,trigger:["blur","change"]}],platform:[{required:!0,message:p.required,trigger:["blur","change"]}],country:[{required:!0,message:p.required,trigger:["blur","change"]},{validator:P,trigger:["blur","change"]}],revenue:[{required:!0,message:p.required,trigger:["blur","change"]}],traffic:[{required:!1,validator:j,trigger:["blur","change"]}],adv_tracking_link:[{required:!0,message:p.required,trigger:["blur","change"]}],site_type:[{required:!0,message:p.required,trigger:["blur","change"]}],site_value:[{required:!0,message:p.required,trigger:["blur","change"]},{validator:g,trigger:["blur","change"]}],is_s2s:[{required:!0,message:p.required,trigger:["blur","change"]}],s2s_tracking_link:[{required:!0,message:p.required,trigger:["blur","change"]}],app_url:[{required:!0,message:p.required,trigger:["blur","change"]}]},ruleForm:v,search:{adv_offer:""}});let S=N(""),F=N(""),d=N(""),s=N(!1);const c=u=>{const r=[];return u.map(n=>{let A=Y({},n);return n.payout&&(A.payout=Number(n.payout)),n.cap_daily&&(A.cap_daily=Number(n.cap_daily)),r.push(A),n}),r},V=async()=>{E.value=!0;const u=se.cloneDeep(e.ruleForm);let r=Y({},u);if(u.conversion_flow&&(r.conversion_flow=u.conversion_flow),r.country=u.country[0],r.revenue=parseFloat(r.revenue),r.target_cvr=parseFloat(r.target_cvr),r.fenix_site.day_limit&&(r.fenix_site.day_limit=parseFloat(r.fenix_site.day_limit)),r.fenix_site.day_limit_value?r.fenix_site.day_limit_value=parseFloat(r.fenix_site.day_limit_value):delete r.fenix_site.day_limit_value,u.traffic.length!==0){const A=c(u.traffic);r.traffic=JSON.stringify(A)}else delete r.traffic;let n;d.value==="create"&&(n=await Te(r)),d.value==="edit"&&(n=await Re(r)),E.value=!1,ze(n)&&window.close()},D=()=>{s.value=!0},U=()=>{h.$refs.ruleForm.validate(u=>{if(console.log(u),u)console.log("submit!"),V();else return console.log("error submit!!"),!1})},y=async()=>{const u=await $e();if(u.code===200){const{offer_id:r}=u;e.ruleForm.offer_id=r.toString()}else y()},T=async()=>await Promise.all([w(),x()]),K=M(()=>e.ruleForm.site_value?e.ruleForm.site_value.split(",").length:0),w=async()=>{const{data:u}=await Ue();return e.options.channel=u,u},x=async()=>{const{data:u}=await Oe();return e.options.country=u,u};R({ruleForm:v}),ae(async()=>{J()});const J=async()=>{S.value=f.currentRoute.value.name,F.value=f.currentRoute.value.params.id,S.value==="fenix-offer-create"&&(y(),d.value="create"),S.value==="fenix-offer-edit"&&(F.value=f.currentRoute.value.params.id,d.value="edit",q()),await T()},q=async()=>{const{data:u}=await Be(F.value);e.ruleForm=Y({},u),e.ruleForm.country=[u.country],e.search.adv_offer=u.adv_offer,e.ruleForm.traffic=u.traffic?JSON.parse(u.traffic):[],ue(e.ruleForm)},de=M(()=>e.ruleForm.site_type==="rule_value");W(()=>e.ruleForm.traffic,(u,r)=>{},{immediate:!0,deep:!0}),W(()=>e.ruleForm.adv_offer,(u,r)=>{u?e.ruleForm.create_type=2:e.ruleForm.create_type=1},{immediate:!0,deep:!0});const _e=u=>{console.log(u)},ce=async()=>{if(d.value==="edit")return!1;console.log("get adv offer"),e.ruleForm.adv_offer=e.search.adv_offer;const u=e.ruleForm.adv_offer;if(!u)return!1;const r={adv_offer:u,platform:e.ruleForm.platform};if(u&&u.includes("_")){console.log("get offer for dump"),e.ruleForm.channel_type=2,e.ruleForm.adtype=39;const n=await Pe(r),{data:A}=n;n.status===200?(e.ruleForm.adv_status=1,pe(A)):(console.log("\u6CA1\u6709dump offer"),e.ruleForm.adv_status=2)}else{console.log("get offer for buzz"),e.ruleForm.channel_type=1,e.ruleForm.adtype=38;const{data:n}=await Le(r);console.log(n),e.ruleForm.adv_status=n.status,me(n)}},me=u=>{e.ruleForm.channel=u.channel,e.ruleForm.attribute_provider=u.attribute_provider,e.ruleForm.conversion_flow=u.conversion_flow,e.ruleForm.title=u.title,e.ruleForm.pkg=u.pkg_name,e.ruleForm.pid=u.pid,e.ruleForm.platform=u.platform,e.ruleForm.revenue=u.payout,e.ruleForm.adv_tracking_link=u.tracking_link,fe(u.country)},pe=u=>{var n;e.ruleForm.pkg=u.app_pkg_name,e.ruleForm.channel=u.channel,e.ruleForm.country=u.country;const r=(n=e.options.platform.find(A=>A.label===u.platform))==null?void 0:n.value;e.ruleForm.platform=r||1,e.ruleForm.revenue=u.revenue,e.ruleForm.title=u.title,e.ruleForm.adv_tracking_link=u.tracking_link,e.ruleForm.conversion_flow=9},fe=u=>{Array.isArray(u)?e.ruleForm.country=u:e.ruleForm.country=[u]},ve=u=>{console.log("site_value",u.site_value.length),e.ruleForm.site_value=u.site_value,e.ruleForm.fenix_site=ue(u)};return(u,r)=>{const n=m("el-form-item"),A=m("el-button"),B=m("el-input"),Z=m("el-option"),H=m("el-select"),le=m("el-radio"),ge=m("el-radio-group"),ee=m("el-switch"),Fe=m("el-form"),be=m("el-dialog"),ye=Ae("loading");return qe((b(),$("div",null,[_(" form "),l(Fe,{ref:"ruleForm",enctype:"multipart/form-data",rules:t(e).rules,model:t(e).ruleForm,"label-width":"240px","label-position":"right"},{default:a(()=>[i("div",Bl,[_(" Offer "),l(n,{label:"Offer:",prop:"offer"},{default:a(()=>[i("div",$l,[i("span",{textContent:G(t(e).ruleForm.offer_id)},null,8,Ul)])]),_:1}),_(" Adv Offer "),l(n,{label:"Adv Offer:",prop:"adv_offer"},{default:a(()=>[i("div",Ol,[l(B,{modelValue:t(e).search.adv_offer,"onUpdate:modelValue":r[0]||(r[0]=o=>t(e).search.adv_offer=o),placeholder:"Please input",class:"input-with-select",disabled:t(d)==="edit"},Se({_:2},[t(d)==="create"?{name:"append",fn:a(()=>[l(A,{type:"primary",icon:"Search",onClick:ce})])}:void 0]),1032,["modelValue","disabled"])])]),_:1}),_(" Channel "),l(n,{label:"Channel:",prop:"channel"},{default:a(()=>[l(H,{modelValue:t(e).ruleForm.channel,"onUpdate:modelValue":r[1]||(r[1]=o=>t(e).ruleForm.channel=o),filterable:"",class:"form-one",clearable:"",placeholder:""},{default:a(()=>[(b(!0),$(z,null,I(t(e).options.channel,o=>(b(),L(Z,{key:o.id,label:o.short_name,value:o.short_name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_(" Channel Type "),l(n,{label:"Channel Type:",prop:"channel_type"},{default:a(()=>[l(ge,{modelValue:t(e).ruleForm.channel_type,"onUpdate:modelValue":r[2]||(r[2]=o=>t(e).ruleForm.channel_type=o),class:"form-one"},{default:a(()=>[l(le,{label:1},{default:a(()=>[Pl]),_:1}),l(le,{label:2},{default:a(()=>[Ll]),_:1})]),_:1},8,["modelValue"])]),_:1}),_(" Adv Status "),l(n,{label:"Adv Status:",prop:"adv_status"},{default:a(()=>[i("div",Tl,[t(e).ruleForm.adv_status===1?(b(),$("span",Rl,"\u5F00")):_("v-if",!0),t(e).ruleForm.adv_status===2?(b(),$("span",Nl,"\u5173")):_("v-if",!0)])]),_:1}),_(" conversion_flow "),l(n,{label:"Conversion Flow:",prop:"conversion_flow"},{default:a(()=>[l(H,{modelValue:t(e).ruleForm.conversion_flow,"onUpdate:modelValue":r[3]||(r[3]=o=>t(e).ruleForm.conversion_flow=o),filterable:"",class:"form-one",clearable:"",placeholder:""},{default:a(()=>[(b(!0),$(z,null,I(t(e).options.conversion_flow,o=>(b(),L(Z,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_(" Status "),l(n,{label:"Status:",prop:"status"},{default:a(()=>[i("div",zl,[l(ee,{modelValue:t(e).ruleForm.status,"onUpdate:modelValue":r[4]||(r[4]=o=>t(e).ruleForm.status=o),"active-value":1,"inactive-value":2},null,8,["modelValue"])])]),_:1}),_(" Offer Title "),l(n,{label:"Offer Title:",prop:"title"},{default:a(()=>[i("div",Il,[l(B,{modelValue:t(e).ruleForm.title,"onUpdate:modelValue":r[5]||(r[5]=o=>t(e).ruleForm.title=o),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1}),_(" Package Name "),l(n,{label:"Package Name:",prop:"pkg"},{default:a(()=>[i("div",Ml,[l(B,{modelValue:t(e).ruleForm.pkg,"onUpdate:modelValue":r[6]||(r[6]=o=>t(e).ruleForm.pkg=o),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1}),_(" Attribute Provider "),l(n,{label:"Attribute Provider:",prop:"attribute_provider"},{default:a(()=>[l(H,{modelValue:t(e).ruleForm.attribute_provider,"onUpdate:modelValue":r[7]||(r[7]=o=>t(e).ruleForm.attribute_provider=o),filterable:"",class:"form-one",clearable:"",placeholder:""},{default:a(()=>[(b(!0),$(z,null,I(t(e).options.attribute_provider,o=>(b(),L(Z,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_(" Pid "),l(n,{label:"Pid:",prop:"pid"},{default:a(()=>[i("div",Gl,[l(B,{modelValue:t(e).ruleForm.pid,"onUpdate:modelValue":r[8]||(r[8]=o=>t(e).ruleForm.pid=o),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1}),_(" Platform "),l(n,{label:"Platform:",prop:"platform"},{default:a(()=>[l(H,{modelValue:t(e).ruleForm.platform,"onUpdate:modelValue":r[9]||(r[9]=o=>t(e).ruleForm.platform=o),filterable:"",class:"form-one",placeholder:""},{default:a(()=>[(b(!0),$(z,null,I(t(e).options.platform,o=>(b(),L(Z,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_(" Country "),l(n,{label:"Country:",prop:"country"},{default:a(()=>[l(H,{modelValue:t(e).ruleForm.country,"onUpdate:modelValue":r[10]||(r[10]=o=>t(e).ruleForm.country=o),filterable:"",class:"form-one",multiple:"",clearable:"",placeholder:""},{default:a(()=>[(b(!0),$(z,null,I(t(e).options.country,o=>(b(),L(Z,{key:o.id,label:o.short_name+"-"+o.zh_cn,value:o.short_name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_(" Revenue "),l(n,{label:"Revenue:",prop:"revenue"},{default:a(()=>[i("div",Kl,[l(B,{modelValue:t(e).ruleForm.revenue,"onUpdate:modelValue":r[11]||(r[11]=o=>t(e).ruleForm.revenue=o),placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1}),_(" Manage Traffic "),l(n,{label:"Manage Traffic:",prop:"traffic"},{default:a(()=>[i("div",Jl,[l(t(Ze),{ref:"traffic",list:t(e).ruleForm.traffic,"onUpdate:list":r[12]||(r[12]=o=>t(e).ruleForm.traffic=o),offer:t(e).ruleForm.offer_id,onKk:_e},null,8,["list","offer"])])]),_:1}),_(" Adv Tracking Link "),l(n,{label:"Adv Tracking Link:",prop:"adv_tracking_link"},{default:a(()=>[i("div",Zl,[l(B,{modelValue:t(e).ruleForm.adv_tracking_link,"onUpdate:modelValue":r[13]||(r[13]=o=>t(e).ruleForm.adv_tracking_link=o),rows:4,autosize:"",type:"textarea",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1}),_(" Target CVR "),l(n,{label:"Target CVR:",prop:"target_cvr"},{default:a(()=>[i("div",Hl,[l(B,{modelValue:t(e).ruleForm.target_cvr,"onUpdate:modelValue":r[14]||(r[14]=o=>t(e).ruleForm.target_cvr=o),type:"number",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1}),_(" CVR Status "),l(n,{label:"CVR Status:",prop:"cvr_status"},{default:a(()=>[i("div",Ql,[l(ee,{modelValue:t(e).ruleForm.cvr_status,"onUpdate:modelValue":r[15]||(r[15]=o=>t(e).ruleForm.cvr_status=o),"active-value":1,"inactive-value":2},null,8,["modelValue"])])]),_:1}),_(" Site Type "),l(n,{label:"Site Type:",prop:"site_type"},{default:a(()=>[l(H,{modelValue:t(e).ruleForm.site_type,"onUpdate:modelValue":r[16]||(r[16]=o=>t(e).ruleForm.site_type=o),filterable:"",class:"form-one",clearable:"",placeholder:""},{default:a(()=>[(b(!0),$(z,null,I(t(e).options.site_type,o=>(b(),L(Z,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_(" Site Value "),l(n,{label:"Site Value:",prop:"site_value",rules:t(de)?t(e).rules.site_value:t(e).rules.no_required},{default:a(()=>[i("div",Wl,[i("div",Xl,[l(A,{class:"cp mr-10",icon:"Tools",circle:"",onClick:D}),i("span",null,G(t(K)),1)]),i("div",null,[_(` <el-input
                v-model="state.ruleForm.site_value"
                type="textarea"
                autosize
                :rows="4"
                placeholder="Please input"
                class="input-with-select siteValue"
              /> `),i("p",Yl,G(t(e).ruleForm.site_value),1)])])]),_:1},8,["rules"]),_(" S2S Async "),l(n,{label:"S2S Async:",prop:"is_s2s"},{default:a(()=>[i("div",et,[l(ee,{modelValue:t(e).ruleForm.is_s2s,"onUpdate:modelValue":r[17]||(r[17]=o=>t(e).ruleForm.is_s2s=o),"active-value":1,"inactive-value":2},null,8,["modelValue"])])]),_:1}),_(" S2S Tracking Link "),l(n,{label:"S2S Tracking Link:",prop:"s2s_tracking_link",rules:t(e).ruleForm.is_s2s===1?t(e).rules.s2s_tracking_link:t(e).rules.no_required},{default:a(()=>[i("div",lt,[l(B,{modelValue:t(e).ruleForm.s2s_tracking_link,"onUpdate:modelValue":r[18]||(r[18]=o=>t(e).ruleForm.s2s_tracking_link=o),rows:2,type:"textarea",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1},8,["rules"]),_(" Preview URL "),l(n,{label:"Preview URL:",prop:"app_url",rules:t(e).ruleForm.is_s2s===1?t(e).rules.app_url:t(e).rules.no_required},{default:a(()=>[i("div",tt,[l(B,{modelValue:t(e).ruleForm.app_url,"onUpdate:modelValue":r[19]||(r[19]=o=>t(e).ruleForm.app_url=o),rows:2,type:"textarea",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1},8,["rules"]),_(" Description "),l(n,{label:"Description:",prop:"description"},{default:a(()=>[i("div",rt,[l(B,{modelValue:t(e).ruleForm.description,"onUpdate:modelValue":r[20]||(r[20]=o=>t(e).ruleForm.description=o),rows:2,type:"textarea",placeholder:"Please input",class:"input-with-select"},null,8,["modelValue"])])]),_:1}),_(" end ")])]),_:1},8,["rules","model"]),_(" form "),_(" footer "),i("div",at,[l(A,{type:"primary",onClick:oe(U,["prevent"])},{default:a(()=>[ot]),_:1},8,["onClick"])]),_(" dialog "),l(be,{modelValue:t(s),"onUpdate:modelValue":r[22]||(r[22]=o=>X(s)?s.value=o:s=o),title:"site",width:"70%"},{default:a(()=>[l(jl,{msg:t(e).ruleForm,onUpdateData:ve,visible:t(s),"onUpdate:visible":r[21]||(r[21]=o=>X(s)?s.value=o:s=o)},null,8,["msg","visible"])]),_:1},8,["modelValue"])])),[[ye,t(E)]])}}});var ft=ie(ut,[["__scopeId","data-v-2659fc52"]]);export{ft as default};
