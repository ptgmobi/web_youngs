import{_ as e,Z as t,q as a,o as i,A as l,s,e as o,x as n,c as d,z as h,f as r,y as c}from"./main-ce43ffdd.js";import{g as u,a as m,s as p,b as f}from"./power-0d7b74cc.js";import{h as D}from"./format-00f0450d.js";import{_ as g}from"./lodash-6b3789ad.js";import{m as b}from"./message-1c1d9ef1.js";import{m as y}from"./self-3965912b.js";import"./moment-56f006b0.js";const C={class:""};const A={element:[],menu:[],operation:[],permission:[]},k={class:"app-container"},w={class:"flex jc-between ai-start"},T={slot:"footer",class:"dialog-footer"};var _=e({components:{RoleTree:e({props:{title:{default:"title",type:String},data:{default:()=>[],type:Array},item:{default:()=>({}),type:Object},choice:{default:()=>[],type:Array},name:{default:"name",type:String},date:{default:0,type:Number}},data:()=>({filterApiText:"",list:[],choiceArr:[],checkStrictly:!1,defaultProps:{children:"children",label:"label"}}),computed:{handleTree(){return D(this.list)},handleRef(){return`tree${this.name}`}},watch:{date(){this.init()},choice:{immediate:!0,handler(e,t){this.$nextTick((()=>{this.$refs[this.handleRef].setCheckedKeys([]),e&&e.forEach((e=>{const t=this.$refs[this.handleRef].getNode(e);t&&t.isLeaf&&this.$refs[this.handleRef].setChecked(t,!0)}))}))}},filterApiText(e){this.$refs[this.handleRef]&&this.$refs[this.handleRef].filter(e)}},created(){this.list=g.cloneDeep(this.data)},methods:{async init(){this.filterApiText=""},changeOneFn(e,t){const a=[...this.$refs[this.handleRef].getCheckedKeys(),...this.$refs[this.handleRef].getHalfCheckedKeys()];this.$emit("changeChoiceData",this.name,a)},filterApiNode(e,t){return!e||t[this.defaultProps.label].includes(e)},checkApiTree(e,t,a){const i=this.handleChoiceApiDataPermissionID,l=this.dialogData.treeData.choiceApiData.find((t=>t.permission_id===e.id));var s=null==l?void 0:l.id;t?(this.dialogData.treeData.choiceApiDataAdd.includes(e.id)||i.includes(e.id)||this.dialogData.treeData.choiceApiDataAdd.push(e.id),this.dialogData.treeData.choiceApiDataAdd.includes(s)&&(this.dialogData.treeData.choiceApiDataDel=this.dialogData.treeData.choiceApiDataDel.filter((e=>e!==s)))):(this.dialogData.treeData.choiceApiDataDel.includes(s)||l&&this.dialogData.treeData.choiceApiDataDel.push(s),this.dialogData.treeData.choiceApiDataAdd.includes(e.id)&&(this.dialogData.treeData.choiceApiDataAdd=this.dialogData.treeData.choiceApiDataAdd.filter((t=>t!==e.id))))},generateRoutes(e,a="/"){const i=[];for(let{route:l}of e){if(l.hidden)continue;const e=this.onlyOneShowingChild(l.children,l);l.children&&e&&!l.alwaysShow&&(l=e);const s={path:t.resolve(a,l.path),title:l.title,name:l.name};l.children&&(s.children=this.generateRoutes(l.children,s.path)),i.push(s)}return i},generateArr(e){let t=[];return e.forEach((e=>{if(t.push(e),e.children){const a=this.generateArr(e.children);a.length>0&&(t=[...t,...a])}})),t},generateTree(e,a="/",i){const l=[];for(const s of e){const e=t.resolve(a,s.path);s.children&&(s.children=this.generateTree(s.children,e,i)),(i.includes(e)||s.children&&s.children.length>=1)&&l.push(s)}return l},onlyOneShowingChild(e=[],a){let i=null;const l=e.filter((e=>!e.hidden));return 1===l.length?(i=l[0],i.path=t.resolve(a.path,i.path),i):0===l.length&&(i={...a,path:"",noShowingChildren:!0},i)}}},[["render",function(e,t,d,h,r,c){const u=a("el-input"),m=a("el-tree"),p=a("el-form-item"),f=a("el-form");return i(),l(f,{"label-width":"150px","label-position":"top"},{default:s((()=>[o(p,{label:d.title},{default:s((()=>[n("div",C,[o(u,{modelValue:r.filterApiText,"onUpdate:modelValue":t[0]||(t[0]=e=>r.filterApiText=e),class:"w100",placeholder:"输入关键字进行过滤"},null,8,["modelValue"]),o(m,{ref:c.handleRef,data:c.handleTree,props:r.defaultProps,"show-checkbox":"","node-key":"id",class:"permission-tree","default-checked-keys":r.choiceArr,"filter-node-method":c.filterApiNode,"default-expand-all":!0,onCheck:c.changeOneFn},null,8,["data","props","default-checked-keys","filter-node-method","onCheck"])])])),_:1},8,["label"])])),_:1})}]])},mixins:[y],data:()=>({date:"",list:[],data:{},dialogVisible:!1,dialogType:"",busData:{item:{type:""},choiceData:{menu:[],element:[],operation:[]}}}),created(){this.getList()},methods:{async getList(){const{data:e}=await u();this.data=e,this.list=e.permission},clearBusData(){this.busData.choiceData=g.cloneDeep(A)},handleCreate(){this.dialogType="new",this.busData.item.type="",this.clearBusData(),this.dialogVisible=!0;const e=new Date;this.date=e.getTime()},async handleEdit(e){this.dialogType="edit",this.busData.item=e.row;const{data:t}=await m(this.busData.item.id);this.busData.choiceData=t,this.dialogVisible=!0;const a=new Date;this.date=a.getTime()},handleDelete(e){},roleChangeChoice(e,t){this.busData.choiceData[e]=t},async submitFn(){if("new"===this.dialogType){const e={type:this.busData.item.type,menu_id:this.busData.choiceData.menu,element_id:this.busData.choiceData.element,operation_id:this.busData.choiceData.operation},t=await p(e);t&&b(t),this.getList()}if("edit"===this.dialogType){const e={permission_id:this.busData.item.id,menu_id:this.busData.choiceData.menu,element_id:this.busData.choiceData.element,operation_id:this.busData.choiceData.operation},t=await f(this.busData.item.id,e);t&&b(t)}this.dialogVisible=!1}}},[["render",function(e,t,u,m,p,f){const D=a("el-button"),g=a("el-table-column"),b=a("el-table"),y=a("el-input"),C=a("el-form-item"),A=a("el-form"),_=a("role-tree"),V=a("el-dialog");return i(),d("div",k,[e.judgePermissionElementFn("A-AP-ADD-V")?(i(),l(D,{key:0,type:"primary",onClick:f.handleCreate},{default:s((()=>[r(" 新建 ")])),_:1},8,["onClick"])):h("v-if",!0),o(b,{data:p.list,style:{width:"100%","margin-top":"30px"},border:""},{default:s((()=>[o(g,{align:"center",label:"ID"},{default:s((e=>[r(c(e.row.id),1)])),_:1}),o(g,{align:"center",label:"Type"},{default:s((e=>[r(c(e.row.type),1)])),_:1}),o(g,{align:"center",label:"Operations"},{default:s((t=>[e.judgePermissionElementFn("A-AP-EDIT-V")?(i(),l(D,{key:0,type:"primary",size:"small",onClick:e=>f.handleEdit(t)},{default:s((()=>[r(" 修改 ")])),_:2},1032,["onClick"])):h("v-if",!0),e.judgePermissionElementFn("A-AP-DEL-V")?(i(),l(D,{key:1,type:"danger",size:"small",onClick:e=>f.handleDelete(t)},{default:s((()=>[r(" 删除 ")])),_:2},1032,["onClick"])):h("v-if",!0)])),_:1})])),_:1},8,["data"]),o(V,{modelValue:p.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>p.dialogVisible=e),title:"edit"===p.dialogType?"Edit Role":"New Role",width:"90%"},{default:s((()=>[o(A,{"label-width":"150px","label-position":"left"},{default:s((()=>[o(C,{label:"Name"},{default:s((()=>[o(y,{modelValue:p.busData.item.type,"onUpdate:modelValue":t[0]||(t[0]=e=>p.busData.item.type=e),placeholder:"Role Name",disabled:"edit"===p.dialogType},null,8,["modelValue","disabled"])])),_:1})])),_:1}),n("div",w,[o(_,{ref:"roleroute",item:p.busData.item,data:p.data.menu,date:p.date,choice:p.busData.choiceData.menu,title:"路由权限",name:"menu",class:"col-auto-8 m0-10",onChangeChoiceData:f.roleChangeChoice},null,8,["item","data","date","choice","onChangeChoiceData"]),o(_,{ref:"rolebutton",item:p.busData.item,data:p.data.element,date:p.date,choice:p.busData.choiceData.element,title:"按钮权限",name:"element",class:"col-auto-8 m0-10",onChangeChoiceData:f.roleChangeChoice},null,8,["item","data","date","choice","onChangeChoiceData"]),o(_,{ref:"roleapi",item:p.busData.item,data:p.data.operation,date:p.date,choice:p.busData.choiceData.operation,title:"API权限",name:"operation",class:"col-auto-8 m0-10",onChangeChoiceData:f.roleChangeChoice},null,8,["item","data","date","choice","onChangeChoiceData"])]),n("div",T,[o(D,{onClick:t[1]||(t[1]=e=>p.dialogVisible=!1)},{default:s((()=>[r(" 取 消 ")])),_:1}),o(D,{type:"primary",onClick:f.submitFn},{default:s((()=>[r(" 确 定 ")])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"])])}]]);export{_ as default};
