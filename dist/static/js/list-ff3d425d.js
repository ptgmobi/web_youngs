import{_ as e,d as a,h as l,$ as t,r as s,w as i,b as o,L as n,q as r,a0 as d,c as u,x as p,e as c,s as m,v as _,z as g,U as v,A as b,a9 as f,V as y,K as h,o as w,N as V,O as x,f as F,y as k}from"./main-ce43ffdd.js";import{u as z,s as U}from"./useUtils-d1805f03.js";import{s as j,A as $,a as C}from"./dsp-common-1d93861f.js";import{P as D}from"./index-2d86919d.js";import{m as Q}from"./message-1c1d9ef1.js";import{_ as S}from"./lodash-6b3789ad.js";import{h as A,g as I}from"./new-format-368dcfb0.js";import"./clipboard-polyfill.text.esm-fc4f7791.js";import{e as P,f as q,g as N}from"./dsp-campaign-556f35e6.js";const T={class:"controlBox w100 mb-10"},B={class:"flex jc-start flex-wrap w100"},E={class:"flex"},K={class:"flex"},L={class:"mb-10 w100"},O={class:"pr"},R={class:"flex jc-around"},G={class:"w100 flex"},H={class:"img-box"},J=["src"],M=a({name:"adserieslist"});var W=e(a({...M,setup(e){const a=l(),M=l([{id:""}]),{status:W,audit_status:X}=U,{feeds_num:Y,creative_goals:Z}=j,{goNewUrl:ee,openAlert:ae}=z(),le=t({status:"",dsp_category_id:"",creative_goals:"",audit_status:"",is_del:"1",value_type:"name",value:""}),te=l({}),se=l(!1),ie=s({preview_img:""});let oe=s({dialogVisible:!1,cache:{item:{}},searchForm:le.value,useData:le.value,loading:!0,options:{status:W,audit_status:X,size:[],feeds_num:Y,category:[],creative_goals:Z,dpa_tpl:[],value_type:[{value:"name",label:"模板名称"},{value:"id",label:"模板ID"}]},list:[{id:1}],pagination:{pageSizes:[20,50,100,500,1e3],total:1,listQuery:{page:1,limit:50,importance:void 0,title:void 0,type:void 0,sort:"+id"}}});s({data:{mode:""},options:{mode:[{value:1,label:"开启"},{value:2,label:"暂停"},{value:0,label:"归档"}]}});const ne=e=>{M.value=e},re=()=>{oe.useData=S.cloneDeep(oe.searchForm),ce()};l([]);const de=()=>{ee({url:"/campaign/dpa/create",query:{type:"create"}})},ue=e=>async()=>{const{row:a,$index:l}=e,t=await(async e=>await N({ids:e,is_del:2}))([a.id]);Q(t)&&oe.list.splice(l,1)};i((()=>M),((e,a)=>{e.value}),{immediate:!0,deep:!0});const pe=e=>{let a=oe.options.dpa_tpl.find((a=>a.id==e.row.follow_template_id));return a?(e.row.url=a.url,a.url):""},ce=async()=>{await(async()=>{Promise.all([q(),$(),C()]).then((e=>{let a=e[0].data.data;oe.options.dpa_tpl=a.map((e=>(e.value=e.id,e.label=`${e.format}_${e.tpl_type}`,e.url=`https://staticdn.cloudmobi.net/dpa/demo/${e.format}_${e.tpl_type}_bg.png`,e)));let l=e[1].data;oe.options.category=l.map((e=>(e.value=e.id,e.label=`${e.cn}-${e.en}`,e)));let t=e[2].data;oe.options.size=t.map((e=>(e.value=e.size,e.label=e.size,e)))}))})(),oe.loading=!0;let e={page:oe.pagination.listQuery.page,limit:oe.pagination.listQuery.limit,...le.value,...te.value};e[e.value_type]=e.value,delete e.value_type,delete e.value,e=A(e);const a=await P(e);if(a){const{data:e}=a;oe.list=null==e?void 0:e.data,oe.pagination.total=Number(e.count)}oe.loading=!1};return o((()=>{})),n((()=>{re()})),(e,l)=>{const t=r("el-option"),s=r("el-select"),i=r("el-form-item"),o=r("el-input"),n=r("el-checkbox"),z=r("el-button"),U=r("el-form"),j=r("el-table-column"),$=r("el-image"),C=r("el-dialog"),Q=d("loading");return w(),u("div",null,[p("div",T,[c(U,{modelValue:_(oe).searchForm,"onUpdate:modelValue":l[6]||(l[6]=e=>_(oe).searchForm=e),inline:!0,class:"flex jc-between w100 ai-end"},{default:m((()=>[p("div",B,[g(" 选择适用商品 "),c(i,{label:""},{default:m((()=>[c(s,{modelValue:_(oe).searchForm.dsp_category_id,"onUpdate:modelValue":l[0]||(l[0]=e=>_(oe).searchForm.dsp_category_id=e),filterable:"",clearable:"",placeholder:"选择适用商品"},{default:m((()=>[(w(!0),u(V,null,x(_(oe).options.category,(e=>(w(),b(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),g(" 选择创意目标 "),c(i,{label:""},{default:m((()=>[c(s,{modelValue:_(oe).searchForm.creative_goals,"onUpdate:modelValue":l[1]||(l[1]=e=>_(oe).searchForm.creative_goals=e),filterable:"",clearable:"",placeholder:"选择创意目标"},{default:m((()=>[(w(!0),u(V,null,x(_(oe).options.creative_goals,(e=>(w(),b(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),g(" 所有审核状态 "),c(i,{label:""},{default:m((()=>[c(s,{modelValue:_(oe).searchForm.audit_status,"onUpdate:modelValue":l[2]||(l[2]=e=>_(oe).searchForm.audit_status=e),filterable:"",clearable:"",placeholder:"选择创意目标"},{default:m((()=>[(w(!0),u(V,null,x(_(oe).options.audit_status,(e=>(w(),b(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),g(" 输入 "),c(i,{label:""},{default:m((()=>[c(o,{modelValue:_(oe).searchForm.value,"onUpdate:modelValue":l[4]||(l[4]=e=>_(oe).searchForm.value=e),placeholder:"请输入",class:"input-with-select"},{prepend:m((()=>[c(s,{modelValue:_(oe).searchForm.value_type,"onUpdate:modelValue":l[3]||(l[3]=e=>_(oe).searchForm.value_type=e),placeholder:"",class:"search-input-select",style:{width:"120px"}},{default:m((()=>[(w(!0),u(V,null,x(_(oe).options.value_type,(e=>(w(),b(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),c(i,{label:""},{default:m((()=>[c(n,{modelValue:_(oe).searchForm.is_del,"onUpdate:modelValue":l[5]||(l[5]=e=>_(oe).searchForm.is_del=e),"true-label":"","false-label":"1",label:"包含已归档"},null,8,["modelValue"])])),_:1})]),p("div",E,[c(i,{class:"mr-0",style:{"margin-right":"0px"}},{default:m((()=>[p("div",K,[c(z,{type:"primary",onClick:re},{default:m((()=>[F(" 查询 ")])),_:1}),g(' <el-button type="primary" @click="handleExportSearch">导出</el-button> ')])])),_:1})])])),_:1},8,["modelValue"]),g(' <el-input placeholder="请输入内容" v-model="state.searchForm.data" class=\'search-input\'>\n        <el-button slot="append" icon="Search" @click=\'searchFun\'></el-button>\n      </el-input> '),p("div",L,[c(z,{type:"primary",onClick:de},{default:m((()=>[F("新建DPA模板")])),_:1})])]),g(" table "),v((w(),b(_(f),{ref_key:"multipleTableRef",ref:a,center:"",data:_(oe).list,class:"w100",border:"",onSelectionChange:ne},{default:m((()=>[c(j,{align:"center",type:"selection",width:"55"}),g(" 模板ID "),c(j,{sortable:"",prop:"id",label:"模板ID",align:"center"}),g(" 模板名称 "),c(j,{sortable:"",width:"120",prop:"name",label:"模板名称",align:"center"}),g(" 缩略图 "),c(j,{width:"120",prop:"url",label:"缩略图",align:"center"},{default:m((e=>[p("div",O,[c($,{class:"logo-img cp","z-index":9999,style:{width:"100px",height:"auto"},src:pe(e),"preview-src-list":[pe(e)],"initial-index":4,fit:"cover","preview-teleported":"true",onClick:a=>{return l=e.row.url,ie.preview_img=l,void(se.value=!0);var l}},null,8,["src","preview-src-list","onClick"])])])),_:1}),g(" 操作 "),c(j,{width:"200",label:"操作",align:"center"},{default:m((e=>[p("div",R,[c(z,{class:"cp",type:"primary",onClick:a=>(({row:e})=>{const{id:a}=e;ee({url:`/campaign/dpa/edit/${a}`,query:{type:"edit",campaign_type:e.type}})})(e)},{default:m((()=>[F("编辑")])),_:2},1032,["onClick"]),g(' <el-button\n              v-if="scope.row.is_del === 2"\n              class="cp"\n              type="default"\n              @click="editFn(scope)"\n            >查看</el-button> '),c(z,{class:"cp",type:"danger",onClick:a=>(async e=>{ae({text:`确认归档${e.row.name}？`,title:"归档操作",buttonText:"确认"},ue(e))})(e),disabled:2===e.row.is_del},{default:m((()=>[F("归档")])),_:2},1032,["onClick","disabled"])])])),_:1}),g(" 开关 "),g(' <el-table-column sortable\n        prop="status"\n        label="开关"\n        align="center"\n      >\n        <template #default="scope">\n          <el-switch\n            v-model="scope.row.status"\n            :active-value="1"\n            :inactive-value="2"\n            @click="changeStatus(scope)"\n          />\n        </template>\n      </el-table-column> '),g(" 审核状态 "),c(j,{sortable:"",prop:"audit_status",label:"审核状态",align:"center"},{default:m((e=>[p("span",null,k(_(I)(e.row.audit_status,_(oe).options.audit_status)),1)])),_:1}),g(" Feeds个数 "),c(j,{sortable:"",width:"120",prop:"feeds_num",label:"Feeds个数",align:"center"}),g(" 适配尺寸 "),c(j,{sortable:"",width:"120",prop:"size",label:"适配尺寸",align:"center"},{default:m((e=>[p("span",null,k(_(I)(e.row.size,_(oe).options.size)),1)])),_:1}),g(" 适用商品 "),c(j,{sortable:"",width:"120",prop:"dsp_category_id",label:"适用商品",align:"center"},{default:m((e=>[p("span",null,k(_(I)(e.row.dsp_category_id,_(oe).options.category)),1)])),_:1}),g(" 创意目标 "),c(j,{sortable:"",width:"120",prop:"creative_goals",label:"创意目标",align:"center"},{default:m((e=>[p("span",null,k(_(I)(e.row.creative_goals,_(oe).options.creative_goals)),1)])),_:1}),g(" 创建人 "),c(j,{sortable:"",width:"120",prop:"create_email",label:"创建人",align:"center"}),g(" 创建时间 "),c(j,{sortable:"",width:"160",prop:"create_time",label:"创建时间",align:"center"})])),_:1},8,["data"])),[[Q,_(oe).loading]]),g(" 分页 "),p("div",G,[v(c(D,{page:_(oe).pagination.listQuery.page,"onUpdate:page":l[7]||(l[7]=e=>_(oe).pagination.listQuery.page=e),limit:_(oe).pagination.listQuery.limit,"onUpdate:limit":l[8]||(l[8]=e=>_(oe).pagination.listQuery.limit=e),total:_(oe).pagination.total,"page-sizes":_(oe).pagination.pageSizes,onPagination:ce},null,8,["page","limit","total","page-sizes"]),[[y,_(oe).pagination.total]])]),g(" 预览 "),c(C,{modelValue:_(se),"onUpdate:modelValue":l[9]||(l[9]=e=>h(se)?se.value=e:null),title:"图片预览",width:"50%"},{default:m((()=>[p("div",H,[p("img",{src:_(ie).preview_img,alt:""},null,8,J)])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-6d63a1fe"]]);export{W as default};
